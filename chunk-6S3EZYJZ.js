import{A as I,B as x,C as O,D as V,E as m,F as H,G as S,J as z,K as U,M as te,N as ie,P,Q as oe,S as ne,T as se,Z as re,a as v,b,c as L,d as F,e as D,f as w,g as Q,h as Z,j as q,n as c,o as ee,p as C,q as g,r as $,s as A,t as M,u as E,v as k,w as u,x as d,y as _,z as K}from"./chunk-J4EZVFE3.js";var R=(t=>(t.RED="red",t.BLACK="black",t))(R||{});var J={board:[],currentPlayer:"red",selectedPiece:null,validMoves:[],gameOver:!1,winner:null,moveHistory:[],isInCheck:!1,isSelfInCheck:!1,isVsAI:!0,aiIsThinking:!1,aiThinkingText:""},N=class r{boardCache={kingPositions:new Map,piecesByColor:new Map,lastMoveCount:-1};moveCache=new Map;ORTHOGONAL_DIRECTIONS=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}];DIAGONAL_DIRECTIONS=[{dx:-1,dy:-1},{dx:1,dy:-1},{dx:-1,dy:1},{dx:1,dy:1}];initializeBoard(){let e=Array(10).fill(null).map(()=>Array(9).fill(null));return this.setupInitialPieces(e),e}setupInitialPieces(e){let t=["rook","horse","elephant","advisor","king","advisor","elephant","horse","rook"];t.forEach((o,n)=>{let s=this.generatePieceId(o,"red",n);e[9][n]=this.createPiece(s,o,"red",n,9)}),[...t].forEach((o,n)=>{let s=this.generatePieceId(o,"black",n);e[0][n]=this.createPiece(s,o,"black",n,0)}),[1,7].forEach((o,n)=>{e[7][o]=this.createPiece(`r-cannon-${n+1}`,"cannon","red",o,7),e[2][o]=this.createPiece(`b-cannon-${n+1}`,"cannon","black",o,2)});for(let o=0;o<9;o+=2)e[6][o]=this.createPiece(`r-soldier-${o}`,"soldier","red",o,6),e[3][o]=this.createPiece(`b-soldier-${o}`,"soldier","black",o,3)}generatePieceId(e,t,i){let o=t==="red"?"r":"b";return e==="king"?`${o}-king`:`${o}-${e}-${i<4?"1":"2"}`}createPiece(e,t,i,o,n){return{id:e,type:t,color:i,position:{x:o,y:n},isSelected:!1,hasMoved:!1}}initializeGameState(){return b(v({},J),{board:this.initializeBoard()})}isValidPosition(e,t){return e>=0&&e<9&&t>=0&&t<10}isInPalace(e,t,i){return i==="red"?e>=3&&e<=5&&t>=7&&t<=9:e>=3&&e<=5&&t>=0&&t<=2}isOnOwnSide(e,t){return t==="red"?e>=5:e<=4}wouldKingsFaceEachOther(e,t=0){this.updateBoardCache(e,t);let i=this.boardCache.kingPositions.get("red"),o=this.boardCache.kingPositions.get("black");return!i||!o||i.x!==o.x?!1:this.isPathClear(e,i,o)}isPathClear(e,t,i){let o=Math.min(t.y,i.y),n=Math.max(t.y,i.y);for(let s=o+1;s<n;s++)if(e[s][t.x]!==null)return!1;return!0}updateBoardCache(e,t){if(this.boardCache.lastMoveCount!==t){this.boardCache.kingPositions.clear(),this.boardCache.piecesByColor.clear(),this.boardCache.piecesByColor.set("red",[]),this.boardCache.piecesByColor.set("black",[]);for(let i=0;i<10;i++)for(let o=0;o<9;o++){let n=e[i][o];n&&(this.boardCache.piecesByColor.get(n.color).push(n),n.type==="king"&&this.boardCache.kingPositions.set(n.color,{x:o,y:i}))}this.boardCache.lastMoveCount=t}}clearCaches(){this.moveCache.clear(),this.boardCache.lastMoveCount=-1}getBoardHash(e){let t="";for(let i=0;i<10;i++)for(let o=0;o<9;o++){let n=e[i][o];t+=n?`${n.type}${n.color}${o}${i}`:"e"}return t}isValidMoveForPiece(e,t,i){if(!this.isValidPosition(e.x,e.y))return!1;let o=i[e.y][e.x];return!o||o.color!==t.color}getSlidingPieceMoves(e,t,i){let o=[],{x:n,y:s}=e.position;return i.forEach(a=>{for(let l=1;l<10;l++){let h=n+a.dx*l,f=s+a.dy*l;if(!this.isValidPosition(h,f))break;let p=t[f][h];if(p){p.color!==e.color&&o.push({x:h,y:f});break}else o.push({x:h,y:f})}}),o}getPossibleMoves(e,t){let i=`${e.id}-${e.position.x}-${e.position.y}-true`;if(this.moveCache.has(i))return this.moveCache.get(i);let o=this.calculatePieceMoves(e,t,!0);return this.moveCache.set(i,o),o}getPossibleMovesForCheck(e,t){let i=`${e.id}-${e.position.x}-${e.position.y}-false`;if(this.moveCache.has(i))return this.moveCache.get(i);let o=this.calculatePieceMoves(e,t,!1);return this.moveCache.set(i,o),o}calculatePieceMoves(e,t,i){switch(e.type){case"king":return this.getKingMoves(e,t,i);case"advisor":return this.getAdvisorMoves(e,t);case"elephant":return this.getElephantMoves(e,t);case"horse":return this.getHorseMoves(e,t);case"rook":return this.getRookMoves(e,t);case"cannon":return this.getCannonMoves(e,t);case"soldier":return this.getSoldierMoves(e,t);default:return[]}}getKingMoves(e,t,i){let{x:o,y:n}=e.position;return this.ORTHOGONAL_DIRECTIONS.map(a=>({x:o+a.dx,y:n+a.dy})).filter(a=>{if(!this.isValidPosition(a.x,a.y)||!this.isInPalace(a.x,a.y,e.color))return!1;let l=t[a.y][a.x];return l&&l.color===e.color?!1:!i||!this.wouldMoveCreateKingFacing(e,a,t)})}wouldMoveCreateKingFacing(e,t,i){let o=i[t.y][t.x],n=e.position;i[t.y][t.x]=e,i[n.y][n.x]=null,e.position=t;let s=this.wouldKingsFaceEachOther(i);return i[n.y][n.x]=e,i[t.y][t.x]=o,e.position=n,s}getAdvisorMoves(e,t){let{x:i,y:o}=e.position;return this.DIAGONAL_DIRECTIONS.map(s=>({x:i+s.dx,y:o+s.dy})).filter(s=>this.isValidPosition(s.x,s.y)&&this.isInPalace(s.x,s.y,e.color)&&this.isValidMoveForPiece(s,e,t))}getElephantMoves(e,t){let{x:i,y:o}=e.position;return[{x:i-2,y:o-2,block:{x:i-1,y:o-1}},{x:i+2,y:o-2,block:{x:i+1,y:o-1}},{x:i-2,y:o+2,block:{x:i-1,y:o+1}},{x:i+2,y:o+2,block:{x:i+1,y:o+1}}].filter(s=>this.isValidPosition(s.x,s.y)&&this.isOnOwnSide(s.y,e.color)&&!t[s.block.y][s.block.x]&&this.isValidMoveForPiece(s,e,t)).map(s=>({x:s.x,y:s.y}))}getHorseMoves(e,t){let{x:i,y:o}=e.position;return[{x:i-1,y:o-2,block:{x:i,y:o-1}},{x:i+1,y:o-2,block:{x:i,y:o-1}},{x:i-1,y:o+2,block:{x:i,y:o+1}},{x:i+1,y:o+2,block:{x:i,y:o+1}},{x:i-2,y:o-1,block:{x:i-1,y:o}},{x:i-2,y:o+1,block:{x:i-1,y:o}},{x:i+2,y:o-1,block:{x:i+1,y:o}},{x:i+2,y:o+1,block:{x:i+1,y:o}}].filter(s=>this.isValidPosition(s.x,s.y)&&!t[s.block.y][s.block.x]&&this.isValidMoveForPiece(s,e,t)).map(s=>({x:s.x,y:s.y}))}getRookMoves(e,t){return this.getSlidingPieceMoves(e,t,this.ORTHOGONAL_DIRECTIONS)}getCannonMoves(e,t){let i=[],{x:o,y:n}=e.position;return this.ORTHOGONAL_DIRECTIONS.forEach(s=>{let a=!1;for(let l=1;l<10;l++){let h=o+s.dx*l,f=n+s.dy*l;if(!this.isValidPosition(h,f))break;let p=t[f][h];if(p)if(!a)a=!0;else{p.color!==e.color&&i.push({x:h,y:f});break}else a||i.push({x:h,y:f})}}),i}getSoldierMoves(e,t){let i=[],{x:o,y:n}=e.position,s=e.color==="red"?-1:1,a={x:o,y:n+s};return this.isValidMoveForPiece(a,e,t)&&i.push(a),this.isOnOwnSide(n,e.color)||[{x:o-1,y:n},{x:o+1,y:n}].forEach(h=>{this.isValidMoveForPiece(h,e,t)&&i.push(h)}),i}isInCheck(e,t,i=0){this.updateBoardCache(e,i);let o=this.boardCache.kingPositions.get(t);if(!o)return!1;let n=t==="red"?"black":"red";return(this.boardCache.piecesByColor.get(n)||[]).some(a=>this.getPossibleMovesForCheck(a,e).some(h=>h.x===o.x&&h.y===o.y))}makeMove(e,t,i){let{board:o,moveHistory:n}=e,s=o[t.y][t.x];if(!s)return{success:!1};let a=o[i.y][i.x],l=n.length;if(this.clearCaches(),o[i.y][i.x]=s,o[t.y][t.x]=null,s.position=i,a&&a.type==="king")return s.hasMoved=!0,{success:!0,captured:a,isCheck:!1,gameOver:!0,winner:s.color};if(this.wouldKingsFaceEachOther(o,l+1))return s.hasMoved=!0,{success:!0,captured:a||void 0,isCheck:!1,gameOver:!0,winner:s.color==="red"?"black":"red"};let h=s.color==="red"?"black":"red",f=this.isInCheck(o,h,l+1),p=this.isInCheck(o,s.color,l+1);return s.hasMoved=!0,{success:!0,captured:a||void 0,isCheck:f,isSelfInCheck:p}}getPieceSymbol(e){return{king:{red:"\u5E25",black:"\u5C07"},advisor:{red:"\u4ED5",black:"\u58EB"},elephant:{red:"\u76F8",black:"\u8C61"},horse:{red:"\u99AC",black:"\u99AC"},rook:{red:"\u8ECA",black:"\u8ECA"},cannon:{red:"\u70AE",black:"\u7832"},soldier:{red:"\u5175",black:"\u5352"}}[e.type][e.color]}static \u0275fac=function(t){return new(t||r)};static \u0275prov=L({token:r,factory:r.\u0275fac,providedIn:"root"})};var B={king:1e4,rook:500,cannon:450,horse:400,elephant:200,advisor:200,soldier:100},fe=[[0,0,0,20,30,20,0,0,0],[0,0,0,10,20,10,0,0,0],[0,0,0,5,10,5,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,-5,-10,-5,0,0,0],[0,0,0,-10,-20,-10,0,0,0],[0,0,0,-20,-30,-20,0,0,0]],pe=[[40,50,50,55,60,55,50,50,40],[30,40,45,50,55,50,45,40,30],[20,30,35,40,45,40,35,30,20],[10,20,25,30,35,30,25,20,10],[5,15,20,25,30,25,20,15,5],[-5,-5,10,15,20,15,10,-5,-5],[-10,-10,0,5,10,5,0,-10,-10],[-15,-15,-5,0,5,0,-5,-15,-15],[-20,-20,-10,-5,0,-5,-10,-20,-20],[-25,-25,-15,-10,-5,-10,-15,-25,-25]],xe=[[30,35,40,45,50,45,40,35,30],[25,30,35,40,45,40,35,30,25],[20,25,30,35,40,35,30,25,20],[15,20,25,30,35,30,25,20,15],[10,15,20,25,30,25,20,15,10],[5,10,15,20,25,20,15,10,5],[0,5,10,15,20,15,10,5,0],[-5,0,5,10,15,10,5,0,-5],[-10,-5,0,5,10,5,0,-5,-10],[-15,-10,-5,0,5,0,-5,-10,-15]],ve=[[10,20,30,35,40,35,30,20,10],[15,25,35,40,45,40,35,25,15],[20,30,40,45,50,45,40,30,20],[25,35,45,50,55,50,45,35,25],[20,30,40,45,50,45,40,30,20],[15,25,35,40,45,40,35,25,15],[10,20,30,35,40,35,30,20,10],[5,15,25,30,35,30,25,15,5],[0,10,20,25,30,25,20,10,0],[-5,5,15,20,25,20,15,5,-5]],Ce=[[0,0,20,0,0,0,20,0,0],[0,0,0,0,0,0,0,0,0],[15,0,0,0,25,0,0,0,15],[0,0,0,0,0,0,0,0,0],[10,0,0,0,20,0,0,0,10],[0,0,0,0,0,0,0,0,0],[-10,0,0,0,-20,0,0,0,-10],[0,0,0,0,0,0,0,0,0],[-15,0,0,0,-25,0,0,0,-15],[0,0,-20,0,0,0,-20,0,0]],ge=[[0,0,0,20,0,20,0,0,0],[0,0,0,0,30,0,0,0,0],[0,0,0,15,0,15,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,-15,0,-15,0,0,0],[0,0,0,0,-30,0,0,0,0],[0,0,0,-20,0,-20,0,0,0]],be=[[15,20,25,30,35,30,25,20,15],[10,15,20,25,30,25,20,15,10],[8,12,16,20,25,20,16,12,8],[6,10,14,18,22,18,14,10,6],[5,8,12,16,20,16,12,8,5],[3,6,9,12,15,12,9,6,3],[2,4,6,8,10,8,6,4,2],[1,2,3,4,5,4,3,2,1],[0,1,2,3,4,3,2,1,0],[0,0,1,2,3,2,1,0,0]],T={king:fe,rook:pe,cannon:xe,horse:ve,elephant:Ce,advisor:ge,soldier:be};function le(r,e,t,i){let o=B[r];if(!T[r])return o;let n;if(i==="red"){let s=9-t;n=T[r][s][e]}else n=T[r][t][e];return o+n}function ce(r,e,t,i){if(!T[r])return 0;if(i==="red"){let o=9-t;return T[r][o][e]}else return T[r][t][e]}var ye={\u4E2D\u70AE:[{moves:["\u70AE\u4E8C\u5E73\u4E94","\u99AC\u516B\u9032\u4E03","\u99AC\u4E8C\u9032\u4E09","\u8ECA\u4E5D\u5E73\u516B","\u8ECA\u4E00\u5E73\u4E8C"],popularity:95,winRate:.52},{moves:["\u70AE\u4E8C\u5E73\u4E94","\u99AC\u516B\u9032\u4E03","\u99AC\u4E8C\u9032\u4E09","\u5352\u4E03\u9032\u4E00","\u8ECA\u4E00\u9032\u4E00"],popularity:85,winRate:.55},{moves:["\u70AE\u4E8C\u5E73\u4E94","\u99AC\u516B\u9032\u4E03","\u8ECA\u4E00\u5E73\u4E8C","\u8ECA\u4E5D\u5E73\u516B","\u99AC\u4E8C\u9032\u4E09"],popularity:80,winRate:.53}],\u4ED9\u4EBA\u6307\u8DEF:[{moves:["\u70AE\u516B\u5E73\u4E94","\u99AC\u516B\u9032\u4E03","\u99AC\u516B\u9032\u4E03","\u8ECA\u4E5D\u5E73\u516B"],popularity:70,winRate:.48}],\u98DB\u76F8:[{moves:["\u76F8\u4E09\u9032\u4E94","\u99AC\u516B\u9032\u4E03","\u99AC\u4E8C\u9032\u4E09","\u8ECA\u4E5D\u5E73\u516B"],popularity:65,winRate:.49}],\u5C4F\u98A8\u99AC:[{moves:["\u99AC\u4E8C\u9032\u4E09","\u5352\u4E03\u9032\u4E00","\u99AC\u516B\u9032\u4E03","\u99AC\u4E8C\u9032\u4E09","\u8ECA\u4E00\u5E73\u4E8C"],popularity:80,winRate:.51}],\u9806\u624B\u70AE:[{moves:["\u99AC\u4E8C\u9032\u4E09","\u99AC\u516B\u9032\u4E03","\u70AE\u4E8C\u5E73\u516D","\u8ECA\u4E5D\u5E73\u516B","\u5175\u4E09\u9032\u4E00"],popularity:75,winRate:.5}]},de={\u70AE\u4E8C\u5E73\u4E94:[{from:{x:1,y:0},to:{x:2,y:2},description:"\u99AC\u516B\u9032\u4E03"},{from:{x:7,y:0},to:{x:6,y:2},description:"\u99AC\u4E8C\u9032\u4E09"},{from:{x:0,y:3},to:{x:0,y:4},description:"\u5352\u4E00\u9032\u4E00"},{from:{x:2,y:3},to:{x:2,y:4},description:"\u5352\u4E09\u9032\u4E00"},{from:{x:1,y:7},to:{x:1,y:4},description:"\u70AE\u516B\u9032\u4E09"}],\u70AE\u516B\u5E73\u4E94:[{from:{x:1,y:0},to:{x:2,y:2},description:"\u99AC\u516B\u9032\u4E03"},{from:{x:7,y:0},to:{x:6,y:2},description:"\u99AC\u4E8C\u9032\u4E09"},{from:{x:4,y:3},to:{x:4,y:4},description:"\u5352\u4E94\u9032\u4E00"},{from:{x:1,y:7},to:{x:1,y:6},description:"\u70AE\u516B\u9032\u4E00"}],\u76F8\u4E09\u9032\u4E94:[{from:{x:1,y:0},to:{x:2,y:2},description:"\u99AC\u516B\u9032\u4E03"},{from:{x:7,y:0},to:{x:6,y:2},description:"\u99AC\u4E8C\u9032\u4E09"},{from:{x:1,y:7},to:{x:1,y:6},description:"\u70AE\u516B\u9032\u4E00"},{from:{x:7,y:7},to:{x:7,y:6},description:"\u70AE\u4E8C\u9032\u4E00"}],\u99AC\u4E8C\u9032\u4E09:[{from:{x:1,y:0},to:{x:2,y:2},description:"\u99AC\u516B\u9032\u4E03"},{from:{x:1,y:7},to:{x:1,y:6},description:"\u70AE\u516B\u9032\u4E00"},{from:{x:2,y:3},to:{x:2,y:4},description:"\u5352\u4E09\u9032\u4E00"},{from:{x:4,y:3},to:{x:4,y:4},description:"\u5352\u4E94\u9032\u4E00"}],\u70AE\u4E8C\u5E73\u516D:[{from:{x:7,y:7},to:{x:4,y:7},description:"\u70AE\u4E8C\u5E73\u4E94"},{from:{x:4,y:3},to:{x:4,y:4},description:"\u5352\u4E94\u9032\u4E00"},{from:{x:1,y:7},to:{x:1,y:5},description:"\u70AE\u516B\u9032\u4E8C"}],default:[{from:{x:1,y:0},to:{x:2,y:2},description:"\u99AC\u516B\u9032\u4E03"},{from:{x:7,y:0},to:{x:6,y:2},description:"\u99AC\u4E8C\u9032\u4E09"},{from:{x:2,y:0},to:{x:4,y:1},description:"\u8C61\u4E09\u9032\u4E94"},{from:{x:6,y:0},to:{x:4,y:1},description:"\u8C61\u4E03\u9032\u4E94"},{from:{x:0,y:3},to:{x:0,y:4},description:"\u5352\u4E00\u9032\u4E00"},{from:{x:2,y:3},to:{x:2,y:4},description:"\u5352\u4E09\u9032\u4E00"},{from:{x:4,y:3},to:{x:4,y:4},description:"\u5352\u4E94\u9032\u4E00"},{from:{x:6,y:3},to:{x:6,y:4},description:"\u5352\u4E03\u9032\u4E00"},{from:{x:8,y:3},to:{x:8,y:4},description:"\u5352\u4E5D\u9032\u4E00"}]},Pe={\u8ECA\u99AC\u8C61\u58EB\u5C07\u58EB\u8C61\u99AC\u8ECA_\u70AE_\u70AE_\u5175\u5175\u5175\u5175\u5175_\u5352\u5352\u5352\u5352\u5352_\u7832_\u7832_\u8ECA\u99AC\u8C61\u58EB\u5C07\u58EB\u8C61\u99AC\u8ECA:0,\u8ECA_\u8C61\u58EB\u5C07\u58EB\u8C61\u99AC\u8ECA_\u70AE_\u70AE\u99AC\u5175\u5175\u5175\u5175\u5175_\u5352\u5352\u5352\u5352\u5352_\u7832_\u7832_\u8ECA\u99AC\u8C61\u58EB\u5C07\u58EB\u8C61_\u8ECA:50,\u8ECA\u99AC\u8C61\u58EB\u5C07\u58EB\u8C61_\u8ECA_\u70AE_\u70AE\u99AC\u5175\u5175\u5175\u5175\u5175_\u5352\u5352\u5352\u5352_\u7832_\u7832_\u8ECA\u99AC\u8C61\u58EB\u5C07\u58EB\u8C61_\u8ECA\u5352:80};function W(r){if(r.length>=15)return null;for(let[e,t]of Object.entries(ye))for(let i of t){let o=Math.min(r.length,i.moves.length),n=!0;for(let s=0;s<o;s++)if(r[s]!==i.moves[s]){n=!1;break}if(n&&i.moves.length>r.length)return i.moves[r.length]}return null}function X(r,e,t){return console.log("\u9700\u8981\u5C07\u68CB\u8B5C\u8868\u793A\u6CD5\u8F49\u63DB\u70BA\u5177\u9AD4\u79FB\u52D5:",r),null}function _e(r){let e="";for(let t=0;t<10;t++)for(let i=0;i<9;i++){let o=r[t][i];if(!o)e+="_";else{let n="";switch(o.type){case"king":n=o.color==="red"?"\u5C07":"\u5E25";break;case"advisor":n=o.color==="red"?"\u58EB":"\u4ED5";break;case"elephant":n=o.color==="red"?"\u8C61":"\u76F8";break;case"horse":n="\u99AC";break;case"rook":n="\u8ECA";break;case"cannon":n=o.color==="red"?"\u70AE":"\u7832";break;case"soldier":n=o.color==="red"?"\u5175":"\u5352";break}e+=n}}return e}function ue(r){let e=_e(r);return Pe[e]||0}var j=class r{chessGameService=F(N);transpositionTable=new Map;maxSearchTime=3e3;searchStartTime=0;nodesSearched=0;maxDepth=4;OPENING_RESPONSES=de;makeAIMove(e){console.log("\u{1F916} AI\u958B\u59CB\u601D\u8003..."),this.searchStartTime=Date.now(),this.nodesSearched=0;try{if(e.moveHistory.length>0&&e.moveHistory.length<=20){let i=this.getHybridMove(e);if(i)return console.log("\u{1F916} \u4F7F\u7528\u6DF7\u5408\u7B56\u7565\u79FB\u52D5:",i),i}let t=null;for(let i=1;i<=this.maxDepth&&!(Date.now()-this.searchStartTime>this.maxSearchTime);i++){let o=this.minimax(e,i,-1/0,1/0,!0);o.bestMove&&(t=o.bestMove,console.log(`\u{1F916} \u6DF1\u5EA6 ${i}: \u5206\u6578 ${o.score}, \u79FB\u52D5 ${JSON.stringify(t)}`))}return console.log(`\u{1F916} \u641C\u5C0B\u5B8C\u6210: ${this.nodesSearched} \u500B\u7BC0\u9EDE, ${Date.now()-this.searchStartTime}ms`),t}catch(t){return console.error("\u{1F916} AI\u601D\u8003\u932F\u8AA4:",t),this.getSimpleMove(e)}}getHybridMove(e){console.log("\u{1F916} \u4F7F\u7528\u6DF7\u5408\u7B56\u7565\u5206\u6790...");let t=this.getOpeningCandidates(e),i=this.getMinimaxCandidates(e,2),o=this.mergeCandidates(t,i);if(o.length===0)return console.log("\u{1F916} \u6DF7\u5408\u7B56\u7565\u672A\u627E\u5230\u5019\u9078\u79FB\u52D5"),null;let n=o.map(a=>b(v({},a),{hybridScore:this.evaluateHybridMove(e,a)}));n.sort((a,l)=>l.hybridScore-a.hybridScore);let s=n[0];return console.log(`\u{1F916} \u6DF7\u5408\u7B56\u7565\u8A55\u4F30\u4E86 ${o.length} \u500B\u5019\u9078\uFF0C\u6700\u4F73\u5206\u6578: ${s.hybridScore}`),{from:s.from,to:s.to}}getOpeningCandidates(e){let t=[],i=e.board,o=e.moveHistory;if(o.length===0)return t;let n=W(o);if(n){let l=X(n,i,"black");l&&this.isSafeMove(e,l.from,l.to)&&t.push(l)}let s=o[o.length-1],a=this.OPENING_RESPONSES[s]||this.OPENING_RESPONSES.default;for(let l of a.slice(0,3)){let h=i[l.from.y][l.from.x];if(!h||h.color!=="black")continue;this.chessGameService.getPossibleMoves(h,i).some(y=>y.x===l.to.x&&y.y===l.to.y)&&this.isSafeMove(e,l.from,l.to)&&t.push({from:l.from,to:l.to})}return t}getMinimaxCandidates(e,t){let n=this.getAllPossibleMoves(e,"black").filter(s=>this.isSafeMove(e,s.from,s.to)).map(s=>b(v({},s),{score:this.quickEvaluateMove(e,s)}));return n.sort((s,a)=>a.score-s.score),n.slice(0,5).map(s=>({from:s.from,to:s.to}))}mergeCandidates(e,t){let i=[...e];for(let o of t)i.some(s=>s.from.x===o.from.x&&s.from.y===o.from.y&&s.to.x===o.to.x&&s.to.y===o.to.y)||i.push(o);return i}evaluateHybridMove(e,t){let i=e.moveHistory.length,o=Math.max(0,(20-i)/20),n=1-o,s=this.evaluateOpeningMove(e,t),a=this.evaluateMinimaxMove(e,t,3),l=s*o+a*n;return console.log(`\u{1F50D} \u79FB\u52D5 (${t.from.x},${t.from.y})->(${t.to.x},${t.to.y}): \u958B\u5C40${s.toFixed(1)}(${(o*100).toFixed(0)}%) + Minimax${a.toFixed(1)}(${(n*100).toFixed(0)}%) = ${l.toFixed(1)}`),l}evaluateOpeningMove(e,t){let i=0,o=e.board[t.from.y][t.from.x],n=e.board[t.to.y][t.to.x];if(!o)return i;(o.type==="horse"||o.type==="cannon")&&(i+=50);let s=Math.abs(t.to.x-4)+Math.abs(t.to.y-4.5);return i+=(9-s)*10,o.type==="rook"&&e.moveHistory.length<6&&(i-=30),(o.type==="advisor"||o.type==="elephant")&&(i+=20),n&&(i+=B[n.type]/10),i}evaluateMinimaxMove(e,t,i){let o=this.simulateMove(e,t.from,t.to);return this.minimax(o,i-1,-1/0,1/0,!1).score}quickEvaluateMove(e,t){let i=this.simulateMove(e,t.from,t.to);return this.evaluatePosition(i)}getOpeningMove(e){let t=e.board,i=e.moveHistory;if(i.length===0)return console.log("\u{1F916} \u904A\u6232\u525B\u958B\u59CB\uFF0C\u7B49\u5F85\u7D05\u65B9\u5148\u8D70"),null;let o=W(i);if(o){console.log("\u{1F916} \u5F9E\u68CB\u8B5C\u5EAB\u627E\u5230\u6700\u4F73\u61C9\u5C0D:",o);let a=X(o,t,"black");if(a&&this.isSafeMove(e,a.from,a.to))return a}let n=i[i.length-1];console.log("\u{1F916} \u5206\u6790\u7D05\u65B9\u8D70\u6CD5:",n);let s=this.OPENING_RESPONSES[n]||this.OPENING_RESPONSES.default;for(let a of s){let l=t[a.from.y][a.from.x];if(!l||l.color!=="black")continue;let f=this.chessGameService.getPossibleMoves(l,t).some(p=>p.x===a.to.x&&p.y===a.to.y);if(f&&this.isSafeMove(e,a.from,a.to))return console.log(`\u{1F916} \u9078\u64C7\u5B89\u5168\u56DE\u61C9\u8D70\u6CD5: ${a.description}`,a),a;f&&console.log(`\u26A0\uFE0F \u8DF3\u904E\u4E0D\u5B89\u5168\u7684\u79FB\u52D5: ${a.description}`,a)}return console.log("\u{1F916} \u6C92\u6709\u627E\u5230\u5B89\u5168\u7684\u56DE\u61C9\u8D70\u6CD5\uFF0C\u4F7F\u7528\u666E\u901A\u7B97\u6CD5"),null}evaluatePosition(e){if(e.gameOver)return e.winner==="black"?8e3:e.winner==="red"?-8e3:0;let t=0,i=e.board;return t+=ue(i)*.08,t+=this.evaluateSafety(i)*.5,t+=this.evaluateMaterial(i)*.3,t+=this.evaluatePositions(i)*.1,t+=this.evaluateMobility(e)*.02,t+=(Math.random()-.5)*2,t}minimax(e,t,i,o,n){if(this.nodesSearched++,Date.now()-this.searchStartTime>this.maxSearchTime)return{score:this.evaluatePosition(e)};if(t===0||e.gameOver)return{score:this.evaluatePosition(e)};let s=n?"black":"red",a=this.getAllPossibleMoves(e,s);if(a.length===0)return console.warn("\u26A0\uFE0F AI\u627E\u4E0D\u5230\u5408\u6CD5\u79FB\u52D5\uFF01\u76EE\u524D\u73A9\u5BB6:",n?"BLACK":"RED"),{score:n?-5e3:5e3};a.sort((h,f)=>{let p=this.getMoveOrderScore(h,e.board),y=this.getMoveOrderScore(f,e.board);return n?y-p:p-y});let l;if(n){let h=-1/0;for(let f of a){if(!this.isSafeMove(e,f.from,f.to))continue;let p=this.simulateMove(e,f.from,f.to),y=this.minimax(p,t-1,i,o,!1);if(y.score>h&&(h=y.score,l=f),i=Math.max(i,y.score),o<=i)break}return{score:h,bestMove:l}}else{let h=1/0;for(let f of a){let p=this.simulateMove(e,f.from,f.to),y=this.minimax(p,t-1,i,o,!0);if(y.score<h&&(h=y.score,l=f),o=Math.min(o,y.score),o<=i)break}return{score:h,bestMove:l}}}getAllPossibleMoves(e,t){let i=[],o=e.board;for(let n=0;n<10;n++)for(let s=0;s<9;s++){let a=o[n][s];if(a&&a.color===t){let l=this.chessGameService.getPossibleMoves(a,o);for(let h of l)i.push({from:a.position,to:h})}}return i.length===0?console.warn(`\u26A0\uFE0F \u6C92\u6709\u627E\u5230 ${t} \u7684\u4EFB\u4F55\u53EF\u80FD\u79FB\u52D5\uFF01`):console.log(`\u{1F3AF} \u627E\u5230 ${t} \u7684 ${i.length} \u500B\u53EF\u80FD\u79FB\u52D5`),i}isLegalMove(e,t,i){if(!e.board[t.y][t.x])return!1;try{let n=b(v({},e),{board:e.board.map(a=>a.map(l=>l?v({},l):null))}),s=this.chessGameService.makeMove(n,t,i);return s.success&&!s.isSelfInCheck}catch{return!1}}isSafeMove(e,t,i){let o=e.board[t.y][t.x];if(!o||o.color!=="black")return!1;try{let n=e.board.map(l=>l.map(h=>h?b(v({},h),{position:v({},h.position)}):null)),s=n[t.y][t.x];return s?(n[i.y][i.x]=s,n[t.y][t.x]=null,s.position={x:i.x,y:i.y},this.chessGameService.isInCheck(n,"black")?(console.log(`\u26A0\uFE0F \u5371\u96AA\u79FB\u52D5\u88AB\u963B\u6B62: ${o.type} \u5F9E (${t.x},${t.y}) \u5230 (${i.x},${i.y}) - \u6703\u88AB\u5C07\u8ECD`),!1):!0):!1}catch(n){return console.error("\u5B89\u5168\u6027\u6AA2\u67E5\u51FA\u932F:",n),!1}}simulateMove(e,t,i){let o=e.board.map(h=>h.map(f=>f?b(v({},f),{position:v({},f.position)}):null)),n=o[t.y][t.x];if(!n)return b(v({},e),{board:o});let s=o[i.y][i.x];o[i.y][i.x]=n,o[t.y][t.x]=null,n.position={x:i.x,y:i.y};let a=s?.type==="king"||this.chessGameService.wouldKingsFaceEachOther(o),l=e.currentPlayer==="red"?"black":"red";return b(v({},e),{board:o,currentPlayer:l,gameOver:a})}evaluateMaterial(e){let t=0;for(let i=0;i<10;i++)for(let o=0;o<9;o++){let n=e[i][o];if(n){let s=le(n.type,o,i,n.color);t+=n.color==="black"?s:-s}}return t}evaluatePositions(e){let t=0;for(let i=0;i<10;i++)for(let o=0;o<9;o++){let n=e[i][o];if(n){let s=ce(n.type,o,i,n.color);t+=n.color==="black"?s:-s}}return t}evaluateMobility(e){let t=this.getAllPossibleMoves(e,"black").length,i=this.getAllPossibleMoves(e,"red").length;return(t-i)*2}evaluateSafety(e){let t=0,i=this.chessGameService.isInCheck(e,"black"),o=this.chessGameService.isInCheck(e,"red");return i&&(t-=1e3,console.warn("\u26A0\uFE0F \u9ED1\u65B9\u88AB\u5C07\u8ECD\uFF01")),o&&(t+=500,console.log("\u2705 \u6210\u529F\u5C07\u8ECD\u7D05\u65B9")),t+=this.evaluateKingSafety(e,"black")*-1,t+=this.evaluateKingSafety(e,"red"),t}evaluateKingSafety(e,t){let i=0,o=null;for(let s=0;s<10;s++){for(let a=0;a<9;a++){let l=e[s][a];if(l&&l.type==="king"&&l.color===t){o={x:a,y:s};break}}if(o)break}if(!o)return 0;let n=t==="red"?"black":"red";for(let s=0;s<10;s++)for(let a=0;a<9;a++){let l=e[s][a];if(l&&l.color===n){let h=this.chessGameService.getPossibleMovesForCheck(l,e);for(let f of h)f.x===o.x&&f.y===o.y&&(i+=B[l.type]/100)}}return i}getMoveOrderScore(e,t){let i=0,o=t[e.from.y][e.from.x],n=t[e.to.y][e.to.x];if(!o)return i;if(n){let a=B[n.type]-B[o.type];i+=a*10}let s=Math.abs(e.to.x-4)+Math.abs(e.to.y-4.5);return i-=s,i}getSimpleMove(e){let t=this.getAllPossibleMoves(e,"black");if(console.log(`\u{1F3B2} \u7C21\u55AE\u7B56\u7565\u627E\u5230 ${t.length} \u500B\u79FB\u52D5`),t.length===0)return console.error("\u{1F6A8} \u9023\u7C21\u55AE\u7B56\u7565\u90FD\u627E\u4E0D\u5230\u4EFB\u4F55\u79FB\u52D5\uFF01"),null;let i=t.filter(a=>this.isSafeMove(e,a.from,a.to));if(console.log(`\u{1F6E1}\uFE0F \u5176\u4E2D ${i.length} \u500B\u662F\u5B89\u5168\u79FB\u52D5`),i.length===0){console.warn("\u26A0\uFE0F \u6C92\u6709\u5B89\u5168\u79FB\u52D5\uFF0C\u53EF\u80FD\u88AB\u56F0\uFF01\u5617\u8A66\u4EFB\u4F55\u79FB\u52D5...");let a=t[Math.floor(Math.random()*t.length)];return console.log("\u{1F3AF} \u88AB\u8FEB\u9078\u64C7\u79FB\u52D5:",a),a}let o=i.filter(a=>{let l=e.board[a.to.y][a.to.x];return l&&l.color==="red"}),n=o.length>0?o:i,s=n[Math.floor(Math.random()*n.length)];return console.log("\u{1F3AF} \u7C21\u55AE\u7B56\u7565\u9078\u64C7\u5B89\u5168\u79FB\u52D5:",s),s}setDifficulty(e){switch(e){case"easy":this.maxDepth=2,this.maxSearchTime=1e3;break;case"medium":this.maxDepth=4,this.maxSearchTime=3e3;break;case"hard":this.maxDepth=6,this.maxSearchTime=5e3;break}}getThinkingDescription(e){let t=e.moveHistory.length;return t===0?"\u{1F916} AI\u7B49\u5F85\u7D05\u65B9\u5148\u8D70...":t<=8&&t>0?"\u{1F916} AI\u6B63\u5728\u5206\u6790\u958B\u5C40\u7406\u8AD6\u8207\u6230\u8853\u7D50\u5408...":t<=20?"\u{1F916} AI\u6B63\u5728\u4F7F\u7528\u6DF7\u5408\u7B56\u7565\u5E03\u5C40...":t<40?"\u{1F916} AI\u6B63\u5728\u5236\u5B9A\u4E2D\u76E4\u6230\u7565...":"\u{1F916} AI\u6B63\u5728\u8A08\u7B97\u6B98\u5C40..."}static \u0275fac=function(t){return new(t||r)};static \u0275prov=L({token:r,factory:r.\u0275fac,providedIn:"root"})};var Se=()=>[0,1,2,3,4,5,6,7,8,9],Me=()=>[0,1,2,3,4,5,6,7,8],he=r=>({"valid-move-point":r});function Ee(r,e){r&1&&(u(0,"div",8),m(1," \u5C07\u8ECD\uFF01 "),d())}function ke(r,e){r&1&&(u(0,"div",9),m(1,"\u88AB\u5C07\u8ECD\uFF01"),d())}function Ie(r,e){if(r&1){let t=K();u(0,"div",11)(1,"div",47)(2,"span",48),m(3,"\u{1F916} AI\u96E3\u5EA6:"),d(),u(4,"button",49),I("click",function(){D(t);let o=x();return w(o.setAIDifficulty("easy"))}),m(5," \u7C21\u55AE "),d(),u(6,"button",49),I("click",function(){D(t);let o=x();return w(o.setAIDifficulty("medium"))}),m(7," \u4E2D\u7B49 "),d(),u(8,"button",49),I("click",function(){D(t);let o=x();return w(o.setAIDifficulty("hard"))}),m(9," \u56F0\u96E3 "),d()()()}if(r&2){let t=x();c(4),k("ngClass",t.aiDifficulty()==="easy"?"bg-green-600 text-white":"bg-neutral-700 text-neutral-300 hover:bg-neutral-600"),c(2),k("ngClass",t.aiDifficulty()==="medium"?"bg-yellow-600 text-white":"bg-neutral-700 text-neutral-300 hover:bg-neutral-600"),c(2),k("ngClass",t.aiDifficulty()==="hard"?"bg-red-600 text-white":"bg-neutral-700 text-neutral-300 hover:bg-neutral-600")}}function Oe(r,e){r&1&&(u(0,"span"),m(1,"\u{1F916}"),d())}function De(r,e){if(r&1&&(u(0,"div",19)(1,"div",50),m(2,"\u6700\u5F8C\u4E00\u6B65"),d(),u(3,"div",16),m(4),d()()),r&2){let t=x();c(4),S(" ",t.moveHistory()[t.moveHistory().length-1]," ")}}function we(r,e){r&1&&m(0," AI \u601D\u8003\u4E2D... ")}function Ae(r,e){if(r&1&&(u(0,"div",26),m(1),d()),r&2){let t=e.$implicit;c(),S(" ",t," ")}}function Re(r,e){if(r&1&&(u(0,"div",29),m(1),d()),r&2){let t=e.$implicit;c(),S(" ",t," ")}}function Ne(r,e){if(r&1&&_(0,"div",51)(1,"div",52),r&2){let t=e.$implicit;V(t===6?"z-20 h-[1.5px]":"z-10"),O("top",t*40+4,"px"),k("ngClass","sm:hidden"),c(),V(t===6?"z-20 h-[1.5px]":"z-10"),O("top",t*50+4,"px")}}function Te(r,e){if(r&1&&_(0,"div",53)(1,"div",53)(2,"div",54)(3,"div",54),r&2){let t=e.$implicit;O("left",t*36+14,"px")("top",4,"px")("height",157,"px"),c(),O("left",t*36+14,"px")("top",203,"px")("height",162,"px"),c(),O("left",t*50+4,"px")("top",4,"px")("height",200,"px"),c(),O("left",t*50+4,"px")("top",254,"px")("height",200,"px")}}function Be(r,e){r&1&&_(0,"div",56)}function Ge(r,e){r&1&&_(0,"div",56)}function Fe(r,e){if(r&1&&(u(0,"div",57)(1,"div",64),m(2),d()()),r&2){let t=x().$implicit,i=x(2);k("ngClass",i.getPieceClass(t)),c(),V(t.color===i.PlayerColor.RED?"bg-red-100 border-red-600 text-red-800":"bg-neutral-100 border-neutral-800 text-neutral-800"),c(),S(" ",i.getPieceSymbol(t)," ")}}function Ve(r,e){r&1&&_(0,"div",58)}function Le(r,e){r&1&&_(0,"div",59)}function $e(r,e){r&1&&_(0,"div",56)}function Ke(r,e){r&1&&_(0,"div",56)}function He(r,e){if(r&1&&(u(0,"div",61)(1,"div",65),m(2),d()()),r&2){let t=x().$implicit,i=x(2);k("ngClass",i.getPieceClass(t)),c(),V(t.color===i.PlayerColor.RED?"bg-red-100 border-red-600 text-red-800":"bg-neutral-100 border-neutral-800 text-neutral-800"),c(),S(" ",i.getPieceSymbol(t)," ")}}function je(r,e){r&1&&_(0,"div",62)}function qe(r,e){r&1&&_(0,"div",63)}function ze(r,e){if(r&1){let t=K();u(0,"div",55),I("click",function(){let o=D(t).$index,n=x().$index,s=x();return w(s.onSquareClick(o,n))}),C(1,Be,1,0,"div",56),C(2,Ge,1,0,"div",56),C(3,Fe,3,4,"div",57),C(4,Ve,1,0,"div",58),C(5,Le,1,0,"div",59),d(),u(6,"div",60),I("click",function(){let o=D(t).$index,n=x().$index,s=x();return w(s.onSquareClick(o,n))}),C(7,$e,1,0,"div",56),C(8,Ke,1,0,"div",56),C(9,He,3,4,"div",61),C(10,je,1,0,"div",62),C(11,qe,1,0,"div",63),d()}if(r&2){let t=e.$implicit,i=e.$index,o=x().$index,n=x();O("top",o*40+4,"px")("left",i*36+14,"px"),k("ngClass",U(20,he,n.isValidMove(i,o))),c(),g((o===2||o===7)&&(i===0||i===2||i===4||i===6||i===8)?1:-1),c(),g((o===3||o===6)&&(i===1||i===7)?2:-1),c(),g(t?3:-1),c(),g(n.isValidMove(i,o)&&!t?4:-1),c(),g(n.isValidMove(i,o)&&t&&t.color!==n.currentPlayer()?5:-1),c(),O("top",o*50+4,"px")("left",i*50+4,"px"),k("ngClass",U(22,he,n.isValidMove(i,o))),c(),g((o===2||o===7)&&(i===0||i===2||i===4||i===6||i===8)?7:-1),c(),g((o===3||o===6)&&(i===1||i===7)?8:-1),c(),g(t?9:-1),c(),g(n.isValidMove(i,o)&&!t?10:-1),c(),g(n.isValidMove(i,o)&&t&&t.color!==n.currentPlayer()?11:-1)}}function Ue(r,e){if(r&1&&M(0,ze,12,24,null,null,$),r&2){let t=e.$implicit;E(t)}}function Ye(r,e){if(r&1&&(u(0,"div",29),m(1),d()),r&2){let t=e.$implicit;c(),S(" ",t," ")}}function Je(r,e){if(r&1&&(u(0,"div",26),m(1),d()),r&2){let t=e.$implicit;c(),S(" ",t," ")}}function We(r,e){if(r&1){let t=K();u(0,"div",43)(1,"div",66)(2,"div",67),m(3,"\u{1F3C6}"),d(),u(4,"h2",68),m(5),d(),u(6,"button",69),I("click",function(){D(t);let o=x();return w(o.resetGame())}),m(7," \u91CD\u65B0\u958B\u59CB "),d()()()}if(r&2){let t=x();c(5),S(" ",t.winner()===t.PlayerColor.RED?"\u7D05\u65B9\u7372\u52DD\uFF01":"\u9ED1\u65B9\u7372\u52DD\uFF01"," ")}}function Xe(r,e){if(r&1&&(u(0,"span",76),m(1),d()),r&2){let t=x(2).$index,i=x(2);c(),H(i.moveHistory()[t+1])}}function Qe(r,e){if(r&1&&(u(0,"div",73)(1,"span",74),m(2),d(),u(3,"span",75),m(4),d(),C(5,Xe,2,1,"span",76),d()),r&2){let t=x(),i=t.$implicit,o=t.$index,n=x(2);c(2),S("",n.Math.floor(o/2)+1,"."),c(2),H(i),c(),g(n.moveHistory()[o+1]?5:-1)}}function Ze(r,e){if(r&1&&C(0,Qe,6,3,"div",73),r&2){let t=e.$index;g(t%2===0?0:-1)}}function et(r,e){if(r&1&&(u(0,"section",44)(1,"h3",70),m(2,"\u68CB\u8B5C\u8A18\u9304"),d(),u(3,"div",71)(4,"div",72),M(5,Ze,1,1,null,null,$),d()()()),r&2){let t=x();c(5),E(t.moveHistory())}}var me=class r{chessGameService=F(N);chessAIService=F(j);gameState=q(J);board=P(()=>this.gameState().board);currentPlayer=P(()=>this.gameState().currentPlayer);selectedPiece=P(()=>this.gameState().selectedPiece);validMoves=P(()=>this.gameState().validMoves);gameOver=P(()=>this.gameState().gameOver);winner=P(()=>this.gameState().winner);moveHistory=P(()=>this.gameState().moveHistory);isInCheck=P(()=>this.gameState().isInCheck);isSelfInCheck=P(()=>this.gameState().isSelfInCheck);currentPlayerDisplay=P(()=>this.currentPlayer()==="red"?"\u7D05\u65B9":"\u9ED1\u65B9");isVsAI=P(()=>this.gameState().isVsAI);aiIsThinking=P(()=>this.gameState().aiIsThinking);aiThinkingText=P(()=>this.gameState().aiThinkingText);aiDifficulty=q("medium");isAITurn=P(()=>this.isVsAI()&&this.currentPlayer()==="black"&&!this.gameOver());canInteract=P(()=>!this.isVsAI()||this.currentPlayer()==="red");PlayerColor=R;Math=Math;ngOnInit(){this.resetGame()}resetGame(){let e=this.chessGameService.initializeGameState();this.gameState.set(e)}onSquareClick(e,t){if(this.gameOver()||!this.canInteract())return;let i=this.gameState(),o=i.board[t][e];i.selectedPiece?o&&o.color===i.currentPlayer&&o!==i.selectedPiece?this.selectPiece(o):this.isValidMove(e,t)?this.makeMove(i.selectedPiece.position,{x:e,y:t}):this.deselectPiece():o&&o.color===i.currentPlayer&&this.selectPiece(o)}selectPiece(e){let t=this.gameState();t.board.flat().forEach(o=>{o&&(o.isSelected=!1)}),e.isSelected=!0;let i=this.chessGameService.getPossibleMoves(e,t.board);this.gameState.set(b(v({},t),{selectedPiece:e,validMoves:i}))}deselectPiece(){let e=this.gameState();e.selectedPiece&&(e.selectedPiece.isSelected=!1),this.gameState.set(b(v({},e),{selectedPiece:null,validMoves:[]}))}isValidMove(e,t){return this.validMoves().some(i=>i.x===e&&i.y===t)}makeMove(e,t){let i=this.gameState(),o=i.board[e.y][e.x];if(!o)return;let n=this.chessGameService.makeMove(i,e,t);if(n.success){let s=this.generateMoveNotation(o,e,t,n.captured),a=[...i.moveHistory,s],l=i.currentPlayer==="red"?"black":"red",h=n.isCheck||!1,f=n.isSelfInCheck||!1,p=n.isCheckmate||n.isStalemate||n.gameOver||!1,y=n.winner||(n.isCheckmate?i.currentPlayer:null);i.board.flat().forEach(G=>{G&&(G.isSelected=!1)}),this.gameState.set(b(v({},i),{currentPlayer:l,selectedPiece:null,validMoves:[],moveHistory:a,isInCheck:h,isSelfInCheck:f,gameOver:p,winner:y})),console.log("\u6AA2\u67E5AI\u89F8\u767C\u689D\u4EF6:",{gameOver:p,isVsAI:i.isVsAI,nextPlayer:l,shouldTrigger:!p&&i.isVsAI&&l==="black"}),!p&&i.isVsAI&&l==="black"&&(console.log("\u6E96\u5099\u89F8\u767CAI\u79FB\u52D5..."),this.triggerAIMove())}}generateMoveNotation(e,t,i,o){if(!e)return"";let n=this.chessGameService.getPieceSymbol(e),s=e.color==="red"?9-t.x:t.x+1,a=i.y-t.y,l="";return a===0?l="\u5E73"+(e.color==="red"?9-i.x:i.x+1):l=(e.color==="red"&&a<0||e.color==="black"&&a>0?"\u9032":"\u9000")+Math.abs(a),`${n}${s}${l}`}getSquareClass(e,t){let i="chess-square";return this.board()[t]?.[e]?.isSelected&&(i+=" selected"),this.isValidMove(e,t)&&(i+=" valid-move"),(this.chessGameService.isInPalace(e,t,"red")||this.chessGameService.isInPalace(e,t,"black"))&&(i+=" palace"),i}getPieceClass(e){if(!e)return"";let t=`chess-piece ${e.color}`;return e.isSelected&&(t+=" selected"),t}getPieceSymbol(e){return e?this.chessGameService.getPieceSymbol(e):""}getRowNumbers(){return Array.from({length:10},(e,t)=>10-t)}getColumnLetters(){return["a","b","c","d","e","f","g","h","i"]}toggleGameMode(){let e=this.gameState(),t=!e.isVsAI;this.gameState.set(b(v({},e),{isVsAI:t,aiIsThinking:!1})),t&&e.currentPlayer==="black"&&!e.gameOver&&this.triggerAIMove()}triggerAIMove(){let e=this.gameState();console.log("\u{1F916} \u89F8\u767CAI\u79FB\u52D5\uFF0C\u7576\u524D\u73A9\u5BB6:",e.currentPlayer),this.chessAIService.setDifficulty(this.aiDifficulty()),this.gameState.set(b(v({},e),{aiIsThinking:!0,aiThinkingText:this.chessAIService.getThinkingDescription(e)})),setTimeout(()=>{try{let t=this.chessAIService.makeAIMove(e);t?(console.log("\u{1F916} AI\u9078\u64C7\u79FB\u52D5:",t),this.makeAIMove(t.from,t.to)):(console.warn("\u{1F916} AI\u7121\u6CD5\u627E\u5230\u6709\u6548\u79FB\u52D5\uFF0CAI\u6295\u964D"),this.aiSurrender())}catch(t){console.error("\u{1F916} AI\u79FB\u52D5\u51FA\u932F:",t),this.aiSurrender()}},500)}makeAIMove(e,t){let i=this.gameState(),o=i.board[e.y][e.x];if(!o)return;let n=this.chessGameService.makeMove(i,e,t);if(n.success){let s=this.generateMoveNotation(o,e,t,n.captured),a=[...i.moveHistory,s],l="red",h=n.isCheck||!1,f=n.isSelfInCheck||!1,p=n.isCheckmate||n.isStalemate||n.gameOver||!1,y=n.winner||(n.isCheckmate?"black":null);i.board.flat().forEach(G=>{G&&(G.isSelected=!1)}),this.gameState.set(b(v({},i),{currentPlayer:l,selectedPiece:null,validMoves:[],moveHistory:a,isInCheck:h,isSelfInCheck:f,gameOver:p,winner:y,aiIsThinking:!1}))}}aiSurrender(){let e=this.gameState();console.log("\u{1F916} AI\u6295\u964D\uFF0C\u904A\u6232\u7D50\u675F"),this.gameState.set(b(v({},e),{gameOver:!0,winner:"red",aiIsThinking:!1,moveHistory:[...e.moveHistory,"\u{1F916} AI\u6295\u964D"]}))}setAIDifficulty(e){this.aiDifficulty.set(e),console.log("\u{1F916} AI\u96E3\u5EA6\u8A2D\u7F6E\u70BA:",e)}getAIDifficultyText(){switch(this.aiDifficulty()){case"easy":return"\u7C21\u55AE";case"medium":return"\u4E2D\u7B49";case"hard":return"\u56F0\u96E3";default:return"\u4E2D\u7B49"}}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=ee({type:r,selectors:[["app-chinese-chess"]],decls:88,vars:17,consts:[[1,"w-full","max-w-[95vw]","sm:max-w-sm","mx-auto","flex","flex-col","px-2","sm:px-0"],[1,"mb-2","flex","flex-col","gap-3","items-stretch"],[1,"flex","justify-between","items-center"],[1,"text-center","text-2xl","font-bold","tracking-wider","text-lime-400","drop-shadow"],["routerLink","/",1,"text-lime-600","text-sm"],[1,"flex","gap-2","justify-between"],[1,"h-12","w-1/3","touch-btn","rounded-md","bg-lime-700","border","border-lime-500","text-lime-50","font-semibold","text-base","shadow","hover:bg-lime-600","focus:outline-none","focus:ring-2","focus:ring-lime-300","drop-shadow-[0_0_5px_#22d3ee]",3,"click"],[1,"h-12","w-1/3","touch-btn","rounded-md","border","font-medium","shadow","bg-zinc-800"],[1,"text-3xl","text-center","text-amber-300","font-bold","leading-12","animate-pulse"],[1,"text-3xl","text-red-400","animate-pulse"],[1,"h-12","w-1/3","touch-btn","rounded-md","bg-cyan-700","border","border-cyan-500","text-cyan-50","font-semibold","text-base","shadow","hover:bg-cyan-600","focus:outline-none","focus:ring-2","focus:ring-cyan-300",3,"click"],[1,"flex","gap-2","justify-center"],[1,"flex","flex-col","gap-2"],[1,"flex","items-center","gap-1","flex-wrap","bg-white/10","rounded-md","p-2","border","border-white/20"],[1,"border","border-lime-400","bg-lime-400/20","px-2","py-1","text-lime-300","font-bold","hover:bg-lime-400/30","transition"],[1,"text-lime-400","text-xs"],[1,"text-center","text-xs"],[1,"border","px-2","py-1","font-bold",3,"ngClass"],[1,"text-xs"],[1,"border","border-amber-400","bg-amber-400/20","px-2","py-1","text-amber-300","font-bold"],[1,"w-full","text-center","text-sm","mt-2","h-4","bg-neutral-700/80","rounded","overflow-hidden","relative","animate-pulse","text-white"],[1,"flex","justify-center"],[1,"relative","inline-block"],[1,"chess-board","bg-amber-100","border-2","sm:border-4","border-amber-800","p-2","sm:p-6","relative"],[1,"flex","justify-center","mb-1","sm:mb-2"],[1,"grid","grid-cols-9","gap-0"],[1,"w-[36px]","sm:w-[50px]","text-center","text-xs","font-bold","text-amber-800"],[1,"flex"],[1,"flex","flex-col","justify-center","mr-1","sm:mr-2"],[1,"h-[40px]","sm:h-[50px]","flex","items-center","justify-center","text-xs","font-bold","text-amber-800","w-4","sm:w-6"],[1,"relative","w-[310px]","h-[360px]","sm:w-[408px]","sm:h-[450px]","bg-amber-100"],["viewBox","0 0 100 100",1,"absolute","top-0","left-[122px]","w-[72px]","h-[80px]","sm:hidden"],["x1","0","y1","0","x2","100","y2","100","stroke","#d97706","stroke-width","1"],["x1","100","y1","0","x2","0","y2","100","stroke","#d97706","stroke-width","1"],["viewBox","0 0 100 100",1,"absolute","bottom-0","left-[122px]","w-[72px]","h-[80px]","sm:hidden"],["viewBox","0 0 100 100",1,"absolute","top-0","left-[154px]","w-[100px]","h-[100px]","hidden","sm:block"],["viewBox","0 0 100 100",1,"absolute","bottom-0","left-[154px]","w-[100px]","h-[100px]","hidden","sm:block"],[1,"absolute","left-0","right-0","bg-amber-100","flex","items-center","justify-between","px-8","z-5","sm:hidden",2,"top","161px","height","40px"],[1,"text-amber-700","font-bold","text-xs","tracking-wider"],[1,"absolute","left-0","right-0","bg-amber-100","flex","items-center","justify-between","px-16","z-5","hidden","sm:flex",2,"top","204px","height","50px"],[1,"text-amber-700","font-bold","text-sm","tracking-wider"],[1,"flex","flex-col","justify-center","ml-1","sm:ml-2"],[1,"flex","justify-center","mt-1","sm:mt-2"],[1,"absolute","inset-0","bg-black/50","backdrop-blur-sm","flex","items-center","justify-center","z-50","rounded-lg"],[1,"mt-6"],[1,"mt-4","text-xs","text-amber-600","text-center"],[1,"mb-1"],[1,"flex","items-center","gap-2","bg-neutral-800/50","rounded-lg","p-2","border","border-neutral-600"],[1,"text-amber-300","text-sm","font-medium"],[1,"px-3","py-1","text-xs","rounded","transition-colors",3,"click","ngClass"],[1,"text-amber-400","text-xs"],[1,"absolute","left-0","right-0","h-[1px]","bg-amber-800",3,"ngClass"],[1,"absolute","left-0","right-0","h-[1px]","bg-amber-800","hidden","sm:block"],[1,"absolute","w-[1px]","bg-amber-800","sm:hidden"],[1,"absolute","w-[1px]","bg-amber-800","hidden","sm:block"],[1,"absolute","w-[20px]","h-[20px]","-translate-x-1/2","-translate-y-1/2","rounded-full","hover:bg-amber-200/30","cursor-pointer","z-20","sm:hidden",3,"click","ngClass"],[1,"absolute","w-[6px]","h-[6px]","bg-amber-800","rounded-full","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[32px]","h-[32px]",3,"ngClass"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-2","h-2","bg-green-500","rounded-full","opacity-70"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[34px]","h-[34px]","border-2","border-red-500","rounded-full"],[1,"absolute","w-[24px]","h-[24px]","-translate-x-1/2","-translate-y-1/2","rounded-full","hover:bg-amber-200/30","cursor-pointer","z-20","hidden","sm:block",3,"click","ngClass"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[40px]","h-[40px]",3,"ngClass"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-3","h-3","bg-green-500","rounded-full","opacity-70"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[42px]","h-[42px]","border-2","border-red-500","rounded-full"],[1,"w-8","h-8","rounded-full","border-2","flex","items-center","justify-center","text-sm","font-bold","shadow-lg"],[1,"w-10","h-10","rounded-full","border-2","flex","items-center","justify-center","text-lg","font-bold","shadow-lg"],[1,"bg-gradient-to-br","from-amber-600","to-amber-800","border-2","border-amber-400","rounded-lg","p-8","shadow-2xl","text-center"],[1,"text-3xl","mb-4"],[1,"text-2xl","font-bold","mb-4","text-amber-100"],[1,"bg-amber-400","hover:bg-amber-300","text-amber-900","font-bold","py-3","px-6","rounded-lg","transition-all","duration-200","transform","hover:scale-105","shadow-lg",3,"click"],[1,"text-lg","font-bold","text-amber-400","mb-3"],[1,"bg-neutral-900/70","border","border-neutral-700","rounded-md","p-4","max-h-32","overflow-y-auto"],[1,"grid","grid-cols-2","gap-2","text-sm"],[1,"flex","gap-2"],[1,"text-neutral-400"],[1,"text-red-400"],[1,"text-neutral-300"]],template:function(t,i){t&1&&(u(0,"div",0)(1,"header",1)(2,"div",2)(3,"h1",3),m(4," \u4E2D\u570B\u8C61\u68CB "),d(),u(5,"a",4),m(6,"HOME"),d()(),u(7,"div",5)(8,"button",6),I("click",function(){return i.toggleGameMode()}),m(9),d(),u(10,"div",7),C(11,Ee,2,0,"div",8),C(12,ke,2,0,"div",9),d(),u(13,"button",10),I("click",function(){return i.resetGame()}),m(14," \u91CD\u65B0\u958B\u59CB "),d()(),C(15,Ie,10,3,"div",11),u(16,"div",12)(17,"div",13)(18,"div",14)(19,"div",15),m(20,"\u7576\u524D\u5C0D\u6230"),d(),u(21,"div",16),m(22),d()(),u(23,"div",17)(24,"div",18),m(25,"\u7576\u524D\u56DE\u5408"),d(),u(26,"div",16),C(27,Oe,2,0,"span"),m(28),d()(),C(29,De,5,1,"div",19),u(30,"div",20),C(31,we,1,0),d()()()(),u(32,"main",21)(33,"div",22)(34,"div",23)(35,"div",24)(36,"div",25),M(37,Ae,2,1,"div",26,A),d()(),u(39,"div",27)(40,"div",28),M(41,Re,2,1,"div",29,A),d(),u(43,"div",30),M(44,Ne,2,9,null,null,A),M(46,Te,4,24,null,null,A),Q(),u(48,"svg",31),_(49,"line",32)(50,"line",33),d(),u(51,"svg",34),_(52,"line",32)(53,"line",33),d(),u(54,"svg",35),_(55,"line",32)(56,"line",33),d(),u(57,"svg",36),_(58,"line",32)(59,"line",33),d(),Z(),u(60,"div",37)(61,"span",38),m(62,"\u695A\u6CB3"),d(),u(63,"span",38),m(64,"\u6F22\u754C"),d()(),u(65,"div",39)(66,"span",40),m(67,"\u695A\u6CB3"),d(),u(68,"span",40),m(69,"\u6F22\u754C"),d()(),M(70,Ue,2,0,null,null,$),d(),u(72,"div",41),M(73,Ye,2,1,"div",29,A),d()(),u(75,"div",42)(76,"div",25),M(77,Je,2,1,"div",26,A),d()()(),C(79,We,8,1,"div",43),d()(),m(80),te(81,"json"),C(82,et,7,0,"section",44),u(83,"footer",45)(84,"p",46),m(85,"\u9EDE\u64CA\u9078\u64C7\u68CB\u5B50\uFF0C\u518D\u9EDE\u64CA\u76EE\u6A19\u4F4D\u7F6E\u79FB\u52D5"),d(),u(86,"p"),m(87,"\u7D05\u65B9\u5148\u884C\uFF0C\u5C07\u8ECD\u5C0D\u65B9\u5373\u7372\u52DD"),d()()()),t&2&&(c(9),S(" ",i.isVsAI()?"\u{1F465} \u5207\u63DB\u96D9\u4EBA":"\u{1F916} \u5207\u63DBAI"," "),c(2),g(i.isInCheck()?11:-1),c(),g(i.isSelfInCheck()&&!i.isInCheck()?12:-1),c(3),g(i.isVsAI()?15:-1),c(7),H(i.isVsAI()?"\u{1F916}":"\u{1F465}"),c(),k("ngClass",i.currentPlayer()===i.PlayerColor.RED?"bg-red-500/20 border-red-400 text-red-300":"bg-neutral-800/20 border-neutral-400 text-neutral-300"),c(4),g(i.isVsAI()&&i.currentPlayer()===i.PlayerColor.BLACK?27:-1),c(),S("",i.currentPlayerDisplay()," "),c(),g(i.moveHistory().length>0?29:-1),c(2),g(i.aiIsThinking()?31:-1),c(6),E(i.getColumnLetters()),c(4),E(i.getRowNumbers()),c(3),E(z(15,Se)),c(2),E(z(16,Me)),c(24),E(i.board()),c(3),E(i.getRowNumbers()),c(4),E(i.getColumnLetters()),c(2),g(i.gameOver()?79:-1),c(),S(" ",ie(81,13,i.moveHistory())," "),c(2),g(i.moveHistory().length>0?82:-1))},dependencies:[se,oe,re,ne],styles:['.chess-board[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fef3c7,#fed7aa);box-shadow:0 8px 32px #0000004d}.chess-square[_ngcontent-%COMP%]{position:relative;background:transparent;transition:all .2s ease}.chess-square[_ngcontent-%COMP%]:hover{background-color:#f59e0b1a}.chess-square.selected[_ngcontent-%COMP%]{background-color:#22c55e4d!important;border-color:#22c55e!important;box-shadow:inset 0 0 0 2px #22c55e}.chess-square.valid-move[_ngcontent-%COMP%]{background-color:#22c55e26!important}.chess-square.valid-move[_ngcontent-%COMP%]:after{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:12px;height:12px;background-color:#22c55e;border-radius:50%;opacity:.8}.chess-square.valid-move[_ngcontent-%COMP%]:hover:after{width:16px;height:16px;opacity:1}.chess-square.palace[_ngcontent-%COMP%]{background-color:#f59e0b0d}.chess-piece[_ngcontent-%COMP%]{transition:all .3s ease;z-index:10}.chess-piece.selected[_ngcontent-%COMP%]{transform:scale(1.1);filter:drop-shadow(0 0 8px rgba(34,197,94,.6))}.chess-piece.red[_ngcontent-%COMP%]   .piece-symbol[_ngcontent-%COMP%]{color:#dc2626;background:linear-gradient(135deg,#fecaca,#fee2e2);border-color:#dc2626}.chess-piece.black[_ngcontent-%COMP%]   .piece-symbol[_ngcontent-%COMP%]{color:#374151;background:linear-gradient(135deg,#f3f4f6,#e5e7eb);border-color:#374151}.chess-piece[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.move-history[_ngcontent-%COMP%]{scrollbar-width:thin;scrollbar-color:#6b7280 #1f2937}.move-history[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.move-history[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#1f2937;border-radius:3px}.move-history[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#6b7280;border-radius:3px}.move-history[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#9ca3af}@media (max-width: 640px){.chess-board[_ngcontent-%COMP%]{padding:1rem}.chess-board[_ngcontent-%COMP%]   .chess-square[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem}.chess-board[_ngcontent-%COMP%]   .chess-piece[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:2rem;height:2rem;font-size:.875rem}}@keyframes _ngcontent-%COMP%_piece-capture{0%{transform:scale(1);opacity:1}50%{transform:scale(1.3);opacity:.7}to{transform:scale(0);opacity:0}}.captured[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_piece-capture .5s ease-out forwards}@keyframes _ngcontent-%COMP%_check-warning{0%,to{box-shadow:0 0 #ef4444b3}50%{box-shadow:0 0 0 10px #ef444400}}.in-check[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_check-warning 1s infinite}.valid-move-point.valid-move[_ngcontent-%COMP%]:after{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:10px;height:10px;background-color:#22c55e;border-radius:50%;opacity:.7}.valid-move-point[_ngcontent-%COMP%]:hover{background-color:#f59e0b33}']})};export{me as ChineseChess};
