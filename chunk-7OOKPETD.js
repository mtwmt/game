import{$a as C,Ab as N,Bb as $,Cb as O,Da as z,Gb as j,M as w,Qa as v,R as E,Ra as b,Sa as I,Ua as S,Va as P,W as y,Wa as D,X as T,Xa as c,Ya as s,Za as V,_a as _,ab as x,ca as f,cb as m,db as g,eb as M,gb as L,la as k,sa as p}from"./chunk-VPIITZIC.js";var F=class o{findPath(e,t,i,n,r){return this.tryDirectPath(e,t,i,n,r)||this.tryLShapePath(e,t,i,n,r)||this.tryBoundaryPath(e,t,i,n,r)}tryDirectPath(e,t,i,n,r){return e.y===t.y&&this.isPathClear(e,t,"horizontal",i,n,r)?[{start:e,end:t,direction:"horizontal"}]:e.x===t.x&&this.isPathClear(e,t,"vertical",i,n,r)?[{start:e,end:t,direction:"vertical"}]:null}tryLShapePath(e,t,i,n,r){let a={x:e.x,y:t.y};if(this.isValidPosition(a,i,n,r)&&this.isPathClear(e,a,"vertical",i,n,r)&&this.isPathClear(a,t,"horizontal",i,n,r))return[{start:e,end:a,direction:"vertical"},{start:a,end:t,direction:"horizontal"}];let l={x:t.x,y:e.y};return this.isValidPosition(l,i,n,r)&&this.isPathClear(e,l,"horizontal",i,n,r)&&this.isPathClear(l,t,"vertical",i,n,r)?[{start:e,end:l,direction:"horizontal"},{start:l,end:t,direction:"vertical"}]:null}tryBoundaryPath(e,t,i,n,r){let a=[{y:-1,name:"top"},{y:r,name:"bottom"},{x:-1,name:"left"},{x:n,name:"right"}];for(let l of a){let d=this.tryBoundaryRoute(e,t,l,i,n,r);if(d)return d}return null}tryBoundaryRoute(e,t,i,n,r,a){if("y"in i){let l={x:e.x,y:i.y},d={x:t.x,y:i.y};if(this.isPathClear(e,l,"vertical",n,r,a)&&this.isPathClear(l,d,"horizontal",n,r,a)&&this.isPathClear(d,t,"vertical",n,r,a))return[{start:e,end:l,direction:"vertical"},{start:l,end:d,direction:"horizontal"},{start:d,end:t,direction:"vertical"}]}else{let l={x:i.x,y:e.y},d={x:i.x,y:t.y};if(this.isPathClear(e,l,"horizontal",n,r,a)&&this.isPathClear(l,d,"vertical",n,r,a)&&this.isPathClear(d,t,"horizontal",n,r,a))return[{start:e,end:l,direction:"horizontal"},{start:l,end:d,direction:"vertical"},{start:d,end:t,direction:"horizontal"}]}return null}isPathClear(e,t,i,n,r,a){if(i==="horizontal"){if(e.y!==t.y)return!1;let l=Math.min(e.x,t.x),d=Math.max(e.x,t.x);return this.checkLineEmpty(l+1,d,e.y,"horizontal",n,r,a)}else{if(e.x!==t.x)return!1;let l=Math.min(e.y,t.y),d=Math.max(e.y,t.y);return this.checkLineEmpty(l+1,d,e.x,"vertical",n,r,a)}}checkLineEmpty(e,t,i,n,r,a,l){for(let d=e;d<t;d++){let u=n==="horizontal"?d:i,h=n==="horizontal"?i:d;if(u>=0&&u<a&&h>=0&&h<l&&r[h][u])return!1}return!0}isValidPosition(e,t,i,n){return e.x<0||e.x>=i||e.y<0||e.y>=n?!0:!t[e.y][e.x]}static \u0275fac=function(t){return new(t||o)};static \u0275prov=w({token:o,factory:o.\u0275fac,providedIn:"root"})};var B=class o{initializeBoard(e,t,i){let n=[],r=0,a=e*t,l=[];for(let u=0;u<a/2;u++){let h=u%i;l.push(h,h)}for(let u=l.length-1;u>0;u--){let h=Math.floor(Math.random()*(u+1));[l[u],l[h]]=[l[h],l[u]]}let d=0;for(let u=0;u<t;u++){n[u]=[];for(let h=0;h<e;h++)d<l.length?n[u][h]={id:r++,petType:l[d++],position:{x:h,y:u},selected:!1}:n[u][h]=null}return n}removeTiles(e,t,i){e[t.position.y][t.position.x]=null,e[i.position.y][i.position.x]=null}collapseBoard(e,t,i){for(let n=0;n<t;n++){let r=[];for(let a=i-1;a>=0;a--)e[a][n]&&r.unshift(e[a][n]);for(let a=0;a<i;a++)if(a<i-r.length)e[a][n]=null;else{let l=r[a-(i-r.length)];l&&(l.position={x:n,y:a},e[a][n]=l)}}}getRemainingTileCount(e){return e.flat().filter(t=>t!==null).length}isGameComplete(e){return this.getRemainingTileCount(e)===0}hasValidMoves(e,t,i,n){for(let r=0;r<i;r++)for(let a=0;a<t;a++){let l=e[r][a];if(l)for(let d=0;d<i;d++)for(let u=0;u<t;u++){let h=e[d][u];if(!(!h||l.id===h.id||l.petType!==h.petType)&&n.findPath(l.position,h.position,e,t,i))return!0}}return!1}getElapsedTime(e){return Math.floor((Date.now()-e)/1e3)}formatTime(e){let t=Math.floor(e/60),i=e%60;return`${t.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`}static \u0275fac=function(t){return new(t||o)};static \u0275prov=w({token:o,factory:o.\u0275fac,providedIn:"root"})};var R=o=>({"grid-template-columns":o}),U=(o,e)=>(e==null?null:e.id)||o,X=(o,e)=>e.id;function Y(o,e){if(o&1){let t=_();c(0,"button",30),C("click",function(){y(t);let n=x();return T(n.nextLevel())}),m(1," \u4E0B\u4E00\u95DC "),s()}}function J(o,e){if(o&1){let t=_();c(0,"button",31),C("click",function(){y(t);let n=x();return T(n.resetGame())}),m(1," \u91CD\u65B0\u958B\u59CB "),s()}}function q(o,e){if(o&1){let t=_();c(0,"button",32),C("click",function(){y(t);let n=x();return T(n.resetGame())}),m(1," \u65B0\u904A\u6232 "),s()}}function K(o,e){if(o&1&&(c(0,"div",18)(1,"div",33),m(2,"\u904A\u6232\u7D50\u675F"),s(),c(3,"div",34),m(4),s()()),o&2){let t=x();p(4),g(t.score()===0?"\u518D\u8A66\u4E00\u6B21\uFF01":"\u606D\u559C\u5B8C\u6210\uFF01")}}function Q(o,e){if(o&1&&(c(0,"span",37),m(1),s()),o&2){let t=x().$implicit,i=x(2);p(),g(i.petEmojis[t.petType])}}function Z(o,e){if(o&1){let t=_();c(0,"div",36),C("click",function(){let n=y(t).$implicit,r=x(2);return T(r.onTileClick(n))}),v(1,Q,2,1,"span",37),s()}if(o&2){let t=e.$implicit,i=x(2);D("ngClass",i.getTileClass(t)),p(),b(t?1:-1)}}function W(o,e){if(o&1&&S(0,Z,2,2,"div",35,U),o&2){let t=e.$implicit;P(t)}}function H(o,e){if(o&1&&V(0,"div",38),o&2){let t=e.$implicit,i=x(2);D("ngStyle",i.getPathStyle(t))}}function ee(o,e){if(o&1&&(c(0,"div",22),S(1,H,1,1,"div",38,I),s()),o&2){let t=x();p(),P(t.matchPath())}}function te(o,e){if(o&1){let t=_();c(0,"div",23)(1,"div",39)(2,"div",40),m(3,"\u{1F389}"),s(),c(4,"h2",41),m(5),s(),c(6,"div",42)(7,"div",43)(8,"div",44),m(9,"\u79FB\u52D5\u6B21\u6578"),s(),c(10,"div",45),m(11),s()(),c(12,"div",43)(13,"div",44),m(14,"\u5B8C\u6210\u6642\u9593"),s(),c(15,"div",45),m(16),s()()(),c(17,"div",46)(18,"div",44),m(19,"\u7E3D\u5206\u6578"),s(),c(20,"div",47),m(21),s()(),c(22,"button",48),C("click",function(){y(t);let n=x();return T(n.nextLevel())}),m(23," \u4E0B\u4E00\u95DC \u2192 "),s()()()}if(o&2){let t=x();p(5),M("\u95DC\u5361 ",t.level()," \u5B8C\u6210\uFF01"),p(6),g(t.moves()),p(5),g(t.formattedTime()),p(5),g(t.score())}}function ie(o,e){o&1&&(c(0,"p",27),m(1,"\u7B2C\u4E00\u95DC\uFF1A\u6D88\u9664\u5F8C\u7A7A\u767D\u4E0D\u6703\u88DC\u4F4D"),s())}function ne(o,e){if(o&1&&(c(0,"p",28),m(1),s()),o&2){let t=x();p(),M("\u7B2C",t.level(),"\u95DC\uFF1A\u6D88\u9664\u5F8C\u7A7A\u767D\u6703\u5F80\u4E0B\u88DC\u4F4D\uFF01")}}function oe(o,e){if(o&1&&(c(0,"div",52),m(1),s()),o&2){let t=e.$implicit,i=x(2);p(),M(" ",i.petEmojis[t.petType]," ")}}function re(o,e){if(o&1&&(c(0,"div",29)(1,"div",49)(2,"div",50),m(3,"\u5DF2\u9078\u64C7:"),s(),c(4,"div",51),S(5,oe,2,1,"div",52,X),s()()()),o&2){let t=x();p(5),P(t.selectedTiles())}}var G=class o{pathfindingService=E(F);gameLogicService=E(B);platformId=E(k);isBrowser=j(this.platformId);boardWidth=6;boardHeight=8;petTypes=12;board=f([]);selectedTiles=f([]);score=f(0);level=f(1);gameOver=f(!1);levelComplete=f(!1);matchPath=f([]);showPath=f(!1);moves=f(0);gameTime=f(0);remainingTiles=f(0);formattedTime=f("00:00");animationTimeout;gameStartTime=0;timeUpdateInterval;petEmojis=["\u{1F436}","\u{1F431}","\u{1F42D}","\u{1F439}","\u{1F430}","\u{1F98A}","\u{1F43B}","\u{1F43C}","\u{1F437}","\u{1F438}","\u{1F435}","\u{1F98B}"];ngOnInit(){this.initializeBoard()}ngOnDestroy(){this.animationTimeout&&clearTimeout(this.animationTimeout),this.timeUpdateInterval&&clearInterval(this.timeUpdateInterval)}initializeBoard(){let e=this.gameLogicService.initializeBoard(this.boardWidth,this.boardHeight,this.petTypes);this.board.set(e),this.updateGameStats(),this.startTimer()}startTimer(){this.isBrowser&&(this.gameStartTime=Date.now(),this.timeUpdateInterval=setInterval(()=>{let e=this.gameLogicService.getElapsedTime(this.gameStartTime);this.gameTime.set(e),this.formattedTime.set(this.gameLogicService.formatTime(e))},1e3))}updateGameStats(){let e=this.gameLogicService.getRemainingTileCount(this.board());this.remainingTiles.set(e)}onTileClick(e){if(!e||this.gameOver()||this.showPath())return;let t=this.selectedTiles();if(e.selected){e.selected=!1,this.selectedTiles.set(t.filter(n=>n.id!==e.id));return}t.length>=2&&this.clearSelection(),e.selected=!0;let i=[...t,e];this.selectedTiles.set(i),i.length===2&&this.checkMatch(i[0],i[1])}checkMatch(e,t){if(e.petType!==t.petType){this.isBrowser?setTimeout(()=>this.clearSelection(),500):this.clearSelection();return}this.moves.update(n=>n+1);let i=this.pathfindingService.findPath(e.position,t.position,this.board(),this.boardWidth,this.boardHeight);if(i){this.matchPath.set(i),this.showPath.set(!0);let n=()=>{let r=this.board();this.gameLogicService.removeTiles(r,e,t),this.level()>=2&&this.gameLogicService.collapseBoard(r,this.boardWidth,this.boardHeight),this.board.set([...r]),this.score.update(a=>a+10),this.showPath.set(!1),this.matchPath.set([]),this.clearSelection(),this.updateGameStats(),this.checkGameOver()};this.isBrowser?this.animationTimeout=setTimeout(n,800):n()}else this.isBrowser?setTimeout(()=>this.clearSelection(),500):this.clearSelection()}clearSelection(){this.selectedTiles().forEach(t=>t.selected=!1),this.selectedTiles.set([])}checkGameOver(){let e=this.board();if(this.gameLogicService.isGameComplete(e)){this.levelComplete.set(!0),this.stopTimer();return}this.gameLogicService.hasValidMoves(e,this.boardWidth,this.boardHeight,this.pathfindingService)||(this.gameOver.set(!0),this.stopTimer())}stopTimer(){this.timeUpdateInterval&&(clearInterval(this.timeUpdateInterval),this.timeUpdateInterval=void 0)}nextLevel(){this.level.update(e=>e+1),this.levelComplete.set(!1),this.clearSelection(),this.showPath.set(!1),this.matchPath.set([]),this.stopTimer(),this.animationTimeout&&clearTimeout(this.animationTimeout),this.initializeBoard()}resetGame(){this.score.set(0),this.level.set(1),this.moves.set(0),this.gameTime.set(0),this.formattedTime.set("00:00"),this.gameOver.set(!1),this.levelComplete.set(!1),this.clearSelection(),this.showPath.set(!1),this.matchPath.set([]),this.stopTimer(),this.animationTimeout&&clearTimeout(this.animationTimeout),this.initializeBoard()}getTileClass(e){if(!e)return"bg-stone-800 border border-stone-700";let t="bg-gradient-to-br border-2 cursor-pointer flex items-center justify-center text-2xl";if(e.selected)return`${t} from-yellow-400 to-yellow-600 border-yellow-300 brightness-125`;let i=["from-blue-400 to-blue-600 border-blue-300","from-pink-400 to-pink-600 border-pink-300","from-gray-400 to-gray-600 border-gray-300","from-yellow-400 to-yellow-600 border-yellow-300","from-purple-400 to-purple-600 border-purple-300","from-orange-400 to-orange-600 border-orange-300","from-amber-600 to-amber-800 border-amber-400","from-slate-400 to-slate-600 border-slate-300","from-rose-400 to-rose-600 border-rose-300","from-green-400 to-green-600 border-green-300","from-teal-400 to-teal-600 border-teal-300","from-violet-400 to-violet-600 border-violet-300"];return`${t} ${i[e.petType]||i[0]}`}getPathStyle(e){let n=e.start.x*50,r=e.start.y*50,a=e.end.x*50,l=e.end.y*50;if(e.direction==="horizontal"){let d=Math.min(n,a)+24,u=Math.abs(a-n),h=r+48/2-1;return{position:"absolute",left:`${d}px`,top:`${h}px`,width:`${u}px`,height:"2px",background:"linear-gradient(90deg, #fbbf24, #f59e0b)",boxShadow:"0 0 8px #fbbf24, 0 0 8px #f59e0b",zIndex:10}}else{let d=Math.min(r,l)+24,u=Math.abs(l-r);return{position:"absolute",left:`${n+48/2-1}px`,top:`${d}px`,width:"2px",height:`${u}px`,background:"linear-gradient(180deg, #fbbf24, #f59e0b)",boxShadow:"0 0 8px #fbbf24, 0 0 16px #f59e0b",zIndex:10}}}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=z({type:o,selectors:[["app-pet-match"]],decls:51,vars:15,consts:[[1,"relative","p-2","h-full"],[1,"text-center"],[1,"flex","justify-between","items-center"],[1,"text-lime-400","text-3xl","font-bold","leading-none"],[1,"border","border-green-800","bg-green-900","p-2","text-green-400","font-bold","hover:bg-green-400/30","transition","mr-2"],[1,"border","border-cyan-800","bg-cyan-900","p-2","text-cyan-400","font-bold","hover:bg-cyan-400/30","transition"],[1,"border","border-yellow-800","bg-yellow-900","p-2","text-yellow-400","font-bold","hover:bg-yellow-300/30","transition"],[1,"flex","justify-center","gap-3","text-white","my-4","flex-wrap"],[1,"border","border-cyan-400","bg-cyan-400/20","px-3","py-2","text-cyan-300","font-bold","hover:bg-cyan-400/30","transition"],[1,"text-cyan-400","text-lg","leading-none"],[1,"border","border-lime-400","bg-lime-400/20","px-3","py-2","text-lime-300","font-bold","hover:bg-lime-400/30","transition"],[1,"text-lime-400","text-lg","leading-none"],[1,"border","border-yellow-400","bg-yellow-400/20","px-3","py-2","text-yellow-300","font-bold","hover:bg-yellow-400/30","transition"],[1,"text-yellow-400","text-lg","leading-none"],[1,"border","border-purple-400","bg-purple-400/20","px-3","py-2","text-purple-300","font-bold","hover:bg-purple-400/30","transition"],[1,"text-purple-400","text-lg","leading-none"],[1,"border","border-orange-400","bg-orange-400/20","px-3","py-2","text-orange-300","font-bold","hover:bg-orange-400/30","transition"],[1,"text-orange-400","text-lg","leading-none"],[1,"border","border-fuchsia-400","bg-fuchsia-400/20","px-3","py-2","text-fuchsia-300","font-bold"],[1,"flex","justify-center"],[1,"relative","inline-block"],[1,"inline-grid","gap-[2px]","p-4","border-2","border-lime-700","rounded-lg",3,"ngStyle"],[1,"absolute","inset-0","pointer-events-none"],[1,"absolute","inset-0","bg-black/50","backdrop-blur-sm","flex","items-center","justify-center","z-50","rounded-lg"],[1,"mt-6","text-center","text-stone-400","text-sm","max-w-md","mx-auto"],[1,"mb-2"],[1,"text-xs"],[1,"text-xs","text-yellow-400","mt-1"],[1,"text-xs","text-orange-400","mt-1"],[1,"fixed","bottom-4","left-1/2","transform","-translate-x-1/2","z-50"],[1,"border","border-green-800","bg-green-900","p-2","text-green-400","font-bold","hover:bg-green-400/30","transition","mr-2",3,"click"],[1,"border","border-cyan-800","bg-cyan-900","p-2","text-cyan-400","font-bold","hover:bg-cyan-400/30","transition",3,"click"],[1,"border","border-yellow-800","bg-yellow-900","p-2","text-yellow-400","font-bold","hover:bg-yellow-300/30","transition",3,"click"],[1,"text-fuchsia-400","text-lg","leading-none"],[1,"text-sm"],[1,"w-12","h-12","rounded-lg","relative",3,"ngClass"],[1,"w-12","h-12","rounded-lg","relative",3,"click","ngClass"],[1,"select-none","pointer-events-none"],[1,"absolute","animate-pulse","transition-all","duration-300",3,"ngStyle"],[1,"bg-gradient-to-br","from-green-600","to-green-800","border-2","border-green-400","rounded-xl","p-8","shadow-2xl","shadow-green-400/50","text-center","animate-pulse"],[1,"text-green-200","text-3xl","mb-4"],[1,"text-green-100","text-2xl","font-bold","mb-4"],[1,"grid","grid-cols-2","gap-4","mb-6","text-sm"],[1,"bg-green-700/50","rounded-lg","p-3"],[1,"text-green-200"],[1,"text-green-100","font-bold","text-xl"],[1,"bg-green-700/50","rounded-lg","p-3","mb-6"],[1,"text-green-100","font-bold","text-2xl"],[1,"bg-green-500","hover:bg-green-400","text-green-900","font-bold","py-3","px-6","rounded-lg","transition-all","duration-200","transform","hover:scale-105","shadow-lg",3,"click"],[1,"bg-stone-800/90","border","border-yellow-400","rounded-lg","px-4","py-2","backdrop-blur-sm"],[1,"text-yellow-400","text-sm","font-bold","mb-1"],[1,"flex","gap-2"],[1,"w-8","h-8","bg-yellow-400/20","border","border-yellow-400","rounded","flex","items-center","justify-center","text-lg"]],template:function(t,i){t&1&&(c(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),m(4,"\u5BF5\u7269\u9023\u9023\u770B"),s(),c(5,"div"),v(6,Y,2,0,"button",4),v(7,J,2,0,"button",5)(8,q,2,0,"button",6),s()(),c(9,"div",7)(10,"div",8)(11,"div",9),m(12,"\u95DC\u5361"),s(),c(13,"div",1),m(14),s()(),c(15,"div",10)(16,"div",11),m(17,"\u5206\u6578"),s(),c(18,"div",1),m(19),s()(),c(20,"div",12)(21,"div",13),m(22,"\u79FB\u52D5"),s(),c(23,"div",1),m(24),s()(),c(25,"div",14)(26,"div",15),m(27,"\u6642\u9593"),s(),c(28,"div",1),m(29),s()(),c(30,"div",16)(31,"div",17),m(32,"\u5269\u9918"),s(),c(33,"div",1),m(34),s()(),v(35,K,5,1,"div",18),s()(),c(36,"div",19)(37,"div",20)(38,"div",21),S(39,W,2,0,null,null,I),s(),v(41,ee,3,0,"div",22),v(42,te,24,4,"div",23),s()(),c(43,"div",24)(44,"p",25),m(45,"\u9EDE\u64CA\u5169\u500B\u76F8\u540C\u7684\u5BF5\u7269\u4F86\u914D\u5C0D\uFF01"),s(),c(46,"p",26),m(47,"\u9023\u63A5\u7DDA\u4E0D\u80FD\u8D85\u904E2-3\u6B21\u8F49\u5F4E\uFF0C\u914D\u5C0D\u6210\u529F\u5F8C\u65B9\u584A\u6703\u6D88\u5931\u3002"),s(),v(48,ie,2,0,"p",27)(49,ne,2,1,"p",28),s(),v(50,re,7,0,"div",29),s()),t&2&&(p(6),b(i.levelComplete()?6:-1),p(),b(i.gameOver()?7:8),p(7),g(i.level()),p(5),g(i.score()),p(5),g(i.moves()),p(5),g(i.formattedTime()),p(5),g(i.remainingTiles()),p(),b(i.gameOver()?35:-1),p(3),D("ngStyle",L(13,R,"repeat("+i.boardWidth+", minmax(0, 1fr))")),p(),P(i.board()),p(2),b(i.showPath()?41:-1),p(),b(i.levelComplete()?42:-1),p(6),b(i.level()===1?48:49),p(2),b(i.selectedTiles().length>0?50:-1))},dependencies:[O,N,$],encapsulation:2})};export{G as PetMatch};
