import{A as S,B as v,C as Y,D as x,E as u,F as y,G as E,H as B,I as O,K as X,N as T,O as J,P as q,Q as K,R as Q,W as Z,c as L,d as z,e as P,f as w,j as f,k as H,l as N,n as m,o as j,p as C,q as _,r as $,t as k,u as U,v as b,w as s,x as d,y as D,z as M}from"./chunk-UIR7DDQE.js";var V=class c{findPath(e,t,n,o,l){let i=this.tryDirectPath(e,t,n,o,l);if(i)return i;let r=this.tryLShapePath(e,t,n,o,l);if(r)return r;let a=this.tryUShapePath(e,t,n,o,l);if(a)return a;let h=this.tryBoundaryPath(e,t,n,o,l);return h||null}tryDirectPath(e,t,n,o,l){return e.y===t.y&&this.isPathClear(e,t,"horizontal",n,o,l)?[{start:e,end:t,direction:"horizontal"}]:e.x===t.x&&this.isPathClear(e,t,"vertical",n,o,l)?[{start:e,end:t,direction:"vertical"}]:null}tryLShapePath(e,t,n,o,l){let i={x:e.x,y:t.y},r=!(i.x===e.x&&i.y===e.y)&&!(i.x===t.x&&i.y===t.y),a=this.isValidPosition(i,n,o,l),h=r&&a&&this.isPathClear(e,i,"vertical",n,o,l),p=h&&this.isPathClear(i,t,"horizontal",n,o,l);if(typeof window<"u"&&e.x===1&&e.y===2&&t.x===4&&t.y===1&&(console.log(`L1 \u8DEF\u5F91\u5206\u6790: corner1=(${i.x},${i.y})`),console.log("- \u8F49\u89D2\u9EDE\u6709\u6548:",r),console.log("- \u8F49\u89D2\u9EDE\u4F4D\u7F6E\u6709\u6548:",a),console.log("- \u5782\u76F4\u8DEF\u5F91\u66A2\u901A:",h),console.log("- \u6C34\u5E73\u8DEF\u5F91\u66A2\u901A:",p),a&&console.log("- \u8F49\u89D2\u9EDE\u5167\u5BB9:",i.x>=0&&i.x<o&&i.y>=0&&i.y<l?n[i.y][i.x]?"\u6709\u65B9\u584A":"\u7A7A\u767D":"\u908A\u754C\u5916")),r&&a&&h&&p)return[{start:e,end:i,direction:"vertical"},{start:i,end:t,direction:"horizontal"}];let g={x:t.x,y:e.y},G=!(g.x===e.x&&g.y===e.y)&&!(g.x===t.x&&g.y===t.y),I=this.isValidPosition(g,n,o,l),F=G&&I&&this.isPathClear(e,g,"horizontal",n,o,l),R=F&&this.isPathClear(g,t,"vertical",n,o,l);return typeof window<"u"&&e.x===1&&e.y===2&&t.x===4&&t.y===1&&(console.log(`L2 \u8DEF\u5F91\u5206\u6790: corner2=(${g.x},${g.y})`),console.log("- \u8F49\u89D2\u9EDE\u6709\u6548:",G),console.log("- \u8F49\u89D2\u9EDE\u4F4D\u7F6E\u6709\u6548:",I),console.log("- \u6C34\u5E73\u8DEF\u5F91\u66A2\u901A:",F),console.log("- \u5782\u76F4\u8DEF\u5F91\u66A2\u901A:",R),I&&console.log("- \u8F49\u89D2\u9EDE\u5167\u5BB9:",g.x>=0&&g.x<o&&g.y>=0&&g.y<l?n[g.y][g.x]?"\u6709\u65B9\u584A":"\u7A7A\u767D":"\u908A\u754C\u5916")),G&&I&&F&&R?[{start:e,end:g,direction:"horizontal"},{start:g,end:t,direction:"vertical"}]:null}tryUShapePath(e,t,n,o,l){for(let i=0;i<o;i++)if(i!==e.x&&i!==t.x){let r={x:i,y:e.y},a={x:i,y:t.y};if(this.isValidPosition(r,n,o,l)&&this.isValidPosition(a,n,o,l)&&this.isPathClear(e,r,"horizontal",n,o,l)&&this.isPathClear(r,a,"vertical",n,o,l)&&this.isPathClear(a,t,"horizontal",n,o,l))return[{start:e,end:r,direction:"horizontal"},{start:r,end:a,direction:"vertical"},{start:a,end:t,direction:"horizontal"}]}for(let i=0;i<l;i++)if(i!==e.y&&i!==t.y){let r={x:e.x,y:i},a={x:t.x,y:i};if(this.isValidPosition(r,n,o,l)&&this.isValidPosition(a,n,o,l)&&this.isPathClear(e,r,"vertical",n,o,l)&&this.isPathClear(r,a,"horizontal",n,o,l)&&this.isPathClear(a,t,"vertical",n,o,l))return[{start:e,end:r,direction:"vertical"},{start:r,end:a,direction:"horizontal"},{start:a,end:t,direction:"vertical"}]}return null}tryBoundaryPath(e,t,n,o,l){let i=[{y:-1,name:"top"},{y:l,name:"bottom"},{x:-1,name:"left"},{x:o,name:"right"}];for(let r of i){let a=this.tryBoundaryRoute(e,t,r,n,o,l);if(a)return a}return null}tryBoundaryRoute(e,t,n,o,l,i){if("y"in n){let r={x:e.x,y:n.y},a={x:t.x,y:n.y};if(this.isPathClear(e,r,"vertical",o,l,i)&&this.isPathClear(r,a,"horizontal",o,l,i)&&this.isPathClear(a,t,"vertical",o,l,i))return[{start:e,end:r,direction:"vertical"},{start:r,end:a,direction:"horizontal"},{start:a,end:t,direction:"vertical"}]}else{let r={x:n.x,y:e.y},a={x:n.x,y:t.y};if(this.isPathClear(e,r,"horizontal",o,l,i)&&this.isPathClear(r,a,"vertical",o,l,i)&&this.isPathClear(a,t,"horizontal",o,l,i))return[{start:e,end:r,direction:"horizontal"},{start:r,end:a,direction:"vertical"},{start:a,end:t,direction:"horizontal"}]}return null}isPathClear(e,t,n,o,l,i){if(e.x===t.x&&e.y===t.y)return!0;if(n==="horizontal"){if(e.y!==t.y)return!1;let r=Math.min(e.x,t.x),a=Math.max(e.x,t.x);return this.checkLineEmpty(r+1,a,e.y,"horizontal",o,l,i)}else{if(e.x!==t.x)return!1;let r=Math.min(e.y,t.y),a=Math.max(e.y,t.y);return this.checkLineEmpty(r+1,a,e.x,"vertical",o,l,i)}}checkLineEmpty(e,t,n,o,l,i,r){for(let a=e;a<t;a++){let h=o==="horizontal"?a:n,p=o==="horizontal"?n:a;if(h>=0&&h<i&&p>=0&&p<r&&l[p][h])return!1}return!0}isValidPosition(e,t,n,o){return e.x<0||e.x>=n||e.y<0||e.y>=o?!0:!t[e.y][e.x]}static \u0275fac=function(t){return new(t||c)};static \u0275prov=L({token:c,factory:c.\u0275fac,providedIn:"root"})};var A=class c{initializeBoard(e,t,n){let o=[],l=0,i=e*t,r=[];for(let h=0;h<i/2;h++){let p=h%n;r.push(p,p)}for(let h=r.length-1;h>0;h--){let p=Math.floor(Math.random()*(h+1));[r[h],r[p]]=[r[p],r[h]]}let a=0;for(let h=0;h<t;h++){o[h]=[];for(let p=0;p<e;p++)a<r.length?o[h][p]={id:l++,petType:r[a++],position:{x:p,y:h},selected:!1}:o[h][p]=null}return o}removeTiles(e,t,n){e[t.position.y][t.position.x]=null,e[n.position.y][n.position.x]=null}collapseBoardDown(e,t,n){for(let o=0;o<t;o++){let l=[];for(let i=n-1;i>=0;i--)e[i][o]&&l.unshift(e[i][o]);for(let i=0;i<n;i++)if(i<n-l.length)e[i][o]=null;else{let r=l[i-(n-l.length)];r&&(r.position={x:o,y:i},e[i][o]=r)}}}collapseBoardUp(e,t,n){for(let o=0;o<t;o++){let l=[];for(let i=0;i<n;i++)e[i][o]&&l.push(e[i][o]);for(let i=0;i<n;i++)if(i<l.length){let r=l[i];r&&(r.position={x:o,y:i},e[i][o]=r)}else e[i][o]=null}}collapseBoardLeft(e,t,n){for(let o=0;o<n;o++){let l=[];for(let i=0;i<t;i++)e[o][i]&&l.push(e[o][i]);for(let i=0;i<t;i++)if(i<l.length){let r=l[i];r&&(r.position={x:i,y:o},e[o][i]=r)}else e[o][i]=null}}collapseBoardRight(e,t,n){for(let o=0;o<n;o++){let l=[];for(let i=t-1;i>=0;i--)e[o][i]&&l.unshift(e[o][i]);for(let i=0;i<t;i++)if(i<t-l.length)e[o][i]=null;else{let r=l[i-(t-l.length)];r&&(r.position={x:i,y:o},e[o][i]=r)}}}getRemainingTileCount(e){return e.flat().filter(t=>t!==null).length}isGameComplete(e){return this.getRemainingTileCount(e)===0}hasValidMoves(e,t,n,o){for(let l=0;l<n;l++)for(let i=0;i<t;i++){let r=e[l][i];if(r)for(let a=0;a<n;a++)for(let h=0;h<t;h++){let p=e[a][h];if(!(!p||r.id===p.id||r.petType!==p.petType)&&o.findPath(r.position,p.position,e,t,n))return!0}}return!1}getElapsedTime(e){return Math.floor((Date.now()-e)/1e3)}formatTime(e){let t=Math.floor(e/60),n=e%60;return`${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}static \u0275fac=function(t){return new(t||c)};static \u0275prov=L({token:c,factory:c.\u0275fac,providedIn:"root"})};var te=c=>({"grid-template-columns":c}),ie=(c,e)=>(e==null?null:e.id)||c;function ne(c,e){if(c&1){let t=M();s(0,"button",28),S("click",function(){P(t);let o=v();return w(o.resetGame())}),u(1," \u91CD\u65B0\u958B\u59CB "),d()}}function oe(c,e){if(c&1){let t=M();s(0,"button",29),S("click",function(){P(t);let o=v();return w(o.resetGame())}),u(1," \u65B0\u904A\u6232 "),d()}}function le(c,e){if(c&1&&(s(0,"span",32),u(1),d()),c&2){let t=v().$implicit,n=v(2);m(),y(n.petEmojis[t.petType])}}function re(c,e){if(c&1){let t=M();s(0,"div",31),S("click",function(){let o=P(t).$implicit,l=v(2);return w(l.onTileClick(o))}),C(1,le,2,1,"span",32),d()}if(c&2){let t=e.$implicit,n=v(2);b("ngClass",n.getTileClass(t)),m(),_(t?1:-1)}}function ae(c,e){if(c&1&&k(0,re,2,2,"div",30,ie),c&2){let t=e.$implicit;U(t)}}function se(c,e){if(c&1&&D(0,"div",33),c&2){let t=e.$implicit,n=v(2);b("ngStyle",n.getPathStyle(t))}}function ce(c,e){if(c&1&&(s(0,"div",26),k(1,se,1,1,"div",33,$),d()),c&2){let t=v();m(),U(t.matchPath())}}function me(c,e){if(c&1){let t=M();s(0,"div",27)(1,"div",34),D(2,"div",35),s(3,"h2",36),u(4),d(),s(5,"div",37)(6,"div"),u(7,"\u7E3D\u5206\u6578"),d(),s(8,"div",38),u(9),d()(),s(10,"button",39),S("click",function(){P(t);let o=v();return w(o.resetGame())}),u(11," \u91CD\u65B0\u958B\u59CB "),d()()()}if(c&2){let t=v();m(),x(t.timeUp()?"from-red-600 to-red-800 border-red-400 shadow-red-400/50":"from-orange-600 to-orange-800 border-orange-400 shadow-orange-400/50"),m(),b("innerHTML",t.timeUp()?"\u23F0":"\u{1F635}",N),m(),x(t.timeUp()?"text-red-100":"text-orange-100"),m(),E(" ",t.timeUp()?"\u6642\u9593\u5230\u4E86\uFF01":"\u904A\u6232\u7D50\u675F"," "),m(),x(t.timeUp()?"bg-red-700/50":"bg-orange-700/50"),m(),x(t.timeUp()?"text-red-200":"text-orange-200"),m(2),x(t.timeUp()?"text-red-100":"text-orange-100"),m(),E(" ",t.score()," "),m(),x(t.timeUp()?"bg-red-500 hover:bg-red-400 text-red-900":"bg-orange-500 hover:bg-orange-400 text-orange-900")}}function de(c,e){if(c&1&&(s(0,"div",40)(1,"div",41),u(2,"\u{1F3AE} \u904A\u6232\u7D71\u8A08 \u{1F3AE}"),d(),s(3,"div",42)(4,"div",43)(5,"div",44),u(6,"\u7E3D\u79FB\u52D5"),d(),s(7,"div",45),u(8),d()(),s(9,"div",43)(10,"div",44),u(11,"\u7E3D\u6642\u9593"),d(),s(12,"div",45),u(13),d()(),s(14,"div",43)(15,"div",44),u(16,"\u9053\u5177\u4F7F\u7528"),d(),s(17,"div",45),u(18),d()(),s(19,"div",43)(20,"div",44),u(21,"\u6700\u7D42\u5206\u6578"),d(),s(22,"div",45),u(23),d()()()()),c&2){let t=v(2);m(8),y(t.moves()),m(5),y(t.formattedTime()),m(5),E(" ",t.totalShufflesUsed()+t.totalHintsUsed()," "),m(5),y(t.score())}}function ue(c,e){if(c&1&&(s(0,"div",46)(1,"div",47)(2,"div",48),u(3,"\u79FB\u52D5\u6B21\u6578"),d(),s(4,"div",49),u(5),d()(),s(6,"div",47)(7,"div",48),u(8,"\u5B8C\u6210\u6642\u9593"),d(),s(9,"div",49),u(10),d()()(),s(11,"div",50)(12,"div",48),u(13,"\u7E3D\u5206\u6578"),d(),s(14,"div",51),u(15),d()()),c&2){let t=v(2);m(5),y(t.moves()),m(5),y(t.formattedTime()),m(5),y(t.score())}}function he(c,e){if(c&1){let t=M();s(0,"div",27)(1,"div",34),D(2,"div",35),s(3,"h2",36),u(4),d(),C(5,de,24,4,"div",40)(6,ue,16,3),s(7,"button",39),S("click",function(){P(t);let o=v();return w(o.gameComplete()?o.resetGame():o.nextLevel())}),u(8),d()()()}if(c&2){let t=v();m(),x(t.gameComplete()?"from-yellow-500 to-yellow-700 border-yellow-300 shadow-yellow-300/50":"from-green-600 to-green-800 border-green-400 shadow-green-400/50"),m(),b("innerHTML",t.gameComplete()?"\u{1F3C6}":"\u{1F389}",N),m(),x(t.gameComplete()?"text-yellow-100":"text-green-100"),m(),E(" ",t.gameComplete()?"\u606D\u559C\u4F60\u5168\u90E8\u7834\u95DC\uFF01":"\u95DC\u5361 "+t.level()+" \u5B8C\u6210\uFF01"," "),m(),_(t.gameComplete()?5:6),m(2),x(t.gameComplete()?"bg-yellow-400 hover:bg-yellow-300 text-yellow-900":"bg-green-500 hover:bg-green-400 text-green-900"),m(),E(" ",t.gameComplete()?"\u91CD\u65B0\u6311\u6230":"\u4E0B\u4E00\u95DC \u2192"," ")}}var ee=class c{pathfindingService=z(V);gameLogicService=z(A);platformId=z(H);isBrowser=Q(this.platformId);boardWidth=6;boardHeight=9;petTypes=12;board=f([]);selectedTiles=f([]);score=f(0);level=f(1);gameOver=f(!1);levelComplete=f(!1);gameComplete=f(!1);matchPath=f([]);showPath=f(!1);moves=f(0);gameTime=f(0);remainingTiles=T(()=>this.gameLogicService.getRemainingTileCount(this.board()));formattedTime=T(()=>this.gameLogicService.formatTime(this.gameTime()));MAX_LEVEL_TIME=300;countdownTime=f(this.MAX_LEVEL_TIME);formattedCountdown=T(()=>{let e=this.countdownTime(),t=Math.floor(e/60),n=e%60;return`${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`});timeUp=T(()=>this.countdownTime()<=0);timelinePercentage=T(()=>this.countdownTime()/this.MAX_LEVEL_TIME*100);timelineColorClass=T(()=>this.countdownTime()<=30?"from-red-500 to-red-300":this.countdownTime()<=60?"from-yellow-500 to-yellow-300":"from-lime-500 to-lime-300");timelineTextClass=T(()=>this.countdownTime()<=this.MAX_LEVEL_TIME*.5?"text-white":"text-neutral-900/90");totalShufflesUsed=f(0);totalHintsUsed=f(0);maxShufflesPerGame=f(5);maxHintsPerGame=f(5);remainingShuffles=T(()=>this.maxShufflesPerGame()-this.totalShufflesUsed());remainingHints=T(()=>this.maxHintsPerGame()-this.totalHintsUsed());hintTiles=f([]);showHint=f(!1);animationTimeout;gameStartTime=0;timeUpdateInterval;countdownInterval;levelStartTime=0;petEmojis=["\u{1F436}","\u{1F431}","\u{1F42D}","\u{1F439}","\u{1F430}","\u{1F98A}","\u{1F43B}","\u{1F43C}","\u{1F437}","\u{1F438}","\u{1F435}","\u{1F98B}"];ngOnInit(){this.initializeBoard()}ngOnDestroy(){this.clearAllTimers()}clearAllTimers(){this.animationTimeout&&clearTimeout(this.animationTimeout),this.timeUpdateInterval&&clearInterval(this.timeUpdateInterval),this.countdownInterval&&clearInterval(this.countdownInterval)}initializeBoard(){let e=this.gameLogicService.initializeBoard(this.boardWidth,this.boardHeight,this.petTypes);this.board.set(e),this.startLevelTimer()}startLevelTimer(){this.isBrowser&&(this.clearAllTimers(),this.levelStartTime=Date.now(),this.countdownTime.set(this.MAX_LEVEL_TIME),this.timeUpdateInterval=setInterval(()=>{let e=this.gameLogicService.getElapsedTime(this.levelStartTime);this.gameTime.set(e)},1e3),this.countdownInterval=setInterval(()=>{let e=this.gameLogicService.getElapsedTime(this.levelStartTime),t=Math.max(0,this.MAX_LEVEL_TIME-e);this.countdownTime.set(t),t<=0&&this.handleTimeUp()},1e3))}handleTimeUp(){this.gameOver()||(this.clearAllTimers(),this.gameOver.set(!0))}getCurrentLevelType(){let e=this.level();return e===1?"classic":e===2?"down":e===3?"up":e===4?"left":"right"}applyLevelGravity(e){switch(this.getCurrentLevelType()){case"classic":break;case"down":this.gameLogicService.collapseBoardDown(e,this.boardWidth,this.boardHeight);break;case"up":this.gameLogicService.collapseBoardUp(e,this.boardWidth,this.boardHeight);break;case"left":this.gameLogicService.collapseBoardLeft(e,this.boardWidth,this.boardHeight);break;case"right":this.gameLogicService.collapseBoardRight(e,this.boardWidth,this.boardHeight);break}}onTileClick(e){if(!e||this.gameOver()||this.showPath())return;let t=this.selectedTiles();if(e.selected){e.selected=!1,this.selectedTiles.set(t.filter(o=>o.id!==e.id));return}t.length>=2&&this.clearSelection(),e.selected=!0;let n=[...t,e];this.selectedTiles.set(n),n.length===2&&this.checkMatch(n[0],n[1])}checkMatch(e,t){if(e.petType!==t.petType){this.isBrowser?setTimeout(()=>this.clearSelection(),300):this.clearSelection();return}this.moves.update(o=>o+1);let n=this.pathfindingService.findPath(e.position,t.position,this.board(),this.boardWidth,this.boardHeight);if(this.isBrowser&&!n&&console.log(`\u914D\u5C0D\u5931\u6557: \u5BF5\u7269${this.petEmojis[e.petType]} (${e.position.x},${e.position.y}) \u2192 (${t.position.x},${t.position.y}) \u7121\u6CD5\u627E\u5230\u8DEF\u5F91`),n){this.matchPath.set(n),this.showPath.set(!0);let o=()=>{let l=this.board();this.gameLogicService.removeTiles(l,e,t),this.applyLevelGravity(l),this.board.set([...l]),this.score.update(i=>i+10),this.showPath.set(!1),this.matchPath.set([]),this.clearSelection(),this.checkGameOver()};this.isBrowser?this.animationTimeout=setTimeout(o,200):o()}else this.isBrowser?setTimeout(()=>this.clearSelection(),300):this.clearSelection()}clearSelection(){this.selectedTiles().forEach(t=>t.selected=!1),this.selectedTiles.set([])}checkGameOver(){let e=this.board();if(this.gameLogicService.isGameComplete(e)){this.levelComplete.set(!0),this.clearAllTimers(),this.level()>=5&&this.gameComplete.set(!0);return}this.gameLogicService.hasValidMoves(e,this.boardWidth,this.boardHeight,this.pathfindingService)||(this.remainingTiles()>0&&this.canUseShuffle()?(console.log("\u81EA\u52D5\u89F8\u767C\u91CD\u6392\uFF1A\u7121\u53EF\u7528\u79FB\u52D5\u4F46\u9084\u6709\u5269\u9918\u65B9\u584A"),this.shuffleTiles()):(this.gameOver.set(!0),this.stopTimer()))}stopTimer(){this.timeUpdateInterval&&(clearInterval(this.timeUpdateInterval),this.timeUpdateInterval=void 0)}nextLevel(){this.gameComplete()||(this.level.update(e=>e+1),this.levelComplete.set(!1),this.clearSelection(),this.showPath.set(!1),this.matchPath.set([]),this.hideHint(),this.clearAllTimers(),this.animationTimeout&&clearTimeout(this.animationTimeout),this.initializeBoard())}resetGame(){this.score.set(0),this.level.set(1),this.moves.set(0),this.gameTime.set(0),this.totalShufflesUsed.set(0),this.totalHintsUsed.set(0),this.hideHint(),this.gameOver.set(!1),this.levelComplete.set(!1),this.gameComplete.set(!1),this.clearSelection(),this.showPath.set(!1),this.matchPath.set([]),this.clearAllTimers(),this.animationTimeout&&clearTimeout(this.animationTimeout),this.initializeBoard()}getTileClass(e){if(!e)return"bg-stone-800 border border-stone-700";let t="bg-gradient-to-br border-2 cursor-pointer flex items-center justify-center text-2xl";if(e.selected)return`${t} from-yellow-400 to-yellow-600 border-yellow-300 brightness-125`;if(this.isHintTile(e))return`${t} from-green-400 to-green-600 border-green-300 animate-pulse ring-2 ring-green-400 ring-opacity-75`;let n=["from-blue-400 to-blue-600 border-blue-300","from-pink-400 to-pink-600 border-pink-300","from-gray-400 to-gray-600 border-gray-300","from-yellow-400 to-yellow-600 border-yellow-300","from-purple-400 to-purple-600 border-purple-300","from-orange-400 to-orange-600 border-orange-300","from-amber-600 to-amber-800 border-amber-400","from-slate-400 to-slate-600 border-slate-300","from-rose-400 to-rose-600 border-rose-300","from-green-400 to-green-600 border-green-300","from-teal-400 to-teal-600 border-teal-300","from-violet-400 to-violet-600 border-violet-300"];return`${t} ${n[e.petType]||n[0]}`}getPathStyle(e){let o=e.start.x*50,l=e.start.y*50,i=e.end.x*50,r=e.end.y*50;if(e.direction==="horizontal"){let a=Math.min(o,i)+24,h=Math.abs(i-o),p=l+48/2-1;return{position:"absolute",left:`${a}px`,top:`${p}px`,width:`${h}px`,height:"2px",background:"linear-gradient(90deg, #fbbf24, #f59e0b)",boxShadow:"0 0 8px #fbbf24, 0 0 8px #f59e0b",zIndex:10}}else{let a=Math.min(l,r)+24,h=Math.abs(r-l);return{position:"absolute",left:`${o+48/2-1}px`,top:`${a}px`,width:"2px",height:`${h}px`,background:"linear-gradient(180deg, #fbbf24, #f59e0b)",boxShadow:"0 0 8px #fbbf24, 0 0 16px #f59e0b",zIndex:10}}}shuffleTiles(){if(!this.canUseShuffle()||this.gameOver()||this.levelComplete()||this.remainingTiles()===0)return;this.clearSelection();let e=this.board(),t=[];for(let l=0;l<this.boardHeight;l++)for(let i=0;i<this.boardWidth;i++)e[l][i]&&t.push(e[l][i].petType);for(let l=t.length-1;l>0;l--){let i=Math.floor(Math.random()*(l+1));[t[l],t[i]]=[t[i],t[l]]}let n=0,o=Date.now();for(let l=0;l<this.boardHeight;l++)for(let i=0;i<this.boardWidth;i++)e[l][i]&&(e[l][i]={id:o++,petType:t[n++],position:{x:i,y:l},selected:!1});this.board.set([...e]),this.totalShufflesUsed.update(l=>l+1),this.checkGameOver()}hasAvailableMoves(){return this.gameLogicService.hasValidMoves(this.board(),this.boardWidth,this.boardHeight,this.pathfindingService)}canUseShuffle(){return this.remainingShuffles()>0&&!this.gameOver()&&!this.levelComplete()&&!this.timeUp()&&this.remainingTiles()>0}useHint(){if(!this.canUseHint())return;this.clearSelection();let e=this.findValidPair();e&&(this.hintTiles.set([e.tile1,e.tile2]),this.showHint.set(!0),this.totalHintsUsed.update(t=>t+1),this.isBrowser&&setTimeout(()=>this.hideHint(),3e3))}hideHint(){this.showHint.set(!1),this.hintTiles.set([])}canUseHint(){return this.remainingHints()>0&&!this.gameOver()&&!this.levelComplete()&&!this.timeUp()&&!this.showHint()&&this.remainingTiles()>0}findValidPair(){let e=this.board();for(let t=0;t<this.boardHeight;t++)for(let n=0;n<this.boardWidth;n++){let o=e[t][n];if(o)for(let l=0;l<this.boardHeight;l++)for(let i=0;i<this.boardWidth;i++){let r=e[l][i];if(!(!r||o.id===r.id)&&o.petType===r.petType&&this.pathfindingService.findPath(o.position,r.position,e,this.boardWidth,this.boardHeight))return{tile1:o,tile2:r}}}return null}isHintTile(e){return!e||!this.showHint()?!1:this.hintTiles().some(t=>t.id===e.id)}static \u0275fac=function(t){return new(t||c)};static \u0275cmp=j({type:c,selectors:[["app-pet-match"]],decls:54,vars:33,consts:[[1,"w-full","max-w-sm","mx-auto","flex","flex-col"],[1,"mb-2","flex","flex-col","gap-3","items-stretch"],[1,"flex","justify-between","items-center"],[1,"text-center","text-2xl","font-bold","tracking-wider","text-lime-400","drop-shadow"],["routerLink","/",1,"text-lime-600","text-sm"],[1,"flex","gap-2"],[1,"h-12","w-1/3","touch-btn","rounded-md","bg-cyan-700","border","border-cyan-500","text-cyan-50","font-semibold","text-base","shadow","hover:bg-cyan-600","focus:outline-none","focus:ring-2","focus:ring-cyan-300"],[1,"h-12","w-1/3","touch-btn","rounded-md","bg-lime-700","border","border-lime-500","text-lime-50","font-semibold","text-base","shadow","hover:bg-lime-600","focus:outline-none","focus:ring-2","focus:ring-lime-300"],[1,"h-12","w-1/3","touch-btn","rounded-md","border","font-medium","shadow","focus:outline-none","focus:ring-2",3,"click","disabled","title"],[1,"flex","flex-col","gap-2"],[1,"flex","items-center","gap-1","justify-center","flex-wrap","bg-neutral-900/70","rounded-md","p-2","border","border-neutral-700"],[1,"border","border-cyan-400","bg-cyan-400/20","px-2","py-1","text-cyan-300","font-bold","hover:bg-cyan-400/30","transition"],[1,"text-cyan-400","text-xs"],[1,"text-center","text-xs"],[1,"border","border-lime-400","bg-lime-400/20","px-2","py-1","text-lime-300","font-bold","hover:bg-lime-400/30","transition"],[1,"text-lime-400","text-xs"],[1,"border","border-yellow-400","bg-yellow-400/20","px-2","py-1","text-yellow-300","font-bold","hover:bg-yellow-400/30","transition"],[1,"text-yellow-400","text-xs"],[1,"border","border-orange-400","bg-orange-400/20","px-2","py-1","text-orange-300","font-bold","hover:bg-orange-400/30","transition"],[1,"text-orange-400","text-xs"],[1,"w-full","mt-2","h-2","bg-neutral-700/80","rounded","overflow-hidden","relative"],[1,"h-full","bg-gradient-to-r","transition-all","duration-300"],[1,"absolute","inset-0","text-[9px]","tracking-wide","font-semibold","flex","items-center","justify-center","select-none","transition-colors","duration-300"],[1,"flex","justify-center"],[1,"relative","inline-block"],[1,"inline-grid","gap-[2px]","p-4","border-2","border-lime-700","rounded-lg",3,"ngStyle"],[1,"absolute","inset-0","pointer-events-none"],[1,"absolute","inset-0","bg-black/50","backdrop-blur-sm","flex","items-center","justify-center","z-50","rounded-lg"],[1,"h-12","w-1/3","touch-btn","rounded-md","bg-cyan-700","border","border-cyan-500","text-cyan-50","font-semibold","text-base","shadow","hover:bg-cyan-600","focus:outline-none","focus:ring-2","focus:ring-cyan-300",3,"click"],[1,"h-12","w-1/3","touch-btn","rounded-md","bg-lime-700","border","border-lime-500","text-lime-50","font-semibold","text-base","shadow","hover:bg-lime-600","focus:outline-none","focus:ring-2","focus:ring-lime-300",3,"click"],[1,"w-12","h-12","rounded-lg","relative",3,"ngClass"],[1,"w-12","h-12","rounded-lg","relative",3,"click","ngClass"],[1,"select-none","pointer-events-none"],[1,"absolute","animate-pulse","transition-all","duration-300",3,"ngStyle"],[1,"bg-gradient-to-br","border-2","rounded-lg","p-8","shadow-2xl","text-center"],[1,"text-3xl","mb-4",3,"innerHTML"],[1,"text-2xl","font-bold","mb-4"],[1,"rounded-lg","p-3","mb-6"],[1,"font-bold","text-2xl"],[1,"font-bold","py-3","px-6","rounded-lg","transition-all","duration-200","transform","hover:scale-105","shadow-lg",3,"click"],[1,"mb-6"],[1,"text-yellow-200","text-lg","mb-4"],[1,"grid","grid-cols-2","gap-4","text-sm"],[1,"bg-yellow-600/50","rounded-lg","p-3"],[1,"text-yellow-200"],[1,"text-yellow-100","font-bold","text-xl"],[1,"grid","grid-cols-2","gap-4","mb-6","text-sm"],[1,"bg-green-700/50","rounded-lg","p-3"],[1,"text-green-200"],[1,"text-green-100","font-bold","text-xl"],[1,"bg-green-700/50","rounded-lg","p-3","mb-6"],[1,"text-green-100","font-bold","text-2xl"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"header",1)(2,"div",2)(3,"h1",3),u(4," \u5BF5\u7269\u9023\u9023\u770B "),d(),s(5,"a",4),u(6,"HOME"),d()(),s(7,"div",5),C(8,ne,2,0,"button",6)(9,oe,2,0,"button",7),s(10,"button",8),S("click",function(){return n.shuffleTiles()}),u(11," \u91CD\u6392 ("),s(12,"span"),u(13),d(),u(14,") "),d(),s(15,"button",8),S("click",function(){return n.useHint()}),u(16," \u63D0\u793A ("),s(17,"span"),u(18),d(),u(19,") "),d()(),s(20,"div",9)(21,"div",10)(22,"div",11)(23,"div",12),u(24,"\u95DC\u5361"),d(),s(25,"div",13),u(26),d()(),s(27,"div",14)(28,"div",15),u(29,"\u5206\u6578"),d(),s(30,"div",13),u(31),d()(),s(32,"div",16)(33,"div",17),u(34,"\u79FB\u52D5"),d(),s(35,"div",13),u(36),d()(),s(37,"div",18)(38,"div",19),u(39,"\u5269\u9918"),d(),s(40,"div",13),u(41),d()(),s(42,"div",20),D(43,"div",21),s(44,"span",22),u(45),d()()()()(),s(46,"main",23)(47,"div",24)(48,"div",25),k(49,ae,2,0,null,null,$),d(),C(51,ce,3,0,"div",26),C(52,me,12,15,"div",27),C(53,he,9,10,"div",27),d()()()),t&2&&(m(8),_(n.gameOver()?8:9),m(2),x(n.canUseShuffle()?"bg-zinc-800 border-zinc-600 text-lime-200 hover:bg-zinc-700 focus:ring-lime-300":"bg-zinc-800 border-zinc-600 text-zinc-400 opacity-50"),b("title",O("\u91CD\u65B0\u6D17\u724C\u6240\u6709\u65B9\u584A (\u5269\u9918: ",n.remainingShuffles(),")"))("disabled",!n.canUseShuffle()),m(3),B("",n.totalShufflesUsed(),"/",n.maxShufflesPerGame()),m(2),x(n.canUseHint()?"bg-emerald-700 border-emerald-500 text-emerald-50 hover:bg-emerald-600 focus:ring-emerald-300":"bg-zinc-800 border-zinc-600 text-zinc-400 opacity-50"),b("title",O("\u986F\u793A\u4E00\u500B\u53EF\u914D\u5C0D\u7684\u63D0\u793A (\u5269\u9918: ",n.remainingHints(),")"))("disabled",!n.canUseHint()),m(3),B("",n.totalHintsUsed(),"/",n.maxHintsPerGame()),m(8),y(n.level()),m(5),y(n.score()),m(5),y(n.moves()),m(5),y(n.remainingTiles()),m(2),x(n.timelineColorClass()),Y("width",n.timelinePercentage(),"%"),m(),x(n.timelineTextClass()),m(),B(" ",n.formattedTime()," / ",n.formattedCountdown()," "),m(3),b("ngStyle",X(31,te,"repeat("+n.boardWidth+", minmax(0, 1fr))")),m(),U(n.board()),m(2),_(n.showPath()?51:-1),m(),_(n.gameOver()?52:-1),m(),_(n.levelComplete()?53:-1))},dependencies:[K,J,q,Z],encapsulation:2})};export{ee as PetMatch};
