import{a as Z}from"./chunk-MA4NP7GB.js";import{A as L,B as b,C as c,D as d,E as M,F as E,G as _,H as v,I as Y,K as x,L as u,M as y,N as D,O as k,P as $,R as X,U as T,V as J,W as q,X as K,Y as Q,d as U,g as B,h as P,i as w,m as f,o as H,p as N,s as m,t as j,v as S,w as C,x as R,z as I}from"./chunk-DY6AVODR.js";var V=class a{findPath(e,t,i,o,l){let n=this.tryDirectPath(e,t,i,o,l);if(n)return n;let r=this.tryLShapePath(e,t,i,o,l);if(r)return r;let s=this.tryUShapePath(e,t,i,o,l);if(s)return s;let h=this.tryBoundaryPath(e,t,i,o,l);return h||null}tryDirectPath(e,t,i,o,l){return e.y===t.y&&this.isPathClear(e,t,"horizontal",i,o,l)?[{start:e,end:t,direction:"horizontal"}]:e.x===t.x&&this.isPathClear(e,t,"vertical",i,o,l)?[{start:e,end:t,direction:"vertical"}]:null}tryLShapePath(e,t,i,o,l){let n={x:e.x,y:t.y},r=!(n.x===e.x&&n.y===e.y)&&!(n.x===t.x&&n.y===t.y),s=this.isValidPosition(n,i,o,l),h=r&&s&&this.isPathClear(e,n,"vertical",i,o,l),p=h&&this.isPathClear(n,t,"horizontal",i,o,l);if(typeof window<"u"&&e.x===1&&e.y===2&&t.x===4&&t.y===1&&(console.log(`L1 \u8DEF\u5F91\u5206\u6790: corner1=(${n.x},${n.y})`),console.log("- \u8F49\u89D2\u9EDE\u6709\u6548:",r),console.log("- \u8F49\u89D2\u9EDE\u4F4D\u7F6E\u6709\u6548:",s),console.log("- \u5782\u76F4\u8DEF\u5F91\u66A2\u901A:",h),console.log("- \u6C34\u5E73\u8DEF\u5F91\u66A2\u901A:",p),s&&console.log("- \u8F49\u89D2\u9EDE\u5167\u5BB9:",n.x>=0&&n.x<o&&n.y>=0&&n.y<l?i[n.y][n.x]?"\u6709\u65B9\u584A":"\u7A7A\u767D":"\u908A\u754C\u5916")),r&&s&&h&&p)return[{start:e,end:n,direction:"vertical"},{start:n,end:t,direction:"horizontal"}];let g={x:t.x,y:e.y},F=!(g.x===e.x&&g.y===e.y)&&!(g.x===t.x&&g.y===t.y),z=this.isValidPosition(g,i,o,l),G=F&&z&&this.isPathClear(e,g,"horizontal",i,o,l),O=G&&this.isPathClear(g,t,"vertical",i,o,l);return typeof window<"u"&&e.x===1&&e.y===2&&t.x===4&&t.y===1&&(console.log(`L2 \u8DEF\u5F91\u5206\u6790: corner2=(${g.x},${g.y})`),console.log("- \u8F49\u89D2\u9EDE\u6709\u6548:",F),console.log("- \u8F49\u89D2\u9EDE\u4F4D\u7F6E\u6709\u6548:",z),console.log("- \u6C34\u5E73\u8DEF\u5F91\u66A2\u901A:",G),console.log("- \u5782\u76F4\u8DEF\u5F91\u66A2\u901A:",O),z&&console.log("- \u8F49\u89D2\u9EDE\u5167\u5BB9:",g.x>=0&&g.x<o&&g.y>=0&&g.y<l?i[g.y][g.x]?"\u6709\u65B9\u584A":"\u7A7A\u767D":"\u908A\u754C\u5916")),F&&z&&G&&O?[{start:e,end:g,direction:"horizontal"},{start:g,end:t,direction:"vertical"}]:null}tryUShapePath(e,t,i,o,l){for(let n=0;n<o;n++)if(n!==e.x&&n!==t.x){let r={x:n,y:e.y},s={x:n,y:t.y};if(this.isValidPosition(r,i,o,l)&&this.isValidPosition(s,i,o,l)&&this.isPathClear(e,r,"horizontal",i,o,l)&&this.isPathClear(r,s,"vertical",i,o,l)&&this.isPathClear(s,t,"horizontal",i,o,l))return[{start:e,end:r,direction:"horizontal"},{start:r,end:s,direction:"vertical"},{start:s,end:t,direction:"horizontal"}]}for(let n=0;n<l;n++)if(n!==e.y&&n!==t.y){let r={x:e.x,y:n},s={x:t.x,y:n};if(this.isValidPosition(r,i,o,l)&&this.isValidPosition(s,i,o,l)&&this.isPathClear(e,r,"vertical",i,o,l)&&this.isPathClear(r,s,"horizontal",i,o,l)&&this.isPathClear(s,t,"vertical",i,o,l))return[{start:e,end:r,direction:"vertical"},{start:r,end:s,direction:"horizontal"},{start:s,end:t,direction:"vertical"}]}return null}tryBoundaryPath(e,t,i,o,l){let n=[{y:-1,name:"top"},{y:l,name:"bottom"},{x:-1,name:"left"},{x:o,name:"right"}];for(let r of n){let s=this.tryBoundaryRoute(e,t,r,i,o,l);if(s)return s}return null}tryBoundaryRoute(e,t,i,o,l,n){if("y"in i){let r={x:e.x,y:i.y},s={x:t.x,y:i.y};if(this.isPathClear(e,r,"vertical",o,l,n)&&this.isPathClear(r,s,"horizontal",o,l,n)&&this.isPathClear(s,t,"vertical",o,l,n))return[{start:e,end:r,direction:"vertical"},{start:r,end:s,direction:"horizontal"},{start:s,end:t,direction:"vertical"}]}else{let r={x:i.x,y:e.y},s={x:i.x,y:t.y};if(this.isPathClear(e,r,"horizontal",o,l,n)&&this.isPathClear(r,s,"vertical",o,l,n)&&this.isPathClear(s,t,"horizontal",o,l,n))return[{start:e,end:r,direction:"horizontal"},{start:r,end:s,direction:"vertical"},{start:s,end:t,direction:"horizontal"}]}return null}isPathClear(e,t,i,o,l,n){if(e.x===t.x&&e.y===t.y)return!0;if(i==="horizontal"){if(e.y!==t.y)return!1;let r=Math.min(e.x,t.x),s=Math.max(e.x,t.x);return this.checkLineEmpty(r+1,s,e.y,"horizontal",o,l,n)}else{if(e.x!==t.x)return!1;let r=Math.min(e.y,t.y),s=Math.max(e.y,t.y);return this.checkLineEmpty(r+1,s,e.x,"vertical",o,l,n)}}checkLineEmpty(e,t,i,o,l,n,r){for(let s=e;s<t;s++){let h=o==="horizontal"?s:i,p=o==="horizontal"?i:s;if(h>=0&&h<n&&p>=0&&p<r&&l[p][h])return!1}return!0}isValidPosition(e,t,i,o){return e.x<0||e.x>=i||e.y<0||e.y>=o?!0:!t[e.y][e.x]}static \u0275fac=function(t){return new(t||a)};static \u0275prov=U({token:a,factory:a.\u0275fac,providedIn:"root"})};var A=class a{initializeBoard(e,t,i){let o=[],l=0,n=e*t,r=[];for(let h=0;h<n/2;h++){let p=h%i;r.push(p,p)}for(let h=r.length-1;h>0;h--){let p=Math.floor(Math.random()*(h+1));[r[h],r[p]]=[r[p],r[h]]}let s=0;for(let h=0;h<t;h++){o[h]=[];for(let p=0;p<e;p++)s<r.length?o[h][p]={id:l++,petType:r[s++],position:{x:p,y:h},selected:!1}:o[h][p]=null}return o}removeTiles(e,t,i){e[t.position.y][t.position.x]=null,e[i.position.y][i.position.x]=null}collapseBoardDown(e,t,i){for(let o=0;o<t;o++){let l=[];for(let n=i-1;n>=0;n--)e[n][o]&&l.unshift(e[n][o]);for(let n=0;n<i;n++)if(n<i-l.length)e[n][o]=null;else{let r=l[n-(i-l.length)];r&&(r.position={x:o,y:n},e[n][o]=r)}}}collapseBoardUp(e,t,i){for(let o=0;o<t;o++){let l=[];for(let n=0;n<i;n++)e[n][o]&&l.push(e[n][o]);for(let n=0;n<i;n++)if(n<l.length){let r=l[n];r&&(r.position={x:o,y:n},e[n][o]=r)}else e[n][o]=null}}collapseBoardLeft(e,t,i){for(let o=0;o<i;o++){let l=[];for(let n=0;n<t;n++)e[o][n]&&l.push(e[o][n]);for(let n=0;n<t;n++)if(n<l.length){let r=l[n];r&&(r.position={x:n,y:o},e[o][n]=r)}else e[o][n]=null}}collapseBoardRight(e,t,i){for(let o=0;o<i;o++){let l=[];for(let n=t-1;n>=0;n--)e[o][n]&&l.unshift(e[o][n]);for(let n=0;n<t;n++)if(n<t-l.length)e[o][n]=null;else{let r=l[n-(t-l.length)];r&&(r.position={x:n,y:o},e[o][n]=r)}}}getRemainingTileCount(e){return e.flat().filter(t=>t!==null).length}isGameComplete(e){return this.getRemainingTileCount(e)===0}hasValidMoves(e,t,i,o){for(let l=0;l<i;l++)for(let n=0;n<t;n++){let r=e[l][n];if(r)for(let s=0;s<i;s++)for(let h=0;h<t;h++){let p=e[s][h];if(!(!p||r.id===p.id||r.petType!==p.petType)&&o.findPath(r.position,p.position,e,t,i))return!0}}return!1}getElapsedTime(e){return Math.floor((Date.now()-e)/1e3)}formatTime(e){let t=Math.floor(e/60),i=e%60;return`${t.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`}static \u0275fac=function(t){return new(t||a)};static \u0275prov=U({token:a,factory:a.\u0275fac,providedIn:"root"})};var te=a=>({"grid-template-columns":a}),ie=(a,e)=>e.id,ne=(a,e)=>(e==null?null:e.id)||a;function oe(a,e){if(a&1){let t=E();c(0,"button",30),_("click",function(){P(t);let o=v();return w(o.resetGame())}),u(1," \u91CD\u65B0\u958B\u59CB "),d()}}function le(a,e){if(a&1){let t=E();c(0,"button",31),_("click",function(){P(t);let o=v();return w(o.resetGame())}),u(1," \u65B0\u904A\u6232 "),d()}}function re(a,e){if(a&1&&(c(0,"span",32),u(1),d()),a&2){let t=e.$implicit,i=v(2);m(),y(i.petEmojis[t.petType])}}function ae(a,e){if(a&1&&I(0,re,2,1,"span",32,ie),a&2){let t=v();L(t.selectedTiles())}}function se(a,e){a&1&&(c(0,"span",21),u(1,"\u9EDE\u64CA\u5BF5\u7269"),d())}function ce(a,e){if(a&1&&(c(0,"span",35),u(1),d()),a&2){let t=v().$implicit,i=v(2);m(),y(i.petEmojis[t.petType])}}function me(a,e){if(a&1){let t=E();c(0,"div",34),_("click",function(){let o=P(t).$implicit,l=v(2);return w(l.onTileClick(o))}),S(1,ce,2,1,"span",35),d()}if(a&2){let t=e.$implicit,i=v(2);b("ngClass",i.getTileClass(t)),m(),C(t?1:-1)}}function de(a,e){if(a&1&&I(0,me,2,2,"div",33,ne),a&2){let t=e.$implicit;L(t)}}function ue(a,e){if(a&1&&M(0,"div",36),a&2){let t=e.$implicit,i=v(2);b("ngStyle",i.getPathStyle(t))}}function he(a,e){if(a&1&&(c(0,"div",28),I(1,ue,1,1,"div",36,R),d()),a&2){let t=v();m(),L(t.matchPath())}}function pe(a,e){if(a&1){let t=E();c(0,"div",29)(1,"div",37),M(2,"div",38),c(3,"h2",39),u(4),d(),c(5,"div",40)(6,"div"),u(7,"\u7E3D\u5206\u6578"),d(),c(8,"div",41),u(9),d()(),c(10,"button",42),_("click",function(){P(t);let o=v();return w(o.resetGame())}),u(11," \u91CD\u65B0\u958B\u59CB "),d()()()}if(a&2){let t=v();m(),x(t.timeUp()?"from-red-600 to-red-800 border-red-400 shadow-red-400/50":"from-orange-600 to-orange-800 border-orange-400 shadow-orange-400/50"),m(),b("innerHTML",t.timeUp()?"\u23F0":"\u{1F635}",N),m(),x(t.timeUp()?"text-red-100":"text-orange-100"),m(),D(" ",t.timeUp()?"\u6642\u9593\u5230\u4E86\uFF01":"\u904A\u6232\u7D50\u675F"," "),m(),x(t.timeUp()?"bg-red-700/50":"bg-orange-700/50"),m(),x(t.timeUp()?"text-red-200":"text-orange-200"),m(2),x(t.timeUp()?"text-red-100":"text-orange-100"),m(),D(" ",t.score()," "),m(),x(t.timeUp()?"bg-red-500 hover:bg-red-400 text-red-900":"bg-orange-500 hover:bg-orange-400 text-orange-900")}}function fe(a,e){if(a&1&&(c(0,"div",43)(1,"div",44),u(2,"\u{1F3AE} \u904A\u6232\u7D71\u8A08 \u{1F3AE}"),d(),c(3,"div",45)(4,"div",46)(5,"div",47),u(6,"\u7E3D\u79FB\u52D5"),d(),c(7,"div",48),u(8),d()(),c(9,"div",46)(10,"div",47),u(11,"\u7E3D\u6642\u9593"),d(),c(12,"div",48),u(13),d()(),c(14,"div",46)(15,"div",47),u(16,"\u9053\u5177\u4F7F\u7528"),d(),c(17,"div",48),u(18),d()(),c(19,"div",46)(20,"div",47),u(21,"\u6700\u7D42\u5206\u6578"),d(),c(22,"div",48),u(23),d()()()()),a&2){let t=v(2);m(8),y(t.moves()),m(5),y(t.formattedTime()),m(5),D(" ",t.totalShufflesUsed()+t.totalHintsUsed()," "),m(5),y(t.score())}}function ge(a,e){if(a&1&&(c(0,"div",49)(1,"div",50)(2,"div",51),u(3,"\u79FB\u52D5\u6B21\u6578"),d(),c(4,"div",52),u(5),d()(),c(6,"div",50)(7,"div",51),u(8,"\u5B8C\u6210\u6642\u9593"),d(),c(9,"div",52),u(10),d()()(),c(11,"div",53)(12,"div",51),u(13,"\u7E3D\u5206\u6578"),d(),c(14,"div",54),u(15),d()()),a&2){let t=v(2);m(5),y(t.moves()),m(5),y(t.formattedTime()),m(5),y(t.score())}}function ve(a,e){if(a&1){let t=E();c(0,"div",29)(1,"div",37),M(2,"div",38),c(3,"h2",39),u(4),d(),S(5,fe,24,4,"div",43)(6,ge,16,3),c(7,"button",42),_("click",function(){P(t);let o=v();return w(o.gameComplete()?o.resetGame():o.nextLevel())}),u(8),d()()()}if(a&2){let t=v();m(),x(t.gameComplete()?"from-yellow-500 to-yellow-700 border-yellow-300 shadow-yellow-300/50":"from-green-600 to-green-800 border-green-400 shadow-green-400/50"),m(),b("innerHTML",t.gameComplete()?"\u{1F3C6}":"\u{1F389}",N),m(),x(t.gameComplete()?"text-yellow-100":"text-green-100"),m(),D(" ",t.gameComplete()?"\u606D\u559C\u4F60\u5168\u90E8\u7834\u95DC\uFF01":"\u95DC\u5361 "+t.level()+" \u5B8C\u6210\uFF01"," "),m(),C(t.gameComplete()?5:6),m(2),x(t.gameComplete()?"bg-yellow-400 hover:bg-yellow-300 text-yellow-900":"bg-green-500 hover:bg-green-400 text-green-900"),m(),D(" ",t.gameComplete()?"\u91CD\u65B0\u6311\u6230":"\u4E0B\u4E00\u95DC \u2192"," ")}}var ee=class a{pathfindingService=B(V);gameLogicService=B(A);platformId=B(H);isBrowser=Q(this.platformId);boardWidth=6;boardHeight=9;petTypes=12;gameRules={title:"\u5BF5\u7269\u9023\u9023\u770B\u904A\u6232\u898F\u5247",rules:["\u9EDE\u64CA\u5169\u500B\u76F8\u540C\u7684\u5BF5\u7269\u5716\u6848\u9032\u884C\u914D\u5C0D\u6D88\u9664","\u5169\u500B\u5716\u6848\u4E4B\u9593\u7684\u9023\u7DDA\u6700\u591A\u53EA\u80FD\u67092\u500B\u8F49\u5F4E","\u9023\u7DDA\u8DEF\u5F91\u4E0D\u80FD\u88AB\u5176\u4ED6\u5716\u6848\u963B\u64CB","\u6210\u529F\u914D\u5C0D\u5F8C\u5716\u6848\u6703\u6D88\u9664\u4E26\u7372\u5F97\u5206\u6578","\u6BCF\u95DC\u9650\u66425\u5206\u9418\uFF0C\u8D85\u6642\u5373\u904A\u6232\u7D50\u675F","\u6D88\u9664\u6240\u6709\u5716\u6848\u5373\u53EF\u904E\u95DC\u9032\u5165\u4E0B\u4E00\u95DC","\u4E0D\u540C\u95DC\u5361\u6709\u4E0D\u540C\u7684\u91CD\u529B\u88DC\u4F4D\u6548\u679C"]};board=f([]);selectedTiles=f([]);score=f(0);level=f(1);gameOver=f(!1);levelComplete=f(!1);gameComplete=f(!1);matchPath=f([]);showPath=f(!1);moves=f(0);gameTime=f(0);remainingTiles=T(()=>this.gameLogicService.getRemainingTileCount(this.board()));formattedTime=T(()=>this.gameLogicService.formatTime(this.gameTime()));MAX_LEVEL_TIME=300;countdownTime=f(this.MAX_LEVEL_TIME);formattedCountdown=T(()=>{let e=this.countdownTime(),t=Math.floor(e/60),i=e%60;return`${t.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`});timeUp=T(()=>this.countdownTime()<=0);timelinePercentage=T(()=>this.countdownTime()/this.MAX_LEVEL_TIME*100);timelineColorClass=T(()=>this.countdownTime()<=30?"from-red-500 to-red-300":this.countdownTime()<=60?"from-yellow-500 to-yellow-300":"from-lime-500 to-lime-300");timelineTextClass=T(()=>this.countdownTime()<=this.MAX_LEVEL_TIME*.5?"text-white":"text-neutral-900/90");totalShufflesUsed=f(0);totalHintsUsed=f(0);maxShufflesPerGame=f(5);maxHintsPerGame=f(5);remainingShuffles=T(()=>this.maxShufflesPerGame()-this.totalShufflesUsed());remainingHints=T(()=>this.maxHintsPerGame()-this.totalHintsUsed());hintTiles=f([]);showHint=f(!1);animationTimeout;gameStartTime=0;timeUpdateInterval;countdownInterval;levelStartTime=0;petEmojis=["\u{1F436}","\u{1F431}","\u{1F42D}","\u{1F439}","\u{1F430}","\u{1F98A}","\u{1F43B}","\u{1F43C}","\u{1F437}","\u{1F438}","\u{1F435}","\u{1F98B}"];ngOnInit(){this.initializeBoard()}ngOnDestroy(){this.clearAllTimers()}clearAllTimers(){this.animationTimeout&&clearTimeout(this.animationTimeout),this.timeUpdateInterval&&clearInterval(this.timeUpdateInterval),this.countdownInterval&&clearInterval(this.countdownInterval)}initializeBoard(){let e=this.gameLogicService.initializeBoard(this.boardWidth,this.boardHeight,this.petTypes);this.board.set(e),this.startLevelTimer()}startLevelTimer(){this.isBrowser&&(this.clearAllTimers(),this.levelStartTime=Date.now(),this.countdownTime.set(this.MAX_LEVEL_TIME),this.timeUpdateInterval=setInterval(()=>{let e=this.gameLogicService.getElapsedTime(this.levelStartTime);this.gameTime.set(e)},1e3),this.countdownInterval=setInterval(()=>{let e=this.gameLogicService.getElapsedTime(this.levelStartTime),t=Math.max(0,this.MAX_LEVEL_TIME-e);this.countdownTime.set(t),t<=0&&this.handleTimeUp()},1e3))}handleTimeUp(){this.gameOver()||(this.clearAllTimers(),this.gameOver.set(!0))}getCurrentLevelType(){let e=this.level();return e===1?"classic":e===2?"down":e===3?"up":e===4?"left":"right"}applyLevelGravity(e){switch(this.getCurrentLevelType()){case"classic":break;case"down":this.gameLogicService.collapseBoardDown(e,this.boardWidth,this.boardHeight);break;case"up":this.gameLogicService.collapseBoardUp(e,this.boardWidth,this.boardHeight);break;case"left":this.gameLogicService.collapseBoardLeft(e,this.boardWidth,this.boardHeight);break;case"right":this.gameLogicService.collapseBoardRight(e,this.boardWidth,this.boardHeight);break}}onTileClick(e){if(!e||this.gameOver()||this.showPath())return;let t=this.selectedTiles();if(e.selected){e.selected=!1,this.selectedTiles.set(t.filter(o=>o.id!==e.id));return}t.length>=2&&this.clearSelection(),e.selected=!0;let i=[...t,e];this.selectedTiles.set(i),i.length===2&&this.checkMatch(i[0],i[1])}checkMatch(e,t){if(e.petType!==t.petType){this.isBrowser?setTimeout(()=>this.clearSelection(),300):this.clearSelection();return}this.moves.update(o=>o+1);let i=this.pathfindingService.findPath(e.position,t.position,this.board(),this.boardWidth,this.boardHeight);if(this.isBrowser&&!i&&console.log(`\u914D\u5C0D\u5931\u6557: \u5BF5\u7269${this.petEmojis[e.petType]} (${e.position.x},${e.position.y}) \u2192 (${t.position.x},${t.position.y}) \u7121\u6CD5\u627E\u5230\u8DEF\u5F91`),i){this.matchPath.set(i),this.showPath.set(!0);let o=()=>{let l=this.board();this.gameLogicService.removeTiles(l,e,t),this.applyLevelGravity(l),this.board.set([...l]),this.score.update(n=>n+10),this.showPath.set(!1),this.matchPath.set([]),this.clearSelection(),this.checkGameOver()};this.isBrowser?this.animationTimeout=setTimeout(o,200):o()}else this.isBrowser?setTimeout(()=>this.clearSelection(),300):this.clearSelection()}clearSelection(){this.selectedTiles().forEach(t=>t.selected=!1),this.selectedTiles.set([])}checkGameOver(){let e=this.board();if(this.gameLogicService.isGameComplete(e)){this.levelComplete.set(!0),this.clearAllTimers(),this.level()>=5&&this.gameComplete.set(!0);return}this.gameLogicService.hasValidMoves(e,this.boardWidth,this.boardHeight,this.pathfindingService)||(this.remainingTiles()>0&&this.canUseShuffle()?(console.log("\u81EA\u52D5\u89F8\u767C\u91CD\u6392\uFF1A\u7121\u53EF\u7528\u79FB\u52D5\u4F46\u9084\u6709\u5269\u9918\u65B9\u584A"),this.shuffleTiles()):(this.gameOver.set(!0),this.stopTimer()))}stopTimer(){this.timeUpdateInterval&&(clearInterval(this.timeUpdateInterval),this.timeUpdateInterval=void 0)}nextLevel(){this.gameComplete()||(this.level.update(e=>e+1),this.levelComplete.set(!1),this.clearSelection(),this.showPath.set(!1),this.matchPath.set([]),this.hideHint(),this.clearAllTimers(),this.animationTimeout&&clearTimeout(this.animationTimeout),this.initializeBoard())}resetGame(){this.score.set(0),this.level.set(1),this.moves.set(0),this.gameTime.set(0),this.totalShufflesUsed.set(0),this.totalHintsUsed.set(0),this.hideHint(),this.gameOver.set(!1),this.levelComplete.set(!1),this.gameComplete.set(!1),this.clearSelection(),this.showPath.set(!1),this.matchPath.set([]),this.clearAllTimers(),this.animationTimeout&&clearTimeout(this.animationTimeout),this.initializeBoard()}getTileClass(e){if(!e)return"bg-stone-800 border border-stone-700";let t="bg-gradient-to-br border-2 cursor-pointer flex items-center justify-center text-2xl";if(e.selected)return`${t} from-yellow-400 to-yellow-600 border-yellow-300 brightness-125`;if(this.isHintTile(e))return`${t} from-green-400 to-green-600 border-green-300 animate-pulse ring-2 ring-green-400 ring-opacity-75`;let i=["from-blue-400 to-blue-600 border-blue-300","from-pink-400 to-pink-600 border-pink-300","from-gray-400 to-gray-600 border-gray-300","from-yellow-400 to-yellow-600 border-yellow-300","from-purple-400 to-purple-600 border-purple-300","from-orange-400 to-orange-600 border-orange-300","from-amber-600 to-amber-800 border-amber-400","from-slate-400 to-slate-600 border-slate-300","from-rose-400 to-rose-600 border-rose-300","from-green-400 to-green-600 border-green-300","from-teal-400 to-teal-600 border-teal-300","from-violet-400 to-violet-600 border-violet-300"];return`${t} ${i[e.petType]||i[0]}`}getPathStyle(e){let o=e.start.x*50,l=e.start.y*50,n=e.end.x*50,r=e.end.y*50;if(e.direction==="horizontal"){let s=Math.min(o,n)+24,h=Math.abs(n-o),p=l+48/2-1;return{position:"absolute",left:`${s}px`,top:`${p}px`,width:`${h}px`,height:"2px",background:"linear-gradient(90deg, #fbbf24, #f59e0b)",boxShadow:"0 0 8px #fbbf24, 0 0 8px #f59e0b",zIndex:10}}else{let s=Math.min(l,r)+24,h=Math.abs(r-l);return{position:"absolute",left:`${o+48/2-1}px`,top:`${s}px`,width:"2px",height:`${h}px`,background:"linear-gradient(180deg, #fbbf24, #f59e0b)",boxShadow:"0 0 8px #fbbf24, 0 0 16px #f59e0b",zIndex:10}}}shuffleTiles(){if(!this.canUseShuffle()||this.gameOver()||this.levelComplete()||this.remainingTiles()===0)return;this.clearSelection();let e=this.board(),t=[];for(let l=0;l<this.boardHeight;l++)for(let n=0;n<this.boardWidth;n++)e[l][n]&&t.push(e[l][n].petType);for(let l=t.length-1;l>0;l--){let n=Math.floor(Math.random()*(l+1));[t[l],t[n]]=[t[n],t[l]]}let i=0,o=Date.now();for(let l=0;l<this.boardHeight;l++)for(let n=0;n<this.boardWidth;n++)e[l][n]&&(e[l][n]={id:o++,petType:t[i++],position:{x:n,y:l},selected:!1});this.board.set([...e]),this.totalShufflesUsed.update(l=>l+1),this.checkGameOver()}hasAvailableMoves(){return this.gameLogicService.hasValidMoves(this.board(),this.boardWidth,this.boardHeight,this.pathfindingService)}canUseShuffle(){return this.remainingShuffles()>0&&!this.gameOver()&&!this.levelComplete()&&!this.timeUp()&&this.remainingTiles()>0}useHint(){if(!this.canUseHint())return;this.clearSelection();let e=this.findValidPair();e&&(this.hintTiles.set([e.tile1,e.tile2]),this.showHint.set(!0),this.totalHintsUsed.update(t=>t+1),this.isBrowser&&setTimeout(()=>this.hideHint(),3e3))}hideHint(){this.showHint.set(!1),this.hintTiles.set([])}canUseHint(){return this.remainingHints()>0&&!this.gameOver()&&!this.levelComplete()&&!this.timeUp()&&!this.showHint()&&this.remainingTiles()>0}findValidPair(){let e=this.board();for(let t=0;t<this.boardHeight;t++)for(let i=0;i<this.boardWidth;i++){let o=e[t][i];if(o)for(let l=0;l<this.boardHeight;l++)for(let n=0;n<this.boardWidth;n++){let r=e[l][n];if(!(!r||o.id===r.id)&&o.petType===r.petType&&this.pathfindingService.findPath(o.position,r.position,e,this.boardWidth,this.boardHeight))return{tile1:o,tile2:r}}}return null}isHintTile(e){return!e||!this.showHint()?!1:this.hintTiles().some(t=>t.id===e.id)}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=j({type:a,selectors:[["app-pet-match"]],decls:56,vars:35,consts:[[1,"w-full","max-w-sm","mx-auto","flex","flex-col"],[1,"mb-2","flex","flex-col","gap-3","items-stretch"],["title","\u5BF5\u7269\u9023\u9023\u770B",3,"gameRules"],[1,"flex","gap-2"],[1,"h-12","w-1/3","rounded-md","bg-cyan-700","border","border-cyan-500","text-cyan-50","font-semibold","text-base","shadow","hover:bg-cyan-600","focus:outline-none","focus:ring-2","focus:ring-cyan-300"],[1,"h-12","w-1/3","rounded-md","bg-lime-700","border","border-lime-500","text-lime-50","font-semibold","text-base","shadow","hover:bg-lime-600","focus:outline-none","focus:ring-2","focus:ring-lime-300"],[1,"h-12","w-1/3","rounded-md","border","font-medium","shadow","focus:outline-none","focus:ring-2",3,"click","disabled","title"],[1,"flex","flex-col","gap-2"],[1,"flex","items-center","gap-1","justify-center","flex-wrap","bg-neutral-900/70","rounded-md","p-2","border","border-neutral-700"],[1,"border","border-cyan-400","bg-cyan-400/20","px-2","py-1","text-cyan-300","font-bold","hover:bg-cyan-400/30","transition"],[1,"text-cyan-400","text-xs"],[1,"text-center","text-xs"],[1,"border","border-lime-400","bg-lime-400/20","px-2","py-1","text-lime-300","font-bold","hover:bg-lime-400/30","transition"],[1,"text-lime-400","text-xs"],[1,"border","border-yellow-400","bg-yellow-400/20","px-2","py-1","text-yellow-300","font-bold","hover:bg-yellow-400/30","transition"],[1,"text-yellow-400","text-xs"],[1,"border","border-orange-400","bg-orange-400/20","px-2","py-1","text-orange-300","font-bold","hover:bg-orange-400/30","transition"],[1,"text-orange-400","text-xs"],[1,"text-center","border","border-purple-400","bg-purple-400/20","px-1","py-1","text-purple-300","font-bold","hover:bg-purple-400/30","transition","w-16"],[1,"text-purple-400","text-xs"],[1,"text-center","text-xs","flex","gap-1","justify-center","h-4","items-center","overflow-hidden"],[1,"text-neutral-500","text-xs","leading-none"],[1,"w-full","mt-2","h-2","bg-neutral-700/80","rounded","overflow-hidden","relative"],[1,"h-full","bg-gradient-to-r","transition-all","duration-300"],[1,"absolute","inset-0","text-[9px]","tracking-wide","font-semibold","flex","items-center","justify-center","select-none","transition-colors","duration-300"],[1,"flex","justify-center"],[1,"relative","inline-block"],[1,"inline-grid","gap-[2px]","p-4","border-2","border-lime-700","rounded-lg",3,"ngStyle"],[1,"absolute","inset-0","pointer-events-none"],[1,"absolute","inset-0","bg-black/50","backdrop-blur-sm","flex","items-center","justify-center","z-50","rounded-lg"],[1,"h-12","w-1/3","rounded-md","bg-cyan-700","border","border-cyan-500","text-cyan-50","font-semibold","text-base","shadow","hover:bg-cyan-600","focus:outline-none","focus:ring-2","focus:ring-cyan-300",3,"click"],[1,"h-12","w-1/3","rounded-md","bg-lime-700","border","border-lime-500","text-lime-50","font-semibold","text-base","shadow","hover:bg-lime-600","focus:outline-none","focus:ring-2","focus:ring-lime-300",3,"click"],[1,"text-xs","leading-none"],[1,"w-12","h-12","rounded-lg","relative",3,"ngClass"],[1,"w-12","h-12","rounded-lg","relative",3,"click","ngClass"],[1,"select-none","pointer-events-none"],[1,"absolute","animate-pulse","transition-all","duration-300",3,"ngStyle"],[1,"bg-gradient-to-br","border-2","rounded-lg","p-8","shadow-2xl","text-center"],[1,"text-3xl","mb-4",3,"innerHTML"],[1,"text-2xl","font-bold","mb-4"],[1,"rounded-lg","p-3","mb-6"],[1,"font-bold","text-2xl"],[1,"font-bold","py-3","px-6","rounded-lg","transition-all","duration-200","transform","hover:scale-105","shadow-lg",3,"click"],[1,"mb-6"],[1,"text-yellow-200","text-lg","mb-4"],[1,"grid","grid-cols-2","gap-4","text-sm"],[1,"bg-yellow-600/50","rounded-lg","p-3"],[1,"text-yellow-200"],[1,"text-yellow-100","font-bold","text-xl"],[1,"grid","grid-cols-2","gap-4","mb-6","text-sm"],[1,"bg-green-700/50","rounded-lg","p-3"],[1,"text-green-200"],[1,"text-green-100","font-bold","text-xl"],[1,"bg-green-700/50","rounded-lg","p-3","mb-6"],[1,"text-green-100","font-bold","text-2xl"]],template:function(t,i){t&1&&(c(0,"div",0)(1,"header",1),M(2,"app-game-header",2),c(3,"div",3),S(4,oe,2,0,"button",4)(5,le,2,0,"button",5),c(6,"button",6),_("click",function(){return i.shuffleTiles()}),u(7," \u91CD\u6392 ("),c(8,"span"),u(9),d(),u(10,") "),d(),c(11,"button",6),_("click",function(){return i.useHint()}),u(12," \u63D0\u793A ("),c(13,"span"),u(14),d(),u(15,") "),d()(),c(16,"div",7)(17,"div",8)(18,"div",9)(19,"div",10),u(20,"\u95DC\u5361"),d(),c(21,"div",11),u(22),d()(),c(23,"div",12)(24,"div",13),u(25,"\u5206\u6578"),d(),c(26,"div",11),u(27),d()(),c(28,"div",14)(29,"div",15),u(30,"\u79FB\u52D5"),d(),c(31,"div",11),u(32),d()(),c(33,"div",16)(34,"div",17),u(35,"\u5269\u9918"),d(),c(36,"div",11),u(37),d()(),c(38,"div",18)(39,"div",19),u(40,"\u5DF2\u9078"),d(),c(41,"div",20),S(42,ae,2,0)(43,se,2,0,"span",21),d()(),c(44,"div",22),M(45,"div",23),c(46,"span",24),u(47),d()()()()(),c(48,"main",25)(49,"div",26)(50,"div",27),I(51,de,2,0,null,null,R),d(),S(53,he,3,0,"div",28),S(54,pe,12,15,"div",29),S(55,ve,9,10,"div",29),d()()()),t&2&&(m(2),b("gameRules",i.gameRules),m(2),C(i.gameOver()?4:5),m(2),x(i.canUseShuffle()?"bg-zinc-800 border-zinc-600 text-lime-200 hover:bg-zinc-700 focus:ring-lime-300":"bg-zinc-800 border-zinc-600 text-zinc-400 opacity-50"),b("title",$("\u91CD\u65B0\u6D17\u724C\u6240\u6709\u65B9\u584A (\u5269\u9918: ",i.remainingShuffles(),")"))("disabled",!i.canUseShuffle()),m(3),k("",i.totalShufflesUsed(),"/",i.maxShufflesPerGame()),m(2),x(i.canUseHint()?"bg-emerald-700 border-emerald-500 text-emerald-50 hover:bg-emerald-600 focus:ring-emerald-300":"bg-zinc-800 border-zinc-600 text-zinc-400 opacity-50"),b("title",$("\u986F\u793A\u4E00\u500B\u53EF\u914D\u5C0D\u7684\u63D0\u793A (\u5269\u9918: ",i.remainingHints(),")"))("disabled",!i.canUseHint()),m(3),k("",i.totalHintsUsed(),"/",i.maxHintsPerGame()),m(8),y(i.level()),m(5),y(i.score()),m(5),y(i.moves()),m(5),y(i.remainingTiles()),m(5),C(i.selectedTiles().length>0?42:43),m(3),x(i.timelineColorClass()),Y("width",i.timelinePercentage(),"%"),m(),x(i.timelineTextClass()),m(),k(" ",i.formattedTime()," / ",i.formattedCountdown()," "),m(3),b("ngStyle",X(33,te,"repeat("+i.boardWidth+", minmax(0, 1fr))")),m(),L(i.board()),m(2),C(i.showPath()?53:-1),m(),C(i.gameOver()?54:-1),m(),C(i.levelComplete()?55:-1))},dependencies:[K,J,q,Z],encapsulation:2})};export{ee as PetMatch};
