import{b as ae}from"./chunk-XSR2BEZR.js";import{a as re,b as oe}from"./chunk-A5EABR2Y.js";import{$ as ne,A as L,B as g,C as m,D as u,E,F as B,G as P,H as S,K as ee,N as d,O as y,P as I,Q as O,R as Y,T as te,X as f,_ as ie,a as T,aa as le,b as _,ba as U,d as Q,g as D,h as A,i as N,m as Z,o as z,p as H,s as c,t as W,v as M,w,x as $,z as G}from"./chunk-GC2AWETS.js";var C={width:14,height:10,petTypes:12,maxLevelTime:300};var b={MATCH_SCORE:10,MAX_SHUFFLES_PER_GAME:5,MAX_HINTS_PER_GAME:5,HINT_DISPLAY_TIME:3e3,PATH_ANIMATION_TIME:200,SELECTION_CLEAR_TIME:300,MAX_LEVELS:5,MAX_TURNS:2,TIMER_INTERVAL:1e3},se=["\u{1F436}","\u{1F431}","\u{1F42D}","\u{1F439}","\u{1F430}","\u{1F98A}","\u{1F43B}","\u{1F43C}","\u{1F437}","\u{1F438}","\u{1F435}","\u{1F98B}","\u{1F414}","\u{1F986}","\u{1F985}","\u{1F989}","\u{1F43A}","\u{1F417}"],j=["from-blue-400 to-blue-600 border-blue-300","from-pink-400 to-pink-600 border-pink-300","from-gray-400 to-gray-600 border-gray-300","from-yellow-400 to-yellow-600 border-yellow-300","from-purple-400 to-purple-600 border-purple-300","from-orange-400 to-orange-600 border-orange-300","from-amber-600 to-amber-800 border-amber-400","from-slate-400 to-slate-600 border-slate-300","from-rose-400 to-rose-600 border-rose-300","from-green-400 to-green-600 border-green-300","from-teal-400 to-teal-600 border-teal-300","from-violet-400 to-violet-600 border-violet-300","from-red-400 to-red-600 border-red-300","from-cyan-400 to-cyan-600 border-cyan-300","from-indigo-400 to-indigo-600 border-indigo-300","from-fuchsia-400 to-fuchsia-600 border-fuchsia-300","from-zinc-400 to-zinc-600 border-zinc-300","from-stone-400 to-stone-600 border-stone-300"];function pe(a,e){let i={cellSize:48,paddingHorizontal:40,paddingVertical:280,gapTotal:2,borderTotal:4,minBoardSize:6,maxBoardWidth:10,maxBoardHeight:15,elementDensity:void 0},t=ae(a,e,i),l=t.width*t.height;l%2!==0&&(t.height>i.minBoardSize?(t.height--,l=t.width*t.height):t.width>i.minBoardSize&&(t.width--,l=t.width*t.height));let r=Math.min(12,Math.max(6,Math.floor(l/2)));return{width:t.width,height:t.height,petTypes:r}}function k(a,e,i){if(a&&e&&i){let t=pe(e,i);return _(T({},t),{maxLevelTime:C.maxLevelTime})}return T({},C)}function me(a){return a===1?"classic":a===2?"down":a===3?"up":a===4?"left":"right"}var F=class{initializeBoard(e,i,t){let l=[],r=0,n=e*i,o=[];for(let h=0;h<n/2;h++){let p=h%t;o.push(p,p)}for(let h=o.length-1;h>0;h--){let p=Math.floor(Math.random()*(h+1));[o[h],o[p]]=[o[p],o[h]]}let s=0;for(let h=0;h<i;h++){l[h]=[];for(let p=0;p<e;p++)s<o.length?l[h][p]={id:r++,petType:o[s++],position:{x:p,y:h},selected:!1}:l[h][p]=null}return l}removeTiles(e,i,t){e[i.position.y][i.position.x]=null,e[t.position.y][t.position.x]=null}collapseBoardDown(e,i,t){for(let l=0;l<i;l++){let r=[];for(let n=t-1;n>=0;n--)e[n][l]&&r.unshift(e[n][l]);for(let n=0;n<t;n++)if(n<t-r.length)e[n][l]=null;else{let o=r[n-(t-r.length)];o&&(o.position={x:l,y:n},e[n][l]=o)}}}collapseBoardUp(e,i,t){for(let l=0;l<i;l++){let r=[];for(let n=0;n<t;n++)e[n][l]&&r.push(e[n][l]);for(let n=0;n<t;n++)if(n<r.length){let o=r[n];o&&(o.position={x:l,y:n},e[n][l]=o)}else e[n][l]=null}}collapseBoardLeft(e,i,t){for(let l=0;l<t;l++){let r=[];for(let n=0;n<i;n++)e[l][n]&&r.push(e[l][n]);for(let n=0;n<i;n++)if(n<r.length){let o=r[n];o&&(o.position={x:n,y:l},e[l][n]=o)}else e[l][n]=null}}collapseBoardRight(e,i,t){for(let l=0;l<t;l++){let r=[];for(let n=i-1;n>=0;n--)e[l][n]&&r.unshift(e[l][n]);for(let n=0;n<i;n++)if(n<i-r.length)e[l][n]=null;else{let o=r[n-(i-r.length)];o&&(o.position={x:n,y:l},e[l][n]=o)}}}getRemainingTileCount(e){return e.flat().filter(i=>i!==null).length}isGameComplete(e){return this.getRemainingTileCount(e)===0}hasValidMoves(e,i,t,l){for(let r=0;r<t;r++)for(let n=0;n<i;n++){let o=e[r][n];if(o)for(let s=0;s<t;s++)for(let h=0;h<i;h++){let p=e[s][h];if(!(!p||o.id===p.id||o.petType!==p.petType)&&l.findPath(o.position,p.position,e,i,t))return!0}}return!1}findValidPair(e,i,t,l){for(let r=0;r<t;r++)for(let n=0;n<i;n++){let o=e[r][n];if(o)for(let s=0;s<t;s++)for(let h=0;h<i;h++){let p=e[s][h];if(!p||o.id===p.id||o.petType!==p.petType)continue;if(l.findPath(o.position,p.position,e,i,t))return{tile1:o,tile2:p}}}return null}getElapsedTime(e){return Math.floor((Date.now()-e)/1e3)}formatTime(e){let i=Math.floor(e/60),t=e%60;return`${i.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`}};var R=class{findPath(e,i,t,l,r){let n=this.tryDirectPath(e,i,t,l,r);if(n)return n;let o=this.tryLShapePath(e,i,t,l,r);if(o)return o;let s=this.tryUShapePath(e,i,t,l,r);if(s)return s;let h=this.tryBoundaryPath(e,i,t,l,r);return h||null}tryDirectPath(e,i,t,l,r){return e.y===i.y&&this.isPathClear(e,i,"horizontal",t,l,r)?[{start:e,end:i,direction:"horizontal"}]:e.x===i.x&&this.isPathClear(e,i,"vertical",t,l,r)?[{start:e,end:i,direction:"vertical"}]:null}tryLShapePath(e,i,t,l,r){let n={x:e.x,y:i.y},o=!(n.x===e.x&&n.y===e.y)&&!(n.x===i.x&&n.y===i.y),s=this.isValidPosition(n,t,l,r),h=o&&s&&this.isPathClear(e,n,"vertical",t,l,r),p=h&&this.isPathClear(n,i,"horizontal",t,l,r);if(o&&s&&h&&p)return[{start:e,end:n,direction:"vertical"},{start:n,end:i,direction:"horizontal"}];let x={x:i.x,y:e.y},J=!(x.x===e.x&&x.y===e.y)&&!(x.x===i.x&&x.y===i.y),q=this.isValidPosition(x,t,l,r),K=J&&q&&this.isPathClear(e,x,"horizontal",t,l,r),he=K&&this.isPathClear(x,i,"vertical",t,l,r);return J&&q&&K&&he?[{start:e,end:x,direction:"horizontal"},{start:x,end:i,direction:"vertical"}]:null}tryUShapePath(e,i,t,l,r){for(let n=0;n<l;n++)if(n!==e.x&&n!==i.x){let o={x:n,y:e.y},s={x:n,y:i.y};if(this.isValidPosition(o,t,l,r)&&this.isValidPosition(s,t,l,r)&&this.isPathClear(e,o,"horizontal",t,l,r)&&this.isPathClear(o,s,"vertical",t,l,r)&&this.isPathClear(s,i,"horizontal",t,l,r))return[{start:e,end:o,direction:"horizontal"},{start:o,end:s,direction:"vertical"},{start:s,end:i,direction:"horizontal"}]}for(let n=0;n<r;n++)if(n!==e.y&&n!==i.y){let o={x:e.x,y:n},s={x:i.x,y:n};if(this.isValidPosition(o,t,l,r)&&this.isValidPosition(s,t,l,r)&&this.isPathClear(e,o,"vertical",t,l,r)&&this.isPathClear(o,s,"horizontal",t,l,r)&&this.isPathClear(s,i,"vertical",t,l,r))return[{start:e,end:o,direction:"vertical"},{start:o,end:s,direction:"horizontal"},{start:s,end:i,direction:"vertical"}]}return null}tryBoundaryPath(e,i,t,l,r){let n=[{y:-1,name:"top"},{y:r,name:"bottom"},{x:-1,name:"left"},{x:l,name:"right"}];for(let o of n){let s=this.tryBoundaryRoute(e,i,o,t,l,r);if(s)return s}return null}tryBoundaryRoute(e,i,t,l,r,n){if("y"in t){let o={x:e.x,y:t.y},s={x:i.x,y:t.y};if(this.isPathClear(e,o,"vertical",l,r,n)&&this.isPathClear(o,s,"horizontal",l,r,n)&&this.isPathClear(s,i,"vertical",l,r,n))return[{start:e,end:o,direction:"vertical"},{start:o,end:s,direction:"horizontal"},{start:s,end:i,direction:"vertical"}]}else{let o={x:t.x,y:e.y},s={x:t.x,y:i.y};if(this.isPathClear(e,o,"horizontal",l,r,n)&&this.isPathClear(o,s,"vertical",l,r,n)&&this.isPathClear(s,i,"horizontal",l,r,n))return[{start:e,end:o,direction:"horizontal"},{start:o,end:s,direction:"vertical"},{start:s,end:i,direction:"horizontal"}]}return null}isPathClear(e,i,t,l,r,n){if(e.x===i.x&&e.y===i.y)return!0;if(t==="horizontal"){if(e.y!==i.y)return!1;let o=Math.min(e.x,i.x),s=Math.max(e.x,i.x);return this.checkLineEmpty(o+1,s,e.y,"horizontal",l,r,n)}else{if(e.x!==i.x)return!1;let o=Math.min(e.y,i.y),s=Math.max(e.y,i.y);return this.checkLineEmpty(o+1,s,e.x,"vertical",l,r,n)}}checkLineEmpty(e,i,t,l,r,n,o){for(let s=e;s<i;s++){let h=l==="horizontal"?s:t,p=l==="horizontal"?t:s;if(h>=0&&h<n&&p>=0&&p<o&&r[p][h])return!1}return!0}isValidPosition(e,i,t,l){return e.x<0||e.x>=t||e.y<0||e.y>=l?!0:!i[e.y][e.x]}};var v=class{static isValidPosition(e,i,t){return e.x>=0&&e.x<i&&e.y>=0&&e.y<t}static isValidGameConfig(e,i,t){let l=e*i;return!(e<=0||i<=0||t<=0||t>18||l%2!==0||l/2<t)}static canMakeMove(e){return e.gameStatus==="playing"&&e.levelStatus==="playing"}static canClickTile(e,i){return!(!e||!this.canMakeMove(i))}static canMatch(e,i){return!(e.id===i.id||e.petType!==i.petType)}static isLevelComplete(e){return e.remainingTiles===0}static isGameOver(e){return e.gameStatus==="timeup"||e.gameStatus==="nomoves"}static isGameComplete(e){return e.gameStatus==="complete"}static hasTimeRemaining(e){return e.countdownTime>0}static isValidLevel(e){return e>=1&&e<=b.MAX_LEVELS}static canUseShuffle(e){return e.totalShufflesUsed<e.maxShufflesPerGame&&e.gameStatus==="playing"&&e.remainingTiles>0&&this.hasTimeRemaining(e)}static canUseHint(e){return e.totalHintsUsed<e.maxHintsPerGame&&e.gameStatus==="playing"&&!e.showHint&&e.remainingTiles>0&&this.hasTimeRemaining(e)}static hasTilesRemaining(e){for(let i of e)for(let t of i)if(t!==null)return!0;return!1}static countRemainingTiles(e){let i=0;for(let t of e)for(let l of t)l!==null&&i++;return i}static isTileSelected(e,i){return i.some(t=>t.id===e.id)}static isHintTile(e,i){return i.showHint?i.hintTiles.some(t=>t.id===e.id):!1}static isValidLevelType(e){return["classic","down","up","left","right"].includes(e)}};var X={board:[],width:C.width,height:C.height,petTypes:C.petTypes,score:0,level:1,moves:0,remainingTiles:0,gameStatus:"waiting",levelStatus:"playing",gameTime:0,countdownTime:C.maxLevelTime,totalShufflesUsed:0,totalHintsUsed:0,maxShufflesPerGame:b.MAX_SHUFFLES_PER_GAME,maxHintsPerGame:b.MAX_HINTS_PER_GAME,hintTiles:[],showHint:!1},V=class a{platformId=D(z);isBrowser=U(this.platformId);gameState=Z(T({},X));logic=new F;pathfinding=new R;gameTimer=null;countdownTimer=null;levelStartTime=0;isMobile=!1;screenWidth=0;screenHeight=0;setDeviceType(e,i,t){this.isMobile=e,this.screenWidth=i||0,this.screenHeight=t||0}initializeGame(){this.stopAllTimers();let e=k(this.isMobile,this.screenWidth,this.screenHeight),i=this.logic.initializeBoard(e.width,e.height,e.petTypes),t=_(T({},X),{width:e.width,height:e.height,petTypes:e.petTypes,board:i,remainingTiles:this.logic.getRemainingTileCount(i),gameStatus:"playing",countdownTime:e.maxLevelTime});this.gameState.set(t),this.startLevelTimer()}resetGame(){this.stopAllTimers();let e=k(this.isMobile,this.screenWidth,this.screenHeight),i=this.logic.initializeBoard(e.width,e.height,e.petTypes),t=_(T({},X),{width:e.width,height:e.height,petTypes:e.petTypes,board:i,remainingTiles:this.logic.getRemainingTileCount(i),gameStatus:"playing",countdownTime:e.maxLevelTime});this.gameState.set(t),this.startLevelTimer()}nextLevel(){let e=this.gameState();if(e.level>=b.MAX_LEVELS)return;this.stopAllTimers();let i=k(this.isMobile,this.screenWidth,this.screenHeight),t=this.logic.initializeBoard(i.width,i.height,i.petTypes),l=_(T({},e),{width:i.width,height:i.height,petTypes:i.petTypes,board:t,level:e.level+1,moves:0,remainingTiles:this.logic.getRemainingTileCount(t),gameStatus:"playing",levelStatus:"playing",gameTime:0,countdownTime:i.maxLevelTime,hintTiles:[],showHint:!1});this.gameState.set(l),this.startLevelTimer()}attemptMatch(e,i){let t=this.gameState();if(!v.canMakeMove(t))return{success:!1,path:null,tile1:e,tile2:i};if(!v.canMatch(e,i))return{success:!1,path:null,tile1:e,tile2:i};let l=this.pathfinding.findPath(e.position,i.position,t.board,t.width,t.height);return l?(this.logic.removeTiles(t.board,e,i),this.applyLevelGravity(t),t.score+=b.MATCH_SCORE,t.moves++,t.remainingTiles=this.logic.getRemainingTileCount(t.board),v.isLevelComplete(t)?(t.levelStatus="completed",t.level>=b.MAX_LEVELS&&(t.gameStatus="complete"),this.stopAllTimers()):this.logic.hasValidMoves(t.board,t.width,t.height,this.pathfinding)||(v.canUseShuffle(t)?this.shuffleTiles():(t.gameStatus="nomoves",t.levelStatus="failed",this.stopAllTimers())),this.gameState.set(T({},t)),{success:!0,path:l,tile1:e,tile2:i}):{success:!1,path:null,tile1:e,tile2:i}}shuffleTiles(){let e=this.gameState();if(!v.canUseShuffle(e))return;let i=[];for(let r=0;r<e.height;r++)for(let n=0;n<e.width;n++)e.board[r][n]&&i.push(e.board[r][n].petType);for(let r=i.length-1;r>0;r--){let n=Math.floor(Math.random()*(r+1));[i[r],i[n]]=[i[n],i[r]]}let t=0,l=Date.now();for(let r=0;r<e.height;r++)for(let n=0;n<e.width;n++)e.board[r][n]&&(e.board[r][n]={id:l++,petType:i[t++],position:{x:n,y:r},selected:!1});e.totalShufflesUsed++,this.gameState.set(T({},e)),this.logic.hasValidMoves(e.board,e.width,e.height,this.pathfinding)||(v.canUseShuffle(e)?this.shuffleTiles():(e.gameStatus="nomoves",e.levelStatus="failed",this.stopAllTimers(),this.gameState.set(T({},e))))}useHint(){let e=this.gameState();if(!v.canUseHint(e))return;let i=this.logic.findValidPair(e.board,e.width,e.height,this.pathfinding);i&&(e.hintTiles=[i.tile1,i.tile2],e.showHint=!0,e.totalHintsUsed++,this.gameState.set(T({},e)))}hideHint(){let e=this.gameState();e.hintTiles=[],e.showHint=!1,this.gameState.set(T({},e))}applyLevelGravity(e){switch(me(e.level)){case"classic":break;case"down":this.logic.collapseBoardDown(e.board,e.width,e.height);break;case"up":this.logic.collapseBoardUp(e.board,e.width,e.height);break;case"left":this.logic.collapseBoardLeft(e.board,e.width,e.height);break;case"right":this.logic.collapseBoardRight(e.board,e.width,e.height);break}}startLevelTimer(){this.isBrowser&&(this.levelStartTime=Date.now(),this.gameTimer=window.setInterval(()=>{let e=this.gameState();e.gameTime=this.logic.getElapsedTime(this.levelStartTime),this.gameState.set(T({},e))},b.TIMER_INTERVAL),this.countdownTimer=window.setInterval(()=>{let e=this.gameState(),i=this.logic.getElapsedTime(this.levelStartTime),t=Math.max(0,C.maxLevelTime-i);e.countdownTime=t,t<=0&&(e.gameStatus="timeup",e.levelStatus="failed",this.stopAllTimers()),this.gameState.set(T({},e))},b.TIMER_INTERVAL))}stopAllTimers(){this.gameTimer&&(clearInterval(this.gameTimer),this.gameTimer=null),this.countdownTimer&&(clearInterval(this.countdownTimer),this.countdownTimer=null)}getRemainingShuffles(){let e=this.gameState();return e.maxShufflesPerGame-e.totalShufflesUsed}getRemainingHints(){let e=this.gameState();return e.maxHintsPerGame-e.totalHintsUsed}formatTime(e){return this.logic.formatTime(e)}cleanup(){this.stopAllTimers()}static \u0275fac=function(i){return new(i||a)};static \u0275prov=Q({token:a,factory:a.\u0275fac,providedIn:"root"})};var ge=a=>({"grid-template-columns":a}),ve=(a,e)=>e.id,Te=(a,e)=>(e==null?null:e.id)||a;function xe(a,e){if(a&1){let i=B();m(0,"button",37),P("click",function(){A(i);let l=S();return N(l.resetGame())}),d(1," \u91CD\u65B0\u958B\u59CB "),u()}}function Se(a,e){if(a&1){let i=B();m(0,"button",38),P("click",function(){A(i);let l=S();return N(l.resetGame())}),d(1," \u65B0\u904A\u6232 "),u()}}function ye(a,e){if(a&1&&(m(0,"span",39),d(1),u()),a&2){let i=e.$implicit,t=S(2);c(),y(t.petEmojis[i.petType])}}function be(a,e){if(a&1&&G(0,ye,2,1,"span",39,ve),a&2){let i=S();L(i.selectedTiles)}}function Pe(a,e){a&1&&(m(0,"span",21),d(1,"\u9EDE\u64CA\u5BF5\u7269"),u())}function Ce(a,e){if(a&1&&(m(0,"span",42),d(1),u()),a&2){let i=S().$implicit,t=S(2);c(),y(t.petEmojis[i.petType])}}function _e(a,e){if(a&1){let i=B();m(0,"div",41),P("click",function(){let l=A(i).$implicit,r=S(2);return N(r.onTileClick(l))}),M(1,Ce,2,1,"span",42),u()}if(a&2){let i=e.$implicit,t=S(2);g("ngClass",t.getTileClass(i)),c(),w(i?1:-1)}}function Me(a,e){if(a&1&&G(0,_e,2,2,"div",40,Te),a&2){let i=e.$implicit;L(i)}}function we(a,e){if(a&1&&E(0,"div",43),a&2){let i=e.$implicit,t=S(2);g("ngStyle",t.getPathStyle(i))}}function Ee(a,e){if(a&1&&(m(0,"div",28),G(1,we,1,1,"div",43,$),u()),a&2){let i=S();c(),L(i.getDisplayPath())}}function Ie(a,e){if(a&1&&(m(0,"div",36)(1,"div",44),d(2,"\u{1F3AE} \u904A\u6232\u7D71\u8A08 \u{1F3AE}"),u(),m(3,"div",45)(4,"div",46)(5,"div",47),d(6,"\u7E3D\u79FB\u52D5"),u(),m(7,"div",48),d(8),u()(),m(9,"div",46)(10,"div",47),d(11,"\u7E3D\u6642\u9593"),u(),m(12,"div",48),d(13),u()(),m(14,"div",46)(15,"div",47),d(16,"\u9053\u5177\u4F7F\u7528"),u(),m(17,"div",48),d(18),u()(),m(19,"div",46)(20,"div",47),d(21,"\u6700\u7D42\u5206\u6578"),u(),m(22,"div",48),d(23),u()()()()),a&2){let i=S();c(8),y(i.moves()),c(5),y(i.formattedTime()),c(5),I(" ",i.totalShufflesUsed()+i.totalHintsUsed()," "),c(5),y(i.score())}}function De(a,e){if(a&1&&(m(0,"div",49)(1,"div",50)(2,"div",51),d(3,"\u79FB\u52D5\u6B21\u6578"),u(),m(4,"div",52),d(5),u()(),m(6,"div",50)(7,"div",51),d(8,"\u5B8C\u6210\u6642\u9593"),u(),m(9,"div",52),d(10),u()()(),m(11,"div",53)(12,"div",51),d(13,"\u7E3D\u5206\u6578"),u(),m(14,"div",54),d(15),u()()),a&2){let i=S();c(5),y(i.moves()),c(5),y(i.formattedTime()),c(5),y(i.score())}}var de=class a{petMatchService=D(V);platformId=D(z);isBrowser=U(this.platformId);gameState=this.petMatchService.gameState;gameRules={title:"\u5BF5\u7269\u9023\u9023\u770B\u904A\u6232\u898F\u5247",rules:["\u9EDE\u64CA\u5169\u500B\u76F8\u540C\u7684\u5BF5\u7269\u5716\u6848\u9032\u884C\u914D\u5C0D\u6D88\u9664","\u5169\u500B\u5716\u6848\u4E4B\u9593\u7684\u9023\u7DDA\u6700\u591A\u53EA\u80FD\u67092\u500B\u8F49\u5F4E","\u9023\u7DDA\u8DEF\u5F91\u4E0D\u80FD\u88AB\u5176\u4ED6\u5716\u6848\u963B\u64CB","\u6210\u529F\u914D\u5C0D\u5F8C\u5716\u6848\u6703\u6D88\u9664\u4E26\u7372\u5F97\u5206\u6578","\u6BCF\u95DC\u9650\u66425\u5206\u9418\uFF0C\u8D85\u6642\u5373\u904A\u6232\u7D50\u675F","\u6D88\u9664\u6240\u6709\u5716\u6848\u5373\u53EF\u904E\u95DC\u9032\u5165\u4E0B\u4E00\u95DC","\u4E0D\u540C\u95DC\u5361\u6709\u4E0D\u540C\u7684\u91CD\u529B\u88DC\u4F4D\u6548\u679C"]};selectedTiles=[];matchPath=f(()=>[]);showPath=f(()=>!1);petEmojis=se;formattedTime=f(()=>this.petMatchService.formatTime(this.gameState().gameTime));formattedCountdown=f(()=>{let e=this.gameState().countdownTime,i=Math.floor(e/60),t=e%60;return`${i.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`});timelinePercentage=f(()=>this.gameState().countdownTime/300*100);timelineColorClass=f(()=>this.gameState().countdownTime<=30?"from-red-500 to-red-300":this.gameState().countdownTime<=60?"from-yellow-500 to-yellow-300":"from-lime-500 to-lime-300");timelineTextClass=f(()=>this.gameState().countdownTime<=150?"text-white":"text-neutral-900/90");remainingShuffles=f(()=>this.petMatchService.getRemainingShuffles());remainingHints=f(()=>this.petMatchService.getRemainingHints());board=f(()=>this.gameState().board);score=f(()=>this.gameState().score);level=f(()=>this.gameState().level);moves=f(()=>this.gameState().moves);remainingTiles=f(()=>this.gameState().remainingTiles);totalShufflesUsed=f(()=>this.gameState().totalShufflesUsed);totalHintsUsed=f(()=>this.gameState().totalHintsUsed);maxShufflesPerGame=f(()=>this.gameState().maxShufflesPerGame);maxHintsPerGame=f(()=>this.gameState().maxHintsPerGame);gameOver=f(()=>this.gameState().gameStatus==="timeup"||this.gameState().gameStatus==="nomoves");levelComplete=f(()=>this.gameState().levelStatus==="completed");gameComplete=f(()=>this.gameState().gameStatus==="complete");timeUp=f(()=>this.gameState().gameStatus==="timeup");selectedTilesSignal=f(()=>this.selectedTiles);animationTimeout;currentPath=[];showingPath=!1;ngOnInit(){if(this.isBrowser){let e=window.innerWidth<=768;this.petMatchService.setDeviceType(e,window.innerWidth,window.innerHeight)}this.petMatchService.initializeGame()}ngOnDestroy(){this.clearAnimationTimeout(),this.petMatchService.cleanup()}clearAnimationTimeout(){this.animationTimeout&&clearTimeout(this.animationTimeout)}onTileClick(e){if(!(!v.canClickTile(e,this.gameState())||this.showingPath)&&e){if(v.isHintTile(e,this.gameState())&&this.petMatchService.hideHint(),e.selected){e.selected=!1;let i=this.selectedTiles.findIndex(t=>t.id===e.id);i!==-1&&this.selectedTiles.splice(i,1);return}this.selectedTiles.length>=2&&this.clearSelection(),e.selected=!0,this.selectedTiles.push(e),this.selectedTiles.length===2&&this.checkMatch(this.selectedTiles[0],this.selectedTiles[1])}}checkMatch(e,i){let t=this.petMatchService.attemptMatch(e,i);if(t.success&&t.path){this.currentPath=t.path,this.showingPath=!0;let l=()=>{this.showingPath=!1,this.currentPath=[],this.clearSelection()};this.isBrowser?this.animationTimeout=setTimeout(l,b.PATH_ANIMATION_TIME):l()}else this.isBrowser?setTimeout(()=>this.clearSelection(),b.SELECTION_CLEAR_TIME):this.clearSelection()}clearSelection(){this.selectedTiles.forEach(e=>e.selected=!1),this.selectedTiles.length=0}nextLevel(){this.clearSelection(),this.petMatchService.nextLevel()}resetGame(){this.clearSelection(),this.clearAnimationTimeout(),this.petMatchService.resetGame()}getTileClass(e){if(!e)return"bg-stone-800 border border-stone-700";let i="bg-gradient-to-br border-2 cursor-pointer flex items-center justify-center text-2xl";return e.selected?`${i} from-yellow-400 to-yellow-600 border-yellow-300 brightness-125`:this.isHintTile(e)?`${i} from-green-400 to-green-600 border-green-300 animate-pulse ring-2 ring-green-400 ring-opacity-75`:`${i} ${j[e.petType]||j[0]}`}getPathStyle(e){let r=8+e.start.x*49,n=8+e.start.y*49,o=8+e.end.x*49,s=8+e.end.y*49;if(e.direction==="horizontal"){let h=Math.min(r,o)+24,p=Math.abs(o-r),x=n+48/2-1;return{position:"absolute",left:`${h}px`,top:`${x}px`,width:`${p}px`,height:"2px",background:"linear-gradient(90deg, #fbbf24, #f59e0b)",boxShadow:"0 0 8px #fbbf24, 0 0 8px #f59e0b",zIndex:10}}else{let h=Math.min(n,s)+24,p=Math.abs(s-n);return{position:"absolute",left:`${r+48/2-1}px`,top:`${h}px`,width:"2px",height:`${p}px`,background:"linear-gradient(180deg, #fbbf24, #f59e0b)",boxShadow:"0 0 8px #fbbf24, 0 0 16px #f59e0b",zIndex:10}}}shuffleTiles(){this.clearSelection(),this.petMatchService.shuffleTiles()}canUseShuffle(){return v.canUseShuffle(this.gameState())}useHint(){this.clearSelection(),this.petMatchService.useHint()}hideHint(){this.petMatchService.hideHint()}canUseHint(){return v.canUseHint(this.gameState())}isHintTile(e){return e?v.isHintTile(e,this.gameState()):!1}getDisplayPath(){return this.showingPath?this.currentPath:[]}static \u0275fac=function(i){return new(i||a)};static \u0275cmp=W({type:a,selectors:[["app-pet-match"]],decls:73,vars:51,consts:[[1,"w-full","max-w-sm","mx-auto","flex","flex-col"],[1,"mb-2","flex","flex-col","gap-3","items-stretch"],["title","\u5BF5\u7269\u9023\u9023\u770B",3,"gameRules"],[1,"flex","gap-2"],[1,"h-12","w-1/3","rounded-md","bg-cyan-700","border","border-cyan-500","text-cyan-50","font-semibold","text-base","shadow","hover:bg-cyan-600","focus:outline-none","focus:ring-2","focus:ring-cyan-300"],[1,"h-12","w-1/3","rounded-md","bg-lime-700","border","border-lime-500","text-lime-50","font-semibold","text-base","shadow","hover:bg-lime-600","focus:outline-none","focus:ring-2","focus:ring-lime-300"],[1,"h-12","w-1/3","rounded-md","border","font-medium","shadow","focus:outline-none","focus:ring-2",3,"click","ngClass","disabled","title"],[1,"flex","flex-col","gap-2"],[1,"flex","items-center","gap-1","justify-center","flex-wrap","bg-neutral-900/70","rounded-md","p-2","border","border-neutral-700"],[1,"border","border-cyan-400","bg-cyan-400/20","px-2","py-1","text-cyan-300","font-bold","hover:bg-cyan-400/30","transition"],[1,"text-cyan-400","text-xs"],[1,"text-center","text-xs"],[1,"border","border-lime-400","bg-lime-400/20","px-2","py-1","text-lime-300","font-bold","hover:bg-lime-400/30","transition"],[1,"text-lime-400","text-xs"],[1,"border","border-yellow-400","bg-yellow-400/20","px-2","py-1","text-yellow-300","font-bold","hover:bg-yellow-400/30","transition"],[1,"text-yellow-400","text-xs"],[1,"border","border-orange-400","bg-orange-400/20","px-2","py-1","text-orange-300","font-bold","hover:bg-orange-400/30","transition"],[1,"text-orange-400","text-xs"],[1,"text-center","border","border-purple-400","bg-purple-400/20","px-1","py-1","text-purple-300","font-bold","hover:bg-purple-400/30","transition","w-16"],[1,"text-purple-400","text-xs"],[1,"text-center","text-xs","flex","gap-1","justify-center","h-4","items-center","overflow-hidden"],[1,"text-neutral-500","text-xs","leading-none"],[1,"w-full","mt-2","h-2","bg-neutral-700/80","rounded","overflow-hidden","relative"],[1,"h-full","bg-gradient-to-r","transition-all","duration-300",3,"ngClass"],[1,"absolute","inset-0","text-[9px]","tracking-wide","font-semibold","flex","items-center","justify-center","select-none","transition-colors","duration-300",3,"ngClass"],[1,"flex","justify-center"],[1,"relative","inline-block"],[1,"inline-grid","gap-[1px]","p-2","bg-lime-900/40","border","border-lime-800","rounded","touch-none","select-none",3,"ngStyle"],[1,"absolute","inset-0","pointer-events-none"],[3,"close","isOpen","theme","showCloseButton","closeOnBackdrop"],[1,"text-3xl","mb-4",3,"innerHTML"],[1,"text-2xl","font-bold","mb-4",3,"ngClass"],[1,"rounded-lg","p-3","mb-6",3,"ngClass"],[3,"ngClass"],[1,"font-bold","text-2xl",3,"ngClass"],[1,"font-bold","py-3","px-6","rounded-lg","transition-all","duration-200","transform","hover:scale-105","shadow-lg",3,"click","ngClass"],[1,"mb-6"],[1,"h-12","w-1/3","rounded-md","bg-cyan-700","border","border-cyan-500","text-cyan-50","font-semibold","text-base","shadow","hover:bg-cyan-600","focus:outline-none","focus:ring-2","focus:ring-cyan-300",3,"click"],[1,"h-12","w-1/3","rounded-md","bg-lime-700","border","border-lime-500","text-lime-50","font-semibold","text-base","shadow","hover:bg-lime-600","focus:outline-none","focus:ring-2","focus:ring-lime-300",3,"click"],[1,"text-xs","leading-none"],[1,"w-12","h-12","rounded-lg","relative",3,"ngClass"],[1,"w-12","h-12","rounded-lg","relative",3,"click","ngClass"],[1,"select-none","pointer-events-none"],[1,"absolute","animate-pulse","transition-all","duration-300",3,"ngStyle"],[1,"text-yellow-200","text-lg","mb-4"],[1,"grid","grid-cols-2","gap-4","text-sm"],[1,"bg-yellow-600/50","rounded-lg","p-3"],[1,"text-yellow-200"],[1,"text-yellow-100","font-bold","text-xl"],[1,"grid","grid-cols-2","gap-4","mb-6","text-sm"],[1,"bg-green-700/50","rounded-lg","p-3"],[1,"text-green-200"],[1,"text-green-100","font-bold","text-xl"],[1,"bg-green-700/50","rounded-lg","p-3","mb-6"],[1,"text-green-100","font-bold","text-2xl"]],template:function(i,t){i&1&&(m(0,"div",0)(1,"header",1),E(2,"app-game-header",2),m(3,"div",3),M(4,xe,2,0,"button",4)(5,Se,2,0,"button",5),m(6,"button",6),P("click",function(){return t.shuffleTiles()}),d(7," \u91CD\u6392 ("),m(8,"span"),d(9),u(),d(10,") "),u(),m(11,"button",6),P("click",function(){return t.useHint()}),d(12," \u63D0\u793A ("),m(13,"span"),d(14),u(),d(15,") "),u()(),m(16,"div",7)(17,"div",8)(18,"div",9)(19,"div",10),d(20,"\u95DC\u5361"),u(),m(21,"div",11),d(22),u()(),m(23,"div",12)(24,"div",13),d(25,"\u5206\u6578"),u(),m(26,"div",11),d(27),u()(),m(28,"div",14)(29,"div",15),d(30,"\u79FB\u52D5"),u(),m(31,"div",11),d(32),u()(),m(33,"div",16)(34,"div",17),d(35,"\u5269\u9918"),u(),m(36,"div",11),d(37),u()(),m(38,"div",18)(39,"div",19),d(40,"\u5DF2\u9078"),u(),m(41,"div",20),M(42,be,2,0)(43,Pe,2,0,"span",21),u()(),m(44,"div",22),E(45,"div",23),m(46,"span",24),d(47),u()()()()(),m(48,"main",25)(49,"div",26)(50,"div",27),G(51,Me,2,0,null,null,$),u(),M(53,Ee,3,0,"div",28),m(54,"app-modal",29),P("close",function(){return t.resetGame()}),E(55,"div",30),m(56,"h2",31),d(57),u(),m(58,"div",32)(59,"div",33),d(60,"\u7E3D\u5206\u6578"),u(),m(61,"div",34),d(62),u()(),m(63,"button",35),P("click",function(){return t.resetGame()}),d(64," \u91CD\u65B0\u958B\u59CB "),u()(),m(65,"app-modal",29),P("close",function(){return t.gameComplete()?t.resetGame():t.nextLevel()}),E(66,"div",30),m(67,"h2",31),d(68),u(),M(69,Ie,24,4,"div",36)(70,De,16,3),m(71,"button",35),P("click",function(){return t.gameComplete()?t.resetGame():t.nextLevel()}),d(72),u()()()()()),i&2&&(c(2),g("gameRules",t.gameRules),c(2),w(t.gameOver()?4:5),c(2),g("title",Y("\u91CD\u65B0\u6D17\u724C\u6240\u6709\u65B9\u584A (\u5269\u9918: ",t.remainingShuffles(),")"))("ngClass",t.canUseShuffle()?"bg-zinc-800 border-zinc-600 text-lime-200 hover:bg-zinc-700 focus:ring-lime-300":"bg-zinc-800 border-zinc-600 text-zinc-400 opacity-50")("disabled",!t.canUseShuffle()),c(3),O("",t.totalShufflesUsed(),"/",t.maxShufflesPerGame()),c(2),g("title",Y("\u986F\u793A\u4E00\u500B\u53EF\u914D\u5C0D\u7684\u63D0\u793A (\u5269\u9918: ",t.remainingHints(),")"))("ngClass",t.canUseHint()?"bg-emerald-700 border-emerald-500 text-emerald-50 hover:bg-emerald-600 focus:ring-emerald-300":"bg-zinc-800 border-zinc-600 text-zinc-400 opacity-50")("disabled",!t.canUseHint()),c(3),O("",t.totalHintsUsed(),"/",t.maxHintsPerGame()),c(8),y(t.level()),c(5),y(t.score()),c(5),y(t.moves()),c(5),y(t.remainingTiles()),c(5),w(t.selectedTiles.length>0?42:43),c(3),ee("width",t.timelinePercentage(),"%"),g("ngClass",t.timelineColorClass()),c(),g("ngClass",t.timelineTextClass()),c(),O(" ",t.formattedTime()," / ",t.formattedCountdown()," "),c(3),g("ngStyle",te(49,ge,"repeat("+t.gameState().width+", 48px")),c(),L(t.board()),c(2),w(t.showingPath?53:-1),c(),g("isOpen",t.gameOver())("theme",t.timeUp()?"red":"orange")("showCloseButton",!1)("closeOnBackdrop",!1),c(),g("innerHTML",t.timeUp()?"\u23F0":"\u{1F635}",H),c(),g("ngClass",t.timeUp()?"text-red-100":"text-orange-100"),c(),I(" ",t.timeUp()?"\u6642\u9593\u5230\u4E86\uFF01":"\u904A\u6232\u7D50\u675F"," "),c(),g("ngClass",t.timeUp()?"bg-red-700/50":"bg-orange-700/50"),c(),g("ngClass",t.timeUp()?"text-red-200":"text-orange-200"),c(2),g("ngClass",t.timeUp()?"text-red-100":"text-orange-100"),c(),I(" ",t.score()," "),c(),g("ngClass",t.timeUp()?"bg-red-500 hover:bg-red-400 text-red-900":"bg-orange-500 hover:bg-orange-400 text-orange-900"),c(2),g("isOpen",t.levelComplete())("theme",t.gameComplete()?"yellow":"green")("showCloseButton",!1)("closeOnBackdrop",!1),c(),g("innerHTML",t.gameComplete()?"\u{1F3C6}":"\u{1F389}",H),c(),g("ngClass",t.gameComplete()?"text-yellow-100":"text-green-100"),c(),I(" ",t.gameComplete()?"\u606D\u559C\u4F60\u5168\u90E8\u7834\u95DC\uFF01":"\u95DC\u5361 "+t.level()+" \u5B8C\u6210\uFF01"," "),c(),w(t.gameComplete()?69:70),c(2),g("ngClass",t.gameComplete()?"bg-yellow-400 hover:bg-yellow-300 text-yellow-900":"bg-green-500 hover:bg-green-400 text-green-900"),c(),I(" ",t.gameComplete()?"\u91CD\u65B0\u6311\u6230":"\u4E0B\u4E00\u95DC \u2192"," "))},dependencies:[le,ie,ne,oe,re],encapsulation:2,changeDetection:0})};export{de as PetMatch};
