import{a as K,b as X}from"./chunk-A5EABR2Y.js";import{$ as z,A as W,B as I,C as r,D as a,E as _,F as P,G as g,H as S,N as s,O as N,P as O,T as Y,X as b,_ as H,a as c,aa as U,b as k,ba as j,d as A,g as C,h as w,i as y,m as M,o as R,r as B,s as d,t as F,v as D,w as T,y as L,z as V}from"./chunk-GC2AWETS.js";var v={boardSize:20,gameSpeed:150,initialSnakeLength:1,scorePerFood:10,minSwipeDistance:30},G={snake:{x:10,y:10},food:{x:5,y:5}},$="RIGHT",q={UP:"DOWN",DOWN:"UP",LEFT:"RIGHT",RIGHT:"LEFT"},J={ArrowUp:"UP",ArrowDown:"DOWN",ArrowLeft:"LEFT",ArrowRight:"RIGHT"},Q={title:"\u8CAA\u98DF\u86C7\u904A\u6232\u898F\u5247",rules:["\u4F7F\u7528\u65B9\u5411\u9375 (\u2191\u2193\u2190\u2192) \u6216\u89F8\u63A7\u6ED1\u52D5\u63A7\u5236\u86C7\u7684\u79FB\u52D5\u65B9\u5411","\u5403\u5230\u7D05\u8272\u98DF\u7269\u53EF\u4EE5\u589E\u52A0\u5206\u6578\u4E26\u8B93\u86C7\u8EAB\u8B8A\u9577","\u907F\u514D\u649E\u5230\u908A\u754C\u7246\u58C1\u6216\u86C7\u8EAB\u672C\u9AD4\uFF0C\u5426\u5247\u904A\u6232\u7D50\u675F","\u6309\u7A7A\u767D\u9375\u53EF\u4EE5\u66AB\u505C/\u7E7C\u7E8C\u904A\u6232","\u904A\u6232\u76EE\u6A19\u662F\u7372\u5F97\u6700\u9AD8\u5206\u6578\uFF0C\u6311\u6230\u81EA\u5DF1\u7684\u6975\u9650","\u86C7\u79FB\u52D5\u901F\u5EA6\u56FA\u5B9A\uFF0C\u9700\u8981\u63D0\u524D\u9810\u5224\u8DEF\u7DDA"]};var m=class{static isWithinBounds(e,t){return e.x>=0&&e.x<t&&e.y>=0&&e.y<t}static isCollidingWithSnake(e,t){return t.some(i=>i.x===e.x&&i.y===e.y)}static checkCollision(e,t,i){return this.isWithinBounds(e,i)?this.isCollidingWithSnake(e,t):!0}static isEatingFood(e,t){return e.x===t.x&&e.y===t.y}static isValidDirection(e,t){return q[e]!==t}static canMove(e){return e==="playing"}static isGameStarted(e){return e==="playing"||e==="paused"}static isGameOver(e){return e==="gameover"}static isPaused(e){return e==="paused"}static isSamePosition(e,t){return e.x===t.x&&e.y===t.y}static validateGameState(e){if(e.snake.length===0||e.boardSize<=0||e.score<0||!this.isWithinBounds(e.food,e.boardSize))return!1;for(let t of e.snake)if(!this.isWithinBounds(t,e.boardSize))return!1;return!0}};var x=class{static getNextHeadPosition(e,t){let i=c({},e);switch(t){case"UP":i.y--;break;case"DOWN":i.y++;break;case"LEFT":i.x--;break;case"RIGHT":i.x++;break}return i}static executeMove(e,t,i,n){let l=e[0],u=this.getNextHeadPosition(l,t);if(m.checkCollision(u,e,n))return{success:!1,ateFood:!1,collision:!0,newSnake:e};let f=m.isEatingFood(u,i),h=[u,...e];return f||h.pop(),{success:!0,ateFood:f,collision:!1,newSnake:h}}static generateFoodPosition(e,t){let i=t*t,n=0,l;do if(l={x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*t)},n++,n>=i){let u=[];for(let p=0;p<t;p++)for(let f=0;f<t;f++){let h={x:f,y:p};m.isCollidingWithSnake(h,e)||u.push(h)}if(u.length>0){let p=Math.floor(Math.random()*u.length);return u[p]}return{x:0,y:0}}while(m.isCollidingWithSnake(l,e));return l}static calculateScoreIncrement(e,t){return e?t:0}static detectSwipeDirection(e,t,i,n,l){let u=i-e,p=n-t,f=Math.abs(u),h=Math.abs(p);return Math.max(f,h)<l?null:f>h?u>0?"RIGHT":"LEFT":p>0?"DOWN":"UP"}};var ee={snake:[c({},G.snake)],food:c({},G.food),direction:$,score:0,gameStatus:"waiting",boardSize:v.boardSize},E=class o{platformId=C(R);isBrowser=j(this.platformId);gameState=M(c({},ee));gameTimer=null;initializeGame(){this.stopTimer();let e=k(c({},ee),{snake:[c({},G.snake)],food:x.generateFoodPosition([G.snake],v.boardSize)});this.gameState.set(e)}startGame(){this.gameState().gameStatus==="waiting"&&(this.gameState.update(t=>k(c({},t),{gameStatus:"playing"})),this.startTimer())}pauseGame(){this.gameState().gameStatus==="playing"&&(this.gameState.update(t=>k(c({},t),{gameStatus:"paused"})),this.stopTimer())}resumeGame(){this.gameState().gameStatus==="paused"&&(this.gameState.update(t=>k(c({},t),{gameStatus:"playing"})),this.startTimer())}togglePause(){let e=this.gameState();e.gameStatus==="playing"?this.pauseGame():e.gameStatus==="paused"&&this.resumeGame()}resetGame(){this.stopTimer(),this.initializeGame()}setDirection(e){let t=this.gameState();m.canMove(t.gameStatus)&&m.isValidDirection(t.direction,e)&&this.gameState.update(i=>k(c({},i),{direction:e}))}moveSnake(){let e=this.gameState();if(!m.canMove(e.gameStatus))return;let t=x.executeMove(e.snake,e.direction,e.food,e.boardSize);if(!t.success){this.gameState.update(n=>k(c({},n),{gameStatus:"gameover"})),this.stopTimer();return}let i={snake:t.newSnake};t.ateFood&&(i.score=e.score+v.scorePerFood,i.food=x.generateFoodPosition(t.newSnake,e.boardSize)),this.gameState.update(n=>c(c({},n),i))}startTimer(){this.isBrowser&&(this.stopTimer(),this.gameTimer=window.setInterval(()=>{this.moveSnake()},v.gameSpeed))}stopTimer(){this.gameTimer!==null&&(clearInterval(this.gameTimer),this.gameTimer=null)}cleanup(){this.stopTimer()}static \u0275fac=function(t){return new(t||o)};static \u0275prov=A({token:o,factory:o.\u0275fac,providedIn:"root"})};var ne=o=>({"grid-template-columns":o});function oe(o,e){if(o&1){let t=P();r(0,"button",25),g("click",function(){w(t);let n=S();return y(n.startGame())}),s(1," \u958B\u59CB\u904A\u6232 "),a()}}function re(o,e){if(o&1){let t=P();r(0,"button",26),g("click",function(){w(t);let n=S();return y(n.resetGame())}),s(1," \u91CD\u65B0\u958B\u59CB "),a()}}function ae(o,e){if(o&1){let t=P();r(0,"button",27),g("click",function(){w(t);let n=S();return y(n.togglePause())}),s(1),a()}if(o&2){let t=S();d(),O(" ",t.isPaused()?"\u7E7C\u7E8C":"\u66AB\u505C"," ")}}function se(o,e){if(o&1&&_(0,"div",9),o&2){let t=e.$implicit,i=S();I("ngClass",i.getCellClass(i.getCol(t),i.getRow(t)))}}function le(o,e){if(o&1){let t=P();r(0,"button",28),g("click",function(){w(t);let n=S();return y(n.startGame())}),s(1," \u958B\u59CB\u904A\u6232 "),a()}}function ce(o,e){if(o&1){let t=P();r(0,"button",29),g("click",function(){w(t);let n=S();return y(n.togglePause())}),s(1),a()}if(o&2){let t=S();d(),O(" ",t.isPaused()?"\u7E7C\u7E8C":"\u66AB\u505C"," ")}}var te=class o{snakeService=C(E);gameState=this.snakeService.gameState;boardSize=v.boardSize;gameRules=Q;snake=b(()=>this.gameState().snake);food=b(()=>this.gameState().food);direction=b(()=>this.gameState().direction);score=b(()=>this.gameState().score);gameStatus=b(()=>this.gameState().gameStatus);gameOver=b(()=>m.isGameOver(this.gameState().gameStatus));gameStarted=b(()=>m.isGameStarted(this.gameState().gameStatus));isPaused=b(()=>m.isPaused(this.gameState().gameStatus));touchStartX=0;touchStartY=0;ngOnInit(){this.snakeService.initializeGame()}ngOnDestroy(){this.snakeService.cleanup()}handleKeyPress(e){let t=this.gameStatus();if(e.key===" "){e.preventDefault(),this.handleSpaceKey(t);return}if(t!=="playing")return;let i=J[e.key];i&&(e.preventDefault(),this.snakeService.setDirection(i))}handleSpaceKey(e){e==="waiting"?this.startGame():e==="gameover"?this.resetGame():(e==="playing"||e==="paused")&&this.togglePause()}startGame(){this.snakeService.startGame()}resetGame(){this.snakeService.resetGame()}togglePause(){this.snakeService.togglePause()}getCellClass(e,t){let i=this.snake().length>0&&this.snake()[0].x===e&&this.snake()[0].y===t,n=this.snake().some(u=>u.x===e&&u.y===t),l=this.food().x===e&&this.food().y===t;return i?"bg-lime-400 border border-lime-600":n?"bg-lime-600 border border-lime-500":l?"bg-fuchsia-500 shadow-[0_0_6px_#c026d3,0_0_12px_#c026d3] animate-pulse":"bg-lime-900"}getBoard(){return Array(this.boardSize*this.boardSize).fill(0).map((e,t)=>t)}getRow(e){return Math.floor(e/this.boardSize)}getCol(e){return e%this.boardSize}onTouchStart(e){e.preventDefault();let t=e.touches[0];this.touchStartX=t.clientX,this.touchStartY=t.clientY}onTouchMove(e){e.preventDefault()}onTouchEnd(e){if(this.gameStatus()!=="playing")return;e.preventDefault();let t=e.changedTouches[0],i=x.detectSwipeDirection(this.touchStartX,this.touchStartY,t.clientX,t.clientY,v.minSwipeDistance);i&&this.snakeService.setDirection(i)}changeDirection(e){this.gameStatus()==="playing"&&this.snakeService.setDirection(e)}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=F({type:o,selectors:[["app-snake"]],hostBindings:function(t,i){t&1&&g("keydown",function(l){return i.handleKeyPress(l)},B)},decls:45,vars:14,consts:[[1,"w-full","max-w-sm","mx-auto","flex","flex-col"],[1,"mb-2","flex","flex-col","gap-3","items-stretch"],["title","\u8CAA\u98DF\u86C7",3,"gameRules"],[1,"flex","gap-2"],[1,"h-12","w-1/2","rounded-md","bg-lime-700","border","border-lime-500","text-lime-50","font-semibold","text-base","shadow","hover:bg-lime-600","focus:outline-none","focus:ring-2","focus:ring-lime-300"],[1,"h-12","w-1/2","rounded-md","bg-cyan-700","border","border-cyan-500","text-cyan-50","font-semibold","text-base","shadow","hover:bg-cyan-600","focus:outline-none","focus:ring-2","focus:ring-cyan-300"],[1,"h-12","w-1/2","rounded-md","bg-yellow-700","border","border-yellow-500","text-yellow-50","font-semibold","text-base","shadow","hover:bg-yellow-600","focus:outline-none","focus:ring-2","focus:ring-yellow-300"],[1,"h-12","w-1/2","rounded-md","bg-zinc-800","border","border-zinc-600","text-lime-200","font-medium","shadow","hover:bg-zinc-700","focus:outline-none","focus:ring-2","focus:ring-lime-300"],[1,"inline-grid","gap-[2px]","p-2","bg-green-900/40","border","border-green-800","touch-none","select-none","mx-auto",3,"touchstart","touchmove","touchend","ngStyle"],[1,"w-3","h-3",3,"ngClass"],[1,"md:hidden","fixed","inset-x-0","bottom-0","z-40","px-4","pb-4","pt-3","bg-black/70","backdrop-blur-sm","flex","justify-center","gap-6","transition-opacity"],[1,"grid","grid-cols-3","grid-rows-3","gap-1"],[1,"gb-pad","h-16","w-16","flex","items-center","justify-center","bg-lime-900","border","border-lime-700","text-lime-400","active:scale-95",3,"click"],["data-key","ArrowLeft",1,"gb-pad","h-16","w-16","flex","items-center","justify-center","bg-lime-900","border","border-lime-700","text-lime-400","active:scale-95",3,"click"],[1,"h-16","w-16"],[1,"absolute","bottom-0","right-0","m-4"],[1,"border","border-lime-800","bg-lime-900","p-2","text-lime-400","font-bold","hover:bg-lime-400/30","transition"],[1,"border","border-yellow-800","bg-yellow-900","p-2","text-yellow-400","font-bold","hover:bg-yellow-300/30","transition"],["theme","lime",3,"close","isOpen","showCloseButton","closeOnBackdrop"],[1,"text-3xl","mb-4"],[1,"text-2xl","font-bold","mb-2","text-lime-100"],[1,"rounded-lg","p-3","mb-6","bg-lime-700/50"],[1,"text-lime-200"],[1,"font-bold","text-2xl","text-lime-100"],[1,"bg-lime-400","hover:bg-lime-300","text-lime-900","font-bold","py-3","px-6","rounded-lg","transition-all","duration-200","transform","hover:scale-105","shadow-lg",3,"click"],[1,"h-12","w-1/2","rounded-md","bg-lime-700","border","border-lime-500","text-lime-50","font-semibold","text-base","shadow","hover:bg-lime-600","focus:outline-none","focus:ring-2","focus:ring-lime-300",3,"click"],[1,"h-12","w-1/2","rounded-md","bg-cyan-700","border","border-cyan-500","text-cyan-50","font-semibold","text-base","shadow","hover:bg-cyan-600","focus:outline-none","focus:ring-2","focus:ring-cyan-300",3,"click"],[1,"h-12","w-1/2","rounded-md","bg-yellow-700","border","border-yellow-500","text-yellow-50","font-semibold","text-base","shadow","hover:bg-yellow-600","focus:outline-none","focus:ring-2","focus:ring-yellow-300",3,"click"],[1,"border","border-lime-800","bg-lime-900","p-2","text-lime-400","font-bold","hover:bg-lime-400/30","transition",3,"click"],[1,"border","border-yellow-800","bg-yellow-900","p-2","text-yellow-400","font-bold","hover:bg-yellow-300/30","transition",3,"click"]],template:function(t,i){t&1&&(r(0,"div",0)(1,"header",1),_(2,"app-game-header",2),r(3,"div",3),D(4,oe,2,0,"button",4),D(5,re,2,0,"button",5),D(6,ae,2,1,"button",6),r(7,"button",7),s(8," \u5206\u6578 ("),r(9,"span"),s(10),a(),s(11,") "),a()()(),r(12,"main",8),g("touchstart",function(l){return i.onTouchStart(l)})("touchmove",function(l){return i.onTouchMove(l)})("touchend",function(l){return i.onTouchEnd(l)}),V(13,se,1,1,"div",9,L),a(),r(15,"div",10)(16,"div",11),_(17,"span"),r(18,"button",12),g("click",function(){return i.changeDirection("UP")}),s(19," \u25B2 "),a(),_(20,"span"),r(21,"button",13),g("click",function(){return i.changeDirection("LEFT")}),s(22," \u25C0 "),a(),_(23,"span",14),r(24,"button",12),g("click",function(){return i.changeDirection("RIGHT")}),s(25," \u25B6 "),a(),_(26,"span"),r(27,"button",12),g("click",function(){return i.changeDirection("DOWN")}),s(28," \u25BC "),a(),_(29,"span"),a(),r(30,"div",15),D(31,le,2,0,"button",16),D(32,ce,2,1,"button",17),a()(),r(33,"app-modal",18),g("close",function(){return i.resetGame()}),r(34,"div",19),s(35,"\u{1F480}"),a(),r(36,"h2",20),s(37,"\u904A\u6232\u7D50\u675F"),a(),r(38,"div",21)(39,"div",22),s(40,"\u6700\u7D42\u5206\u6578"),a(),r(41,"div",23),s(42),a()(),r(43,"button",24),g("click",function(){return i.resetGame()}),s(44," \u91CD\u65B0\u958B\u59CB "),a()()()),t&2&&(d(2),I("gameRules",i.gameRules),d(2),T(!i.gameStarted()&&!i.gameOver()?4:-1),d(),T(i.gameOver()?5:-1),d(),T(i.gameStarted()&&!i.gameOver()?6:-1),d(4),N(i.score()),d(2),I("ngStyle",Y(12,ne,"repeat("+i.boardSize+", minmax(0, 1fr))")),d(),W(i.getBoard()),d(18),T(!i.gameStarted()&&!i.gameOver()?31:-1),d(),T(i.gameStarted()&&!i.gameOver()?32:-1),d(),I("isOpen",i.gameOver())("showCloseButton",!1)("closeOnBackdrop",!1),d(9),N(i.score()))},dependencies:[U,H,z,X,K],encapsulation:2,changeDetection:0})};export{te as Snake};
