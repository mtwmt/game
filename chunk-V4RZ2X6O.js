import{$ as ae,A,B as j,C as T,D as b,E as G,F as W,G as m,H as N,I as D,L as X,M as te,O as ie,P as oe,R as C,S as ne,U as re,V as se,a as P,b as M,c as V,d as J,f as F,g as H,h as Y,i as Q,k as Z,o as d,p as q,q as ee,r as y,s as g,t as $,u as O,v as k,w as E,x as K,y as c,z as l}from"./chunk-UD7MAS2H.js";var L=(t=>(t.RED="red",t.BLACK="black",t))(L||{});var R=class r{initializeBoard(){let e=Array(10).fill(null).map(()=>Array(9).fill(null));e[9][0]={id:"r-chariot-1",type:"chariot",color:"red",position:{x:0,y:9},isSelected:!1,hasMoved:!1},e[9][1]={id:"r-horse-1",type:"horse",color:"red",position:{x:1,y:9},isSelected:!1,hasMoved:!1},e[9][2]={id:"r-elephant-1",type:"elephant",color:"red",position:{x:2,y:9},isSelected:!1,hasMoved:!1},e[9][3]={id:"r-advisor-1",type:"advisor",color:"red",position:{x:3,y:9},isSelected:!1,hasMoved:!1},e[9][4]={id:"r-general",type:"general",color:"red",position:{x:4,y:9},isSelected:!1,hasMoved:!1},e[9][5]={id:"r-advisor-2",type:"advisor",color:"red",position:{x:5,y:9},isSelected:!1,hasMoved:!1},e[9][6]={id:"r-elephant-2",type:"elephant",color:"red",position:{x:6,y:9},isSelected:!1,hasMoved:!1},e[9][7]={id:"r-horse-2",type:"horse",color:"red",position:{x:7,y:9},isSelected:!1,hasMoved:!1},e[9][8]={id:"r-chariot-2",type:"chariot",color:"red",position:{x:8,y:9},isSelected:!1,hasMoved:!1},e[7][1]={id:"r-cannon-1",type:"cannon",color:"red",position:{x:1,y:7},isSelected:!1,hasMoved:!1},e[7][7]={id:"r-cannon-2",type:"cannon",color:"red",position:{x:7,y:7},isSelected:!1,hasMoved:!1};for(let t=0;t<9;t+=2)e[6][t]={id:`r-soldier-${t}`,type:"soldier",color:"red",position:{x:t,y:6},isSelected:!1,hasMoved:!1};e[0][0]={id:"b-chariot-1",type:"chariot",color:"black",position:{x:0,y:0},isSelected:!1,hasMoved:!1},e[0][1]={id:"b-horse-1",type:"horse",color:"black",position:{x:1,y:0},isSelected:!1,hasMoved:!1},e[0][2]={id:"b-elephant-1",type:"elephant",color:"black",position:{x:2,y:0},isSelected:!1,hasMoved:!1},e[0][3]={id:"b-advisor-1",type:"advisor",color:"black",position:{x:3,y:0},isSelected:!1,hasMoved:!1},e[0][4]={id:"b-general",type:"general",color:"black",position:{x:4,y:0},isSelected:!1,hasMoved:!1},e[0][5]={id:"b-advisor-2",type:"advisor",color:"black",position:{x:5,y:0},isSelected:!1,hasMoved:!1},e[0][6]={id:"b-elephant-2",type:"elephant",color:"black",position:{x:6,y:0},isSelected:!1,hasMoved:!1},e[0][7]={id:"b-horse-2",type:"horse",color:"black",position:{x:7,y:0},isSelected:!1,hasMoved:!1},e[0][8]={id:"b-chariot-2",type:"chariot",color:"black",position:{x:8,y:0},isSelected:!1,hasMoved:!1},e[2][1]={id:"b-cannon-1",type:"cannon",color:"black",position:{x:1,y:2},isSelected:!1,hasMoved:!1},e[2][7]={id:"b-cannon-2",type:"cannon",color:"black",position:{x:7,y:2},isSelected:!1,hasMoved:!1};for(let t=0;t<9;t+=2)e[3][t]={id:`b-soldier-${t}`,type:"soldier",color:"black",position:{x:t,y:3},isSelected:!1,hasMoved:!1};return e}initializeGameState(){return{board:this.initializeBoard(),currentPlayer:"red",selectedPiece:null,validMoves:[],gameOver:!1,winner:null,moveHistory:[],isInCheck:!1,isVsAI:!1,aiIsThinking:!1,aiThinkingText:""}}isValidPosition(e,t){return e>=0&&e<9&&t>=0&&t<10}isInPalace(e,t,i){return i==="red"?e>=3&&e<=5&&t>=7&&t<=9:e>=3&&e<=5&&t>=0&&t<=2}isOnOwnSide(e,t){return t==="red"?e>=5:e<=4}getPossibleMoves(e,t){let i=[],{x:o,y:n}=e.position;switch(e.type){case"general":[{x:o-1,y:n},{x:o+1,y:n},{x:o,y:n-1},{x:o,y:n+1}].forEach(a=>{if(this.isValidPosition(a.x,a.y)&&this.isInPalace(a.x,a.y,e.color)){let f=t[a.y][a.x];(!f||f.color!==e.color)&&i.push(a)}});break;case"advisor":[{x:o-1,y:n-1},{x:o+1,y:n-1},{x:o-1,y:n+1},{x:o+1,y:n+1}].forEach(a=>{if(this.isValidPosition(a.x,a.y)&&this.isInPalace(a.x,a.y,e.color)){let f=t[a.y][a.x];(!f||f.color!==e.color)&&i.push(a)}});break;case"elephant":[{x:o-2,y:n-2,block:{x:o-1,y:n-1}},{x:o+2,y:n-2,block:{x:o+1,y:n-1}},{x:o-2,y:n+2,block:{x:o-1,y:n+1}},{x:o+2,y:n+2,block:{x:o+1,y:n+1}}].forEach(a=>{if(this.isValidPosition(a.x,a.y)&&this.isOnOwnSide(a.y,e.color)&&!t[a.block.y][a.block.x]){let f=t[a.y][a.x];(!f||f.color!==e.color)&&i.push({x:a.x,y:a.y})}});break;case"horse":[{x:o-1,y:n-2,block:{x:o,y:n-1}},{x:o+1,y:n-2,block:{x:o,y:n-1}},{x:o-1,y:n+2,block:{x:o,y:n+1}},{x:o+1,y:n+2,block:{x:o,y:n+1}},{x:o-2,y:n-1,block:{x:o-1,y:n}},{x:o-2,y:n+1,block:{x:o-1,y:n}},{x:o+2,y:n-1,block:{x:o+1,y:n}},{x:o+2,y:n+1,block:{x:o+1,y:n}}].forEach(a=>{if(this.isValidPosition(a.x,a.y)&&!t[a.block.y][a.block.x]){let f=t[a.y][a.x];(!f||f.color!==e.color)&&i.push({x:a.x,y:a.y})}});break;case"chariot":[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}].forEach(a=>{for(let f=1;f<10;f++){let x=o+a.dx*f,I=n+a.dy*f;if(!this.isValidPosition(x,I))break;let w=t[I][x];if(w){w.color!==e.color&&i.push({x,y:I});break}else i.push({x,y:I})}});break;case"cannon":[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}].forEach(a=>{let f=!1;for(let x=1;x<10;x++){let I=o+a.dx*x,w=n+a.dy*x;if(!this.isValidPosition(I,w))break;let U=t[w][I];if(U)if(!f)f=!0;else{U.color!==e.color&&i.push({x:I,y:w});break}else f||i.push({x:I,y:w})}});break;case"soldier":let _=e.color==="red"?-1:1,B={x:o,y:n+_};if(this.isValidPosition(B.x,B.y)){let a=t[B.y][B.x];(!a||a.color!==e.color)&&i.push(B)}if(!this.isOnOwnSide(n,e.color)){let a={x:o-1,y:n},f={x:o+1,y:n};if(this.isValidPosition(a.x,a.y)){let x=t[a.y][a.x];(!x||x.color!==e.color)&&i.push(a)}if(this.isValidPosition(f.x,f.y)){let x=t[f.y][f.x];(!x||x.color!==e.color)&&i.push(f)}}break}return i}isInCheck(e,t){let i=null;for(let o=0;o<10;o++)for(let n=0;n<9;n++){let s=e[o][n];if(s&&s.type==="general"&&s.color===t){i={x:n,y:o};break}}if(!i)return!1;for(let o=0;o<10;o++)for(let n=0;n<9;n++){let s=e[o][n];if(s&&s.color!==t&&this.getPossibleMoves(s,e).some(h=>h.x===i.x&&h.y===i.y))return!0}return!1}makeMove(e,t,i){let{board:o}=e,n=o[t.y][t.x];if(!n)return{success:!1};let s=o[i.y][i.x];if(o[i.y][i.x]=n,o[t.y][t.x]=null,n.position=i,this.isInCheck(o,n.color))return o[t.y][t.x]=n,o[i.y][i.x]=s,n.position=t,{success:!1};let u=n.color==="red"?"black":"red",h=this.isInCheck(o,u);return n.hasMoved=!0,{success:!0,captured:s||void 0,isCheck:h}}getPieceSymbol(e){return{general:{red:"\u5E25",black:"\u5C07"},advisor:{red:"\u4ED5",black:"\u58EB"},elephant:{red:"\u76F8",black:"\u8C61"},horse:{red:"\u99AC",black:"\u99AC"},chariot:{red:"\u8ECA",black:"\u8ECA"},cannon:{red:"\u70AE",black:"\u7832"},soldier:{red:"\u5175",black:"\u5352"}}[e.type][e.color]}static \u0275fac=function(t){return new(t||r)};static \u0275prov=V({token:r,factory:r.\u0275fac,providedIn:"root"})};var z=class r{constructor(e){this.chessGameService=e}MAX_DEPTH=3;PIECE_VALUES={general:1e4,chariot:500,cannon:450,horse:400,elephant:200,advisor:200,soldier:100};POSITION_BONUS={general:[[0,0,0,8,9,8,0,0,0],[0,0,0,9,10,9,0,0,0],[0,0,0,8,9,8,0,0,0]],soldier:[[9,9,9,11,13,11,9,9,9],[19,24,34,42,44,42,34,24,19],[19,24,32,37,37,37,32,24,19],[19,23,27,29,30,29,27,23,19],[14,18,20,27,29,27,20,18,14]]};makeAIMove(e){console.log("\u{1F916} AI\u958B\u59CB\u5206\u6790\u68CB\u5C40...");let t=this.getAllPossibleMoves(e,"black");if(console.log(`\u{1F916} \u627E\u5230 ${t.length} \u500B\u53EF\u80FD\u79FB\u52D5`),t.length===0)return console.log("\u{1F916} AI\u7121\u79FB\u52D5\u53EF\u8D70\uFF0C\u6E96\u5099\u6295\u964D"),null;let i=this.chessGameService.isInCheck(e.board,"black"),o=i?Math.min(2,this.MAX_DEPTH):this.MAX_DEPTH;console.log(`\u{1F916} AI${i?"\u88AB\u5C07\u8ECD\uFF0C":""}\u4F7F\u7528\u6DF1\u5EA6 ${o} \u9032\u884C\u641C\u7D22`);let n=this.findBestMoveWithTimeout(e,o,3e3);if(n)return console.log(`\u{1F916} AI\u6C7A\u5B9A\u79FB\u52D5: (${n.from.x},${n.from.y}) -> (${n.to.x},${n.to.y}), \u8A55\u5206: ${n.score}`),{from:n.from,to:n.to};console.warn("\u{1F916} AI\u7121\u6CD5\u627E\u5230\u6700\u4F73\u79FB\u52D5\u6216\u8D85\u6642\uFF0C\u96A8\u6A5F\u9078\u64C7");let s=t[Math.floor(Math.random()*t.length)];return{from:s.from,to:s.to}}findBestMoveWithTimeout(e,t,i){let o=Date.now(),n=null;try{return this.findBestMoveInternal(e,t,o,i)}catch(s){return console.warn("\u{1F916} AI\u641C\u7D22\u8D85\u6642\u6216\u51FA\u932F:",s),n}}findBestMove(e,t){return this.findBestMoveInternal(e,t,Date.now(),1e4)}findBestMoveInternal(e,t,i,o){let n=this.getAllPossibleMoves(e,e.currentPlayer);if(n.length===0)return null;let s=null,u=e.currentPlayer==="black"?-1/0:1/0;for(let h of n){if(Date.now()-i>o){console.log("\u{1F916} AI\u641C\u7D22\u8D85\u6642\uFF0C\u8FD4\u56DE\u7576\u524D\u6700\u4F73\u79FB\u52D5");break}let p=this.simulateMove(e,h),v=this.minimaxWithTimeout(p,t-1,-1/0,1/0,e.currentPlayer==="red",i,o);h.score=v,e.currentPlayer==="black"?v>u&&(u=v,s=h):v<u&&(u=v,s=h)}return s}minimaxWithTimeout(e,t,i,o,n,s,u){if(Date.now()-s>u)return this.evaluateBoard(e);if(t===0||e.gameOver)return this.evaluateBoard(e);let h=this.getAllPossibleMoves(e,e.currentPlayer);if(n){let p=-1/0;for(let v of h){if(Date.now()-s>u)break;let S=this.simulateMove(e,v),_=this.minimaxWithTimeout(S,t-1,i,o,!1,s,u);if(p=Math.max(p,_),i=Math.max(i,_),o<=i)break}return p}else{let p=1/0;for(let v of h){if(Date.now()-s>u)break;let S=this.simulateMove(e,v),_=this.minimaxWithTimeout(S,t-1,i,o,!0,s,u);if(p=Math.min(p,_),o=Math.min(o,_),o<=i)break}return p}}minimax(e,t,i,o,n){return this.minimaxWithTimeout(e,t,i,o,n,Date.now(),1e4)}getAllPossibleMoves(e,t){let i=[];for(let o=0;o<10;o++)for(let n=0;n<9;n++){let s=e.board[o][n];if(s&&s.color===t){let u=this.chessGameService.getPossibleMoves(s,e.board);for(let h of u){let p=e.board[h.y][h.x];i.push({from:s.position,to:h,score:0,capturedPiece:p||void 0})}}}return i}simulateMove(e,t){let i=e.board.map(n=>n.map(s=>s?M(P({},s),{position:P({},s.position)}):null)),o=i[t.from.y][t.from.x];return o&&(i[t.to.y][t.to.x]=o,i[t.from.y][t.from.x]=null,o.position=P({},t.to)),M(P({},e),{board:i,currentPlayer:e.currentPlayer==="red"?"black":"red"})}evaluateBoard(e){let t=0;for(let i=0;i<10;i++)for(let o=0;o<9;o++){let n=e.board[i][o];if(n){let s=this.PIECE_VALUES[n.type];s+=this.getPositionBonus(n),s+=this.getThreatScore(o,i,n,e.board),n.color==="black"?t+=s:t-=s}}return t+=this.getCenterControlScore(e.board),t+=this.getCheckScore(e.board),t}getPositionBonus(e){let{x:t,y:i}=e.position,o=0,n=Math.abs(i-4.5)+Math.abs(t-4);switch(o+=(9-n)*2,e.type){case"horse":i>=2&&i<=7&&t>=1&&t<=7&&(o+=30);break;case"cannon":(t===4||i===(e.color==="red"?7:2))&&(o+=20);break;case"soldier":if(e.color==="red"&&i<5||e.color==="black"&&i>4){o+=50;let u=e.color==="red"?4-i:i-5;o+=u*10}break}return o}getThreatScore(e,t,i,o){let n=0,s=i.color==="red"?"black":"red";for(let u=0;u<10;u++)for(let h=0;h<9;h++){let p=o[u][h];if(p&&p.color===s&&this.chessGameService.getPossibleMoves(p,o).some(S=>S.x===e&&S.y===t)){n-=this.PIECE_VALUES[i.type]*.5;break}}return n}getCenterControlScore(e){let t=0,i=[{x:3,y:4},{x:4,y:4},{x:5,y:4},{x:3,y:5},{x:4,y:5},{x:5,y:5}];for(let{x:o,y:n}of i){let s=e[n][o];s&&(s.color==="black"?t+=15:t-=15)}return t}getCheckScore(e){let t=0;return this.chessGameService.isInCheck(e,"red")&&(t+=100),this.chessGameService.isInCheck(e,"black")&&(t-=100),t}delay(e){return new Promise(t=>setTimeout(t,e))}getThinkingDescription(e){let t=this.analyzeThreats(e),i=this.analyzeOpportunities(e),o=["\u6B63\u5728\u5206\u6790\u68CB\u5C40\u5F62\u52E2...","\u8A08\u7B97\u6700\u4F73\u79FB\u52D5\u8DEF\u7DDA...","\u8A55\u4F30\u653B\u9632\u5E73\u8861...","\u5C0B\u627E\u6230\u8853\u6A5F\u6703..."];return t.length>0&&o.push("\u767C\u73FE\u5A01\u8105\uFF0C\u6B63\u5728\u5236\u5B9A\u9632\u5B88\u7B56\u7565..."),i.length>0&&o.push("\u767C\u73FE\u653B\u64CA\u6A5F\u6703\uFF0C\u6B63\u5728\u8A08\u7B97..."),o[Math.floor(Math.random()*o.length)]}analyzeThreats(e){let t=[],i="black",o="red";if(this.chessGameService.isInCheck(e.board,i))for(let n=0;n<10;n++)for(let s=0;s<9;s++){let u=e.board[n][s];if(u&&u.type==="general"&&u.color===i){t.push({x:s,y:n});break}}return t}analyzeOpportunities(e){let t=[],i="black";return this.chessGameService.isInCheck(e.board,"red")&&t.push({x:4,y:9}),t}static \u0275fac=function(t){return new(t||r)(J(R))};static \u0275prov=V({token:r,factory:r.\u0275fac,providedIn:"root"})};var he=()=>[0,1,2,3,4,5,6,7,8,9],me=()=>[0,1,2,3,4,5,6,7,8],fe=r=>({"valid-move-point":r});function pe(r,e){r&1&&(c(0,"span"),m(1,"\u{1F916}"),l())}function ve(r,e){r&1&&(c(0,"div",13),m(1,"\u5C07\u8ECD\uFF01"),l())}function xe(r,e){if(r&1){let t=j();c(0,"button",40),T("click",function(){F(t);let o=b();return H(o.startPvP())}),c(1,"div",12),m(2,"\u5207\u63DB\u6A21\u5F0F"),l()()}}function be(r,e){r&1&&m(0," AI \u601D\u8003\u4E2D... ")}function Ce(r,e){if(r&1&&(c(0,"div",21),m(1),l()),r&2){let t=e.$implicit;d(),N(t)}}function ye(r,e){if(r&1&&(c(0,"div",24),m(1),l()),r&2){let t=e.$implicit;d(),D(" ",t," ")}}function ge(r,e){if(r&1&&A(0,"div",41),r&2){let t=e.$implicit;W(t===6?"z-20 h-[1.5px]":"z-10"),G("top",t*50+4,"px")}}function _e(r,e){if(r&1&&A(0,"div",42)(1,"div",42),r&2){let t=e.$implicit;G("left",t*50+4,"px")("top",4,"px")("height",200,"px"),d(),G("left",t*50+4,"px")("top",254,"px")("height",200,"px")}}function Pe(r,e){r&1&&A(0,"div",45)}function Se(r,e){r&1&&A(0,"div",45)}function Me(r,e){if(r&1&&(c(0,"div",46)(1,"div",49),m(2),l()()),r&2){let t=b().$implicit,i=b(2);K("ngClass",i.getPieceClass(t)),d(),W(t.color===i.PlayerColor.RED?"bg-red-100 border-red-600 text-red-800":"bg-neutral-100 border-neutral-800 text-neutral-800"),d(),D(" ",i.getPieceSymbol(t)," ")}}function ke(r,e){r&1&&A(0,"div",47)}function Ee(r,e){r&1&&A(0,"div",48)}function Ie(r,e){if(r&1){let t=j();c(0,"div",44),T("click",function(){let o=F(t).$index,n=b().$index,s=b();return H(s.onSquareClick(o,n))}),y(1,Pe,1,0,"div",45),y(2,Se,1,0,"div",45),y(3,Me,3,4,"div",46),y(4,ke,1,0,"div",47),y(5,Ee,1,0,"div",48),l()}if(r&2){let t=e.$implicit,i=e.$index,o=b().$index,n=b();G("top",o*50+4,"px")("left",i*50+4,"px"),K("ngClass",te(10,fe,n.isValidMove(i,o))),d(),g((o===2||o===7)&&(i===0||i===2||i===4||i===6||i===8)?1:-1),d(),g((o===3||o===6)&&(i===1||i===7)?2:-1),d(),g(t?3:-1),d(),g(n.isValidMove(i,o)&&!t?4:-1),d(),g(n.isValidMove(i,o)&&t&&t.color!==n.currentPlayer()?5:-1)}}function Ae(r,e){if(r&1&&k(0,Ie,6,12,"div",43,$),r&2){let t=e.$implicit;E(t)}}function De(r,e){if(r&1&&(c(0,"div",24),m(1),l()),r&2){let t=e.$implicit;d(),D(" ",t," ")}}function we(r,e){if(r&1&&(c(0,"div",21),m(1),l()),r&2){let t=e.$implicit;d(),N(t)}}function Oe(r,e){if(r&1){let t=j();c(0,"div",36)(1,"div",50)(2,"div",51),m(3,"\u{1F3C6}"),l(),c(4,"h2",52),m(5),l(),c(6,"button",53),T("click",function(){F(t);let o=b();return H(o.resetGame())}),m(7," \u91CD\u65B0\u958B\u59CB "),l()()()}if(r&2){let t=b();d(5),D(" ",t.winner()===t.PlayerColor.RED?"\u7D05\u65B9\u7372\u52DD\uFF01":"\u9ED1\u65B9\u7372\u52DD\uFF01"," ")}}function Te(r,e){if(r&1&&(c(0,"span",59),m(1),l()),r&2){let t=b(2).$index,i=b(2);d(),N(i.moveHistory()[t+1])}}function Re(r,e){if(r&1&&(c(0,"div",5)(1,"span",57),m(2),l(),c(3,"span",58),m(4),l(),y(5,Te,2,1,"span",59),l()),r&2){let t=b(),i=t.$implicit,o=t.$index,n=b(2);d(2),D("",n.Math.floor(o/2)+1,"."),d(2),N(i),d(),g(n.moveHistory()[o+1]?5:-1)}}function Be(r,e){if(r&1&&y(0,Re,6,3,"div",5),r&2){let t=e.$index;g(t%2===0?0:-1)}}function Ge(r,e){if(r&1&&(c(0,"section",37)(1,"h3",54),m(2,"\u68CB\u8B5C\u8A18\u9304"),l(),c(3,"div",55)(4,"div",56),k(5,Be,1,1,null,null,$),l()()()),r&2){let t=b();d(5),E(t.moveHistory())}}var de=class r{constructor(e,t){this.chessGameService=e;this.chessAIService=t}gameState=Z({board:[],currentPlayer:"red",selectedPiece:null,validMoves:[],gameOver:!1,winner:null,moveHistory:[],isInCheck:!1,isVsAI:!1,aiIsThinking:!1,aiThinkingText:""});board=C(()=>this.gameState().board);currentPlayer=C(()=>this.gameState().currentPlayer);selectedPiece=C(()=>this.gameState().selectedPiece);validMoves=C(()=>this.gameState().validMoves);gameOver=C(()=>this.gameState().gameOver);winner=C(()=>this.gameState().winner);moveHistory=C(()=>this.gameState().moveHistory);isInCheck=C(()=>this.gameState().isInCheck);currentPlayerDisplay=C(()=>this.currentPlayer()==="red"?"\u7D05\u65B9":"\u9ED1\u65B9");isVsAI=C(()=>this.gameState().isVsAI);aiIsThinking=C(()=>this.gameState().aiIsThinking);aiThinkingText=C(()=>this.gameState().aiThinkingText);isAITurn=C(()=>this.isVsAI()&&this.currentPlayer()==="black"&&!this.gameOver());canInteract=C(()=>!this.isVsAI()||this.currentPlayer()==="red");PlayerColor=L;Math=Math;ngOnInit(){this.resetGame(!0)}resetGame(e=!1){let t=this.chessGameService.initializeGameState();t.isVsAI=e,this.gameState.set(t)}onSquareClick(e,t){if(this.gameOver()||!this.canInteract())return;let i=this.gameState(),o=i.board[t][e];i.selectedPiece?o&&o.color===i.currentPlayer&&o!==i.selectedPiece?this.selectPiece(o):this.isValidMove(e,t)?this.makeMove(i.selectedPiece.position,{x:e,y:t}):this.deselectPiece():o&&o.color===i.currentPlayer&&this.selectPiece(o)}selectPiece(e){let t=this.gameState();t.board.flat().forEach(o=>{o&&(o.isSelected=!1)}),e.isSelected=!0;let i=this.chessGameService.getPossibleMoves(e,t.board);this.gameState.set(M(P({},t),{selectedPiece:e,validMoves:i}))}deselectPiece(){let e=this.gameState();e.selectedPiece&&(e.selectedPiece.isSelected=!1),this.gameState.set(M(P({},e),{selectedPiece:null,validMoves:[]}))}isValidMove(e,t){return this.validMoves().some(i=>i.x===e&&i.y===t)}makeMove(e,t){let i=this.gameState(),o=i.board[e.y][e.x];if(!o)return;let n=this.chessGameService.makeMove(i,e,t);if(n.success){let s=this.generateMoveNotation(o,e,t,n.captured),u=[...i.moveHistory,s],h=i.currentPlayer==="red"?"black":"red",p=n.isCheck||!1,v=n.isCheckmate||n.isStalemate||!1,S=n.isCheckmate?i.currentPlayer:null;i.board.flat().forEach(_=>{_&&(_.isSelected=!1)}),this.gameState.set(M(P({},i),{currentPlayer:h,selectedPiece:null,validMoves:[],moveHistory:u,isInCheck:p,gameOver:v,winner:S})),console.log("\u6AA2\u67E5AI\u89F8\u767C\u689D\u4EF6:",{gameOver:v,isVsAI:i.isVsAI,nextPlayer:h,shouldTrigger:!v&&i.isVsAI&&h==="black"}),!v&&i.isVsAI&&h==="black"&&(console.log("\u6E96\u5099\u89F8\u767CAI\u79FB\u52D5..."),this.triggerAIMove())}}generateMoveNotation(e,t,i,o){if(!e)return"";let n=this.chessGameService.getPieceSymbol(e),s=e.color==="red"?9-t.x:t.x+1,u=i.y-t.y,h="";return u===0?h="\u5E73"+(e.color==="red"?9-i.x:i.x+1):h=(u<0?"\u9032":"\u9000")+Math.abs(u),`${n}${s}${h}`}getSquareClass(e,t){let i="chess-square";return this.board()[t]?.[e]?.isSelected&&(i+=" selected"),this.isValidMove(e,t)&&(i+=" valid-move"),(this.chessGameService.isInPalace(e,t,"red")||this.chessGameService.isInPalace(e,t,"black"))&&(i+=" palace"),i}getPieceClass(e){if(!e)return"";let t=`chess-piece ${e.color}`;return e.isSelected&&(t+=" selected"),t}getPieceSymbol(e){return e?this.chessGameService.getPieceSymbol(e):""}getRowNumbers(){return Array.from({length:10},(e,t)=>10-t)}getColumnLetters(){return["a","b","c","d","e","f","g","h","i"]}startVsAI(){let e=this.chessGameService.initializeGameState();e.isVsAI=!0,this.gameState.set(e)}startPvP(){let e=this.chessGameService.initializeGameState();e.isVsAI=!1,this.gameState.set(e)}triggerAIMove(){let e=this.gameState();console.log("\u{1F916} \u89F8\u767CAI\u79FB\u52D5\uFF0C\u7576\u524D\u73A9\u5BB6:",e.currentPlayer),this.gameState.set(M(P({},e),{aiIsThinking:!0,aiThinkingText:this.chessAIService.getThinkingDescription(e)})),setTimeout(()=>{try{let t=this.chessAIService.makeAIMove(e);t?(console.log("\u{1F916} AI\u9078\u64C7\u79FB\u52D5:",t),this.makeAIMove(t.from,t.to)):(console.warn("\u{1F916} AI\u7121\u6CD5\u627E\u5230\u6709\u6548\u79FB\u52D5\uFF0CAI\u6295\u964D"),this.aiSurrender())}catch(t){console.error("\u{1F916} AI\u79FB\u52D5\u51FA\u932F:",t),this.aiSurrender()}},500)}makeAIMove(e,t){let i=this.gameState(),o=i.board[e.y][e.x];if(!o)return;let n=this.chessGameService.makeMove(i,e,t);if(n.success){let s=this.generateMoveNotation(o,e,t,n.captured),u=[...i.moveHistory,s],h="red",p=n.isCheck||!1,v=n.isCheckmate||n.isStalemate||!1,S=n.isCheckmate?"black":null;i.board.flat().forEach(_=>{_&&(_.isSelected=!1)}),this.gameState.set(M(P({},i),{currentPlayer:h,selectedPiece:null,validMoves:[],moveHistory:u,isInCheck:p,gameOver:v,winner:S,aiIsThinking:!1}))}}aiSurrender(){let e=this.gameState();console.log("\u{1F916} AI\u6295\u964D\uFF0C\u904A\u6232\u7D50\u675F"),this.gameState.set(M(P({},e),{gameOver:!0,winner:"red",aiIsThinking:!1,moveHistory:[...e.moveHistory,"\u{1F916} AI\u6295\u964D"]}))}static \u0275fac=function(t){return new(t||r)(q(R),q(z))};static \u0275cmp=ee({type:r,selectors:[["app-chinese-chess"]],decls:71,vars:13,consts:[[1,"w-full","max-w-sm","mx-auto","flex","flex-col"],[1,"mb-2","flex","flex-col","gap-3","items-stretch"],[1,"flex","justify-between","items-center"],[1,"text-center","text-2xl","font-bold","tracking-wider","text-lime-400","drop-shadow"],["routerLink","/",1,"text-lime-600","text-sm"],[1,"flex","gap-2"],[1,"h-12","w-1/3","touch-btn","rounded-md","bg-cyan-700","border","border-cyan-500","text-cyan-50","font-semibold","text-base","shadow","hover:bg-cyan-600","focus:outline-none","focus:ring-2","focus:ring-cyan-300",3,"click"],[1,"h-12","w-1/3","touch-btn","rounded-md","bg-lime-700","border","border-lime-500","text-lime-50","font-semibold","text-base","shadow","hover:bg-lime-600","focus:outline-none","focus:ring-2","focus:ring-lime-300","drop-shadow-[0_0_5px_#22d3ee]",3,"click"],[1,"flex","flex-col","gap-2"],[1,"flex","items-center","gap-1","justify-between","flex-wrap","bg-white/10","rounded-md","p-2","border","border-white/20"],[1,"border","px-2","py-1","font-bold",3,"ngClass"],[1,"text-xs"],[1,"text-center","text-xs"],[1,"text-3xl","text-amber-300","animate-pulse"],[1,"py-3","border-1","border-lime-400","bg-lime-400/20","px-2","py-1","text-lime-300","font-bold","hover:bg-lime-400/30","transition"],[1,"w-full","text-center","text-sm","mt-2","h-4","bg-neutral-700/80","rounded","overflow-hidden","relative","animate-pulse","text-white"],[1,"flex","justify-center"],[1,"relative","inline-block"],[1,"chess-board","bg-amber-100","border-4","border-amber-800","p-6","relative"],[1,"flex","justify-center","mb-2"],[1,"grid","grid-cols-9","gap-0"],[1,"w-12","text-center","text-xs","font-bold","text-amber-800"],[1,"flex"],[1,"flex","flex-col","justify-center","mr-2"],[1,"h-12","flex","items-center","justify-center","text-xs","font-bold","text-amber-800","w-6"],[1,"relative","w-[414px]","h-[456px]","bg-amber-100"],[1,"absolute","left-0","right-0","h-[1px]","bg-amber-800",3,"class","top"],["viewBox","0 0 100 100",1,"absolute","top-0","left-[154px]","w-[100px]","h-[100px]"],["x1","0","y1","0","x2","100","y2","100","stroke","#d97706","stroke-width","1"],["x1","100","y1","0","x2","0","y2","100","stroke","#d97706","stroke-width","1"],["viewBox","0 0 100 100",1,"absolute","bottom-0","left-[154px]","w-[100px]","h-[100px]"],[1,"absolute","left-0","right-0","top-[204px]","h-[50px]","bg-amber-100","flex","items-center","justify-between","px-16","z-5"],[1,"text-amber-700","font-bold","text-sm","tracking-wider"],[1,"flex","flex-col","justify-center","ml-2"],[1,"flex","justify-center","mt-2"],[1,"grid","grid-cols-9","gap-0",2,"width","450px"],[1,"absolute","inset-0","bg-black/50","backdrop-blur-sm","flex","items-center","justify-center","z-50","rounded-lg"],[1,"mt-6"],[1,"mt-4","text-xs","text-amber-600","text-center"],[1,"mb-1"],[1,"py-3","border-1","border-lime-400","bg-lime-400/20","px-2","py-1","text-lime-300","font-bold","hover:bg-lime-400/30","transition",3,"click"],[1,"absolute","left-0","right-0","h-[1px]","bg-amber-800"],[1,"absolute","w-[1px]","bg-amber-800"],[1,"absolute","w-[24px]","h-[24px]","-translate-x-1/2","-translate-y-1/2","rounded-full","hover:bg-amber-200/30","cursor-pointer","z-20",3,"top","left","ngClass"],[1,"absolute","w-[24px]","h-[24px]","-translate-x-1/2","-translate-y-1/2","rounded-full","hover:bg-amber-200/30","cursor-pointer","z-20",3,"click","ngClass"],[1,"absolute","w-[6px]","h-[6px]","bg-amber-800","rounded-full","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[40px]","h-[40px]",3,"ngClass"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-3","h-3","bg-green-500","rounded-full","opacity-70"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[42px]","h-[42px]","border-2","border-red-500","rounded-full"],[1,"w-10","h-10","rounded-full","border-2","flex","items-center","justify-center","text-lg","font-bold","shadow-lg"],[1,"bg-gradient-to-br","from-amber-600","to-amber-800","border-2","border-amber-400","rounded-lg","p-8","shadow-2xl","text-center"],[1,"text-3xl","mb-4"],[1,"text-2xl","font-bold","mb-4","text-amber-100"],[1,"bg-amber-400","hover:bg-amber-300","text-amber-900","font-bold","py-3","px-6","rounded-lg","transition-all","duration-200","transform","hover:scale-105","shadow-lg",3,"click"],[1,"text-lg","font-bold","text-amber-400","mb-3"],[1,"bg-neutral-900/70","border","border-neutral-700","rounded-md","p-4","max-h-32","overflow-y-auto"],[1,"grid","grid-cols-2","gap-2","text-sm"],[1,"text-neutral-400"],[1,"text-red-400"],[1,"text-neutral-300"]],template:function(t,i){t&1&&(c(0,"div",0)(1,"header",1)(2,"div",2)(3,"h1",3),m(4," \u4E2D\u570B\u8C61\u68CB "),l(),c(5,"a",4),m(6,"HOME"),l()(),c(7,"div",5)(8,"button",6),T("click",function(){return i.startPvP()}),m(9," \u{1F465} \u96D9\u4EBA\u5C0D\u6230 "),l(),c(10,"button",7),T("click",function(){return i.startVsAI()}),m(11," \u{1F916} \u4EBA\u6A5F\u5C0D\u6230 "),l(),c(12,"button",6),T("click",function(){return i.resetGame(!1)}),m(13," \u91CD\u65B0\u958B\u59CB "),l()(),c(14,"div",8)(15,"div",9)(16,"div",10)(17,"div",11),m(18,"\u7576\u524D\u56DE\u5408"),l(),c(19,"div",12),y(20,pe,2,0,"span"),m(21),l()(),y(22,ve,2,0,"div",13),y(23,xe,3,0,"button",14),c(24,"div",15),y(25,be,1,0),l()()()(),c(26,"main",16)(27,"div",17)(28,"div",18)(29,"div",19)(30,"div",20),k(31,Ce,2,1,"div",21,O),l()(),c(33,"div",22)(34,"div",23),k(35,ye,2,1,"div",24,O),l(),c(37,"div",25),k(38,ge,1,4,"div",26,O),k(40,_e,2,12,null,null,O),Y(),c(42,"svg",27),A(43,"line",28)(44,"line",29),l(),c(45,"svg",30),A(46,"line",28)(47,"line",29),l(),Q(),c(48,"div",31)(49,"span",32),m(50,"\u695A\u6CB3"),l(),c(51,"span",32),m(52,"\u6F22\u754C"),l()(),k(53,Ae,2,0,null,null,$),l(),c(55,"div",33),k(56,De,2,1,"div",24,O),l()(),c(58,"div",34)(59,"div",35),k(60,we,2,1,"div",21,O),l()()(),y(62,Oe,8,1,"div",36),l()(),m(63),ie(64,"json"),y(65,Ge,7,0,"section",37),c(66,"footer",38)(67,"p",39),m(68,"\u9EDE\u64CA\u9078\u64C7\u68CB\u5B50\uFF0C\u518D\u9EDE\u64CA\u76EE\u6A19\u4F4D\u7F6E\u79FB\u52D5"),l(),c(69,"p"),m(70,"\u7D05\u65B9\u5148\u884C\uFF0C\u5C07\u8ECD\u5C0D\u65B9\u5373\u7372\u52DD"),l()()()),t&2&&(d(16),K("ngClass",i.currentPlayer()===i.PlayerColor.RED?"bg-red-500/20 border-red-400 text-red-300":"bg-neutral-800/20 border-neutral-400 text-neutral-300"),d(4),g(i.isVsAI()&&i.currentPlayer()===i.PlayerColor.BLACK?20:-1),d(),D("",i.currentPlayerDisplay()," "),d(),g(i.isInCheck()?22:-1),d(),g(i.isVsAI()?23:-1),d(2),g(i.aiIsThinking()?25:-1),d(6),E(i.getColumnLetters()),d(4),E(i.getRowNumbers()),d(3),E(X(11,he)),d(2),E(X(12,me)),d(13),E(i.board()),d(3),E(i.getRowNumbers()),d(4),E(i.getColumnLetters()),d(2),g(i.gameOver()?62:-1),d(),D(" ",oe(64,9,i.moveHistory())," "),d(2),g(i.moveHistory().length>0?65:-1))},dependencies:[se,ne,ae,re],styles:['.chess-board[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fef3c7,#fed7aa);box-shadow:0 8px 32px #0000004d}.chess-square[_ngcontent-%COMP%]{position:relative;background:transparent;transition:all .2s ease}.chess-square[_ngcontent-%COMP%]:hover{background-color:#f59e0b1a}.chess-square.selected[_ngcontent-%COMP%]{background-color:#22c55e4d!important;border-color:#22c55e!important;box-shadow:inset 0 0 0 2px #22c55e}.chess-square.valid-move[_ngcontent-%COMP%]{background-color:#22c55e26!important}.chess-square.valid-move[_ngcontent-%COMP%]:after{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:12px;height:12px;background-color:#22c55e;border-radius:50%;opacity:.8}.chess-square.valid-move[_ngcontent-%COMP%]:hover:after{width:16px;height:16px;opacity:1}.chess-square.palace[_ngcontent-%COMP%]{background-color:#f59e0b0d}.chess-piece[_ngcontent-%COMP%]{transition:all .3s ease;z-index:10}.chess-piece.selected[_ngcontent-%COMP%]{transform:scale(1.1);filter:drop-shadow(0 0 8px rgba(34,197,94,.6))}.chess-piece.red[_ngcontent-%COMP%]   .piece-symbol[_ngcontent-%COMP%]{color:#dc2626;background:linear-gradient(135deg,#fecaca,#fee2e2);border-color:#dc2626}.chess-piece.black[_ngcontent-%COMP%]   .piece-symbol[_ngcontent-%COMP%]{color:#374151;background:linear-gradient(135deg,#f3f4f6,#e5e7eb);border-color:#374151}.chess-piece[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.move-history[_ngcontent-%COMP%]{scrollbar-width:thin;scrollbar-color:#6b7280 #1f2937}.move-history[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.move-history[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#1f2937;border-radius:3px}.move-history[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#6b7280;border-radius:3px}.move-history[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#9ca3af}@media (max-width: 640px){.chess-board[_ngcontent-%COMP%]{padding:1rem}.chess-board[_ngcontent-%COMP%]   .chess-square[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem}.chess-board[_ngcontent-%COMP%]   .chess-piece[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:2rem;height:2rem;font-size:.875rem}}@keyframes _ngcontent-%COMP%_piece-capture{0%{transform:scale(1);opacity:1}50%{transform:scale(1.3);opacity:.7}to{transform:scale(0);opacity:0}}.captured[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_piece-capture .5s ease-out forwards}@keyframes _ngcontent-%COMP%_check-warning{0%,to{box-shadow:0 0 #ef4444b3}50%{box-shadow:0 0 0 10px #ef444400}}.in-check[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_check-warning 1s infinite}.valid-move-point.valid-move[_ngcontent-%COMP%]:after{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:10px;height:10px;background-color:#22c55e;border-radius:50%;opacity:.7}.valid-move-point[_ngcontent-%COMP%]:hover{background-color:#f59e0b33}']})};export{de as ChineseChess};
