import{$a as c,Ab as G,Bb as I,Cb as L,Da as w,Qa as b,Ra as _,Ta as T,Ua as D,Va as E,W as p,Wa as v,X as g,Xa as r,Ya as a,Za as f,_a as k,a as x,ab as u,ca as m,cb as s,db as P,eb as y,gb as O,ra as C,sa as d}from"./chunk-VPIITZIC.js";var N=o=>({"grid-template-columns":o});function M(o,t){if(o&1){let e=k();r(0,"button",17),c("click",function(){p(e);let n=u();return g(n.startGame())}),s(1," \u958B\u59CB\u904A\u6232 "),a()}}function F(o,t){if(o&1){let e=k();r(0,"button",18),c("click",function(){p(e);let n=u();return g(n.resetGame())}),s(1," \u91CD\u65B0\u958B\u59CB "),a()}}function V(o,t){if(o&1){let e=k();r(0,"button",19),c("click",function(){p(e);let n=u();return g(n.togglePause())}),s(1),a()}if(o&2){let e=u();d(),y(" ",e.isPaused()?"\u7E7C\u7E8C":"\u66AB\u505C"," ")}}function H(o,t){if(o&1&&f(0,"div",10),o&2){let e=t.$implicit,i=u();v("ngClass",i.getCellClass(i.getCol(e),i.getRow(e)))}}function R(o,t){if(o&1){let e=k();r(0,"button",17),c("click",function(){p(e);let n=u();return g(n.startGame())}),s(1," \u958B\u59CB\u904A\u6232 "),a()}}function A(o,t){if(o&1){let e=k();r(0,"button",18),c("click",function(){p(e);let n=u();return g(n.resetGame())}),s(1," \u91CD\u65B0\u958B\u59CB "),a()}}function z(o,t){if(o&1){let e=k();r(0,"button",19),c("click",function(){p(e);let n=u();return g(n.togglePause())}),s(1),a()}if(o&2){let e=u();d(),y(" ",e.isPaused()?"\u7E7C\u7E8C":"\u66AB\u505C"," ")}}var B=class o{boardSize=20;snake=m([{x:10,y:10}]);food=m({x:5,y:5});direction=m("RIGHT");score=m(0);gameOver=m(!1);gameStarted=m(!1);isPaused=m(!1);gameLoop;gameSpeed=150;touchStartX=0;touchStartY=0;minSwipeDistance=30;ngOnInit(){this.generateFood()}ngOnDestroy(){this.gameLoop&&clearInterval(this.gameLoop)}handleKeyPress(t){if(!this.gameStarted()&&t.key===" "){this.startGame();return}if(this.gameOver()&&t.key===" "){this.resetGame();return}if(this.gameStarted()&&!this.gameOver()&&t.key===" "){this.togglePause();return}if(!this.gameStarted()||this.gameOver()||this.isPaused())return;let e=this.direction();switch(t.key){case"ArrowUp":e!=="DOWN"&&this.direction.set("UP");break;case"ArrowDown":e!=="UP"&&this.direction.set("DOWN");break;case"ArrowLeft":e!=="RIGHT"&&this.direction.set("LEFT");break;case"ArrowRight":e!=="LEFT"&&this.direction.set("RIGHT");break}}startGame(){this.gameStarted.set(!0),this.gameLoop=setInterval(()=>this.moveSnake(),this.gameSpeed)}resetGame(){this.snake.set([{x:10,y:10}]),this.direction.set("RIGHT"),this.score.set(0),this.gameOver.set(!1),this.gameStarted.set(!1),this.isPaused.set(!1),this.generateFood(),this.gameLoop&&clearInterval(this.gameLoop)}togglePause(){this.isPaused()?this.resumeGame():this.pauseGame()}pauseGame(){this.isPaused.set(!0),this.gameLoop&&(clearInterval(this.gameLoop),this.gameLoop=void 0)}resumeGame(){this.isPaused.set(!1),this.gameStarted()&&!this.gameOver()&&(this.gameLoop=setInterval(()=>this.moveSnake(),this.gameSpeed))}moveSnake(){let t=this.snake(),e=x({},t[0]);switch(this.direction()){case"UP":e.y--;break;case"DOWN":e.y++;break;case"LEFT":e.x--;break;case"RIGHT":e.x++;break}if(this.checkCollision(e)){this.endGame();return}let i=[e,...t];e.x===this.food().x&&e.y===this.food().y?(this.score.update(n=>n+10),this.generateFood()):i.pop(),this.snake.set(i)}checkCollision(t){return t.x<0||t.x>=this.boardSize||t.y<0||t.y>=this.boardSize?!0:this.snake().some(e=>e.x===t.x&&e.y===t.y)}generateFood(){let t;do t={x:Math.floor(Math.random()*this.boardSize),y:Math.floor(Math.random()*this.boardSize)};while(this.snake().some(e=>e.x===t.x&&e.y===t.y));this.food.set(t)}endGame(){this.gameOver.set(!0),this.gameLoop&&clearInterval(this.gameLoop)}getCellClass(t,e){let i=this.snake().length>0&&this.snake()[0].x===t&&this.snake()[0].y===e,n=this.snake().some(h=>h.x===t&&h.y===e),l=this.food().x===t&&this.food().y===e,S=!i&&!n&&!l;return i?"bg-lime-400 border border-lime-600 ":n?"bg-lime-600 border border-lime-500":l?"bg-fuchsia-500 shadow-[0_0_6px_#c026d3,0_0_12px_#c026d3] animate-pulse":S?"bg-lime-900":""}getBoard(){return Array(this.boardSize*this.boardSize).fill(0).map((t,e)=>e)}getRow(t){return Math.floor(t/this.boardSize)}getCol(t){return t%this.boardSize}onTouchStart(t){t.preventDefault();let e=t.touches[0];this.touchStartX=e.clientX,this.touchStartY=e.clientY}onTouchMove(t){t.preventDefault()}onTouchEnd(t){if(!this.gameStarted()||this.gameOver()||this.isPaused())return;t.preventDefault();let e=t.changedTouches[0],i=e.clientX-this.touchStartX,n=e.clientY-this.touchStartY,l=Math.abs(i),S=Math.abs(n);if(Math.max(l,S)<this.minSwipeDistance)return;let h=this.direction();l>S?i>0&&h!=="LEFT"?this.direction.set("RIGHT"):i<0&&h!=="RIGHT"&&this.direction.set("LEFT"):n>0&&h!=="UP"?this.direction.set("DOWN"):n<0&&h!=="DOWN"&&this.direction.set("UP")}changeDirection(t){if(!this.gameStarted()||this.gameOver()||this.isPaused())return;let e=this.direction();({UP:"DOWN",DOWN:"UP",LEFT:"RIGHT",RIGHT:"LEFT"})[e]!==t&&this.direction.set(t)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=w({type:o,selectors:[["app-snake"]],hostBindings:function(e,i){e&1&&c("keydown",function(l){return i.handleKeyPress(l)},C)},decls:36,vars:10,consts:[[1,"relative","p-2","h-full"],[1,"text-center"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-lime-400","text-3xl","font-bold","leading-none"],[1,"flex","justify-between","uppercase","mb-1","text-lime-500"],[1,"hidden","md:block"],[1,"border","border-lime-800","bg-lime-900","p-2","text-lime-400","font-bold","hover:bg-lime-400/30","transition"],[1,"border","border-cyan-800","bg-cyan-900","p-2","text-cyan-400","font-bold","hover:bg-cyan-400/30","transition"],[1,"border","border-yellow-800","bg-yellow-900","p-2","text-yellow-400","font-bold","hover:bg-yellow-300/30","transition"],[1,"inline-grid","grid-cols-12","gap-[2px]","p-2","bg-green-900/40","border","border-green-800","touch-none","select-none",3,"touchstart","touchmove","touchend","ngStyle"],[1,"w-3","h-3","sm:w-5","sm:h-5",3,"ngClass"],[1,"md:hidden","fixed","inset-x-0","bottom-0","z-40","px-4","pb-4","pt-3","bg-black/70","backdrop-blur-sm","flex","justify-center","gap-6","transition-opacity"],[1,"grid","grid-cols-3","grid-rows-3","gap-1"],[1,"gb-pad","h-16","w-16","flex","items-center","justify-center","bg-lime-900","border","border-lime-700","text-lime-400","active:scale-95",3,"click"],["data-key","ArrowLeft",1,"gb-pad","h-16","w-16","flex","items-center","justify-center","bg-lime-900","border","border-lime-700","text-lime-400","active:scale-95",3,"click"],[1,"h-16","w-16"],[1,"absolute","bottom-0","right-0","m-4"],[1,"border","border-lime-800","bg-lime-900","p-2","text-lime-400","font-bold","hover:bg-lime-400/30","transition",3,"click"],[1,"border","border-cyan-800","bg-cyan-900","p-2","text-cyan-400","font-bold","hover:bg-cyan-400/30","transition",3,"click"],[1,"border","border-yellow-800","bg-yellow-900","p-2","text-yellow-400","font-bold","hover:bg-yellow-300/30","transition",3,"click"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),s(4,"\u8CAA\u98DF\u86C7"),a(),r(5,"div",4)(6,"span"),s(7,"\u5206\u6578: "),a(),r(8,"span"),s(9),a()(),r(10,"div",5),b(11,M,2,0,"button",6),b(12,F,2,0,"button",7),b(13,V,2,1,"button",8),a()()(),r(14,"div",9),c("touchstart",function(l){return i.onTouchStart(l)})("touchmove",function(l){return i.onTouchMove(l)})("touchend",function(l){return i.onTouchEnd(l)}),D(15,H,1,1,"div",10,T),a(),r(17,"div",11)(18,"div",12),f(19,"span"),r(20,"button",13),c("click",function(){return i.changeDirection("UP")}),s(21," \u25B2 "),a(),f(22,"span"),r(23,"button",14),c("click",function(){return i.changeDirection("LEFT")}),s(24," \u25C0 "),a(),f(25,"span",15),r(26,"button",13),c("click",function(){return i.changeDirection("RIGHT")}),s(27," \u25B6 "),a(),f(28,"span"),r(29,"button",13),c("click",function(){return i.changeDirection("DOWN")}),s(30," \u25BC "),a(),f(31,"span"),a(),r(32,"div",16),b(33,R,2,0,"button",6),b(34,A,2,0,"button",7),b(35,z,2,1,"button",8),a()()()),e&2&&(d(9),P(i.score()),d(2),_(!i.gameStarted()&&!i.gameOver()?11:-1),d(),_(i.gameOver()?12:-1),d(),_(i.gameStarted()&&!i.gameOver()?13:-1),d(),v("ngStyle",O(8,N,"repeat("+i.boardSize+", minmax(0, 1fr))")),d(),E(i.getBoard()),d(18),_(!i.gameStarted()&&!i.gameOver()?33:-1),d(),_(i.gameOver()?34:-1),d(),_(i.gameStarted()&&!i.gameOver()?35:-1))},dependencies:[L,G,I],encapsulation:2})};export{B as Snake};
