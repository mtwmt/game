import{A as K,B as D,C as x,D as k,E as O,F as h,G as $,H as _,K as H,L as j,N as W,O as Z,Q as g,R as ee,T as te,U as ie,_ as ne,a as y,b as P,c as R,d as Y,e as L,f as T,g as N,h as U,i as J,k as X,o as a,p as Q,q as v,r as C,s as F,t as I,u as M,v as S,w as E,x as d,y as l,z as b}from"./chunk-ZLBWINJC.js";var B=(i=>(i.RED="red",i.BLACK="black",i))(B||{});var q={board:[],currentPlayer:"red",selectedPiece:null,validMoves:[],gameOver:!1,winner:null,moveHistory:[],isInCheck:!1,isSelfInCheck:!1,isVsAI:!0,aiIsThinking:!1,aiThinkingText:""},w=class r{boardCache={kingPositions:new Map,piecesByColor:new Map,lastMoveCount:-1};moveCache=new Map;ORTHOGONAL_DIRECTIONS=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}];DIAGONAL_DIRECTIONS=[{dx:-1,dy:-1},{dx:1,dy:-1},{dx:-1,dy:1},{dx:1,dy:1}];initializeBoard(){let t=Array(10).fill(null).map(()=>Array(9).fill(null));return this.setupInitialPieces(t),t}setupInitialPieces(t){let i=["rook","horse","elephant","advisor","king","advisor","elephant","horse","rook"];i.forEach((n,o)=>{let s=this.generatePieceId(n,"red",o);t[9][o]=this.createPiece(s,n,"red",o,9)}),[...i].forEach((n,o)=>{let s=this.generatePieceId(n,"black",o);t[0][o]=this.createPiece(s,n,"black",o,0)}),[1,7].forEach((n,o)=>{t[7][n]=this.createPiece(`r-cannon-${o+1}`,"cannon","red",n,7),t[2][n]=this.createPiece(`b-cannon-${o+1}`,"cannon","black",n,2)});for(let n=0;n<9;n+=2)t[6][n]=this.createPiece(`r-soldier-${n}`,"soldier","red",n,6),t[3][n]=this.createPiece(`b-soldier-${n}`,"soldier","black",n,3)}generatePieceId(t,i,e){let n=i==="red"?"r":"b";return t==="king"?`${n}-king`:`${n}-${t}-${e<4?"1":"2"}`}createPiece(t,i,e,n,o){return{id:t,type:i,color:e,position:{x:n,y:o},isSelected:!1,hasMoved:!1}}initializeGameState(){return P(y({},q),{board:this.initializeBoard()})}isValidPosition(t,i){return t>=0&&t<9&&i>=0&&i<10}isInPalace(t,i,e){return e==="red"?t>=3&&t<=5&&i>=7&&i<=9:t>=3&&t<=5&&i>=0&&i<=2}isOnOwnSide(t,i){return i==="red"?t>=5:t<=4}wouldKingsFaceEachOther(t,i=0){this.updateBoardCache(t,i);let e=this.boardCache.kingPositions.get("red"),n=this.boardCache.kingPositions.get("black");return!e||!n||e.x!==n.x?!1:this.isPathClear(t,e,n)}isPathClear(t,i,e){let n=Math.min(i.y,e.y),o=Math.max(i.y,e.y);for(let s=n+1;s<o;s++)if(t[s][i.x]!==null)return!1;return!0}updateBoardCache(t,i){if(this.boardCache.lastMoveCount!==i){this.boardCache.kingPositions.clear(),this.boardCache.piecesByColor.clear(),this.boardCache.piecesByColor.set("red",[]),this.boardCache.piecesByColor.set("black",[]);for(let e=0;e<10;e++)for(let n=0;n<9;n++){let o=t[e][n];o&&(this.boardCache.piecesByColor.get(o.color).push(o),o.type==="king"&&this.boardCache.kingPositions.set(o.color,{x:n,y:e}))}this.boardCache.lastMoveCount=i}}clearCaches(){this.moveCache.clear(),this.boardCache.lastMoveCount=-1}getBoardHash(t){let i="";for(let e=0;e<10;e++)for(let n=0;n<9;n++){let o=t[e][n];i+=o?`${o.type}${o.color}${n}${e}`:"e"}return i}isValidMoveForPiece(t,i,e){if(!this.isValidPosition(t.x,t.y))return!1;let n=e[t.y][t.x];return!n||n.color!==i.color}getSlidingPieceMoves(t,i,e){let n=[],{x:o,y:s}=t.position;return e.forEach(c=>{for(let u=1;u<10;u++){let m=o+c.dx*u,p=s+c.dy*u;if(!this.isValidPosition(m,p))break;let f=i[p][m];if(f){f.color!==t.color&&n.push({x:m,y:p});break}else n.push({x:m,y:p})}}),n}getPossibleMoves(t,i){let e=`${t.id}-${t.position.x}-${t.position.y}-true`;if(this.moveCache.has(e))return this.moveCache.get(e);let n=this.calculatePieceMoves(t,i,!0);return this.moveCache.set(e,n),n}getPossibleMovesForCheck(t,i){let e=`${t.id}-${t.position.x}-${t.position.y}-false`;if(this.moveCache.has(e))return this.moveCache.get(e);let n=this.calculatePieceMoves(t,i,!1);return this.moveCache.set(e,n),n}calculatePieceMoves(t,i,e){switch(t.type){case"king":return this.getKingMoves(t,i,e);case"advisor":return this.getAdvisorMoves(t,i);case"elephant":return this.getElephantMoves(t,i);case"horse":return this.getHorseMoves(t,i);case"rook":return this.getRookMoves(t,i);case"cannon":return this.getCannonMoves(t,i);case"soldier":return this.getSoldierMoves(t,i);default:return[]}}getKingMoves(t,i,e){let{x:n,y:o}=t.position;return this.ORTHOGONAL_DIRECTIONS.map(c=>({x:n+c.dx,y:o+c.dy})).filter(c=>{if(!this.isValidPosition(c.x,c.y)||!this.isInPalace(c.x,c.y,t.color))return!1;let u=i[c.y][c.x];return u&&u.color===t.color?!1:!e||!this.wouldMoveCreateKingFacing(t,c,i)})}wouldMoveCreateKingFacing(t,i,e){let n=e[i.y][i.x],o=t.position;e[i.y][i.x]=t,e[o.y][o.x]=null,t.position=i;let s=this.wouldKingsFaceEachOther(e);return e[o.y][o.x]=t,e[i.y][i.x]=n,t.position=o,s}getAdvisorMoves(t,i){let{x:e,y:n}=t.position;return this.DIAGONAL_DIRECTIONS.map(s=>({x:e+s.dx,y:n+s.dy})).filter(s=>this.isValidPosition(s.x,s.y)&&this.isInPalace(s.x,s.y,t.color)&&this.isValidMoveForPiece(s,t,i))}getElephantMoves(t,i){let{x:e,y:n}=t.position;return[{x:e-2,y:n-2,block:{x:e-1,y:n-1}},{x:e+2,y:n-2,block:{x:e+1,y:n-1}},{x:e-2,y:n+2,block:{x:e-1,y:n+1}},{x:e+2,y:n+2,block:{x:e+1,y:n+1}}].filter(s=>this.isValidPosition(s.x,s.y)&&this.isOnOwnSide(s.y,t.color)&&!i[s.block.y][s.block.x]&&this.isValidMoveForPiece(s,t,i)).map(s=>({x:s.x,y:s.y}))}getHorseMoves(t,i){let{x:e,y:n}=t.position;return[{x:e-1,y:n-2,block:{x:e,y:n-1}},{x:e+1,y:n-2,block:{x:e,y:n-1}},{x:e-1,y:n+2,block:{x:e,y:n+1}},{x:e+1,y:n+2,block:{x:e,y:n+1}},{x:e-2,y:n-1,block:{x:e-1,y:n}},{x:e-2,y:n+1,block:{x:e-1,y:n}},{x:e+2,y:n-1,block:{x:e+1,y:n}},{x:e+2,y:n+1,block:{x:e+1,y:n}}].filter(s=>this.isValidPosition(s.x,s.y)&&!i[s.block.y][s.block.x]&&this.isValidMoveForPiece(s,t,i)).map(s=>({x:s.x,y:s.y}))}getRookMoves(t,i){return this.getSlidingPieceMoves(t,i,this.ORTHOGONAL_DIRECTIONS)}getCannonMoves(t,i){let e=[],{x:n,y:o}=t.position;return this.ORTHOGONAL_DIRECTIONS.forEach(s=>{let c=!1;for(let u=1;u<10;u++){let m=n+s.dx*u,p=o+s.dy*u;if(!this.isValidPosition(m,p))break;let f=i[p][m];if(f)if(!c)c=!0;else{f.color!==t.color&&e.push({x:m,y:p});break}else c||e.push({x:m,y:p})}}),e}getSoldierMoves(t,i){let e=[],{x:n,y:o}=t.position,s=t.color==="red"?-1:1,c={x:n,y:o+s};return this.isValidMoveForPiece(c,t,i)&&e.push(c),this.isOnOwnSide(o,t.color)||[{x:n-1,y:o},{x:n+1,y:o}].forEach(m=>{this.isValidMoveForPiece(m,t,i)&&e.push(m)}),e}isInCheck(t,i,e=0){this.updateBoardCache(t,e);let n=this.boardCache.kingPositions.get(i);if(!n)return!1;let o=i==="red"?"black":"red";return(this.boardCache.piecesByColor.get(o)||[]).some(c=>this.getPossibleMovesForCheck(c,t).some(m=>m.x===n.x&&m.y===n.y))}makeMove(t,i,e){let{board:n,moveHistory:o}=t,s=n[i.y][i.x];if(!s)return{success:!1};let c=n[e.y][e.x],u=o.length;if(this.clearCaches(),n[e.y][e.x]=s,n[i.y][i.x]=null,s.position=e,c&&c.type==="king")return s.hasMoved=!0,{success:!0,captured:c,isCheck:!1,gameOver:!0,winner:s.color};if(this.wouldKingsFaceEachOther(n,u+1))return s.hasMoved=!0,{success:!0,captured:c||void 0,isCheck:!1,gameOver:!0,winner:s.color==="red"?"black":"red"};let m=s.color==="red"?"black":"red",p=this.isInCheck(n,m,u+1),f=this.isInCheck(n,s.color,u+1);return s.hasMoved=!0,{success:!0,captured:c||void 0,isCheck:p,isSelfInCheck:f}}getPieceSymbol(t){return{king:{red:"\u5E25",black:"\u5C07"},advisor:{red:"\u4ED5",black:"\u58EB"},elephant:{red:"\u76F8",black:"\u8C61"},horse:{red:"\u99AC",black:"\u99AC"},rook:{red:"\u8ECA",black:"\u8ECA"},cannon:{red:"\u70AE",black:"\u7832"},soldier:{red:"\u5175",black:"\u5352"}}[t.type][t.color]}static \u0275fac=function(i){return new(i||r)};static \u0275prov=R({token:r,factory:r.\u0275fac,providedIn:"root"})};var z=(e=>(e[e.EASY=2]="EASY",e[e.MEDIUM=3]="MEDIUM",e[e.HARD=4]="HARD",e))(z||{}),G=class r{constructor(t){this.chessGameService=t;console.log(`\u{1F916} AI\u521D\u59CB\u5316 - \u9810\u8A2D\u96E3\u5EA6: ${this.getDifficultyName()} (\u6DF1\u5EA6${this.difficulty}\u6B65)`)}difficulty=4;PIECE_VALUES={king:1e4,rook:500,cannon:450,horse:400,elephant:200,advisor:200,soldier:100};getDifficulty(){return this.difficulty}setDifficulty(t){this.difficulty=t,console.log(`\u{1F916} AI\u96E3\u5EA6\u8A2D\u7F6E\u70BA: ${this.getDifficultyName()} (\u6DF1\u5EA6: ${t}\u6B65)`)}getDifficultyName(){switch(this.difficulty){case 2:return"\u7C21\u55AE";case 3:return"\u4E2D\u7B49";case 4:return"\u56F0\u96E3";default:return"\u672A\u77E5"}}makeAIMove(t){console.log(`\u{1F916} AI\u958B\u59CB\u601D\u8003 (${this.getDifficultyName()}\u96E3\u5EA6, \u6DF1\u5EA6${this.difficulty}\u6B65)...`);let i=this.getAllPossibleMoves(t,"black");if(i.length===0)return console.log("\u{1F916} AI\u7121\u53EF\u7528\u79FB\u52D5\uFF0C\u6295\u964D"),null;console.log(`\u{1F50D} \u627E\u5230 ${i.length} \u500B\u53EF\u80FD\u79FB\u52D5`);let e=this.findBestMove(t,this.difficulty);if(e)return console.log(`\u{1F3AF} AI\u9078\u64C7\u79FB\u52D5: (${e.from.x},${e.from.y}) \u2192 (${e.to.x},${e.to.y}), \u8A55\u5206: ${e.score}`),{from:e.from,to:e.to};console.log("\u26A0\uFE0F Minimax\u672A\u627E\u5230\u6700\u4F73\u79FB\u52D5\uFF0C\u96A8\u6A5F\u9078\u64C7");let n=i[Math.floor(Math.random()*i.length)];return{from:n.from,to:n.to}}findBestMove(t,i){let e=this.getAllPossibleMoves(t,"black");if(e.length===0)return null;let n=null,o=-1/0,s=-1/0,c=1/0;console.log(`\u{1F332} \u958B\u59CBMinimax\u641C\u7D22 (\u6DF1\u5EA6: ${i})`);for(let u of e){let m=this.simulateMove(t,u),p=this.minimax(m,i-1,s,c,!1);if(u.score=p,p>o&&(o=p,n=u),s=Math.max(s,p),c<=s){console.log("\u26A1 Alpha-Beta\u526A\u679D\u89F8\u767C");break}}return console.log(`\u{1F4CA} \u641C\u7D22\u5B8C\u6210\uFF0C\u6700\u4F73\u5206\u6578: ${o}`),n}minimax(t,i,e,n,o){if(i===0||t.gameOver)return this.evaluatePosition(t);let s=o?"black":"red",c=this.getAllPossibleMoves(t,s);if(c.length===0)return o?-9999:9999;if(o){let u=-1/0;for(let m of c){let p=this.simulateMove(t,m),f=this.minimax(p,i-1,e,n,!1);if(u=Math.max(u,f),e=Math.max(e,f),n<=e)break}return u}else{let u=1/0;for(let m of c){let p=this.simulateMove(t,m),f=this.minimax(p,i-1,e,n,!0);if(u=Math.min(u,f),n=Math.min(n,f),n<=e)break}return u}}evaluatePosition(t){let i=0;for(let e=0;e<10;e++)for(let n=0;n<9;n++){let o=t.board[e][n];if(o){let s=this.PIECE_VALUES[o.type];s+=this.getPositionBonus(o),o.color==="black"?i+=s:i-=s}}return this.chessGameService.isInCheck(t.board,"red")&&(i+=300),this.chessGameService.isInCheck(t.board,"black")&&(i-=300),i}getPositionBonus(t){let{x:i,y:e}=t.position,n=0,o=Math.abs(i-4)+Math.abs(e-4.5);if(n+=Math.max(0,(6-o)*5),t.type==="soldier"&&(t.color==="red"&&e<5||t.color==="black"&&e>4)){n+=30;let c=t.color==="black"?e-5:4-e;n+=c*15}return n}getAllPossibleMoves(t,i){let e=[];for(let n=0;n<10;n++)for(let o=0;o<9;o++){let s=t.board[n][o];if(s&&s.color===i){let c=this.chessGameService.getPossibleMoves(s,t.board);for(let u of c)this.wouldCauseSelfCheck(t,s.position,u)||e.push({from:s.position,to:u,score:0})}}return e}wouldCauseSelfCheck(t,i,e){let n=this.copyBoard(t.board),o=n[i.y][i.x];return o?(n[e.y][e.x]=o,n[i.y][i.x]=null,o.position={x:e.x,y:e.y},this.chessGameService.isInCheck(n,o.color)):!0}simulateMove(t,i){let e=this.copyBoard(t.board),n=e[i.from.y][i.from.x];return n&&(e[i.to.y][i.to.x]=n,e[i.from.y][i.from.x]=null,n.position={x:i.to.x,y:i.to.y}),P(y({},t),{board:e,currentPlayer:t.currentPlayer==="red"?"black":"red"})}copyBoard(t){return t.map(i=>i.map(e=>e?P(y({},e),{position:y({},e.position)}):null))}getThinkingDescription(t){let i=[`\u{1F50D} \u5206\u6790\u5C40\u9762 (${this.getDifficultyName()}\u6A21\u5F0F)`,`\u{1F332} \u5EFA\u69CB\u904A\u6232\u6A39 (\u6DF1\u5EA6${this.difficulty}\u6B65)`,"\u26A1 Alpha-Beta\u526A\u679D\u641C\u7D22\u4E2D...","\u{1F4CA} \u8A55\u4F30\u4F4D\u7F6E\u5206\u6578","\u{1F3AF} \u8A08\u7B97\u6700\u4F73\u79FB\u52D5"];return i[Math.floor(Math.random()*i.length)]}static \u0275fac=function(i){return new(i||r)(Y(w))};static \u0275prov=R({token:r,factory:r.\u0275fac,providedIn:"root"})};var ce=()=>[0,1,2,3,4,5,6,7,8,9],de=()=>[0,1,2,3,4,5,6,7,8],se=r=>({"valid-move-point":r});function ue(r,t){r&1&&(d(0,"div",8),h(1," \u5C07\u8ECD\uFF01 "),l())}function he(r,t){r&1&&(d(0,"div",9),h(1,"\u88AB\u5C07\u8ECD\uFF01"),l())}function me(r,t){r&1&&(d(0,"span"),h(1,"\u{1F916}"),l())}function pe(r,t){if(r&1&&(d(0,"div",18)(1,"div",46),h(2,"\u6700\u5F8C\u4E00\u6B65"),l(),d(3,"div",15),h(4),l()()),r&2){let i=x();a(4),_(" ",i.moveHistory()[i.moveHistory().length-1]," ")}}function fe(r,t){r&1&&h(0," AI \u601D\u8003\u4E2D... ")}function ve(r,t){if(r&1&&(d(0,"div",25),h(1),l()),r&2){let i=t.$implicit;a(),_(" ",i," ")}}function Ce(r,t){if(r&1&&(d(0,"div",28),h(1),l()),r&2){let i=t.$implicit;a(),_(" ",i," ")}}function xe(r,t){if(r&1&&b(0,"div",47)(1,"div",48),r&2){let i=t.$implicit;O(i===6?"z-20 h-[1.5px]":"z-10"),k("top",i*40+4,"px"),E("ngClass","sm:hidden"),a(),O(i===6?"z-20 h-[1.5px]":"z-10"),k("top",i*50+4,"px")}}function ge(r,t){if(r&1&&b(0,"div",49)(1,"div",49)(2,"div",50)(3,"div",50),r&2){let i=t.$implicit;k("left",i*36+14,"px")("top",4,"px")("height",157,"px"),a(),k("left",i*36+14,"px")("top",203,"px")("height",162,"px"),a(),k("left",i*50+4,"px")("top",4,"px")("height",200,"px"),a(),k("left",i*50+4,"px")("top",254,"px")("height",200,"px")}}function be(r,t){r&1&&b(0,"div",52)}function ye(r,t){r&1&&b(0,"div",52)}function Pe(r,t){if(r&1&&(d(0,"div",53)(1,"div",60),h(2),l()()),r&2){let i=x().$implicit,e=x(2);E("ngClass",e.getPieceClass(i)),a(),O(i.color===e.PlayerColor.RED?"bg-red-100 border-red-600 text-red-800":"bg-neutral-100 border-neutral-800 text-neutral-800"),a(),_(" ",e.getPieceSymbol(i)," ")}}function _e(r,t){r&1&&b(0,"div",54)}function Me(r,t){r&1&&b(0,"div",55)}function Se(r,t){r&1&&b(0,"div",52)}function ke(r,t){r&1&&b(0,"div",52)}function Ie(r,t){if(r&1&&(d(0,"div",57)(1,"div",61),h(2),l()()),r&2){let i=x().$implicit,e=x(2);E("ngClass",e.getPieceClass(i)),a(),O(i.color===e.PlayerColor.RED?"bg-red-100 border-red-600 text-red-800":"bg-neutral-100 border-neutral-800 text-neutral-800"),a(),_(" ",e.getPieceSymbol(i)," ")}}function Ee(r,t){r&1&&b(0,"div",58)}function De(r,t){r&1&&b(0,"div",59)}function we(r,t){if(r&1){let i=K();d(0,"div",51),D("click",function(){let n=T(i).$index,o=x().$index,s=x();return N(s.onSquareClick(n,o))}),v(1,be,1,0,"div",52),v(2,ye,1,0,"div",52),v(3,Pe,3,4,"div",53),v(4,_e,1,0,"div",54),v(5,Me,1,0,"div",55),l(),d(6,"div",56),D("click",function(){let n=T(i).$index,o=x().$index,s=x();return N(s.onSquareClick(n,o))}),v(7,Se,1,0,"div",52),v(8,ke,1,0,"div",52),v(9,Ie,3,4,"div",57),v(10,Ee,1,0,"div",58),v(11,De,1,0,"div",59),l()}if(r&2){let i=t.$implicit,e=t.$index,n=x().$index,o=x();k("top",n*40+4,"px")("left",e*36+14,"px"),E("ngClass",j(20,se,o.isValidMove(e,n))),a(),C((n===2||n===7)&&(e===0||e===2||e===4||e===6||e===8)?1:-1),a(),C((n===3||n===6)&&(e===1||e===7)?2:-1),a(),C(i?3:-1),a(),C(o.isValidMove(e,n)&&!i?4:-1),a(),C(o.isValidMove(e,n)&&i&&i.color!==o.currentPlayer()?5:-1),a(),k("top",n*50+4,"px")("left",e*50+4,"px"),E("ngClass",j(22,se,o.isValidMove(e,n))),a(),C((n===2||n===7)&&(e===0||e===2||e===4||e===6||e===8)?7:-1),a(),C((n===3||n===6)&&(e===1||e===7)?8:-1),a(),C(i?9:-1),a(),C(o.isValidMove(e,n)&&!i?10:-1),a(),C(o.isValidMove(e,n)&&i&&i.color!==o.currentPlayer()?11:-1)}}function Ae(r,t){if(r&1&&M(0,we,12,24,null,null,F),r&2){let i=t.$implicit;S(i)}}function Oe(r,t){if(r&1&&(d(0,"div",28),h(1),l()),r&2){let i=t.$implicit;a(),_(" ",i," ")}}function Be(r,t){if(r&1&&(d(0,"div",25),h(1),l()),r&2){let i=t.$implicit;a(),_(" ",i," ")}}function Re(r,t){if(r&1){let i=K();d(0,"div",42)(1,"div",62)(2,"div",63),h(3,"\u{1F3C6}"),l(),d(4,"h2",64),h(5),l(),d(6,"button",65),D("click",function(){T(i);let n=x();return N(n.resetGame())}),h(7," \u91CD\u65B0\u958B\u59CB "),l()()()}if(r&2){let i=x();a(5),_(" ",i.winner()===i.PlayerColor.RED?"\u7D05\u65B9\u7372\u52DD\uFF01":"\u9ED1\u65B9\u7372\u52DD\uFF01"," ")}}function Te(r,t){if(r&1&&(d(0,"span",72),h(1),l()),r&2){let i=x(2).$index,e=x(2);a(),$(e.moveHistory()[i+1])}}function Ne(r,t){if(r&1&&(d(0,"div",69)(1,"span",70),h(2),l(),d(3,"span",71),h(4),l(),v(5,Te,2,1,"span",72),l()),r&2){let i=x(),e=i.$implicit,n=i.$index,o=x(2);a(2),_("",o.Math.floor(n/2)+1,"."),a(2),$(e),a(),C(o.moveHistory()[n+1]?5:-1)}}function Fe(r,t){if(r&1&&v(0,Ne,6,3,"div",69),r&2){let i=t.$index;C(i%2===0?0:-1)}}function $e(r,t){if(r&1&&(d(0,"section",43)(1,"h3",66),h(2,"\u68CB\u8B5C\u8A18\u9304"),l(),d(3,"div",67)(4,"div",68),M(5,Fe,1,1,null,null,F),l()()()),r&2){let i=x();a(5),S(i.moveHistory())}}var re=class r{chessGameService=L(w);chessAIService=L(G);gameState=X(q);board=g(()=>this.gameState().board);currentPlayer=g(()=>this.gameState().currentPlayer);selectedPiece=g(()=>this.gameState().selectedPiece);validMoves=g(()=>this.gameState().validMoves);gameOver=g(()=>this.gameState().gameOver);winner=g(()=>this.gameState().winner);moveHistory=g(()=>this.gameState().moveHistory);isInCheck=g(()=>this.gameState().isInCheck);isSelfInCheck=g(()=>this.gameState().isSelfInCheck);currentPlayerDisplay=g(()=>this.currentPlayer()==="red"?"\u7D05\u65B9":"\u9ED1\u65B9");isVsAI=g(()=>this.gameState().isVsAI);aiIsThinking=g(()=>this.gameState().aiIsThinking);aiThinkingText=g(()=>this.gameState().aiThinkingText);isAITurn=g(()=>this.isVsAI()&&this.currentPlayer()==="black"&&!this.gameOver());canInteract=g(()=>!this.isVsAI()||this.currentPlayer()==="red");PlayerColor=B;Math=Math;AIDifficulty=z;ngOnInit(){this.resetGame()}resetGame(){let t=this.chessGameService.initializeGameState();this.gameState.set(t)}onSquareClick(t,i){if(this.gameOver()||!this.canInteract())return;let e=this.gameState(),n=e.board[i][t];e.selectedPiece?n&&n.color===e.currentPlayer&&n!==e.selectedPiece?this.selectPiece(n):this.isValidMove(t,i)?this.makeMove(e.selectedPiece.position,{x:t,y:i}):this.deselectPiece():n&&n.color===e.currentPlayer&&this.selectPiece(n)}selectPiece(t){let i=this.gameState();i.board.flat().forEach(n=>{n&&(n.isSelected=!1)}),t.isSelected=!0;let e=this.chessGameService.getPossibleMoves(t,i.board);this.gameState.set(P(y({},i),{selectedPiece:t,validMoves:e}))}deselectPiece(){let t=this.gameState();t.selectedPiece&&(t.selectedPiece.isSelected=!1),this.gameState.set(P(y({},t),{selectedPiece:null,validMoves:[]}))}isValidMove(t,i){return this.validMoves().some(e=>e.x===t&&e.y===i)}makeMove(t,i){let e=this.gameState(),n=e.board[t.y][t.x];if(!n)return;let o=this.chessGameService.makeMove(e,t,i);if(o.success){let s=this.generateMoveNotation(n,t,i,o.captured),c=[...e.moveHistory,s],u=e.currentPlayer==="red"?"black":"red",m=o.isCheck||!1,p=o.isSelfInCheck||!1,f=o.isCheckmate||o.isStalemate||o.gameOver||!1,V=o.winner||(o.isCheckmate?e.currentPlayer:null);e.board.flat().forEach(A=>{A&&(A.isSelected=!1)}),this.gameState.set(P(y({},e),{currentPlayer:u,selectedPiece:null,validMoves:[],moveHistory:c,isInCheck:m,isSelfInCheck:p,gameOver:f,winner:V})),console.log("\u6AA2\u67E5AI\u89F8\u767C\u689D\u4EF6:",{gameOver:f,isVsAI:e.isVsAI,nextPlayer:u,shouldTrigger:!f&&e.isVsAI&&u==="black"}),!f&&e.isVsAI&&u==="black"&&(console.log("\u6E96\u5099\u89F8\u767CAI\u79FB\u52D5..."),this.triggerAIMove())}}generateMoveNotation(t,i,e,n){if(!t)return"";let o=this.chessGameService.getPieceSymbol(t),s=t.color==="red"?9-i.x:i.x+1,c=e.y-i.y,u="";return c===0?u="\u5E73"+(t.color==="red"?9-e.x:e.x+1):u=(c<0?"\u9032":"\u9000")+Math.abs(c),`${o}${s}${u}`}getSquareClass(t,i){let e="chess-square";return this.board()[i]?.[t]?.isSelected&&(e+=" selected"),this.isValidMove(t,i)&&(e+=" valid-move"),(this.chessGameService.isInPalace(t,i,"red")||this.chessGameService.isInPalace(t,i,"black"))&&(e+=" palace"),e}getPieceClass(t){if(!t)return"";let i=`chess-piece ${t.color}`;return t.isSelected&&(i+=" selected"),i}getPieceSymbol(t){return t?this.chessGameService.getPieceSymbol(t):""}getRowNumbers(){return Array.from({length:10},(t,i)=>10-i)}getColumnLetters(){return["a","b","c","d","e","f","g","h","i"]}setAIDifficulty(t){this.chessAIService.setDifficulty(t)}getCurrentDifficulty(){return this.chessAIService.getDifficulty()}toggleGameMode(){let t=this.gameState(),i=!t.isVsAI;this.gameState.set(P(y({},t),{isVsAI:i,aiIsThinking:!1})),i&&t.currentPlayer==="black"&&!t.gameOver&&this.triggerAIMove()}triggerAIMove(){let t=this.gameState();console.log("\u{1F916} \u89F8\u767CAI\u79FB\u52D5\uFF0C\u7576\u524D\u73A9\u5BB6:",t.currentPlayer),this.gameState.set(P(y({},t),{aiIsThinking:!0,aiThinkingText:this.chessAIService.getThinkingDescription(t)})),setTimeout(()=>{try{let i=this.chessAIService.makeAIMove(t);i?(console.log("\u{1F916} AI\u9078\u64C7\u79FB\u52D5:",i),this.makeAIMove(i.from,i.to)):(console.warn("\u{1F916} AI\u7121\u6CD5\u627E\u5230\u6709\u6548\u79FB\u52D5\uFF0CAI\u6295\u964D"),this.aiSurrender())}catch(i){console.error("\u{1F916} AI\u79FB\u52D5\u51FA\u932F:",i),this.aiSurrender()}},500)}makeAIMove(t,i){let e=this.gameState(),n=e.board[t.y][t.x];if(!n)return;let o=this.chessGameService.makeMove(e,t,i);if(o.success){let s=this.generateMoveNotation(n,t,i,o.captured),c=[...e.moveHistory,s],u="red",m=o.isCheck||!1,p=o.isSelfInCheck||!1,f=o.isCheckmate||o.isStalemate||o.gameOver||!1,V=o.winner||(o.isCheckmate?"black":null);e.board.flat().forEach(A=>{A&&(A.isSelected=!1)}),this.gameState.set(P(y({},e),{currentPlayer:u,selectedPiece:null,validMoves:[],moveHistory:c,isInCheck:m,isSelfInCheck:p,gameOver:f,winner:V,aiIsThinking:!1}))}}aiSurrender(){let t=this.gameState();console.log("\u{1F916} AI\u6295\u964D\uFF0C\u904A\u6232\u7D50\u675F"),this.gameState.set(P(y({},t),{gameOver:!0,winner:"red",aiIsThinking:!1,moveHistory:[...t.moveHistory,"\u{1F916} AI\u6295\u964D"]}))}static \u0275fac=function(i){return new(i||r)};static \u0275cmp=Q({type:r,selectors:[["app-chinese-chess"]],decls:87,vars:16,consts:[[1,"w-full","max-w-[95vw]","sm:max-w-sm","mx-auto","flex","flex-col","px-2","sm:px-0"],[1,"mb-2","flex","flex-col","gap-3","items-stretch"],[1,"flex","justify-between","items-center"],[1,"text-center","text-2xl","font-bold","tracking-wider","text-lime-400","drop-shadow"],["routerLink","/",1,"text-lime-600","text-sm"],[1,"flex","gap-2","justify-between"],[1,"h-12","w-1/3","touch-btn","rounded-md","bg-lime-700","border","border-lime-500","text-lime-50","font-semibold","text-base","shadow","hover:bg-lime-600","focus:outline-none","focus:ring-2","focus:ring-lime-300","drop-shadow-[0_0_5px_#22d3ee]",3,"click"],[1,"h-12","w-1/3","touch-btn","rounded-md","border","font-medium","shadow","bg-zinc-800"],[1,"text-3xl","text-center","text-amber-300","font-bold","leading-12","animate-pulse"],[1,"text-3xl","text-red-400","animate-pulse"],[1,"h-12","w-1/3","touch-btn","rounded-md","bg-cyan-700","border","border-cyan-500","text-cyan-50","font-semibold","text-base","shadow","hover:bg-cyan-600","focus:outline-none","focus:ring-2","focus:ring-cyan-300",3,"click"],[1,"flex","flex-col","gap-2"],[1,"flex","items-center","gap-1","flex-wrap","bg-white/10","rounded-md","p-2","border","border-white/20"],[1,"border","border-lime-400","bg-lime-400/20","px-2","py-1","text-lime-300","font-bold","hover:bg-lime-400/30","transition"],[1,"text-lime-400","text-xs"],[1,"text-center","text-xs"],[1,"border","px-2","py-1","font-bold",3,"ngClass"],[1,"text-xs"],[1,"border","border-amber-400","bg-amber-400/20","px-2","py-1","text-amber-300","font-bold"],[1,"w-full","text-center","text-sm","mt-2","h-4","bg-neutral-700/80","rounded","overflow-hidden","relative","animate-pulse","text-white"],[1,"flex","justify-center"],[1,"relative","inline-block"],[1,"chess-board","bg-amber-100","border-2","sm:border-4","border-amber-800","p-2","sm:p-6","relative"],[1,"flex","justify-center","mb-1","sm:mb-2"],[1,"grid","grid-cols-9","gap-0"],[1,"w-[36px]","sm:w-[50px]","text-center","text-xs","font-bold","text-amber-800"],[1,"flex"],[1,"flex","flex-col","justify-center","mr-1","sm:mr-2"],[1,"h-[40px]","sm:h-[50px]","flex","items-center","justify-center","text-xs","font-bold","text-amber-800","w-4","sm:w-6"],[1,"relative","w-[310px]","h-[360px]","sm:w-[408px]","sm:h-[450px]","bg-amber-100"],["viewBox","0 0 100 100",1,"absolute","top-0","left-[122px]","w-[72px]","h-[80px]","sm:hidden"],["x1","0","y1","0","x2","100","y2","100","stroke","#d97706","stroke-width","1"],["x1","100","y1","0","x2","0","y2","100","stroke","#d97706","stroke-width","1"],["viewBox","0 0 100 100",1,"absolute","bottom-0","left-[122px]","w-[72px]","h-[80px]","sm:hidden"],["viewBox","0 0 100 100",1,"absolute","top-0","left-[154px]","w-[100px]","h-[100px]","hidden","sm:block"],["viewBox","0 0 100 100",1,"absolute","bottom-0","left-[154px]","w-[100px]","h-[100px]","hidden","sm:block"],[1,"absolute","left-0","right-0","bg-amber-100","flex","items-center","justify-between","px-8","z-5","sm:hidden",2,"top","161px","height","40px"],[1,"text-amber-700","font-bold","text-xs","tracking-wider"],[1,"absolute","left-0","right-0","bg-amber-100","flex","items-center","justify-between","px-16","z-5","hidden","sm:flex",2,"top","204px","height","50px"],[1,"text-amber-700","font-bold","text-sm","tracking-wider"],[1,"flex","flex-col","justify-center","ml-1","sm:ml-2"],[1,"flex","justify-center","mt-1","sm:mt-2"],[1,"absolute","inset-0","bg-black/50","backdrop-blur-sm","flex","items-center","justify-center","z-50","rounded-lg"],[1,"mt-6"],[1,"mt-4","text-xs","text-amber-600","text-center"],[1,"mb-1"],[1,"text-amber-400","text-xs"],[1,"absolute","left-0","right-0","h-[1px]","bg-amber-800",3,"ngClass"],[1,"absolute","left-0","right-0","h-[1px]","bg-amber-800","hidden","sm:block"],[1,"absolute","w-[1px]","bg-amber-800","sm:hidden"],[1,"absolute","w-[1px]","bg-amber-800","hidden","sm:block"],[1,"absolute","w-[20px]","h-[20px]","-translate-x-1/2","-translate-y-1/2","rounded-full","hover:bg-amber-200/30","cursor-pointer","z-20","sm:hidden",3,"click","ngClass"],[1,"absolute","w-[6px]","h-[6px]","bg-amber-800","rounded-full","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[32px]","h-[32px]",3,"ngClass"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-2","h-2","bg-green-500","rounded-full","opacity-70"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[34px]","h-[34px]","border-2","border-red-500","rounded-full"],[1,"absolute","w-[24px]","h-[24px]","-translate-x-1/2","-translate-y-1/2","rounded-full","hover:bg-amber-200/30","cursor-pointer","z-20","hidden","sm:block",3,"click","ngClass"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[40px]","h-[40px]",3,"ngClass"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-3","h-3","bg-green-500","rounded-full","opacity-70"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[42px]","h-[42px]","border-2","border-red-500","rounded-full"],[1,"w-8","h-8","rounded-full","border-2","flex","items-center","justify-center","text-sm","font-bold","shadow-lg"],[1,"w-10","h-10","rounded-full","border-2","flex","items-center","justify-center","text-lg","font-bold","shadow-lg"],[1,"bg-gradient-to-br","from-amber-600","to-amber-800","border-2","border-amber-400","rounded-lg","p-8","shadow-2xl","text-center"],[1,"text-3xl","mb-4"],[1,"text-2xl","font-bold","mb-4","text-amber-100"],[1,"bg-amber-400","hover:bg-amber-300","text-amber-900","font-bold","py-3","px-6","rounded-lg","transition-all","duration-200","transform","hover:scale-105","shadow-lg",3,"click"],[1,"text-lg","font-bold","text-amber-400","mb-3"],[1,"bg-neutral-900/70","border","border-neutral-700","rounded-md","p-4","max-h-32","overflow-y-auto"],[1,"grid","grid-cols-2","gap-2","text-sm"],[1,"flex","gap-2"],[1,"text-neutral-400"],[1,"text-red-400"],[1,"text-neutral-300"]],template:function(i,e){i&1&&(d(0,"div",0)(1,"header",1)(2,"div",2)(3,"h1",3),h(4," \u4E2D\u570B\u8C61\u68CB "),l(),d(5,"a",4),h(6,"HOME"),l()(),d(7,"div",5)(8,"button",6),D("click",function(){return e.toggleGameMode()}),h(9),l(),d(10,"div",7),v(11,ue,2,0,"div",8),v(12,he,2,0,"div",9),l(),d(13,"button",10),D("click",function(){return e.resetGame()}),h(14," \u91CD\u65B0\u958B\u59CB "),l()(),d(15,"div",11)(16,"div",12)(17,"div",13)(18,"div",14),h(19,"\u7576\u524D\u5C0D\u6230"),l(),d(20,"div",15),h(21),l()(),d(22,"div",16)(23,"div",17),h(24,"\u7576\u524D\u56DE\u5408"),l(),d(25,"div",15),v(26,me,2,0,"span"),h(27),l()(),v(28,pe,5,1,"div",18),d(29,"div",19),v(30,fe,1,0),l()()()(),d(31,"main",20)(32,"div",21)(33,"div",22)(34,"div",23)(35,"div",24),M(36,ve,2,1,"div",25,I),l()(),d(38,"div",26)(39,"div",27),M(40,Ce,2,1,"div",28,I),l(),d(42,"div",29),M(43,xe,2,9,null,null,I),M(45,ge,4,24,null,null,I),U(),d(47,"svg",30),b(48,"line",31)(49,"line",32),l(),d(50,"svg",33),b(51,"line",31)(52,"line",32),l(),d(53,"svg",34),b(54,"line",31)(55,"line",32),l(),d(56,"svg",35),b(57,"line",31)(58,"line",32),l(),J(),d(59,"div",36)(60,"span",37),h(61,"\u695A\u6CB3"),l(),d(62,"span",37),h(63,"\u6F22\u754C"),l()(),d(64,"div",38)(65,"span",39),h(66,"\u695A\u6CB3"),l(),d(67,"span",39),h(68,"\u6F22\u754C"),l()(),M(69,Ae,2,0,null,null,F),l(),d(71,"div",40),M(72,Oe,2,1,"div",28,I),l()(),d(74,"div",41)(75,"div",24),M(76,Be,2,1,"div",25,I),l()()(),v(78,Re,8,1,"div",42),l()(),h(79),W(80,"json"),v(81,$e,7,0,"section",43),d(82,"footer",44)(83,"p",45),h(84,"\u9EDE\u64CA\u9078\u64C7\u68CB\u5B50\uFF0C\u518D\u9EDE\u64CA\u76EE\u6A19\u4F4D\u7F6E\u79FB\u52D5"),l(),d(85,"p"),h(86,"\u7D05\u65B9\u5148\u884C\uFF0C\u5C07\u8ECD\u5C0D\u65B9\u5373\u7372\u52DD"),l()()()),i&2&&(a(9),_(" ",e.isVsAI()?"\u{1F465} \u5207\u63DB\u96D9\u4EBA":"\u{1F916} \u5207\u63DBAI"," "),a(2),C(e.isInCheck()?11:-1),a(),C(e.isSelfInCheck()&&!e.isInCheck()?12:-1),a(9),$(e.isVsAI()?"\u{1F916}":"\u{1F465}"),a(),E("ngClass",e.currentPlayer()===e.PlayerColor.RED?"bg-red-500/20 border-red-400 text-red-300":"bg-neutral-800/20 border-neutral-400 text-neutral-300"),a(4),C(e.isVsAI()&&e.currentPlayer()===e.PlayerColor.BLACK?26:-1),a(),_("",e.currentPlayerDisplay()," "),a(),C(e.moveHistory().length>0?28:-1),a(2),C(e.aiIsThinking()?30:-1),a(6),S(e.getColumnLetters()),a(4),S(e.getRowNumbers()),a(3),S(H(14,ce)),a(2),S(H(15,de)),a(24),S(e.board()),a(3),S(e.getRowNumbers()),a(4),S(e.getColumnLetters()),a(2),C(e.gameOver()?78:-1),a(),_(" ",Z(80,12,e.moveHistory())," "),a(2),C(e.moveHistory().length>0?81:-1))},dependencies:[ie,ee,ne,te],styles:['.chess-board[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fef3c7,#fed7aa);box-shadow:0 8px 32px #0000004d}.chess-square[_ngcontent-%COMP%]{position:relative;background:transparent;transition:all .2s ease}.chess-square[_ngcontent-%COMP%]:hover{background-color:#f59e0b1a}.chess-square.selected[_ngcontent-%COMP%]{background-color:#22c55e4d!important;border-color:#22c55e!important;box-shadow:inset 0 0 0 2px #22c55e}.chess-square.valid-move[_ngcontent-%COMP%]{background-color:#22c55e26!important}.chess-square.valid-move[_ngcontent-%COMP%]:after{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:12px;height:12px;background-color:#22c55e;border-radius:50%;opacity:.8}.chess-square.valid-move[_ngcontent-%COMP%]:hover:after{width:16px;height:16px;opacity:1}.chess-square.palace[_ngcontent-%COMP%]{background-color:#f59e0b0d}.chess-piece[_ngcontent-%COMP%]{transition:all .3s ease;z-index:10}.chess-piece.selected[_ngcontent-%COMP%]{transform:scale(1.1);filter:drop-shadow(0 0 8px rgba(34,197,94,.6))}.chess-piece.red[_ngcontent-%COMP%]   .piece-symbol[_ngcontent-%COMP%]{color:#dc2626;background:linear-gradient(135deg,#fecaca,#fee2e2);border-color:#dc2626}.chess-piece.black[_ngcontent-%COMP%]   .piece-symbol[_ngcontent-%COMP%]{color:#374151;background:linear-gradient(135deg,#f3f4f6,#e5e7eb);border-color:#374151}.chess-piece[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.move-history[_ngcontent-%COMP%]{scrollbar-width:thin;scrollbar-color:#6b7280 #1f2937}.move-history[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.move-history[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#1f2937;border-radius:3px}.move-history[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#6b7280;border-radius:3px}.move-history[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#9ca3af}@media (max-width: 640px){.chess-board[_ngcontent-%COMP%]{padding:1rem}.chess-board[_ngcontent-%COMP%]   .chess-square[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem}.chess-board[_ngcontent-%COMP%]   .chess-piece[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:2rem;height:2rem;font-size:.875rem}}@keyframes _ngcontent-%COMP%_piece-capture{0%{transform:scale(1);opacity:1}50%{transform:scale(1.3);opacity:.7}to{transform:scale(0);opacity:0}}.captured[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_piece-capture .5s ease-out forwards}@keyframes _ngcontent-%COMP%_check-warning{0%,to{box-shadow:0 0 #ef4444b3}50%{box-shadow:0 0 0 10px #ef444400}}.in-check[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_check-warning 1s infinite}.valid-move-point.valid-move[_ngcontent-%COMP%]:after{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:10px;height:10px;background-color:#22c55e;border-radius:50%;opacity:.7}.valid-move-point[_ngcontent-%COMP%]:hover{background-color:#f59e0b33}']})};export{re as ChineseChess};
