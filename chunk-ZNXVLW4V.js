import{$ as ut,A as N,B as he,C as Ge,D as Y,E as te,F as fe,G as ct,H as y,I as C,J as pe,K as U,L as T,M as G,N as O,O as c,P as l,Q as V,R,S as A,T as m,U as K,V as dt,W as ie,X as h,Y as me,Z as P,a as x,aa as ht,b as D,ba as ft,c as b,d as tt,da as Be,e as it,ea as Ke,f as nt,fa as Le,g as ot,h as Fe,i as ee,ia as q,j as ke,ja as E,k as W,ka as He,l as L,la as pt,m as I,ma as mt,n as S,na as je,o as st,oa as gt,p as rt,qa as ge,r as k,s as at,t as lt,u as Re,wa as _t,y as u,z as Te}from"./chunk-PVIEXI2X.js";var Dt=(()=>{class i{_renderer;_elementRef;onChange=t=>{};onTouched=()=>{};constructor(t,n){this._renderer=t,this._elementRef=n}setProperty(t,n){this._renderer.setProperty(this._elementRef.nativeElement,t,n)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static \u0275fac=function(n){return new(n||i)(N(Te),N(Re))};static \u0275dir=Y({type:i})}return i})(),Jt=(()=>{class i extends Dt{static \u0275fac=(()=>{let t;return function(o){return(t||(t=lt(i)))(o||i)}})();static \u0275dir=Y({type:i,features:[te]})}return i})(),It=new W("");var Xt={provide:It,useExisting:Fe(()=>xe),multi:!0};function Zt(){let i=je()?je().getUserAgent():"";return/android (\d+)/.test(i.toLowerCase())}var Qt=new W(""),xe=(()=>{class i extends Dt{_compositionMode;_composing=!1;constructor(t,n,o){super(t,n),this._compositionMode=o,this._compositionMode==null&&(this._compositionMode=!Zt())}writeValue(t){let n=t??"";this.setProperty("value",n)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static \u0275fac=function(n){return new(n||i)(N(Te),N(Re),N(Qt,8))};static \u0275dir=Y({type:i,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(n,o){n&1&&A("input",function(r){return o._handleInput(r.target.value)})("blur",function(){return o.onTouched()})("compositionstart",function(){return o._compositionStart()})("compositionend",function(r){return o._compositionEnd(r.target.value)})},standalone:!1,features:[Be([Xt]),te]})}return i})();var ei=new W(""),ti=new W("");function St(i){return i!=null}function Mt(i){return ct(i)?it(i):i}function wt(i){let e={};return i.forEach(t=>{e=t!=null?x(x({},e),t):e}),Object.keys(e).length===0?null:e}function Vt(i,e){return e.map(t=>t(i))}function ii(i){return!i.validate}function Pt(i){return i.map(e=>ii(e)?e:t=>e.validate(t))}function ni(i){if(!i)return null;let e=i.filter(St);return e.length==0?null:function(t){return wt(Vt(t,e))}}function Ot(i){return i!=null?ni(Pt(i)):null}function oi(i){if(!i)return null;let e=i.filter(St);return e.length==0?null:function(t){let n=Vt(t,e).map(Mt);return ot(n).pipe(nt(wt))}}function Nt(i){return i!=null?oi(Pt(i)):null}function vt(i,e){return i===null?[e]:Array.isArray(i)?[...i,e]:[i,e]}function si(i){return i._rawValidators}function ri(i){return i._rawAsyncValidators}function $e(i){return i?Array.isArray(i)?i:[i]:[]}function ve(i,e){return Array.isArray(i)?i.includes(e):i===e}function yt(i,e){let t=$e(e);return $e(i).forEach(o=>{ve(t,o)||t.push(o)}),t}function Ct(i,e){return $e(e).filter(t=>!ve(i,t))}var ye=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=Ot(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=Nt(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},Ue=class extends ye{name;get formDirective(){return null}get path(){return null}},ae=class extends ye{_parent=null;name=null;valueAccessor=null},qe=class{_cd;constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},ai={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},yo=D(x({},ai),{"[class.ng-submitted]":"isSubmitted"}),Ft=(()=>{class i extends qe{constructor(t){super(t)}static \u0275fac=function(n){return new(n||i)(N(ae,2))};static \u0275dir=Y({type:i,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(n,o){n&2&&dt("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)},standalone:!1,features:[te]})}return i})();var ne="VALID",_e="INVALID",z="PENDING",oe="DISABLED",X=class{},Ce=class extends X{value;source;constructor(e,t){super(),this.value=e,this.source=t}},se=class extends X{pristine;source;constructor(e,t){super(),this.pristine=e,this.source=t}},re=class extends X{touched;source;constructor(e,t){super(),this.touched=e,this.source=t}},J=class extends X{status;source;constructor(e,t){super(),this.status=e,this.source=t}};function li(i){return(Ae(i)?i.validators:i)||null}function ci(i){return Array.isArray(i)?Ot(i):i||null}function di(i,e){return(Ae(e)?e.asyncValidators:i)||null}function ui(i){return Array.isArray(i)?Nt(i):i||null}function Ae(i){return i!=null&&!Array.isArray(i)&&typeof i=="object"}var We=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(e,t){this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return q(this.statusReactive)}set status(e){q(()=>this.statusReactive.set(e))}_status=E(()=>this.statusReactive());statusReactive=k(void 0);get valid(){return this.status===ne}get invalid(){return this.status===_e}get pending(){return this.status==z}get disabled(){return this.status===oe}get enabled(){return this.status!==oe}errors;get pristine(){return q(this.pristineReactive)}set pristine(e){q(()=>this.pristineReactive.set(e))}_pristine=E(()=>this.pristineReactive());pristineReactive=k(!0);get dirty(){return!this.pristine}get touched(){return q(this.touchedReactive)}set touched(e){q(()=>this.touchedReactive.set(e))}_touched=E(()=>this.touchedReactive());touchedReactive=k(!1);get untouched(){return!this.touched}_events=new tt;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(yt(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(yt(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(Ct(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(Ct(e,this._rawAsyncValidators))}hasValidator(e){return ve(this._rawValidators,e)}hasAsyncValidator(e){return ve(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let n=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(D(x({},e),{sourceControl:n})),t&&e.emitEvent!==!1&&this._events.next(new re(!0,n))}markAllAsDirty(e={}){this.markAsDirty({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsDirty(e))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let n=e.sourceControl??this;this._forEachChild(o=>{o.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:n})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,n),t&&e.emitEvent!==!1&&this._events.next(new re(!1,n))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let n=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(D(x({},e),{sourceControl:n})),t&&e.emitEvent!==!1&&this._events.next(new se(!1,n))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let n=e.sourceControl??this;this._forEachChild(o=>{o.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,n),t&&e.emitEvent!==!1&&this._events.next(new se(!0,n))}markAsPending(e={}){this.status=z;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new J(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(D(x({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=oe,this.errors=null,this._forEachChild(o=>{o.disable(D(x({},e),{onlySelf:!0}))}),this._updateValue();let n=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Ce(this.value,n)),this._events.next(new J(this.status,n)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(D(x({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(o=>o(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=ne,this._forEachChild(n=>{n.enable(D(x({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(D(x({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(n=>n(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let n=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===ne||this.status===z)&&this._runAsyncValidator(n,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Ce(this.value,t)),this._events.next(new J(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(D(x({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?oe:ne}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=z,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1,shouldHaveEmitted:e!==!1};let n=Mt(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(o=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(o,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=(this._hasOwnPendingAsyncValidator?.emitEvent||this._hasOwnPendingAsyncValidator?.shouldHaveEmitted)??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((n,o)=>n&&n._find(o),this)}getError(e,t){let n=t?this.get(t):this;return n&&n.errors?n.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,n){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||n)&&this._events.next(new J(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,n)}_initObservables(){this.valueChanges=new fe,this.statusChanges=new fe}_calculateStatus(){return this._allControlsDisabled()?oe:this.errors?_e:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(z)?z:this._anyControlsHaveStatus(_e)?_e:ne}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let n=!this._anyControlsDirty(),o=this.pristine!==n;this.pristine=n,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),o&&this._events.next(new se(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new re(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_onDisabledChange=[];_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Ae(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=ci(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=ui(this._rawAsyncValidators)}};var kt=new W("",{providedIn:"root",factory:()=>Ye}),Ye="always";function hi(i,e){return[...e.path,i]}function fi(i,e,t=Ye){mi(i,e),e.valueAccessor.writeValue(i.value),(i.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(i.disabled),gi(i,e),vi(i,e),_i(i,e),pi(i,e)}function bt(i,e){i.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function pi(i,e){if(e.valueAccessor.setDisabledState){let t=n=>{e.valueAccessor.setDisabledState(n)};i.registerOnDisabledChange(t),e._registerOnDestroy(()=>{i._unregisterOnDisabledChange(t)})}}function mi(i,e){let t=si(i);e.validator!==null?i.setValidators(vt(t,e.validator)):typeof t=="function"&&i.setValidators([t]);let n=ri(i);e.asyncValidator!==null?i.setAsyncValidators(vt(n,e.asyncValidator)):typeof n=="function"&&i.setAsyncValidators([n]);let o=()=>i.updateValueAndValidity();bt(e._rawValidators,o),bt(e._rawAsyncValidators,o)}function gi(i,e){e.valueAccessor.registerOnChange(t=>{i._pendingValue=t,i._pendingChange=!0,i._pendingDirty=!0,i.updateOn==="change"&&Rt(i,e)})}function _i(i,e){e.valueAccessor.registerOnTouched(()=>{i._pendingTouched=!0,i.updateOn==="blur"&&i._pendingChange&&Rt(i,e),i.updateOn!=="submit"&&i.markAsTouched()})}function Rt(i,e){i._pendingDirty&&i.markAsDirty(),i.setValue(i._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(i._pendingValue),i._pendingChange=!1}function vi(i,e){let t=(n,o)=>{e.valueAccessor.writeValue(n),o&&e.viewToModelUpdate(n)};i.registerOnChange(t),e._registerOnDestroy(()=>{i._unregisterOnChange(t)})}function yi(i,e){if(!i.hasOwnProperty("model"))return!1;let t=i.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function Ci(i){return Object.getPrototypeOf(i.constructor)===Jt}function bi(i,e){if(!e)return null;Array.isArray(e);let t,n,o;return e.forEach(s=>{s.constructor===xe?t=s:Ci(s)?n=s:o=s}),o||n||t||null}function xt(i,e){let t=i.indexOf(e);t>-1&&i.splice(t,1)}function At(i){return typeof i=="object"&&i!==null&&Object.keys(i).length===2&&"value"in i&&"disabled"in i}var xi=class extends We{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(e=null,t,n){super(li(t),di(n,t)),this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Ae(t)&&(t.nonNullable||t.initialValueIsDefault)&&(At(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(n=>n(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){xt(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){xt(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){At(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var Ai={provide:ae,useExisting:Fe(()=>ze)},Et=Promise.resolve(),ze=(()=>{class i extends ae{_changeDetectorRef;callSetDisabledState;control=new xi;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new fe;constructor(t,n,o,s,r,a){super(),this._changeDetectorRef=r,this.callSetDisabledState=a,this._parent=t,this._setValidators(n),this._setAsyncValidators(o),this.valueAccessor=bi(this,s)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){let n=t.name.previousValue;this.formDirective.removeControl({name:n,path:this._getPath(n)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),yi(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){fi(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(t){Et.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){let n=t.isDisabled.currentValue,o=n!==0&&mt(n);Et.then(()=>{o&&!this.control.disabled?this.control.disable():!o&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?hi(t,this._parent):[t]}static \u0275fac=function(n){return new(n||i)(N(Ue,9),N(ei,10),N(ti,10),N(It,10),N(pt,8),N(kt,8))};static \u0275dir=Y({type:i,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[Be([Ai]),te,at]})}return i})();var Ei=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=Ge({type:i});static \u0275inj=ke({})}return i})();var Ee=(()=>{class i{static withConfig(t){return{ngModule:i,providers:[{provide:kt,useValue:t.callSetDisabledState??Ye}]}}static \u0275fac=function(n){return new(n||i)};static \u0275mod=Ge({type:i});static \u0275inj=ke({imports:[Ei]})}return i})();var Z=(t=>(t.RED="red",t.BLACK="black",t))(Z||{});var Je={board:[],currentPlayer:"red",selectedPiece:null,validMoves:[],gameOver:!1,winner:null,moveHistory:[],isInCheck:!1,isSelfInCheck:!1,isVsAI:!0,aiIsThinking:!1,aiThinkingText:"",hasApiKey:!1},H=class i{static BOARD_WIDTH=9;static BOARD_HEIGHT=10;static PALACE_LEFT=3;static PALACE_RIGHT=5;static RED_PALACE_TOP=7;static RED_PALACE_BOTTOM=9;static BLACK_PALACE_TOP=0;static BLACK_PALACE_BOTTOM=2;hasApiKey=k(!1);boardCache={kingPositions:new Map,piecesByColor:new Map,lastMoveCount:-1};constructor(){this.updateApiKeyStatus()}moveCache=new Map;ORTHOGONAL_DIRECTIONS=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}];DIAGONAL_DIRECTIONS=[{dx:-1,dy:-1},{dx:1,dy:-1},{dx:-1,dy:1},{dx:1,dy:1}];initializeBoard(){let e=Array(10).fill(null).map(()=>Array(9).fill(null));return this.setupInitialPieces(e),e}setupInitialPieces(e){let t=["rook","horse","elephant","advisor","king","advisor","elephant","horse","rook"];t.forEach((o,s)=>{let r=this.generatePieceId(o,"red",s);e[9][s]=this.createPiece(r,o,"red",s,9)}),[...t].forEach((o,s)=>{let r=this.generatePieceId(o,"black",s);e[0][s]=this.createPiece(r,o,"black",s,0)}),[1,7].forEach((o,s)=>{e[7][o]=this.createPiece(`r-cannon-${s+1}`,"cannon","red",o,7),e[2][o]=this.createPiece(`b-cannon-${s+1}`,"cannon","black",o,2)});for(let o=0;o<9;o+=2)e[6][o]=this.createPiece(`r-soldier-${o}`,"soldier","red",o,6),e[3][o]=this.createPiece(`b-soldier-${o}`,"soldier","black",o,3)}generatePieceId(e,t,n){let o=t==="red"?"r":"b";return e==="king"?`${o}-king`:`${o}-${e}-${n<4?"1":"2"}`}createPiece(e,t,n,o,s){return{id:e,type:t,color:n,position:{x:o,y:s},isSelected:!1,hasMoved:!1}}initializeGameState(){return D(x({},Je),{board:this.initializeBoard(),hasApiKey:this.checkHasApiKey()})}isValidPosition(e,t){return e>=0&&e<i.BOARD_WIDTH&&t>=0&&t<i.BOARD_HEIGHT}isInPalace(e,t,n){return n==="red"?e>=i.PALACE_LEFT&&e<=i.PALACE_RIGHT&&t>=i.RED_PALACE_TOP&&t<=i.RED_PALACE_BOTTOM:e>=i.PALACE_LEFT&&e<=i.PALACE_RIGHT&&t>=i.BLACK_PALACE_TOP&&t<=i.BLACK_PALACE_BOTTOM}isOnOwnSide(e,t){return t==="red"?e>=5:e<=4}wouldKingsFaceEachOther(e,t=0){this.updateBoardCache(e,t);let n=this.boardCache.kingPositions.get("red"),o=this.boardCache.kingPositions.get("black");return!n||!o||n.x!==o.x?!1:this.isPathClear(e,n,o)}isPathClear(e,t,n){let o=Math.min(t.y,n.y),s=Math.max(t.y,n.y);for(let r=o+1;r<s;r++)if(e[r][t.x]!==null)return!1;return!0}updateBoardCache(e,t){if(this.boardCache.lastMoveCount!==t){this.boardCache.kingPositions.clear(),this.boardCache.piecesByColor.clear(),this.boardCache.piecesByColor.set("red",[]),this.boardCache.piecesByColor.set("black",[]);for(let n=0;n<i.BOARD_HEIGHT;n++)for(let o=0;o<i.BOARD_WIDTH;o++){let s=e[n][o];s&&(this.boardCache.piecesByColor.get(s.color).push(s),s.type==="king"&&this.boardCache.kingPositions.set(s.color,{x:o,y:n}))}this.boardCache.lastMoveCount=t}}clearCaches(){this.moveCache.clear(),this.boardCache.lastMoveCount=-1}getBoardHash(e){let t="";for(let n=0;n<i.BOARD_HEIGHT;n++)for(let o=0;o<i.BOARD_WIDTH;o++){let s=e[n][o];t+=s?`${s.type}${s.color}${o}${n}`:"e"}return t}isValidMoveForPiece(e,t,n){if(!this.isValidPosition(e.x,e.y))return!1;let o=n[e.y][e.x];return!o||o.color!==t.color}getSlidingPieceMoves(e,t,n){let o=[],{x:s,y:r}=e.position;return n.forEach(a=>{for(let d=1;d<10;d++){let f=s+a.dx*d,p=r+a.dy*d;if(!this.isValidPosition(f,p))break;let g=t[p][f];if(g){g.color!==e.color&&o.push({x:f,y:p});break}else o.push({x:f,y:p})}}),o}getPossibleMoves(e,t){let n=`${e.id}-${e.position.x}-${e.position.y}-true`;if(this.moveCache.has(n))return this.moveCache.get(n);let o=this.calculatePieceMoves(e,t,!0);return this.moveCache.set(n,o),o}getPossibleMovesForCheck(e,t){let n=`${e.id}-${e.position.x}-${e.position.y}-false`;if(this.moveCache.has(n))return this.moveCache.get(n);let o=this.calculatePieceMoves(e,t,!1);return this.moveCache.set(n,o),o}calculatePieceMoves(e,t,n){switch(e.type){case"king":return this.getKingMoves(e,t,n);case"advisor":return this.getAdvisorMoves(e,t);case"elephant":return this.getElephantMoves(e,t);case"horse":return this.getHorseMoves(e,t);case"rook":return this.getRookMoves(e,t);case"cannon":return this.getCannonMoves(e,t);case"soldier":return this.getSoldierMoves(e,t);default:return[]}}getKingMoves(e,t,n){let{x:o,y:s}=e.position;return this.ORTHOGONAL_DIRECTIONS.map(a=>({x:o+a.dx,y:s+a.dy})).filter(a=>{if(!this.isValidPosition(a.x,a.y)||!this.isInPalace(a.x,a.y,e.color))return!1;let d=t[a.y][a.x];return d&&d.color===e.color?!1:!n||!this.wouldMoveCreateKingFacing(e,a,t)})}wouldMoveCreateKingFacing(e,t,n){let o=n[t.y][t.x],s=e.position;n[t.y][t.x]=e,n[s.y][s.x]=null,e.position=t;let r=this.wouldKingsFaceEachOther(n);return n[s.y][s.x]=e,n[t.y][t.x]=o,e.position=s,r}getAdvisorMoves(e,t){let{x:n,y:o}=e.position;return this.DIAGONAL_DIRECTIONS.map(r=>({x:n+r.dx,y:o+r.dy})).filter(r=>this.isValidPosition(r.x,r.y)&&this.isInPalace(r.x,r.y,e.color)&&this.isValidMoveForPiece(r,e,t))}getElephantMoves(e,t){let{x:n,y:o}=e.position;return[{x:n-2,y:o-2,block:{x:n-1,y:o-1}},{x:n+2,y:o-2,block:{x:n+1,y:o-1}},{x:n-2,y:o+2,block:{x:n-1,y:o+1}},{x:n+2,y:o+2,block:{x:n+1,y:o+1}}].filter(r=>this.isValidPosition(r.x,r.y)&&this.isOnOwnSide(r.y,e.color)&&!t[r.block.y][r.block.x]&&this.isValidMoveForPiece(r,e,t)).map(r=>({x:r.x,y:r.y}))}getHorseMoves(e,t){let{x:n,y:o}=e.position;return[{x:n-1,y:o-2,block:{x:n,y:o-1}},{x:n+1,y:o-2,block:{x:n,y:o-1}},{x:n-1,y:o+2,block:{x:n,y:o+1}},{x:n+1,y:o+2,block:{x:n,y:o+1}},{x:n-2,y:o-1,block:{x:n-1,y:o}},{x:n-2,y:o+1,block:{x:n-1,y:o}},{x:n+2,y:o-1,block:{x:n+1,y:o}},{x:n+2,y:o+1,block:{x:n+1,y:o}}].filter(r=>this.isValidPosition(r.x,r.y)&&!t[r.block.y][r.block.x]&&this.isValidMoveForPiece(r,e,t)).map(r=>({x:r.x,y:r.y}))}getRookMoves(e,t){return this.getSlidingPieceMoves(e,t,this.ORTHOGONAL_DIRECTIONS)}getCannonMoves(e,t){let n=[],{x:o,y:s}=e.position;return this.ORTHOGONAL_DIRECTIONS.forEach(r=>{let a=!1;for(let d=1;d<10;d++){let f=o+r.dx*d,p=s+r.dy*d;if(!this.isValidPosition(f,p))break;let g=t[p][f];if(g)if(!a)a=!0;else{g.color!==e.color&&n.push({x:f,y:p});break}else a||n.push({x:f,y:p})}}),n}getSoldierMoves(e,t){let n=[],{x:o,y:s}=e.position,r=e.color==="red"?-1:1,a={x:o,y:s+r};return this.isValidMoveForPiece(a,e,t)&&n.push(a),this.isOnOwnSide(s,e.color)||[{x:o-1,y:s},{x:o+1,y:s}].forEach(f=>{this.isValidMoveForPiece(f,e,t)&&n.push(f)}),n}isInCheck(e,t,n=0){this.updateBoardCache(e,n);let o=this.boardCache.kingPositions.get(t);if(!o)return!1;let s=t==="red"?"black":"red";return(this.boardCache.piecesByColor.get(s)||[]).some(a=>this.getPossibleMovesForCheck(a,e).some(f=>f.x===o.x&&f.y===o.y))}makeMove(e,t,n){let{board:o,moveHistory:s}=e,r=o[t.y][t.x];if(!r)return{success:!1};let a=o[n.y][n.x],d=s.length;if(this.clearCaches(),o[n.y][n.x]=r,o[t.y][t.x]=null,r.position=n,a&&a.type==="king")return r.hasMoved=!0,{success:!0,captured:a,isCheck:!1,gameOver:!0,winner:r.color};if(this.wouldKingsFaceEachOther(o,d+1))return r.hasMoved=!0,{success:!0,captured:a||void 0,isCheck:!1,gameOver:!0,winner:r.color==="red"?"black":"red"};let f=r.color==="red"?"black":"red",p=this.isInCheck(o,f,d+1),g=this.isInCheck(o,r.color,d+1);return r.hasMoved=!0,{success:!0,captured:a||void 0,isCheck:p,isSelfInCheck:g}}getPieceSymbol(e){return{king:{red:"\u5E25",black:"\u5C07"},advisor:{red:"\u4ED5",black:"\u58EB"},elephant:{red:"\u76F8",black:"\u8C61"},horse:{red:"\u99AC",black:"\u99AC"},rook:{red:"\u8ECA",black:"\u8ECA"},cannon:{red:"\u70AE",black:"\u7832"},soldier:{red:"\u5175",black:"\u5352"}}[e.type][e.color]}checkHasApiKey(){if(typeof localStorage<"u"){let e=localStorage.getItem("gemini-api-key");return!!e&&e!=="YOUR_GEMINI_API_KEY_HERE"}return!1}updateApiKeyStatus(){let e=this.checkHasApiKey();this.hasApiKey.set(e)}static \u0275fac=function(t){return new(t||i)};static \u0275prov=ee({token:i,factory:i.\u0275fac,providedIn:"root"})};var De={king:1e4,rook:500,cannon:450,horse:400,elephant:200,advisor:200,soldier:100},Si=[[0,0,0,20,30,20,0,0,0],[0,0,0,10,20,10,0,0,0],[0,0,0,5,10,5,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,-5,-10,-5,0,0,0],[0,0,0,-10,-20,-10,0,0,0],[0,0,0,-20,-30,-20,0,0,0]],Mi=[[40,50,50,55,60,55,50,50,40],[30,40,45,50,55,50,45,40,30],[20,30,35,40,45,40,35,30,20],[10,20,25,30,35,30,25,20,10],[5,15,20,25,30,25,20,15,5],[-5,-5,10,15,20,15,10,-5,-5],[-10,-10,0,5,10,5,0,-10,-10],[-15,-15,-5,0,5,0,-5,-15,-15],[-20,-20,-10,-5,0,-5,-10,-20,-20],[-25,-25,-15,-10,-5,-10,-15,-25,-25]],wi=[[30,35,40,45,50,45,40,35,30],[25,30,35,40,45,40,35,30,25],[20,25,30,35,40,35,30,25,20],[15,20,25,30,35,30,25,20,15],[10,15,20,25,30,25,20,15,10],[5,10,15,20,25,20,15,10,5],[0,5,10,15,20,15,10,5,0],[-5,0,5,10,15,10,5,0,-5],[-10,-5,0,5,10,5,0,-5,-10],[-15,-10,-5,0,5,0,-5,-10,-15]],Vi=[[10,20,30,35,40,35,30,20,10],[15,25,35,40,45,40,35,25,15],[20,30,40,45,50,45,40,30,20],[25,35,45,50,55,50,45,35,25],[20,30,40,45,50,45,40,30,20],[15,25,35,40,45,40,35,25,15],[10,20,30,35,40,35,30,20,10],[5,15,25,30,35,30,25,15,5],[0,10,20,25,30,25,20,10,0],[-5,5,15,20,25,20,15,5,-5]],Pi=[[0,0,20,0,0,0,20,0,0],[0,0,0,0,0,0,0,0,0],[15,0,0,0,25,0,0,0,15],[0,0,0,0,0,0,0,0,0],[10,0,0,0,20,0,0,0,10],[0,0,0,0,0,0,0,0,0],[-10,0,0,0,-20,0,0,0,-10],[0,0,0,0,0,0,0,0,0],[-15,0,0,0,-25,0,0,0,-15],[0,0,-20,0,0,0,-20,0,0]],Oi=[[0,0,0,20,0,20,0,0,0],[0,0,0,0,30,0,0,0,0],[0,0,0,15,0,15,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,-15,0,-15,0,0,0],[0,0,0,0,-30,0,0,0,0],[0,0,0,-20,0,-20,0,0,0]],Ni=[[15,20,25,30,35,30,25,20,15],[10,15,20,25,30,25,20,15,10],[8,12,16,20,25,20,16,12,8],[6,10,14,18,22,18,14,10,6],[5,8,12,16,20,16,12,8,5],[3,6,9,12,15,12,9,6,3],[2,4,6,8,10,8,6,4,2],[1,2,3,4,5,4,3,2,1],[0,1,2,3,4,3,2,1,0],[0,0,1,2,3,2,1,0,0]],Xe={king:Si,rook:Mi,cannon:wi,horse:Vi,elephant:Pi,advisor:Oi,soldier:Ni};function Tt(i,e,t,n){if(!Xe[i])return 0;if(n==="red"){let o=9-t;return Xe[i][o][e]}else return Xe[i][t][e]}var Gt=["user","model","function","system"];var Ie=(function(i){return i.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",i.STOP="STOP",i.MAX_TOKENS="MAX_TOKENS",i.SAFETY="SAFETY",i.RECITATION="RECITATION",i.LANGUAGE="LANGUAGE",i.BLOCKLIST="BLOCKLIST",i.PROHIBITED_CONTENT="PROHIBITED_CONTENT",i.SPII="SPII",i.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",i.OTHER="OTHER",i})(Ie||{});var w=class extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}},j=class extends w{constructor(e,t){super(e),this.response=t}},Me=class extends w{constructor(e,t,n,o){super(e),this.status=t,this.statusText=n,this.errorDetails=o}},B=class extends w{},we=class extends w{};var Fi="https://generativelanguage.googleapis.com",ki="v1beta",Ri="0.24.1",Ti="genai-js",Q=(function(i){return i.GENERATE_CONTENT="generateContent",i.STREAM_GENERATE_CONTENT="streamGenerateContent",i.COUNT_TOKENS="countTokens",i.EMBED_CONTENT="embedContent",i.BATCH_EMBED_CONTENTS="batchEmbedContents",i})(Q||{}),Ze=class{constructor(e,t,n,o,s){this.model=e,this.task=t,this.apiKey=n,this.stream=o,this.requestOptions=s}toString(){var e,t;let n=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||ki,s=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||Fi}/${n}/${this.model}:${this.task}`;return this.stream&&(s+="?alt=sse"),s}};function Gi(i){let e=[];return i?.apiClient&&e.push(i.apiClient),e.push(`${Ti}/${Ri}`),e.join(" ")}function Bi(i){return b(this,null,function*(){var e;let t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",Gi(i.requestOptions)),t.append("x-goog-api-key",i.apiKey);let n=(e=i.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(n){if(!(n instanceof Headers))try{n=new Headers(n)}catch(o){throw new B(`unable to convert customHeaders value ${JSON.stringify(n)} to Headers: ${o.message}`)}for(let[o,s]of n.entries()){if(o==="x-goog-api-key")throw new B(`Cannot set reserved header name ${o}`);if(o==="x-goog-api-client")throw new B(`Header name ${o} can only be set using the apiClient field`);t.append(o,s)}}return t})}function Ki(i,e,t,n,o,s){return b(this,null,function*(){let r=new Ze(i,e,t,n,s);return{url:r.toString(),fetchOptions:Object.assign(Object.assign({},$i(s)),{method:"POST",headers:yield Bi(r),body:o})}})}function de(a,d,f,p,g){return b(this,arguments,function*(i,e,t,n,o,s={},r=fetch){let{url:_,fetchOptions:v}=yield Ki(i,e,t,n,o,s);return Li(_,v,r)})}function Li(n,o){return b(this,arguments,function*(i,e,t=fetch){let s;try{s=yield t(i,e)}catch(r){Hi(r,i)}return s.ok||(yield ji(s,i)),s})}function Hi(i,e){let t=i;throw t.name==="AbortError"?(t=new we(`Request aborted when fetching ${e.toString()}: ${i.message}`),t.stack=i.stack):i instanceof Me||i instanceof B||(t=new w(`Error fetching from ${e.toString()}: ${i.message}`),t.stack=i.stack),t}function ji(i,e){return b(this,null,function*(){let t="",n;try{let o=yield i.json();t=o.error.message,o.error.details&&(t+=` ${JSON.stringify(o.error.details)}`,n=o.error.details)}catch{}throw new Me(`Error fetching from ${e.toString()}: [${i.status} ${i.statusText}] ${t}`,i.status,i.statusText,n)})}function $i(i){let e={};if(i?.signal!==void 0||i?.timeout>=0){let t=new AbortController;i?.timeout>=0&&setTimeout(()=>t.abort(),i.timeout),i?.signal&&i.signal.addEventListener("abort",()=>{t.abort()}),e.signal=t.signal}return e}function et(i){return i.text=()=>{if(i.candidates&&i.candidates.length>0){if(i.candidates.length>1&&console.warn(`This response had ${i.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),Se(i.candidates[0]))throw new j(`${$(i)}`,i);return Ui(i)}else if(i.promptFeedback)throw new j(`Text not available. ${$(i)}`,i);return""},i.functionCall=()=>{if(i.candidates&&i.candidates.length>0){if(i.candidates.length>1&&console.warn(`This response had ${i.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Se(i.candidates[0]))throw new j(`${$(i)}`,i);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Bt(i)[0]}else if(i.promptFeedback)throw new j(`Function call not available. ${$(i)}`,i)},i.functionCalls=()=>{if(i.candidates&&i.candidates.length>0){if(i.candidates.length>1&&console.warn(`This response had ${i.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Se(i.candidates[0]))throw new j(`${$(i)}`,i);return Bt(i)}else if(i.promptFeedback)throw new j(`Function call not available. ${$(i)}`,i)},i}function Ui(i){var e,t,n,o;let s=[];if(!((t=(e=i.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(let r of(o=(n=i.candidates)===null||n===void 0?void 0:n[0].content)===null||o===void 0?void 0:o.parts)r.text&&s.push(r.text),r.executableCode&&s.push("\n```"+r.executableCode.language+`
`+r.executableCode.code+"\n```\n"),r.codeExecutionResult&&s.push("\n```\n"+r.codeExecutionResult.output+"\n```\n");return s.length>0?s.join(""):""}function Bt(i){var e,t,n,o;let s=[];if(!((t=(e=i.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(let r of(o=(n=i.candidates)===null||n===void 0?void 0:n[0].content)===null||o===void 0?void 0:o.parts)r.functionCall&&s.push(r.functionCall);if(s.length>0)return s}var qi=[Ie.RECITATION,Ie.SAFETY,Ie.LANGUAGE];function Se(i){return!!i.finishReason&&qi.includes(i.finishReason)}function $(i){var e,t,n;let o="";if((!i.candidates||i.candidates.length===0)&&i.promptFeedback)o+="Response was blocked",!((e=i.promptFeedback)===null||e===void 0)&&e.blockReason&&(o+=` due to ${i.promptFeedback.blockReason}`),!((t=i.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(o+=`: ${i.promptFeedback.blockReasonMessage}`);else if(!((n=i.candidates)===null||n===void 0)&&n[0]){let s=i.candidates[0];Se(s)&&(o+=`Candidate was blocked due to ${s.finishReason}`,s.finishMessage&&(o+=`: ${s.finishMessage}`))}return o}function le(i){return this instanceof le?(this.v=i,this):new le(i)}function Wi(i,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(i,e||[]),o,s=[];return o={},r("next"),r("throw"),r("return"),o[Symbol.asyncIterator]=function(){return this},o;function r(_){n[_]&&(o[_]=function(v){return new Promise(function(M,F){s.push([_,v,M,F])>1||a(_,v)})})}function a(_,v){try{d(n[_](v))}catch(M){g(s[0][3],M)}}function d(_){_.value instanceof le?Promise.resolve(_.value.v).then(f,p):g(s[0][2],_)}function f(_){a("next",_)}function p(_){a("throw",_)}function g(_,v){_(v),s.shift(),s.length&&a(s[0][0],s[0][1])}}var Kt=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function Yi(i){let e=i.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=Xi(e),[n,o]=t.tee();return{stream:Ji(n),response:zi(o)}}function zi(i){return b(this,null,function*(){let e=[],t=i.getReader();for(;;){let{done:n,value:o}=yield t.read();if(n)return et(Zi(e));e.push(o)}})}function Ji(i){return Wi(this,arguments,function*(){let t=i.getReader();for(;;){let{value:n,done:o}=yield le(t.read());if(o)break;yield yield le(et(n))}})}function Xi(i){let e=i.getReader();return new ReadableStream({start(n){let o="";return s();function s(){return e.read().then(({value:r,done:a})=>{if(a){if(o.trim()){n.error(new w("Failed to parse stream"));return}n.close();return}o+=r;let d=o.match(Kt),f;for(;d;){try{f=JSON.parse(d[1])}catch{n.error(new w(`Error parsing JSON response: "${d[1]}"`));return}n.enqueue(f),o=o.substring(d[0].length),d=o.match(Kt)}return s()}).catch(r=>{let a=r;throw a.stack=r.stack,a.name==="AbortError"?a=new we("Request aborted when reading from the stream"):a=new w("Error reading from the stream"),a})}}})}function Zi(i){let e=i[i.length-1],t={promptFeedback:e?.promptFeedback};for(let n of i){if(n.candidates){let o=0;for(let s of n.candidates)if(t.candidates||(t.candidates=[]),t.candidates[o]||(t.candidates[o]={index:o}),t.candidates[o].citationMetadata=s.citationMetadata,t.candidates[o].groundingMetadata=s.groundingMetadata,t.candidates[o].finishReason=s.finishReason,t.candidates[o].finishMessage=s.finishMessage,t.candidates[o].safetyRatings=s.safetyRatings,s.content&&s.content.parts){t.candidates[o].content||(t.candidates[o].content={role:s.content.role||"user",parts:[]});let r={};for(let a of s.content.parts)a.text&&(r.text=a.text),a.functionCall&&(r.functionCall=a.functionCall),a.executableCode&&(r.executableCode=a.executableCode),a.codeExecutionResult&&(r.codeExecutionResult=a.codeExecutionResult),Object.keys(r).length===0&&(r.text=""),t.candidates[o].content.parts.push(r)}o++}n.usageMetadata&&(t.usageMetadata=n.usageMetadata)}return t}function Ut(i,e,t,n){return b(this,null,function*(){let o=yield de(e,Q.STREAM_GENERATE_CONTENT,i,!0,JSON.stringify(t),n);return Yi(o)})}function qt(i,e,t,n){return b(this,null,function*(){let s=yield(yield de(e,Q.GENERATE_CONTENT,i,!1,JSON.stringify(t),n)).json();return{response:et(s)}})}function Wt(i){if(i!=null){if(typeof i=="string")return{role:"system",parts:[{text:i}]};if(i.text)return{role:"system",parts:[i]};if(i.parts)return i.role?i:{role:"system",parts:i.parts}}}function ce(i){let e=[];if(typeof i=="string")e=[{text:i}];else for(let t of i)typeof t=="string"?e.push({text:t}):e.push(t);return Qi(e)}function Qi(i){let e={role:"user",parts:[]},t={role:"function",parts:[]},n=!1,o=!1;for(let s of i)"functionResponse"in s?(t.parts.push(s),o=!0):(e.parts.push(s),n=!0);if(n&&o)throw new w("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!n&&!o)throw new w("No content is provided for sending chat message.");return n?e:t}function en(i,e){var t;let n={model:e?.model,generationConfig:e?.generationConfig,safetySettings:e?.safetySettings,tools:e?.tools,toolConfig:e?.toolConfig,systemInstruction:e?.systemInstruction,cachedContent:(t=e?.cachedContent)===null||t===void 0?void 0:t.name,contents:[]},o=i.generateContentRequest!=null;if(i.contents){if(o)throw new B("CountTokensRequest must have one of contents or generateContentRequest, not both.");n.contents=i.contents}else if(o)n=Object.assign(Object.assign({},n),i.generateContentRequest);else{let s=ce(i);n.contents=[s]}return{generateContentRequest:n}}function Lt(i){let e;return i.contents?e=i:e={contents:[ce(i)]},i.systemInstruction&&(e.systemInstruction=Wt(i.systemInstruction)),e}function tn(i){return typeof i=="string"||Array.isArray(i)?{content:ce(i)}:i}var Ht=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],nn={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function on(i){let e=!1;for(let t of i){let{role:n,parts:o}=t;if(!e&&n!=="user")throw new w(`First content should be with role 'user', got ${n}`);if(!Gt.includes(n))throw new w(`Each item should include role field. Got ${n} but valid roles are: ${JSON.stringify(Gt)}`);if(!Array.isArray(o))throw new w("Content should have 'parts' property with an array of Parts");if(o.length===0)throw new w("Each Content should have at least one part");let s={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let a of o)for(let d of Ht)d in a&&(s[d]+=1);let r=nn[n];for(let a of Ht)if(!r.includes(a)&&s[a]>0)throw new w(`Content with role '${n}' can't contain '${a}' part`);e=!0}}function jt(i){var e;if(i.candidates===void 0||i.candidates.length===0)return!1;let t=(e=i.candidates[0])===null||e===void 0?void 0:e.content;if(t===void 0||t.parts===void 0||t.parts.length===0)return!1;for(let n of t.parts)if(n===void 0||Object.keys(n).length===0||n.text!==void 0&&n.text==="")return!1;return!0}var $t="SILENT_ERROR",Qe=class{constructor(e,t,n,o={}){this.model=t,this.params=n,this._requestOptions=o,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,n?.history&&(on(n.history),this._history=n.history)}getHistory(){return b(this,null,function*(){return yield this._sendPromise,this._history})}sendMessage(n){return b(this,arguments,function*(e,t={}){var o,s,r,a,d,f;yield this._sendPromise;let p=ce(e),g={safetySettings:(o=this.params)===null||o===void 0?void 0:o.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(r=this.params)===null||r===void 0?void 0:r.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(d=this.params)===null||d===void 0?void 0:d.systemInstruction,cachedContent:(f=this.params)===null||f===void 0?void 0:f.cachedContent,contents:[...this._history,p]},_=Object.assign(Object.assign({},this._requestOptions),t),v;return this._sendPromise=this._sendPromise.then(()=>qt(this._apiKey,this.model,g,_)).then(M=>{var F;if(jt(M.response)){this._history.push(p);let ue=Object.assign({parts:[],role:"model"},(F=M.response.candidates)===null||F===void 0?void 0:F[0].content);this._history.push(ue)}else{let ue=$(M.response);ue&&console.warn(`sendMessage() was unsuccessful. ${ue}. Inspect response object for details.`)}v=M}).catch(M=>{throw this._sendPromise=Promise.resolve(),M}),yield this._sendPromise,v})}sendMessageStream(n){return b(this,arguments,function*(e,t={}){var o,s,r,a,d,f;yield this._sendPromise;let p=ce(e),g={safetySettings:(o=this.params)===null||o===void 0?void 0:o.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(r=this.params)===null||r===void 0?void 0:r.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(d=this.params)===null||d===void 0?void 0:d.systemInstruction,cachedContent:(f=this.params)===null||f===void 0?void 0:f.cachedContent,contents:[...this._history,p]},_=Object.assign(Object.assign({},this._requestOptions),t),v=Ut(this._apiKey,this.model,g,_);return this._sendPromise=this._sendPromise.then(()=>v).catch(M=>{throw new Error($t)}).then(M=>M.response).then(M=>{if(jt(M)){this._history.push(p);let F=Object.assign({},M.candidates[0].content);F.role||(F.role="model"),this._history.push(F)}else{let F=$(M);F&&console.warn(`sendMessageStream() was unsuccessful. ${F}. Inspect response object for details.`)}}).catch(M=>{M.message!==$t&&console.error(M)}),v})}};function sn(i,e,t,n){return b(this,null,function*(){return(yield de(e,Q.COUNT_TOKENS,i,!1,JSON.stringify(t),n)).json()})}function rn(i,e,t,n){return b(this,null,function*(){return(yield de(e,Q.EMBED_CONTENT,i,!1,JSON.stringify(t),n)).json()})}function an(i,e,t,n){return b(this,null,function*(){let o=t.requests.map(r=>Object.assign(Object.assign({},r),{model:e}));return(yield de(e,Q.BATCH_EMBED_CONTENTS,i,!1,JSON.stringify({requests:o}),n)).json()})}var Ve=class{constructor(e,t,n={}){this.apiKey=e,this._requestOptions=n,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=Wt(t.systemInstruction),this.cachedContent=t.cachedContent}generateContent(n){return b(this,arguments,function*(e,t={}){var o;let s=Lt(e),r=Object.assign(Object.assign({},this._requestOptions),t);return qt(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(o=this.cachedContent)===null||o===void 0?void 0:o.name},s),r)})}generateContentStream(n){return b(this,arguments,function*(e,t={}){var o;let s=Lt(e),r=Object.assign(Object.assign({},this._requestOptions),t);return Ut(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(o=this.cachedContent)===null||o===void 0?void 0:o.name},s),r)})}startChat(e){var t;return new Qe(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},e),this._requestOptions)}countTokens(n){return b(this,arguments,function*(e,t={}){let o=en(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),t);return sn(this.apiKey,this.model,o,s)})}embedContent(n){return b(this,arguments,function*(e,t={}){let o=tn(e),s=Object.assign(Object.assign({},this._requestOptions),t);return rn(this.apiKey,this.model,o,s)})}batchEmbedContents(n){return b(this,arguments,function*(e,t={}){let o=Object.assign(Object.assign({},this._requestOptions),t);return an(this.apiKey,this.model,e,o)})}};var Pe=class{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new w("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Ve(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,n){if(!e.name)throw new B("Cached content must contain a `name` field.");if(!e.model)throw new B("Cached content must contain a `model` field.");let o=["model","systemInstruction"];for(let r of o)if(t?.[r]&&e[r]&&t?.[r]!==e[r]){if(r==="model"){let a=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,d=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(a===d)continue}throw new B(`Different value for "${r}" specified in modelParams (${t[r]}) and cachedContent (${e[r]})`)}let s=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new Ve(this.apiKey,s,n)}};var Oe=class i{chessGameService=L(H);maxDepth=4;searchTime=3e3;startTime=0;nodes=0;useGeminiAI=!0;makeAIMove(e){return b(this,null,function*(){console.log("\u{1F9E0} AI\u958B\u59CB\u601D\u8003..."),this.startTime=Date.now(),this.nodes=0;try{if(this.useGeminiAI){console.log("\u{1F916} \u4F7F\u7528 Gemini AI \u9032\u884C\u6C7A\u7B56...");let s=yield this.getGeminiMove(e);if(s){let r=Date.now()-this.startTime;return console.log(`\u{1F3AF} Gemini AI \u6C7A\u7B56\u5B8C\u6210: ${r}ms`),console.log(`\u{1F916} Gemini \u9078\u64C7\u79FB\u52D5: (${s.from.x},${s.from.y}) -> (${s.to.x},${s.to.y})`),s}console.log("\u26A0\uFE0F Gemini AI \u672A\u80FD\u63D0\u4F9B\u6709\u6548\u79FB\u52D5\uFF0C\u4F7F\u7528\u50B3\u7D71\u7B97\u6CD5...")}console.log(`\u{1F9E0} \u4F7F\u7528 Minimax \u7B97\u6CD5 (\u6DF1\u5EA6${this.maxDepth}\u5C64)...`);let t=this.minimax(e,this.maxDepth,-1/0,1/0,!0),n=Date.now()-this.startTime;if(console.log(`\u{1F3AF} AI\u6C7A\u7B56\u5B8C\u6210: ${n}ms, \u641C\u7D22${this.nodes}\u500B\u7BC0\u9EDE`),t&&t.move)return console.log(`\u{1F916} \u9078\u64C7\u79FB\u52D5: (${t.move.from.x},${t.move.from.y}) -> (${t.move.to.x},${t.move.to.y}), \u8A55\u5206: ${t.score}`),t.move;let o=this.getAllPossibleMoves(e,"black");return o.length>0?o[Math.floor(Math.random()*o.length)]:null}catch(t){console.error("\u{1F916} AI\u601D\u8003\u51FA\u932F:",t);let n=this.getAllPossibleMoves(e,"black");return n.length>0?n[0]:null}})}getGeminiMove(e){return b(this,null,function*(){try{let n=typeof localStorage<"u"?localStorage.getItem("gemini-api-key"):null;if(!n||n==="YOUR_GEMINI_API_KEY_HERE")return console.log("\u274C Gemini API Key \u672A\u8A2D\u7F6E\uFF0C\u8ACB\u5728\u8A2D\u5B9A\u4E2D\u8F38\u5165 API Key"),null;console.log("\u{1F511} \u4F7F\u7528 API Key:",n?`${n.substring(0,8)}...${n.substring(n.length-4)}`:"\u7121");let s=new Pe(n).getGenerativeModel({model:"gemini-2.5-pro"});console.log("\u{1F4E1} \u6E96\u5099\u547C\u53EB Gemini API...");let r=this.createGeminiPrompt(e);console.log("\u{1F680} \u6B63\u5728\u547C\u53EB Gemini API...");let a=yield s.generateContent(r);console.log("\u2705 Gemini API \u547C\u53EB\u6210\u529F\uFF01");let f=(yield a.response).text();if(console.log("\u{1F4DD} Gemini \u56DE\u61C9\u9577\u5EA6:",f?.length||0),!f)return console.log("\u274C Gemini \u6C92\u6709\u8FD4\u56DE\u6709\u6548\u56DE\u61C9"),null;let p=f.match(/\{[\s\S]*\}/);if(p){let g=JSON.parse(p[0]);console.log("\u{1F916} Gemini \u5206\u6790:",g.analysis),console.log("\u{1F916} \u9078\u64C7\u7406\u7531:",g.reasoning);let _=this.getAllPossibleMoves(e,"black"),v=g.move;if(this.isValidMove(v,_))return v;console.log("\u274C Gemini \u63D0\u4F9B\u7684\u79FB\u52D5\u7121\u6548")}}catch(t){console.error("\u274C Gemini API \u8ABF\u7528\u5931\u6557:",t)}return null})}createGeminiPrompt(e){let t=this.describeBoardState(e),n=this.getAllPossibleMoves(e,"black"),o=this.describeValidMoves(n);return`
You are a professional Chinese Chess AI. Please analyze the current board state and choose the best move.

Board state (RED at bottom, BLACK at top, coordinates start from 0,0):
${t}

Available moves:
${o}

Please analyze the position and choose the best move. Response must be in JSON format:
{
  "analysis": "Your analysis process",
  "move": {
    "from": {"x": start_x_coordinate, "y": start_y_coordinate},
    "to": {"x": target_x_coordinate, "y": target_y_coordinate}
  },
  "reasoning": "Reason for choosing this move"
}

Important notes:
1. You are BLACK player, choose moves that benefit BLACK
2. Coordinate system: x is column (0-8), y is row (0-9)
3. You can only choose from the provided available moves
4. Priority: capturing, checking, position improvement, defense
5. You have maximum 10 seconds thinking time
6. Please respond in Traditional Chinese
`}describeBoardState(e){let t="";for(let n=0;n<10;n++){let o=`Row ${n}: `;for(let s=0;s<9;s++){let r=e.board[n][s];if(r){let a=r.color==="red"?"RED":"BLACK";o+=`(${s},${n}):${a}_${r.type} `}}t+=o+`
`}return t}describeValidMoves(e){return e.map((t,n)=>`${n+1}. Move from (${t.from.x},${t.from.y}) to (${t.to.x},${t.to.y})`).join(`
`)}isValidMove(e,t){return t.some(n=>n.from.x===e.from.x&&n.from.y===e.from.y&&n.to.x===e.to.x&&n.to.y===e.to.y)}setUseGeminiAI(e){this.useGeminiAI=e}minimax(e,t,n,o,s){if(this.nodes++,Date.now()-this.startTime>this.searchTime)return null;if(t===0)return{move:{from:{x:0,y:0},to:{x:0,y:0}},score:this.evaluatePosition(e)};let r=s?"black":"red",a=this.getAllPossibleMoves(e,r);if(a.length===0)return this.chessGameService.isInCheck(e.board,r)?{move:{from:{x:0,y:0},to:{x:0,y:0}},score:s?-1e4:1e4}:{move:{from:{x:0,y:0},to:{x:0,y:0}},score:0};let d=this.orderMoves(e,a),f=null;if(s){let p=-1/0;for(let g of d){let _=this.simulateMove(e,g.from,g.to);if(this.chessGameService.isInCheck(_.board,"black"))continue;let v=this.minimax(_,t-1,n,o,!1);if(v&&v.score>p&&(p=v.score,f=g),n=Math.max(n,p),o<=n)break}return f?{move:f,score:p}:null}else{let p=1/0;for(let g of d){let _=this.simulateMove(e,g.from,g.to);if(this.chessGameService.isInCheck(_.board,"red"))continue;let v=this.minimax(_,t-1,n,o,!0);if(v&&v.score<p&&(p=v.score,f=g),o=Math.min(o,p),o<=n)break}return f?{move:f,score:p}:null}}orderMoves(e,t){return t.sort((n,o)=>{let s=0,r=0,a=e.board[n.to.y][n.to.x],d=e.board[o.to.y][o.to.x];a&&(s+=De[a.type]),d&&(r+=De[d.type]);let f=this.simulateMove(e,n.from,n.to),p=this.simulateMove(e,o.from,o.to);return this.chessGameService.isInCheck(f.board,"red")&&(s+=100),this.chessGameService.isInCheck(p.board,"red")&&(r+=100),r-s})}evaluatePosition(e){let t=0;for(let s=0;s<10;s++)for(let r=0;r<9;r++){let a=e.board[s][r];if(!a)continue;let d=De[a.type];d+=Tt(a.type,r,s,a.color),a.color==="black"?t+=d:t-=d}let n=this.getAllPossibleMoves(e,"black").length,o=this.getAllPossibleMoves(e,"red").length;return t+=(n-o)*5,this.chessGameService.isInCheck(e.board,"black")&&(t-=100),this.chessGameService.isInCheck(e.board,"red")&&(t+=100),t}simulateMove(e,t,n){let o=e.board.map((s,r)=>r===t.y||r===n.y?s.map((a,d)=>{if(d===t.x&&r===t.y||d===n.x&&r===n.y){if(d===t.x&&r===t.y)return null;if(d===n.x&&r===n.y){let f=e.board[t.y][t.x];return f?D(x({},f),{position:{x:n.x,y:n.y},hasMoved:!0,isSelected:!1}):null}}return a}):s);return D(x({},e),{board:o})}getAllPossibleMoves(e,t){let n=[],o=e.board;for(let s=0;s<10;s++)for(let r=0;r<9;r++){let a=o[s][r];if(a&&a.color===t){let d=this.chessGameService.getPossibleMoves(a,o);for(let f of d)n.push({from:a.position,to:f})}}return n}setDifficulty(e){switch(e){case"easy":this.maxDepth=2,this.searchTime=1e3;break;case"medium":this.maxDepth=4,this.searchTime=3e3;break;case"hard":this.maxDepth=6,this.searchTime=5e3;break}}getThinkingDescription(){return"\u{1F9E0} AI\u6B63\u5728\u4F7F\u7528Minimax\u7B97\u6CD5\u6DF1\u5EA6\u5206\u6790..."}static \u0275fac=function(t){return new(t||i)};static \u0275prov=ee({token:i,factory:i.\u0275fac,providedIn:"root"})};function cn(i,e){if(i&1){let t=R();c(0,"div",2)(1,"label",4),h(2," Gemini API Key "),l(),c(3,"div",5)(4,"input",6),ft("ngModelChange",function(o){I(t);let s=m();return ht(s.apiKeyInput,o)||(s.apiKeyInput=o),S(o)}),A("keyup.enter",function(){I(t);let o=m();return S(o.saveApiKey())}),l(),c(5,"button",7),A("click",function(){I(t);let o=m();return S(o.saveApiKey())}),h(6," \u5132\u5B58 "),l()(),c(7,"p",8),h(8," \u8ACB\u5F9E "),c(9,"a",9),h(10,"Google AI Studio"),l(),h(11," \u53D6\u5F97 API Key "),l()()}if(i&2){let t=m();u(4),ut("ngModel",t.apiKeyInput),u(),O("disabled",!t.apiKeyInput.trim())}}function dn(i,e){if(i&1){let t=R();c(0,"div",3)(1,"div")(2,"p",10),h(3),l(),c(4,"p",11),h(5,"Gemini AI \u8C61\u68CB\u529F\u80FD\u5DF2\u555F\u7528"),l()(),c(6,"button",12),A("click",function(){I(t);let o=m();return S(o.clearApiKey())}),h(7," \u6E05\u9664 "),l()()}if(i&2){let t=m();u(3),P("\u2705 API Key \u5DF2\u8A2D\u5B9A (",t.maskedApiKey(),")")}}var Ne=class i{chessGameService=L(H);apiKeyInput="";hasApiKey=E(()=>this.chessGameService.hasApiKey());onApiKeySaved=He();onApiKeyClear=He();constructor(){this.chessGameService.updateApiKeyStatus()}saveApiKey(){this.apiKeyInput.trim()&&typeof localStorage<"u"&&(localStorage.setItem("gemini-api-key",this.apiKeyInput.trim()),this.apiKeyInput="",console.log("API Key saved, emitting onApiKeySaved event"),this.onApiKeySaved.emit(),typeof window<"u"&&window.dispatchEvent(new CustomEvent("gemini_api_key_updated")),this.chessGameService.updateApiKeyStatus())}clearApiKey(){typeof localStorage<"u"&&(localStorage.removeItem("gemini-api-key"),this.onApiKeyClear.emit(),typeof window<"u"&&window.dispatchEvent(new CustomEvent("gemini_api_key_updated")),this.chessGameService.updateApiKeyStatus())}maskedApiKey(){if(typeof localStorage<"u"){let e=localStorage.getItem("gemini-api-key");if(e)return`${e.substring(0,8)}...${e.substring(e.length-4)}`}return""}static getApiKey(){return typeof localStorage<"u"?localStorage.getItem("gemini-api-key"):null}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=he({type:i,selectors:[["app-gemini-api-key"]],outputs:{onApiKeySaved:"onApiKeySaved",onApiKeyClear:"onApiKeyClear"},decls:5,vars:1,consts:[[1,"bg-gray-900","border","border-gray-700","rounded-lg","p-4","mb-4"],[1,"text-lime-400","font-bold","mb-3","flex","items-center","gap-2"],[1,"mb-3"],[1,"flex","items-center","justify-between"],[1,"block","text-gray-300","text-sm","font-medium","mb-2"],[1,"flex","gap-2"],["type","password","placeholder","\u8ACB\u8F38\u5165\u60A8\u7684 Gemini API Key...",1,"flex-1","bg-gray-800","border","border-gray-600","rounded","px-3","py-2","text-white","focus:outline-none","focus:border-lime-400",3,"ngModelChange","keyup.enter","ngModel"],[1,"bg-lime-600","hover:bg-lime-700","disabled:bg-gray-600","disabled:cursor-not-allowed","text-white","px-4","py-2","rounded","transition-colors",3,"click","disabled"],[1,"text-gray-400","text-xs","mt-2"],["href","https://makersuite.google.com/app/apikey","target","_blank",1,"text-lime-400","hover:underline"],[1,"text-green-400","text-sm"],[1,"text-gray-400","text-xs"],[1,"bg-red-600","hover:bg-red-700","text-white","px-3","py-1","rounded","text-sm","transition-colors",3,"click"]],template:function(t,n){t&1&&(c(0,"div",0)(1,"h3",1),h(2,"\u{1F916} Gemini AI \u8A2D\u5B9A"),l(),y(3,cn,12,2,"div",2)(4,dn,8,1,"div",3),l()),t&2&&(u(3),C(n.hasApiKey()?4:3))},dependencies:[ge,Ee,xe,Ft,ze],styles:["[_nghost-%COMP%]{display:block}@media (max-width: 640px){.flex[_ngcontent-%COMP%]{flex-direction:column}.flex-1[_ngcontent-%COMP%]{margin-bottom:.5rem}}"]})};var un=()=>[0,1,2,3,4,5,6,7,8,9],hn=()=>[0,1,2,3,4,5,6,7,8],Yt=i=>({"valid-move-point":i});function fn(i,e){i&1&&(c(0,"div",8),h(1," \u5C07\u8ECD\uFF01 "),l())}function pn(i,e){i&1&&(c(0,"div",9),h(1,"\u88AB\u5C07\u8ECD\uFF01"),l())}function mn(i,e){if(i&1){let t=R();c(0,"div",54)(1,"button",55),A("click",function(){I(t);let o=m(2);return S(o.setAIDifficulty("easy"))}),h(2," \u7C21\u55AE "),l(),c(3,"button",55),A("click",function(){I(t);let o=m(2);return S(o.setAIDifficulty("medium"))}),h(4," \u4E2D\u7B49 "),l(),c(5,"button",55),A("click",function(){I(t);let o=m(2);return S(o.setAIDifficulty("hard"))}),h(6," \u56F0\u96E3 "),l()()}if(i&2){let t=m(2);u(),O("ngClass",t.aiDifficulty()==="easy"?"bg-green-600 text-white":"bg-neutral-700 text-neutral-300 hover:bg-neutral-600"),u(2),O("ngClass",t.aiDifficulty()==="medium"?"bg-yellow-600 text-white":"bg-neutral-700 text-neutral-300 hover:bg-neutral-600"),u(2),O("ngClass",t.aiDifficulty()==="hard"?"bg-red-600 text-white":"bg-neutral-700 text-neutral-300 hover:bg-neutral-600")}}function gn(i,e){if(i&1){let t=R();c(0,"div",56)(1,"span",22),h(2,"API Key \u5DF2\u8A2D\u7F6E"),l(),c(3,"button",58),A("click",function(){I(t);let o=m(3);return S(o.clearApiKey())}),h(4," \u6E05\u9664 "),l()()}}function _n(i,e){if(i&1){let t=R();c(0,"button",59),A("click",function(){I(t);let o=m(3);return S(o.openApiKeyModal())}),h(1," Gemini API Key "),l()}}function vn(i,e){if(i&1&&(c(0,"div",54),y(1,gn,5,0,"div",56)(2,_n,2,0,"button",57),l()),i&2){let t=m(2);u(),C(t.hasApiKey()?1:2)}}function yn(i,e){if(i&1){let t=R();c(0,"div",11)(1,"div",51)(2,"span",52),h(3,"\u{1F916}AI\u985E\u578B:"),l(),c(4,"button",53),A("click",function(){I(t);let o=m();return S(o.setAIType("local"))}),h(5," \u672C\u5730\u7AEF "),l(),c(6,"button",53),A("click",function(){I(t);let o=m();return S(o.setAIType("service"))}),h(7," Gemini AI "),l()(),y(8,mn,7,3,"div",54),y(9,vn,3,1,"div",54),l()}if(i&2){let t=m();u(4),O("ngClass",t.aiType()==="local"?"bg-blue-600 text-white":"bg-neutral-700 text-neutral-300 hover:bg-neutral-600"),u(2),O("ngClass",t.aiType()==="service"?"bg-purple-600 text-white":"bg-neutral-700 text-neutral-300 hover:bg-neutral-600"),u(2),C(t.aiType()==="local"?8:-1),u(),C(t.aiType()==="service"?9:-1)}}function Cn(i,e){i&1&&(c(0,"span"),h(1,"\u{1F916}"),l())}function bn(i,e){if(i&1&&h(0),i&2){let t=m();P(" ",t.moveHistory()[t.moveHistory().length-1]," ")}}function xn(i,e){i&1&&h(0," \uFF1F\uFF1F ")}function An(i,e){i&1&&h(0," Gemini \u5DF2\u555F\u7528 ")}function En(i,e){if(i&1&&h(0),i&2){let t=m();P(" \u672C\u5730\u7AEF (",t.getAIDifficultyText(),")")}}function Dn(i,e){i&1&&h(0," AI \u601D\u8003\u4E2D... ")}function In(i,e){if(i&1&&(c(0,"div",29),h(1),l()),i&2){let t=e.$implicit;u(),P(" ",t," ")}}function Sn(i,e){if(i&1&&(c(0,"div",32),h(1),l()),i&2){let t=e.$implicit;u(),P(" ",t," ")}}function Mn(i,e){if(i&1&&V(0,"div",60)(1,"div",61),i&2){let t=e.$implicit;ie(t===6?"z-20 h-[1.5px]":"z-10"),K("top",t*40+4,"px"),O("ngClass","sm:hidden"),u(),ie(t===6?"z-20 h-[1.5px]":"z-10"),K("top",t*50+4,"px")}}function wn(i,e){if(i&1&&V(0,"div",62)(1,"div",62)(2,"div",63)(3,"div",63),i&2){let t=e.$implicit;K("left",t*36+14,"px")("top",4,"px")("height",157,"px"),u(),K("left",t*36+14,"px")("top",203,"px")("height",162,"px"),u(),K("left",t*50+4,"px")("top",4,"px")("height",200,"px"),u(),K("left",t*50+4,"px")("top",254,"px")("height",200,"px")}}function Vn(i,e){i&1&&V(0,"div",65)}function Pn(i,e){i&1&&V(0,"div",65)}function On(i,e){if(i&1&&(c(0,"div",66)(1,"div",73),h(2),l()()),i&2){let t=m().$implicit,n=m(2);O("ngClass",n.getPieceClass(t)),u(),ie(t.color===n.PlayerColor.RED?"bg-red-100 border-red-600 text-red-800":"bg-neutral-100 border-neutral-800 text-neutral-800"),u(),P(" ",n.getPieceSymbol(t)," ")}}function Nn(i,e){i&1&&V(0,"div",67)}function Fn(i,e){i&1&&V(0,"div",68)}function kn(i,e){i&1&&V(0,"div",65)}function Rn(i,e){i&1&&V(0,"div",65)}function Tn(i,e){if(i&1&&(c(0,"div",70)(1,"div",74),h(2),l()()),i&2){let t=m().$implicit,n=m(2);O("ngClass",n.getPieceClass(t)),u(),ie(t.color===n.PlayerColor.RED?"bg-red-100 border-red-600 text-red-800":"bg-neutral-100 border-neutral-800 text-neutral-800"),u(),P(" ",n.getPieceSymbol(t)," ")}}function Gn(i,e){i&1&&V(0,"div",71)}function Bn(i,e){i&1&&V(0,"div",72)}function Kn(i,e){if(i&1){let t=R();c(0,"div",64),A("click",function(){let o=I(t).$index,s=m().$index,r=m();return S(r.onSquareClick(o,s))}),y(1,Vn,1,0,"div",65),y(2,Pn,1,0,"div",65),y(3,On,3,4,"div",66),y(4,Nn,1,0,"div",67),y(5,Fn,1,0,"div",68),l(),c(6,"div",69),A("click",function(){let o=I(t).$index,s=m().$index,r=m();return S(r.onSquareClick(o,s))}),y(7,kn,1,0,"div",65),y(8,Rn,1,0,"div",65),y(9,Tn,3,4,"div",70),y(10,Gn,1,0,"div",71),y(11,Bn,1,0,"div",72),l()}if(i&2){let t=e.$implicit,n=e.$index,o=m().$index,s=m();K("top",o*40+4,"px")("left",n*36+14,"px"),O("ngClass",Le(20,Yt,s.isValidMove(n,o))),u(),C((o===2||o===7)&&(n===0||n===2||n===4||n===6||n===8)?1:-1),u(),C((o===3||o===6)&&(n===1||n===7)?2:-1),u(),C(t?3:-1),u(),C(s.isValidMove(n,o)&&!t?4:-1),u(),C(s.isValidMove(n,o)&&t&&t.color!==s.currentPlayer()?5:-1),u(),K("top",o*50+4,"px")("left",n*50+4,"px"),O("ngClass",Le(22,Yt,s.isValidMove(n,o))),u(),C((o===2||o===7)&&(n===0||n===2||n===4||n===6||n===8)?7:-1),u(),C((o===3||o===6)&&(n===1||n===7)?8:-1),u(),C(t?9:-1),u(),C(s.isValidMove(n,o)&&!t?10:-1),u(),C(s.isValidMove(n,o)&&t&&t.color!==s.currentPlayer()?11:-1)}}function Ln(i,e){if(i&1&&T(0,Kn,12,24,null,null,pe),i&2){let t=e.$implicit;G(t)}}function Hn(i,e){if(i&1&&(c(0,"div",32),h(1),l()),i&2){let t=e.$implicit;u(),P(" ",t," ")}}function jn(i,e){if(i&1&&(c(0,"div",29),h(1),l()),i&2){let t=e.$implicit;u(),P(" ",t," ")}}function $n(i,e){if(i&1){let t=R();c(0,"div",46)(1,"div",75)(2,"div",76),h(3,"\u{1F3C6}"),l(),c(4,"h2",77),h(5),l(),c(6,"button",78),A("click",function(){I(t);let o=m();return S(o.resetGame())}),h(7," \u91CD\u65B0\u958B\u59CB "),l()()()}if(i&2){let t=m();u(5),P(" ",t.winner()===t.PlayerColor.RED?"\u7D05\u65B9\u7372\u52DD\uFF01":"\u9ED1\u65B9\u7372\u52DD\uFF01"," ")}}function Un(i,e){if(i&1&&(c(0,"span",84),h(1),l()),i&2){let t=m(2).$index,n=m(2);u(),me(n.moveHistory()[t+1])}}function qn(i,e){if(i&1&&(c(0,"div",11)(1,"span",82),h(2),l(),c(3,"span",83),h(4),l(),y(5,Un,2,1,"span",84),l()),i&2){let t=m(),n=t.$implicit,o=t.$index,s=m(2);u(2),P("",s.Math.floor(o/2)+1,"."),u(2),me(n),u(),C(s.moveHistory()[o+1]?5:-1)}}function Wn(i,e){if(i&1&&y(0,qn,6,3,"div",11),i&2){let t=e.$index;C(t%2===0?0:-1)}}function Yn(i,e){if(i&1&&(c(0,"section",47)(1,"h3",79),h(2,"\u68CB\u8B5C\u8A18\u9304"),l(),c(3,"div",80)(4,"div",81),T(5,Wn,1,1,null,null,pe),l()()()),i&2){let t=m();u(5),G(t.moveHistory())}}function zn(i,e){if(i&1){let t=R();c(0,"div",85),A("click",function(){I(t);let o=m();return S(o.closeApiKeyModal())}),c(1,"div",86),A("click",function(o){return I(t),S(o.stopPropagation())}),c(2,"button",87),A("click",function(){I(t);let o=m();return S(o.closeApiKeyModal())}),h(3,"\xD7"),l(),c(4,"app-gemini-api-key",88),A("onApiKeySaved",function(){I(t);let o=m();return S(o.onApiKeySaved())})("onApiKeyClear",function(){I(t);let o=m();return S(o.onApiKeyCleared())}),l()()()}}var zt=class i{chessGameService=L(H);chessAIService=L(Oe);apiKeyUpdateListener;gameState=k(Je);aiType=k("local");board=E(()=>this.gameState().board);currentPlayer=E(()=>this.gameState().currentPlayer);selectedPiece=E(()=>this.gameState().selectedPiece);validMoves=E(()=>this.gameState().validMoves);gameOver=E(()=>this.gameState().gameOver);winner=E(()=>this.gameState().winner);moveHistory=E(()=>this.gameState().moveHistory);isInCheck=E(()=>this.gameState().isInCheck);isSelfInCheck=E(()=>this.gameState().isSelfInCheck);currentPlayerDisplay=E(()=>this.currentPlayer()==="red"?"\u7D05\u65B9":"\u9ED1\u65B9");isVsAI=E(()=>this.gameState().isVsAI);aiIsThinking=E(()=>this.gameState().aiIsThinking);aiThinkingText=E(()=>this.gameState().aiThinkingText);aiDifficulty=k("hard");hasApiKey=E(()=>this.chessGameService.hasApiKey());isGeminiEnabled=E(()=>this.hasApiKey()&&this.isVsAI());isApiKeyModalOpen=k(!1);isAITurn=E(()=>this.isVsAI()&&this.currentPlayer()==="black"&&!this.gameOver());canInteract=E(()=>!this.isVsAI()||this.currentPlayer()==="red");PlayerColor=Z;Math=Math;ngOnInit(){this.resetGame(),this.chessGameService.updateApiKeyStatus(),this.hasApiKey()&&this.setAIType("service"),typeof window<"u"&&(this.apiKeyUpdateListener=()=>{this.chessGameService.updateApiKeyStatus(),this.hasApiKey()&&this.aiType()==="local"&&this.setAIType("service")},window.addEventListener("gemini_api_key_updated",this.apiKeyUpdateListener))}ngOnDestroy(){typeof window<"u"&&this.apiKeyUpdateListener&&window.removeEventListener("gemini_api_key_updated",this.apiKeyUpdateListener)}resetGame(){let e=this.chessGameService.initializeGameState();this.gameState.set(e)}onSquareClick(e,t){if(this.gameOver()||!this.canInteract())return;let n=this.gameState(),o=n.board[t][e];n.selectedPiece?o&&o.color===n.currentPlayer&&o!==n.selectedPiece?this.selectPiece(o):this.isValidMove(e,t)?this.makeMove(n.selectedPiece.position,{x:e,y:t}):this.deselectPiece():o&&o.color===n.currentPlayer&&this.selectPiece(o)}selectPiece(e){let t=this.gameState();t.board.flat().forEach(o=>{o&&(o.isSelected=!1)}),e.isSelected=!0;let n=this.chessGameService.getPossibleMoves(e,t.board);this.gameState.set(D(x({},t),{selectedPiece:e,validMoves:n}))}deselectPiece(){let e=this.gameState();e.selectedPiece&&(e.selectedPiece.isSelected=!1),this.gameState.set(D(x({},e),{selectedPiece:null,validMoves:[]}))}isValidMove(e,t){return this.validMoves().some(n=>n.x===e&&n.y===t)}makeMove(e,t){let n=this.gameState(),o=n.board[e.y][e.x];if(!o)return;let s=this.chessGameService.makeMove(n,e,t);if(s.success){let r=this.generateMoveNotation(o,e,t,s.captured),a=[...n.moveHistory,r],d=n.currentPlayer==="red"?"black":"red",f=s.isCheck||!1,p=s.isSelfInCheck||!1,g=s.isCheckmate||s.isStalemate||s.gameOver||!1,_=s.winner||(s.isCheckmate?n.currentPlayer:null);n.board.flat().forEach(v=>{v&&(v.isSelected=!1)}),this.gameState.set(D(x({},n),{currentPlayer:d,selectedPiece:null,validMoves:[],moveHistory:a,isInCheck:f,isSelfInCheck:p,gameOver:g,winner:_})),console.log("\u6AA2\u67E5AI\u89F8\u767C\u689D\u4EF6:",{gameOver:g,isVsAI:n.isVsAI,nextPlayer:d,shouldTrigger:!g&&n.isVsAI&&d==="black"}),!g&&n.isVsAI&&d==="black"&&(console.log("\u6E96\u5099\u89F8\u767CAI\u79FB\u52D5..."),this.triggerAIMove())}}generateMoveNotation(e,t,n,o){if(!e)return"";let s=p=>{let g=["\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D","\u4E03","\u516B","\u4E5D"];return p>=1&&p<=9?g[p-1]:p.toString()},r=this.chessGameService.getPieceSymbol(e),a=e.color==="red"?9-t.x:t.x+1,d=n.y-t.y,f="";if(d===0){let p=e.color==="red"?9-n.x:n.x+1;f="\u5E73"+s(p)}else f=(e.color==="red"&&d<0||e.color==="black"&&d>0?"\u9032":"\u9000")+s(Math.abs(d));return`${r}${s(a)}${f}`}getSquareClass(e,t){let n="chess-square";return this.board()[t]?.[e]?.isSelected&&(n+=" selected"),this.isValidMove(e,t)&&(n+=" valid-move"),(this.chessGameService.isInPalace(e,t,"red")||this.chessGameService.isInPalace(e,t,"black"))&&(n+=" palace"),n}getPieceClass(e){if(!e)return"";let t=`chess-piece ${e.color}`;return e.isSelected&&(t+=" selected"),t}getPieceSymbol(e){return e?this.chessGameService.getPieceSymbol(e):""}getRowNumbers(){return Array.from({length:10},(e,t)=>10-t)}getColumnLetters(){return["a","b","c","d","e","f","g","h","i"]}toggleGameMode(){let e=this.gameState(),t=!e.isVsAI;this.gameState.set(D(x({},e),{isVsAI:t,aiIsThinking:!1})),t&&e.currentPlayer==="black"&&!e.gameOver&&this.triggerAIMove()}triggerAIMove(){return b(this,null,function*(){let e=this.gameState();console.log("\u{1F916} \u89F8\u767CAI\u79FB\u52D5\uFF0C\u7576\u524D\u73A9\u5BB6:",e.currentPlayer),this.chessAIService.setDifficulty(this.aiDifficulty()),this.gameState.set(D(x({},e),{aiIsThinking:!0,aiThinkingText:this.chessAIService.getThinkingDescription()})),setTimeout(()=>b(this,null,function*(){try{let t=yield this.chessAIService.makeAIMove(e);t?(console.log("\u{1F916} AI\u9078\u64C7\u79FB\u52D5:",t),this.makeAIMove(t.from,t.to)):(console.warn("\u{1F916} AI\u7121\u6CD5\u627E\u5230\u6709\u6548\u79FB\u52D5\uFF0CAI\u6295\u964D"),this.aiSurrender())}catch(t){console.error("\u{1F916} AI\u79FB\u52D5\u51FA\u932F:",t),this.aiSurrender()}}),500)})}makeAIMove(e,t){let n=this.gameState(),o=n.board[e.y][e.x];if(!o)return;let s=this.chessGameService.makeMove(n,e,t);if(s.success){let r=this.generateMoveNotation(o,e,t,s.captured),a=[...n.moveHistory,r],d="red",f=s.isCheck||!1,p=s.isSelfInCheck||!1,g=s.isCheckmate||s.isStalemate||s.gameOver||!1,_=s.winner||(s.isCheckmate?"black":null);n.board.flat().forEach(v=>{v&&(v.isSelected=!1)}),this.gameState.set(D(x({},n),{currentPlayer:d,selectedPiece:null,validMoves:[],moveHistory:a,isInCheck:f,isSelfInCheck:p,gameOver:g,winner:_,aiIsThinking:!1}))}}aiSurrender(){let e=this.gameState();console.log("\u{1F916} AI\u6295\u964D\uFF0C\u904A\u6232\u7D50\u675F"),this.gameState.set(D(x({},e),{gameOver:!0,winner:"red",aiIsThinking:!1,moveHistory:[...e.moveHistory,"\u{1F916} AI\u6295\u964D"]}))}setAIDifficulty(e){this.aiDifficulty.set(e),console.log("\u{1F916} AI\u96E3\u5EA6\u8A2D\u7F6E\u70BA:",e)}getAIDifficultyText(){switch(this.aiDifficulty()){case"easy":return"\u7C21\u55AE";case"medium":return"\u4E2D\u7B49";case"hard":return"\u56F0\u96E3";default:return"\u4E2D\u7B49"}}openApiKeyModal(){this.isApiKeyModalOpen.set(!0)}closeApiKeyModal(){this.isApiKeyModalOpen.set(!1)}clearApiKey(){typeof localStorage<"u"&&localStorage.removeItem("gemini-api-key"),this.chessGameService.updateApiKeyStatus(),this.aiType()==="service"&&this.setAIType("local"),console.log("Gemini API Key \u5DF2\u6E05\u9664")}onApiKeySaved(){console.log("onApiKeySaved called"),this.chessGameService.updateApiKeyStatus(),console.log("hasApiKey after save:",this.hasApiKey()),setTimeout(()=>{this.closeApiKeyModal()},100)}onApiKeyCleared(){console.log("onApiKeyCleared called"),this.chessGameService.updateApiKeyStatus(),console.log("hasApiKey after clear:",this.hasApiKey()),this.aiType()==="service"&&this.setAIType("local"),setTimeout(()=>{this.closeApiKeyModal()},100)}setAIType(e){this.aiType.set(e),e==="service"&&!this.hasApiKey()&&this.openApiKeyModal(),this.chessAIService.setUseGeminiAI(e==="service"),console.log(`\u{1F916} \u5DF2\u5207\u63DB AI \u985E\u578B: ${e}`)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=he({type:i,selectors:[["app-chinese-chess"]],decls:98,vars:16,consts:[[1,"w-full","max-w-[95vw]","sm:max-w-sm","mx-auto","flex","flex-col","px-2","sm:px-0"],[1,"mb-2","flex","flex-col","gap-3","items-stretch"],[1,"flex","justify-between","items-center"],[1,"text-center","text-2xl","font-bold","tracking-wider","text-lime-400","drop-shadow"],["routerLink","/",1,"text-lime-600","text-sm"],[1,"flex","gap-2","justify-between"],[1,"h-12","w-1/3","rounded-md","bg-lime-700","border","border-lime-500","text-lime-50","font-semibold","text-base","shadow","hover:bg-lime-600","focus:outline-none","focus:ring-2","focus:ring-lime-300","drop-shadow-[0_0_5px_#22d3ee]",3,"click"],[1,"h-12","w-1/3","rounded-md","border","font-medium","shadow","bg-zinc-800"],[1,"text-3xl","text-center","text-amber-300","font-bold","leading-12","animate-pulse"],[1,"text-3xl","text-red-400","animate-pulse"],[1,"h-12","w-1/3","rounded-md","bg-cyan-700","border","border-cyan-500","text-cyan-50","font-semibold","text-base","shadow","hover:bg-cyan-600","focus:outline-none","focus:ring-2","focus:ring-cyan-300",3,"click"],[1,"flex","gap-2"],[1,"flex","flex-col","gap-2"],[1,"flex","items-center","gap-1","flex-wrap","bg-white/10","rounded-md","p-2","border","border-white/20"],[1,"border","border-lime-400","bg-lime-400/20","px-2","py-1","text-lime-300","font-bold","hover:bg-lime-400/30","transition"],[1,"text-lime-400","text-xs"],[1,"text-center","text-xs"],[1,"border","px-2","py-1","font-bold",3,"ngClass"],[1,"text-xs"],[1,"border","border-amber-400","bg-amber-400/20","px-2","py-1","text-amber-300","font-bold"],[1,"text-amber-400","text-xs"],[1,"border","border-green-400","bg-green-400/20","px-2","py-1","text-green-300","font-bold","text-center",3,"click"],[1,"text-green-400","text-xs"],[1,"w-full","text-center","text-sm","mt-2","h-4","bg-neutral-700/80","rounded","overflow-hidden","relative","animate-pulse","text-white"],[1,"flex","justify-center"],[1,"relative","inline-block"],[1,"chess-board","bg-amber-100","border-2","sm:border-4","border-amber-800","p-2","sm:p-6","relative"],[1,"flex","justify-center","mb-1","sm:mb-2"],[1,"grid","grid-cols-9","gap-0"],[1,"w-[36px]","sm:w-[50px]","text-center","text-xs","font-bold","text-amber-800"],[1,"flex"],[1,"flex","flex-col","justify-center","mr-1","sm:mr-2"],[1,"h-[40px]","sm:h-[50px]","flex","items-center","justify-center","text-xs","font-bold","text-amber-800","w-4","sm:w-6"],[1,"relative","w-[310px]","h-[360px]","sm:w-[408px]","sm:h-[450px]","bg-amber-100"],["viewBox","0 0 100 100",1,"absolute","top-0","left-[122px]","w-[72px]","h-[80px]","sm:hidden"],["x1","0","y1","0","x2","100","y2","100","stroke","#d97706","stroke-width","1"],["x1","100","y1","0","x2","0","y2","100","stroke","#d97706","stroke-width","1"],["viewBox","0 0 100 100",1,"absolute","bottom-0","left-[122px]","w-[72px]","h-[80px]","sm:hidden"],["viewBox","0 0 100 100",1,"absolute","top-0","left-[154px]","w-[100px]","h-[100px]","hidden","sm:block"],["viewBox","0 0 100 100",1,"absolute","bottom-0","left-[154px]","w-[100px]","h-[100px]","hidden","sm:block"],[1,"absolute","left-0","right-0","bg-amber-100","flex","items-center","justify-between","px-8","z-5","sm:hidden",2,"top","161px","height","40px"],[1,"text-amber-700","font-bold","text-xs","tracking-wider"],[1,"absolute","left-0","right-0","bg-amber-100","flex","items-center","justify-between","px-16","z-5","hidden","sm:flex",2,"top","204px","height","50px"],[1,"text-amber-700","font-bold","text-sm","tracking-wider"],[1,"flex","flex-col","justify-center","ml-1","sm:ml-2"],[1,"flex","justify-center","mt-1","sm:mt-2"],[1,"absolute","inset-0","bg-black/50","backdrop-blur-sm","flex","items-center","justify-center","z-50","rounded-lg"],[1,"mt-6"],[1,"mt-4","text-xs","text-amber-600","text-center"],[1,"mb-1"],[1,"api-key-modal-overlay"],[1,"w-3/5","flex","items-center","gap-2","bg-neutral-800/50","rounded-lg","p-2","border","border-neutral-600","justify-center"],[1,"text-amber-300","text-sm","font-medium"],[1,"px-2","py-1","text-xs","rounded","transition-colors",3,"click","ngClass"],[1,"w-2/5","flex","items-center","gap-2","bg-neutral-800/50","rounded-lg","p-2","border","border-neutral-600","justify-center"],[1,"px-1","py-1","text-xs","rounded","transition-colors",3,"click","ngClass"],[1,"flex","gap-2","items-center"],[1,"px-3","py-1","text-xs","rounded","transition-colors","bg-purple-700","hover:bg-purple-600","text-white"],[1,"px-2","py-1","text-xs","rounded","transition-colors","bg-red-700","hover:bg-red-600","text-white",3,"click"],[1,"px-3","py-1","text-xs","rounded","transition-colors","bg-purple-700","hover:bg-purple-600","text-white",3,"click"],[1,"absolute","left-0","right-0","h-[1px]","bg-amber-800",3,"ngClass"],[1,"absolute","left-0","right-0","h-[1px]","bg-amber-800","hidden","sm:block"],[1,"absolute","w-[1px]","bg-amber-800","sm:hidden"],[1,"absolute","w-[1px]","bg-amber-800","hidden","sm:block"],[1,"absolute","w-[20px]","h-[20px]","-translate-x-1/2","-translate-y-1/2","rounded-full","hover:bg-amber-200/30","cursor-pointer","z-20","sm:hidden",3,"click","ngClass"],[1,"absolute","w-[6px]","h-[6px]","bg-amber-800","rounded-full","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[32px]","h-[32px]",3,"ngClass"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-2","h-2","bg-green-500","rounded-full","opacity-70"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[34px]","h-[34px]","border-2","border-red-500","rounded-full"],[1,"absolute","w-[24px]","h-[24px]","-translate-x-1/2","-translate-y-1/2","rounded-full","hover:bg-amber-200/30","cursor-pointer","z-20","hidden","sm:block",3,"click","ngClass"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[40px]","h-[40px]",3,"ngClass"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-3","h-3","bg-green-500","rounded-full","opacity-70"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[42px]","h-[42px]","border-2","border-red-500","rounded-full"],[1,"w-8","h-8","rounded-full","border-2","flex","items-center","justify-center","text-sm","font-bold","shadow-lg"],[1,"w-10","h-10","rounded-full","border-2","flex","items-center","justify-center","text-lg","font-bold","shadow-lg"],[1,"bg-gradient-to-br","from-amber-600","to-amber-800","border-2","border-amber-400","rounded-lg","p-8","shadow-2xl","text-center"],[1,"text-3xl","mb-4"],[1,"text-2xl","font-bold","mb-4","text-amber-100"],[1,"bg-amber-400","hover:bg-amber-300","text-amber-900","font-bold","py-3","px-6","rounded-lg","transition-all","duration-200","transform","hover:scale-105","shadow-lg",3,"click"],[1,"text-lg","font-bold","text-amber-400","mb-3"],[1,"bg-neutral-900/70","border","border-neutral-700","rounded-md","p-4","max-h-32","overflow-y-auto"],[1,"grid","grid-cols-2","gap-2","text-sm"],[1,"text-neutral-400"],[1,"text-red-400"],[1,"text-neutral-300"],[1,"api-key-modal-overlay",3,"click"],[1,"api-key-modal-content",3,"click"],[1,"close-button",3,"click"],[3,"onApiKeySaved","onApiKeyClear"]],template:function(t,n){t&1&&(c(0,"div",0)(1,"header",1)(2,"div",2)(3,"h1",3),h(4," \u4E2D\u570B\u8C61\u68CB "),l(),c(5,"a",4),h(6,"HOME"),l()(),c(7,"div",5)(8,"button",6),A("click",function(){return n.toggleGameMode()}),h(9),l(),c(10,"div",7),y(11,fn,2,0,"div",8),y(12,pn,2,0,"div",9),l(),c(13,"button",10),A("click",function(){return n.resetGame()}),h(14," \u91CD\u65B0\u958B\u59CB "),l()(),y(15,yn,10,4,"div",11),c(16,"div",12)(17,"div",13)(18,"div",14)(19,"div",15),h(20,"\u7576\u524D\u5C0D\u6230"),l(),c(21,"div",16),h(22),l()(),c(23,"div",17)(24,"div",18),h(25,"\u7576\u524D\u56DE\u5408"),l(),c(26,"div",16),y(27,Cn,2,0,"span"),h(28),l()(),c(29,"div",19)(30,"div",20),h(31,"\u6700\u5F8C\u4E00\u6B65"),l(),c(32,"div",16),y(33,bn,1,1)(34,xn,1,0),l()(),c(35,"div",21),A("click",function(){return n.openApiKeyModal()}),c(36,"div",22),h(37,"\u{1F916} AI \u8A2D\u5B9A"),l(),c(38,"div",16),y(39,An,1,0)(40,En,1,1),l()(),c(41,"div",23),y(42,Dn,1,0),l()()()(),c(43,"main",24)(44,"div",25)(45,"div",26)(46,"div",27)(47,"div",28),T(48,In,2,1,"div",29,U),l()(),c(50,"div",30)(51,"div",31),T(52,Sn,2,1,"div",32,U),l(),c(54,"div",33),T(55,Mn,2,9,null,null,U),T(57,wn,4,24,null,null,U),st(),c(59,"svg",34),V(60,"line",35)(61,"line",36),l(),c(62,"svg",37),V(63,"line",35)(64,"line",36),l(),c(65,"svg",38),V(66,"line",35)(67,"line",36),l(),c(68,"svg",39),V(69,"line",35)(70,"line",36),l(),rt(),c(71,"div",40)(72,"span",41),h(73,"\u695A\u6CB3"),l(),c(74,"span",41),h(75,"\u6F22\u754C"),l()(),c(76,"div",42)(77,"span",43),h(78,"\u695A\u6CB3"),l(),c(79,"span",43),h(80,"\u6F22\u754C"),l()(),T(81,Ln,2,0,null,null,pe),l(),c(83,"div",44),T(84,Hn,2,1,"div",32,U),l()(),c(86,"div",45)(87,"div",28),T(88,jn,2,1,"div",29,U),l()()(),y(90,$n,8,1,"div",46),l()(),y(91,Yn,7,0,"section",47),c(92,"footer",48)(93,"p",49),h(94,"\u9EDE\u64CA\u9078\u64C7\u68CB\u5B50\uFF0C\u518D\u9EDE\u64CA\u76EE\u6A19\u4F4D\u7F6E\u79FB\u52D5"),l(),c(95,"p"),h(96,"\u7D05\u65B9\u5148\u884C\uFF0C\u5C07\u8ECD\u5C0D\u65B9\u5373\u7372\u52DD"),l()()(),y(97,zn,5,0,"div",50)),t&2&&(u(9),P(" ",n.isVsAI()?"\u{1F465} \u5207\u63DB\u96D9\u4EBA":"\u{1F916} \u5207\u63DBAI"," "),u(2),C(n.isInCheck()?11:-1),u(),C(n.isSelfInCheck()&&!n.isInCheck()?12:-1),u(3),C(n.isVsAI()?15:-1),u(7),me(n.isVsAI()?"\u{1F916}":"\u{1F465}"),u(),O("ngClass",n.currentPlayer()===n.PlayerColor.RED?"bg-red-500/20 border-red-400 text-red-300":"bg-neutral-800/20 border-neutral-400 text-neutral-300"),u(4),C(n.isVsAI()&&n.currentPlayer()===n.PlayerColor.BLACK?27:-1),u(),P("",n.currentPlayerDisplay()," "),u(5),C(n.moveHistory().length>0?33:34),u(6),C(n.isGeminiEnabled()?39:40),u(3),C(n.aiIsThinking()?42:-1),u(6),G(n.getColumnLetters()),u(4),G(n.getRowNumbers()),u(3),G(Ke(14,un)),u(2),G(Ke(15,hn)),u(24),G(n.board()),u(3),G(n.getRowNumbers()),u(4),G(n.getColumnLetters()),u(2),C(n.gameOver()?90:-1),u(),C(n.moveHistory().length>0?91:-1),u(6),C(n.isApiKeyModalOpen()?97:-1))},dependencies:[ge,gt,_t,Ne,Ee],styles:[".api-key-modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#0009;display:flex;justify-content:center;align-items:center;z-index:1000;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.api-key-modal-content[_ngcontent-%COMP%]{position:relative;padding:20px;background:#1a1a1a;border-radius:8px;border:1px solid #444;width:90%;max-width:500px;box-shadow:0 5px 15px #00000080}.close-button[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;background:none;border:none;font-size:1.5rem;color:#888;cursor:pointer;line-height:1}.close-button[_ngcontent-%COMP%]:hover{color:#fff}"]})};export{zt as ChineseChess};
