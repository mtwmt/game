import{A as N,B as T,C as f,D as d,E as w,F as le,G as k,H as C,I as L,J as Z,K as p,L as ce,M as V,P as Ee,Q as xe,T as I,U as Oe,W as Re,a as _,aa as Ne,b,c as g,d as _e,e as S,f as Ce,g as Se,h as E,i as W,j as q,k as we,l as Pe,n as B,o as J,s as h,t as Ve,u as be,v as x,w as A,x as ae,y as Y,z as R}from"./chunk-KAPDN7P7.js";var Je={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},Wi=b(_({},Je),{"[class.ng-submitted]":"isSubmitted"});var Ze=new Se("",{providedIn:"root",factory:()=>Te}),Te="always";var et=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=be({type:o});static \u0275inj=Ce({})}return o})();var ke=(()=>{class o{static withConfig(t){return{ngModule:o,providers:[{provide:Ze,useValue:t.callSetDisabledState??Te}]}}static \u0275fac=function(i){return new(i||o)};static \u0275mod=be({type:o});static \u0275inj=Ce({imports:[et]})}return o})();var F=(t=>(t.RED="red",t.BLACK="black",t))(F||{});var Ae={board:[],currentPlayer:"red",selectedPiece:null,validMoves:[],gameOver:!1,winner:null,moveHistory:[],isInCheck:!1,isSelfInCheck:!1,isVsAI:!0,aiIsThinking:!1,aiThinkingText:"",hasApiKey:!1},P=class o{static BOARD_WIDTH=9;static BOARD_HEIGHT=10;static PALACE_LEFT=3;static PALACE_RIGHT=5;static RED_PALACE_TOP=7;static RED_PALACE_BOTTOM=9;static BLACK_PALACE_TOP=0;static BLACK_PALACE_BOTTOM=2;hasApiKey=B(!1);boardCache={kingPositions:new Map,piecesByColor:new Map,lastMoveCount:-1};constructor(){this.updateApiKeyStatus()}moveCache=new Map;ORTHOGONAL_DIRECTIONS=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}];DIAGONAL_DIRECTIONS=[{dx:-1,dy:-1},{dx:1,dy:-1},{dx:-1,dy:1},{dx:1,dy:1}];initializeBoard(){let e=Array(10).fill(null).map(()=>Array(9).fill(null));return this.setupInitialPieces(e),e}setupInitialPieces(e){let t=["rook","horse","elephant","advisor","king","advisor","elephant","horse","rook"];t.forEach((n,s)=>{let r=this.generatePieceId(n,"red",s);e[9][s]=this.createPiece(r,n,"red",s,9)}),[...t].forEach((n,s)=>{let r=this.generatePieceId(n,"black",s);e[0][s]=this.createPiece(r,n,"black",s,0)}),[1,7].forEach((n,s)=>{e[7][n]=this.createPiece(`r-cannon-${s+1}`,"cannon","red",n,7),e[2][n]=this.createPiece(`b-cannon-${s+1}`,"cannon","black",n,2)});for(let n=0;n<9;n+=2)e[6][n]=this.createPiece(`r-soldier-${n}`,"soldier","red",n,6),e[3][n]=this.createPiece(`b-soldier-${n}`,"soldier","black",n,3)}generatePieceId(e,t,i){let n=t==="red"?"r":"b";return e==="king"?`${n}-king`:`${n}-${e}-${i<4?"1":"2"}`}createPiece(e,t,i,n,s){return{id:e,type:t,color:i,position:{x:n,y:s},isSelected:!1,hasMoved:!1}}initializeGameState(){return b(_({},Ae),{board:this.initializeBoard(),hasApiKey:this.checkHasApiKey()})}isValidPosition(e,t){return e>=0&&e<o.BOARD_WIDTH&&t>=0&&t<o.BOARD_HEIGHT}isInPalace(e,t,i){return i==="red"?e>=o.PALACE_LEFT&&e<=o.PALACE_RIGHT&&t>=o.RED_PALACE_TOP&&t<=o.RED_PALACE_BOTTOM:e>=o.PALACE_LEFT&&e<=o.PALACE_RIGHT&&t>=o.BLACK_PALACE_TOP&&t<=o.BLACK_PALACE_BOTTOM}isOnOwnSide(e,t){return t==="red"?e>=5:e<=4}wouldKingsFaceEachOther(e,t=0){this.updateBoardCache(e,t);let i=this.boardCache.kingPositions.get("red"),n=this.boardCache.kingPositions.get("black");return!i||!n||i.x!==n.x?!1:this.isPathClear(e,i,n)}isPathClear(e,t,i){let n=Math.min(t.y,i.y),s=Math.max(t.y,i.y);for(let r=n+1;r<s;r++)if(e[r][t.x]!==null)return!1;return!0}updateBoardCache(e,t){if(this.boardCache.lastMoveCount!==t){this.boardCache.kingPositions.clear(),this.boardCache.piecesByColor.clear(),this.boardCache.piecesByColor.set("red",[]),this.boardCache.piecesByColor.set("black",[]);for(let i=0;i<o.BOARD_HEIGHT;i++)for(let n=0;n<o.BOARD_WIDTH;n++){let s=e[i][n];s&&(this.boardCache.piecesByColor.get(s.color).push(s),s.type==="king"&&this.boardCache.kingPositions.set(s.color,{x:n,y:i}))}this.boardCache.lastMoveCount=t}}clearCaches(){this.moveCache.clear(),this.boardCache.lastMoveCount=-1}getBoardHash(e){let t="";for(let i=0;i<o.BOARD_HEIGHT;i++)for(let n=0;n<o.BOARD_WIDTH;n++){let s=e[i][n];t+=s?`${s.type}${s.color}${n}${i}`:"e"}return t}isValidMoveForPiece(e,t,i){if(!this.isValidPosition(e.x,e.y))return!1;let n=i[e.y][e.x];return!n||n.color!==t.color}getSlidingPieceMoves(e,t,i){let n=[],{x:s,y:r}=e.position;return i.forEach(a=>{for(let l=1;l<10;l++){let c=s+a.dx*l,u=r+a.dy*l;if(!this.isValidPosition(c,u))break;let m=t[u][c];if(m){m.color!==e.color&&n.push({x:c,y:u});break}else n.push({x:c,y:u})}}),n}getPossibleMoves(e,t){let i=`${e.id}-${e.position.x}-${e.position.y}-true`;if(this.moveCache.has(i))return this.moveCache.get(i);let n=this.calculatePieceMoves(e,t,!0);return this.moveCache.set(i,n),n}getPossibleMovesForCheck(e,t){let i=`${e.id}-${e.position.x}-${e.position.y}-false`;if(this.moveCache.has(i))return this.moveCache.get(i);let n=this.calculatePieceMoves(e,t,!1);return this.moveCache.set(i,n),n}calculatePieceMoves(e,t,i){switch(e.type){case"king":return this.getKingMoves(e,t,i);case"advisor":return this.getAdvisorMoves(e,t);case"elephant":return this.getElephantMoves(e,t);case"horse":return this.getHorseMoves(e,t);case"rook":return this.getRookMoves(e,t);case"cannon":return this.getCannonMoves(e,t);case"soldier":return this.getSoldierMoves(e,t);default:return[]}}getKingMoves(e,t,i){let{x:n,y:s}=e.position;return this.ORTHOGONAL_DIRECTIONS.map(a=>({x:n+a.dx,y:s+a.dy})).filter(a=>{if(!this.isValidPosition(a.x,a.y)||!this.isInPalace(a.x,a.y,e.color))return!1;let l=t[a.y][a.x];return l&&l.color===e.color?!1:!i||!this.wouldMoveCreateKingFacing(e,a,t)})}wouldMoveCreateKingFacing(e,t,i){let n=i[t.y][t.x],s=e.position;i[t.y][t.x]=e,i[s.y][s.x]=null,e.position=t;let r=this.wouldKingsFaceEachOther(i);return i[s.y][s.x]=e,i[t.y][t.x]=n,e.position=s,r}getAdvisorMoves(e,t){let{x:i,y:n}=e.position;return this.DIAGONAL_DIRECTIONS.map(r=>({x:i+r.dx,y:n+r.dy})).filter(r=>this.isValidPosition(r.x,r.y)&&this.isInPalace(r.x,r.y,e.color)&&this.isValidMoveForPiece(r,e,t))}getElephantMoves(e,t){let{x:i,y:n}=e.position;return[{x:i-2,y:n-2,block:{x:i-1,y:n-1}},{x:i+2,y:n-2,block:{x:i+1,y:n-1}},{x:i-2,y:n+2,block:{x:i-1,y:n+1}},{x:i+2,y:n+2,block:{x:i+1,y:n+1}}].filter(r=>this.isValidPosition(r.x,r.y)&&this.isOnOwnSide(r.y,e.color)&&!t[r.block.y][r.block.x]&&this.isValidMoveForPiece(r,e,t)).map(r=>({x:r.x,y:r.y}))}getHorseMoves(e,t){let{x:i,y:n}=e.position;return[{x:i-1,y:n-2,block:{x:i,y:n-1}},{x:i+1,y:n-2,block:{x:i,y:n-1}},{x:i-1,y:n+2,block:{x:i,y:n+1}},{x:i+1,y:n+2,block:{x:i,y:n+1}},{x:i-2,y:n-1,block:{x:i-1,y:n}},{x:i-2,y:n+1,block:{x:i-1,y:n}},{x:i+2,y:n-1,block:{x:i+1,y:n}},{x:i+2,y:n+1,block:{x:i+1,y:n}}].filter(r=>this.isValidPosition(r.x,r.y)&&!t[r.block.y][r.block.x]&&this.isValidMoveForPiece(r,e,t)).map(r=>({x:r.x,y:r.y}))}getRookMoves(e,t){return this.getSlidingPieceMoves(e,t,this.ORTHOGONAL_DIRECTIONS)}getCannonMoves(e,t){let i=[],{x:n,y:s}=e.position;return this.ORTHOGONAL_DIRECTIONS.forEach(r=>{let a=!1;for(let l=1;l<10;l++){let c=n+r.dx*l,u=s+r.dy*l;if(!this.isValidPosition(c,u))break;let m=t[u][c];if(m)if(!a)a=!0;else{m.color!==e.color&&i.push({x:c,y:u});break}else a||i.push({x:c,y:u})}}),i}getSoldierMoves(e,t){let i=[],{x:n,y:s}=e.position,r=e.color==="red"?-1:1,a={x:n,y:s+r};return this.isValidMoveForPiece(a,e,t)&&i.push(a),this.isOnOwnSide(s,e.color)||[{x:n-1,y:s},{x:n+1,y:s}].forEach(c=>{this.isValidMoveForPiece(c,e,t)&&i.push(c)}),i}isInCheck(e,t,i=0){this.updateBoardCache(e,i);let n=this.boardCache.kingPositions.get(t);if(!n)return!1;let s=t==="red"?"black":"red";return(this.boardCache.piecesByColor.get(s)||[]).some(a=>this.getPossibleMovesForCheck(a,e).some(c=>c.x===n.x&&c.y===n.y))}makeMove(e,t,i){let{board:n,moveHistory:s}=e,r=n[t.y][t.x];if(!r)return{success:!1};let a=n[i.y][i.x],l=s.length;if(this.clearCaches(),n[i.y][i.x]=r,n[t.y][t.x]=null,r.position=i,a&&a.type==="king")return r.hasMoved=!0,{success:!0,captured:a,isCheck:!1,gameOver:!0,winner:r.color};if(this.wouldKingsFaceEachOther(n,l+1))return r.hasMoved=!0,{success:!0,captured:a||void 0,isCheck:!1,gameOver:!0,winner:r.color==="red"?"black":"red"};let c=r.color==="red"?"black":"red",u=this.isInCheck(n,c,l+1),m=this.isInCheck(n,r.color,l+1);return r.hasMoved=!0,{success:!0,captured:a||void 0,isCheck:u,isSelfInCheck:m}}getPieceSymbol(e){return{king:{red:"\u5E25",black:"\u5C07"},advisor:{red:"\u4ED5",black:"\u58EB"},elephant:{red:"\u76F8",black:"\u8C61"},horse:{red:"\u99AC",black:"\u99AC"},rook:{red:"\u8ECA",black:"\u8ECA"},cannon:{red:"\u70AE",black:"\u7832"},soldier:{red:"\u5175",black:"\u5352"}}[e.type][e.color]}checkHasApiKey(){if(typeof localStorage<"u"){let e=localStorage.getItem("gemini-api-key");return!!e&&e!=="YOUR_GEMINI_API_KEY_HERE"}return!1}updateApiKeyStatus(){let e=this.checkHasApiKey();this.hasApiKey.set(e)}static \u0275fac=function(t){return new(t||o)};static \u0275prov=S({token:o,factory:o.\u0275fac,providedIn:"root"})};var z=class o{chessGameService=E(P);engines=new Map;currentEngine=null;engineReady$=new _e(!1);isThinking$=new _e(!1);availableEngines=[{name:"Pikafish",path:"engines/pikafish.exe",author:"Pikafish Team",difficulty:9,description:"Professional xiangqi engine with NNUE evaluation"},{name:"Fairy-Stockfish",path:"engines/fairy-stockfish.exe",author:"Fairy-Stockfish Team",difficulty:8,description:"Multi-variant chess engine supporting xiangqi"}];constructor(){console.log("\u{1F527} UCI\u5F15\u64CE\u670D\u52D9\u5DF2\u521D\u59CB\u5316")}getAvailableEngines(){return this.availableEngines}initializeEngine(e){return g(this,null,function*(){console.log(`\u{1F680} \u521D\u59CB\u5316\u5F15\u64CE: ${e}`);try{yield this.delay(1e3);let t=this.availableEngines.find(n=>n.name===e);if(!t)return console.error(`\u274C \u627E\u4E0D\u5230\u5F15\u64CE: ${e}`),!1;let i={name:t.name,author:t.author,isReady:!0,difficulty:t.difficulty};return this.engines.set(e,i),this.currentEngine=e,this.engineReady$.next(!0),console.log(`\u2705 \u5F15\u64CE ${e} \u521D\u59CB\u5316\u5B8C\u6210`),!0}catch(t){return console.error("\u274C \u5F15\u64CE\u521D\u59CB\u5316\u5931\u6557:",t),this.engineReady$.next(!1),!1}})}shutdownEngine(){return g(this,null,function*(){this.currentEngine&&(console.log(`\u{1F50C} \u95DC\u9589\u5F15\u64CE: ${this.currentEngine}`),this.engines.delete(this.currentEngine),this.currentEngine=null,this.engineReady$.next(!1),this.isThinking$.next(!1))})}getEngineMove(e,t=3e3){return g(this,null,function*(){if(!this.currentEngine||!this.engineReady$.value)return console.error("\u274C \u5F15\u64CE\u672A\u5C31\u7DD2"),null;console.log(`\u{1F9E0} ${this.currentEngine} \u958B\u59CB\u5206\u6790...`),this.isThinking$.next(!0);try{yield this.delay(Math.min(t,2e3));let i=this.generateMockEngineMove(e);return this.isThinking$.next(!1),i&&(console.log(`\u{1F3AF} ${this.currentEngine} \u63A8\u85A6\u79FB\u52D5:`,i),console.log(`\u{1F4CA} \u8A55\u5206: ${i.score}, \u6DF1\u5EA6: ${i.depth}`)),i}catch(i){return console.error("\u274C \u5F15\u64CE\u5206\u6790\u5931\u6557:",i),this.isThinking$.next(!1),null}})}generateMockEngineMove(e){let t=this.getAllPossibleMoves(e,"black");if(t.length===0)return console.warn("\u{1F50D} UCI\u5F15\u64CE\uFF1A\u6C92\u6709\u627E\u5230\u4EFB\u4F55\u6709\u6548\u79FB\u52D5"),null;console.log(`\u{1F3AF} UCI\u5F15\u64CE\uFF1A\u5728 ${t.length} \u500B\u6709\u6548\u79FB\u52D5\u4E2D\u9078\u64C7`);let i=t.map(s=>{let r=0,a=e.board[s.to.y][s.to.x];a&&a.color==="red"&&(r+=100,console.log(`\u26A1 \u767C\u73FE\u5403\u5B50\u79FB\u52D5: ${this.positionToNotation(s.from)} -> ${this.positionToNotation(s.to)}`));let l=this.simulateMove(e.board,s.from,s.to);return this.chessGameService.isInCheck(l,"red")&&(r+=50,console.log(`\u{1F451} \u767C\u73FE\u5C07\u8ECD\u79FB\u52D5: ${this.positionToNotation(s.from)} -> ${this.positionToNotation(s.to)}`)),r+=Math.floor(Math.random()*20),{move:s,score:r}});i.sort((s,r)=>r.score-s.score);let n=i[0].move;return console.log(`\u2705 UCI\u5F15\u64CE\u9078\u64C7: ${this.positionToNotation(n.from)} -> ${this.positionToNotation(n.to)} (\u8A55\u5206: ${i[0].score})`),{from:n.from,to:n.to,score:i[0].score,depth:12,pv:`${this.positionToNotation(n.from)}${this.positionToNotation(n.to)}`}}getAllPossibleMoves(e,t){let i=[],n=e.board;for(let s=0;s<10;s++)for(let r=0;r<9;r++){let a=n[s][r];if(a&&a.color===t)try{let l=this.chessGameService.getPossibleMoves(a,n);for(let c of l){let u=this.simulateMove(n,a.position,c);this.chessGameService.isInCheck(u,t)||i.push({from:a.position,to:c})}}catch(l){console.warn(`\u7372\u53D6\u68CB\u5B50 ${a.type} \u79FB\u52D5\u5931\u6557:`,l)}}return console.log(`\u{1F50D} UCI\u5F15\u64CE\u627E\u5230 ${i.length} \u500B\u6709\u6548\u79FB\u52D5`),i}simulateMove(e,t,i){let n=e.map(r=>[...r]),s=n[t.y][t.x];return n[t.y][t.x]=null,n[i.y][i.x]=s?b(_({},s),{position:i}):null,n}positionToNotation(e){return"abcdefghi"[e.x]+(9-e.y)}setEngineOption(e,t){return g(this,null,function*(){if(!this.currentEngine){console.error("\u274C \u6C92\u6709\u6D3B\u52D5\u5F15\u64CE");return}console.log(`\u2699\uFE0F \u8A2D\u7F6E\u5F15\u64CE\u9078\u9805: ${e} = ${t}`)})}setDifficulty(e){return g(this,null,function*(){if(e<1||e>10){console.error("\u274C \u96E3\u5EA6\u7B49\u7D1A\u5FC5\u9808\u57281-10\u4E4B\u9593");return}let t=Math.floor(e*500),i=Math.floor(e*1.5);yield this.setEngineOption("Depth",i.toString()),yield this.setEngineOption("MoveTime",t.toString()),console.log(`\u{1F39A}\uFE0F \u8A2D\u7F6E\u5F15\u64CE\u96E3\u5EA6\u70BA ${e}/10`)})}delay(e){return new Promise(t=>setTimeout(t,e))}get engineReady(){return this.engineReady$.asObservable()}get isThinking(){return this.isThinking$.asObservable()}get currentEngineName(){return this.currentEngine}getEngineInfo(){return this.currentEngine&&this.engines.get(this.currentEngine)||null}pingEngine(){return g(this,null,function*(){if(!this.currentEngine||!this.engineReady$.value)return!1;try{return yield this.delay(100),!0}catch{return!1}})}static \u0275fac=function(t){return new(t||o)};static \u0275prov=S({token:o,factory:o.\u0275fac,providedIn:"root"})};var H=class{isValidMove(e,t){return t.some(i=>i.from.x===e.from.x&&i.from.y===e.from.y&&i.to.x===e.to.x&&i.to.y===e.to.y)}getAllPossibleMoves(e,t,i){let n=[],s=e.board;for(let r=0;r<10;r++)for(let a=0;a<9;a++){let l=s[r][a];if(l&&l.color===t){let c=i.getPossibleMoves(l,s);for(let u of c)n.push({from:l.position,to:u})}}return n}};var j={king:1e4,rook:500,cannon:450,horse:400,elephant:200,advisor:200,soldier:100},tt=[[0,0,0,20,30,20,0,0,0],[0,0,0,10,20,10,0,0,0],[0,0,0,5,10,5,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,-5,-10,-5,0,0,0],[0,0,0,-10,-20,-10,0,0,0],[0,0,0,-20,-30,-20,0,0,0]],it=[[40,50,50,55,60,55,50,50,40],[30,40,45,50,55,50,45,40,30],[20,30,35,40,45,40,35,30,20],[10,20,25,30,35,30,25,20,10],[5,15,20,25,30,25,20,15,5],[-5,-5,10,15,20,15,10,-5,-5],[-10,-10,0,5,10,5,0,-10,-10],[-15,-15,-5,0,5,0,-5,-15,-15],[-20,-20,-10,-5,0,-5,-10,-20,-20],[-25,-25,-15,-10,-5,-10,-15,-25,-25]],nt=[[30,35,40,45,50,45,40,35,30],[25,30,35,40,45,40,35,30,25],[20,25,30,35,40,35,30,25,20],[15,20,25,30,35,30,25,20,15],[10,15,20,25,30,25,20,15,10],[5,10,15,20,25,20,15,10,5],[0,5,10,15,20,15,10,5,0],[-5,0,5,10,15,10,5,0,-5],[-10,-5,0,5,10,5,0,-5,-10],[-15,-10,-5,0,5,0,-5,-10,-15]],ot=[[10,20,30,35,40,35,30,20,10],[15,25,35,40,45,40,35,25,15],[20,30,40,45,50,45,40,30,20],[25,35,45,50,55,50,45,35,25],[20,30,40,45,50,45,40,30,20],[15,25,35,40,45,40,35,25,15],[10,20,30,35,40,35,30,20,10],[5,15,25,30,35,30,25,15,5],[0,10,20,25,30,25,20,10,0],[-5,5,15,20,25,20,15,5,-5]],st=[[0,0,20,0,0,0,20,0,0],[0,0,0,0,0,0,0,0,0],[15,0,0,0,25,0,0,0,15],[0,0,0,0,0,0,0,0,0],[10,0,0,0,20,0,0,0,10],[0,0,0,0,0,0,0,0,0],[-10,0,0,0,-20,0,0,0,-10],[0,0,0,0,0,0,0,0,0],[-15,0,0,0,-25,0,0,0,-15],[0,0,-20,0,0,0,-20,0,0]],rt=[[0,0,0,20,0,20,0,0,0],[0,0,0,0,30,0,0,0,0],[0,0,0,15,0,15,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,-15,0,-15,0,0,0],[0,0,0,0,-30,0,0,0,0],[0,0,0,-20,0,-20,0,0,0]],at=[[15,20,25,30,35,30,25,20,15],[10,15,20,25,30,25,20,15,10],[8,12,16,20,25,20,16,12,8],[6,10,14,18,22,18,14,10,6],[5,8,12,16,20,16,12,8,5],[3,6,9,12,15,12,9,6,3],[2,4,6,8,10,8,6,4,2],[1,2,3,4,5,4,3,2,1],[0,1,2,3,4,3,2,1,0],[0,0,1,2,3,2,1,0,0]],X={king:tt,rook:it,cannon:nt,horse:ot,elephant:st,advisor:rt,soldier:at};function Ge(o,e,t,i){let n=j[o];if(!X[o])return n;let s;if(i==="red"){let r=9-t;s=X[o][r][e]}else s=X[o][t][e];return n+s}function Le(o,e,t,i){if(!X[o])return 0;if(i==="red"){let n=9-t;return X[o][n][e]}else return X[o][t][e]}var An={king:"king",advisor:"advisor",elephant:"elephant",horse:"horse",rook:"rook",cannon:"cannon",soldier:"soldier"},ue=class{maxDepth=4;maxTime=3e3;nodeCount=0;startTime=0;setDifficulty(e){this.maxDepth=Math.max(2,Math.min(8,Math.floor(e*.8)+2)),this.maxTime=Math.max(1e3,Math.min(8e3,e*800)),console.log(`\u{1F9E0} XQWLight \u5F15\u64CE\u96E3\u5EA6\u8A2D\u7F6E: \u6DF1\u5EA6=${this.maxDepth}, \u6642\u9593=${this.maxTime}ms`)}searchBestMove(e){return g(this,null,function*(){console.log(`\u{1F9E0} XQWLight \u5F15\u64CE\u958B\u59CB\u5206\u6790 (\u6DF1\u5EA6${this.maxDepth}, \u6642\u9593${this.maxTime}ms)...`),this.startTime=Date.now(),this.nodeCount=0;try{let t=yield this.alphaBetaSearch(e,this.maxDepth,-999999,999999,!0),i=Date.now()-this.startTime;return t?(console.log(`\u2705 XQWLight \u5206\u6790\u5B8C\u6210: ${i}ms, ${this.nodeCount} \u7BC0\u9EDE, \u8A55\u5206=${t.score}`),{from:t.from,to:t.to,score:t.score,depth:this.maxDepth,nodes:this.nodeCount,time:i}):null}catch(t){return console.error("\u274C XQWLight \u5F15\u64CE\u641C\u7D22\u5931\u6557:",t),null}})}alphaBetaSearch(e,t,i,n,s){return g(this,null,function*(){if(this.nodeCount++,Date.now()-this.startTime>this.maxTime)return null;if(t===0){let u=this.evaluatePosition(e);return{from:{x:0,y:0},to:{x:0,y:0},score:u}}let r=s?"black":"red",a=this.generateAllMoves(e,r);if(a.length===0){let u=this.isInCheck(e,r)?s?-999999:999999:0;return{from:{x:0,y:0},to:{x:0,y:0},score:u}}let l=this.orderMoves(e,a),c=null;if(s){let u=-999999;for(let m of l){let v=this.makeMove(e,m.from,m.to);if(this.isInCheck(v,r))continue;let y=yield this.alphaBetaSearch(v,t-1,i,n,!1);if(y&&y.score>u&&(u=y.score,c=m),i=Math.max(i,u),n<=i)break}return c?b(_({},c),{score:u}):null}else{let u=999999;for(let m of l){let v=this.makeMove(e,m.from,m.to);if(this.isInCheck(v,r))continue;let y=yield this.alphaBetaSearch(v,t-1,i,n,!0);if(y&&y.score<u&&(u=y.score,c=m),n=Math.min(n,u),n<=i)break}return c?b(_({},c),{score:u}):null}})}evaluatePosition(e){let t=0;for(let s=0;s<10;s++)for(let r=0;r<9;r++){let a=e.board[s][r];if(!a)continue;let l=this.getPieceType(a),c=Ge(l,r,s,a.color);a.color==="black"?t+=c:t-=c}let i=this.generateAllMoves(e,"black").length,n=this.generateAllMoves(e,"red").length;return t+=(i-n)*5,this.isInCheck(e,"black")&&(t-=200),this.isInCheck(e,"red")&&(t+=200),t}orderMoves(e,t){return t.sort((i,n)=>{let s=0,r=0,a=e.board[i.to.y][i.to.x],l=e.board[n.to.y][n.to.x];if(a){let m=this.getPieceType(a);s+=j[m]+1e3}if(l){let m=this.getPieceType(l);r+=j[m]+1e3}let c=this.makeMove(e,i.from,i.to),u=this.makeMove(e,n.from,n.to);return this.isInCheck(c,"red")&&(s+=500),this.isInCheck(u,"red")&&(r+=500),r-s})}getPieceType(e){return e.type}generateAllMoves(e,t){let i=[];for(let n=0;n<10;n++)for(let s=0;s<9;s++){let r=e.board[n][s];if(r&&r.color===t)try{let a=this.chessGameService?.getPossibleMoves(r,e.board)||[];for(let l of a)i.push({from:r.position,to:l})}catch(a){console.warn(`\u7372\u53D6\u68CB\u5B50 ${r.type} \u79FB\u52D5\u5931\u6557:`,a)}}return i}makeMove(e,t,i){let n=e.board.map(r=>[...r]),s=n[t.y][t.x];return n[t.y][t.x]=null,s&&(n[i.y][i.x]=b(_({},s),{position:{x:i.x,y:i.y},hasMoved:!0})),b(_({},e),{board:n})}isInCheck(e,t){try{return this.chessGameService?.isInCheck(e.board,t)||!1}catch(i){return console.warn("\u6AA2\u67E5\u5C07\u8ECD\u72C0\u614B\u5931\u6557:",i),!1}}chessGameService;constructor(e){this.chessGameService=e}};var ee=class o extends H{name="XQWLight\u5F15\u64CE";priority=1;uciEngineService=E(z);chessGameService=E(P);xqwlightEngine;difficultyLevel=7;constructor(){super(),this.xqwlightEngine=new ue(this.chessGameService),this.xqwlightEngine.setDifficulty(this.difficultyLevel)}isAvailable(){return g(this,null,function*(){return!0})}makeMove(e){return g(this,null,function*(){try{console.log(`\u{1F9E0} XQWLight \u5F15\u64CE\u958B\u59CB\u5206\u6790 (\u96E3\u5EA6 ${this.difficultyLevel})...`);let t=yield this.xqwlightEngine.searchBestMove(e);return t?(console.log(`\u2705 XQWLight \u5F15\u64CE\u5206\u6790\u5B8C\u6210: \u8A55\u5206=${t.score}, \u7BC0\u9EDE=${t.nodes}, \u6642\u9593=${t.time}ms`),{from:t.from,to:t.to,score:t.score,analysis:`XQWLight \u6DF1\u5EA6${t.depth}, ${t.nodes}\u7BC0\u9EDE, ${t.time}ms, \u8A55\u5206${t.score}`}):(console.log("\u274C XQWLight \u5F15\u64CE\u672A\u627E\u5230\u6709\u6548\u79FB\u52D5"),null)}catch(t){return console.error("\u274C XQWLight \u5F15\u64CE\u8ABF\u7528\u5931\u6557:",t),null}})}getThinkingDescription(){return`\u{1F9E0} XQWLight \u5F15\u64CE\u6B63\u5728\u6DF1\u5EA6\u5206\u6790 (\u96E3\u5EA6 ${this.difficultyLevel})...`}setDifficulty(e){switch(e){case"easy":this.difficultyLevel=3;break;case"medium":this.difficultyLevel=5;break;case"hard":this.difficultyLevel=7;break}this.xqwlightEngine.setDifficulty(this.difficultyLevel),console.log(`\u{1F527} XQWLight \u5F15\u64CE\u96E3\u5EA6\u8A2D\u7F6E\u70BA: ${e} (\u7B49\u7D1A ${this.difficultyLevel})`)}static \u0275fac=function(t){return new(t||o)};static \u0275prov=S({token:o,factory:o.\u0275fac,providedIn:"root"})};var Be=["user","model","function","system"];var de=(function(o){return o.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",o.STOP="STOP",o.MAX_TOKENS="MAX_TOKENS",o.SAFETY="SAFETY",o.RECITATION="RECITATION",o.LANGUAGE="LANGUAGE",o.BLOCKLIST="BLOCKLIST",o.PROHIBITED_CONTENT="PROHIBITED_CONTENT",o.SPII="SPII",o.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",o.OTHER="OTHER",o})(de||{});var M=class extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}},U=class extends M{constructor(e,t){super(e),this.response=t}},fe=class extends M{constructor(e,t,i,n){super(e),this.status=t,this.statusText=i,this.errorDetails=n}},G=class extends M{},me=class extends M{};var lt="https://generativelanguage.googleapis.com",ct="v1beta",ut="0.24.1",dt="genai-js",Q=(function(o){return o.GENERATE_CONTENT="generateContent",o.STREAM_GENERATE_CONTENT="streamGenerateContent",o.COUNT_TOKENS="countTokens",o.EMBED_CONTENT="embedContent",o.BATCH_EMBED_CONTENTS="batchEmbedContents",o})(Q||{}),De=class{constructor(e,t,i,n,s){this.model=e,this.task=t,this.apiKey=i,this.stream=n,this.requestOptions=s}toString(){var e,t;let i=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||ct,s=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||lt}/${i}/${this.model}:${this.task}`;return this.stream&&(s+="?alt=sse"),s}};function ht(o){let e=[];return o?.apiClient&&e.push(o.apiClient),e.push(`${dt}/${ut}`),e.join(" ")}function ft(o){return g(this,null,function*(){var e;let t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",ht(o.requestOptions)),t.append("x-goog-api-key",o.apiKey);let i=(e=o.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(i){if(!(i instanceof Headers))try{i=new Headers(i)}catch(n){throw new G(`unable to convert customHeaders value ${JSON.stringify(i)} to Headers: ${n.message}`)}for(let[n,s]of i.entries()){if(n==="x-goog-api-key")throw new G(`Cannot set reserved header name ${n}`);if(n==="x-goog-api-client")throw new G(`Header name ${n} can only be set using the apiClient field`);t.append(n,s)}}return t})}function mt(o,e,t,i,n,s){return g(this,null,function*(){let r=new De(o,e,t,i,s);return{url:r.toString(),fetchOptions:Object.assign(Object.assign({},yt(s)),{method:"POST",headers:yield ft(r),body:n})}})}function ne(a,l,c,u,m){return g(this,arguments,function*(o,e,t,i,n,s={},r=fetch){let{url:v,fetchOptions:y}=yield mt(o,e,t,i,n,s);return gt(v,y,r)})}function gt(i,n){return g(this,arguments,function*(o,e,t=fetch){let s;try{s=yield t(o,e)}catch(r){pt(r,o)}return s.ok||(yield vt(s,o)),s})}function pt(o,e){let t=o;throw t.name==="AbortError"?(t=new me(`Request aborted when fetching ${e.toString()}: ${o.message}`),t.stack=o.stack):o instanceof fe||o instanceof G||(t=new M(`Error fetching from ${e.toString()}: ${o.message}`),t.stack=o.stack),t}function vt(o,e){return g(this,null,function*(){let t="",i;try{let n=yield o.json();t=n.error.message,n.error.details&&(t+=` ${JSON.stringify(n.error.details)}`,i=n.error.details)}catch{}throw new fe(`Error fetching from ${e.toString()}: [${o.status} ${o.statusText}] ${t}`,o.status,o.statusText,i)})}function yt(o){let e={};if(o?.signal!==void 0||o?.timeout>=0){let t=new AbortController;o?.timeout>=0&&setTimeout(()=>t.abort(),o.timeout),o?.signal&&o.signal.addEventListener("abort",()=>{t.abort()}),e.signal=t.signal}return e}function Me(o){return o.text=()=>{if(o.candidates&&o.candidates.length>0){if(o.candidates.length>1&&console.warn(`This response had ${o.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),he(o.candidates[0]))throw new U(`${K(o)}`,o);return _t(o)}else if(o.promptFeedback)throw new U(`Text not available. ${K(o)}`,o);return""},o.functionCall=()=>{if(o.candidates&&o.candidates.length>0){if(o.candidates.length>1&&console.warn(`This response had ${o.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),he(o.candidates[0]))throw new U(`${K(o)}`,o);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),$e(o)[0]}else if(o.promptFeedback)throw new U(`Function call not available. ${K(o)}`,o)},o.functionCalls=()=>{if(o.candidates&&o.candidates.length>0){if(o.candidates.length>1&&console.warn(`This response had ${o.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),he(o.candidates[0]))throw new U(`${K(o)}`,o);return $e(o)}else if(o.promptFeedback)throw new U(`Function call not available. ${K(o)}`,o)},o}function _t(o){var e,t,i,n;let s=[];if(!((t=(e=o.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(let r of(n=(i=o.candidates)===null||i===void 0?void 0:i[0].content)===null||n===void 0?void 0:n.parts)r.text&&s.push(r.text),r.executableCode&&s.push("\n```"+r.executableCode.language+`
`+r.executableCode.code+"\n```\n"),r.codeExecutionResult&&s.push("\n```\n"+r.codeExecutionResult.output+"\n```\n");return s.length>0?s.join(""):""}function $e(o){var e,t,i,n;let s=[];if(!((t=(e=o.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(let r of(n=(i=o.candidates)===null||i===void 0?void 0:i[0].content)===null||n===void 0?void 0:n.parts)r.functionCall&&s.push(r.functionCall);if(s.length>0)return s}var Ct=[de.RECITATION,de.SAFETY,de.LANGUAGE];function he(o){return!!o.finishReason&&Ct.includes(o.finishReason)}function K(o){var e,t,i;let n="";if((!o.candidates||o.candidates.length===0)&&o.promptFeedback)n+="Response was blocked",!((e=o.promptFeedback)===null||e===void 0)&&e.blockReason&&(n+=` due to ${o.promptFeedback.blockReason}`),!((t=o.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(n+=`: ${o.promptFeedback.blockReasonMessage}`);else if(!((i=o.candidates)===null||i===void 0)&&i[0]){let s=o.candidates[0];he(s)&&(n+=`Candidate was blocked due to ${s.finishReason}`,s.finishMessage&&(n+=`: ${s.finishMessage}`))}return n}function te(o){return this instanceof te?(this.v=o,this):new te(o)}function bt(o,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(o,e||[]),n,s=[];return n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n;function r(v){i[v]&&(n[v]=function(y){return new Promise(function(D,O){s.push([v,y,D,O])>1||a(v,y)})})}function a(v,y){try{l(i[v](y))}catch(D){m(s[0][3],D)}}function l(v){v.value instanceof te?Promise.resolve(v.value.v).then(c,u):m(s[0][2],v)}function c(v){a("next",v)}function u(v){a("throw",v)}function m(v,y){v(y),s.shift(),s.length&&a(s[0][0],s[0][1])}}var He=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function Et(o){let e=o.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=Dt(e),[i,n]=t.tee();return{stream:At(i),response:xt(n)}}function xt(o){return g(this,null,function*(){let e=[],t=o.getReader();for(;;){let{done:i,value:n}=yield t.read();if(i)return Me(It(e));e.push(n)}})}function At(o){return bt(this,arguments,function*(){let t=o.getReader();for(;;){let{value:i,done:n}=yield te(t.read());if(n)break;yield yield te(Me(i))}})}function Dt(o){let e=o.getReader();return new ReadableStream({start(i){let n="";return s();function s(){return e.read().then(({value:r,done:a})=>{if(a){if(n.trim()){i.error(new M("Failed to parse stream"));return}i.close();return}n+=r;let l=n.match(He),c;for(;l;){try{c=JSON.parse(l[1])}catch{i.error(new M(`Error parsing JSON response: "${l[1]}"`));return}i.enqueue(c),n=n.substring(l[0].length),l=n.match(He)}return s()}).catch(r=>{let a=r;throw a.stack=r.stack,a.name==="AbortError"?a=new me("Request aborted when reading from the stream"):a=new M("Error reading from the stream"),a})}}})}function It(o){let e=o[o.length-1],t={promptFeedback:e?.promptFeedback};for(let i of o){if(i.candidates){let n=0;for(let s of i.candidates)if(t.candidates||(t.candidates=[]),t.candidates[n]||(t.candidates[n]={index:n}),t.candidates[n].citationMetadata=s.citationMetadata,t.candidates[n].groundingMetadata=s.groundingMetadata,t.candidates[n].finishReason=s.finishReason,t.candidates[n].finishMessage=s.finishMessage,t.candidates[n].safetyRatings=s.safetyRatings,s.content&&s.content.parts){t.candidates[n].content||(t.candidates[n].content={role:s.content.role||"user",parts:[]});let r={};for(let a of s.content.parts)a.text&&(r.text=a.text),a.functionCall&&(r.functionCall=a.functionCall),a.executableCode&&(r.executableCode=a.executableCode),a.codeExecutionResult&&(r.codeExecutionResult=a.codeExecutionResult),Object.keys(r).length===0&&(r.text=""),t.candidates[n].content.parts.push(r)}n++}i.usageMetadata&&(t.usageMetadata=i.usageMetadata)}return t}function qe(o,e,t,i){return g(this,null,function*(){let n=yield ne(e,Q.STREAM_GENERATE_CONTENT,o,!0,JSON.stringify(t),i);return Et(n)})}function Ye(o,e,t,i){return g(this,null,function*(){let s=yield(yield ne(e,Q.GENERATE_CONTENT,o,!1,JSON.stringify(t),i)).json();return{response:Me(s)}})}function ze(o){if(o!=null){if(typeof o=="string")return{role:"system",parts:[{text:o}]};if(o.text)return{role:"system",parts:[o]};if(o.parts)return o.role?o:{role:"system",parts:o.parts}}}function ie(o){let e=[];if(typeof o=="string")e=[{text:o}];else for(let t of o)typeof t=="string"?e.push({text:t}):e.push(t);return Mt(e)}function Mt(o){let e={role:"user",parts:[]},t={role:"function",parts:[]},i=!1,n=!1;for(let s of o)"functionResponse"in s?(t.parts.push(s),n=!0):(e.parts.push(s),i=!0);if(i&&n)throw new M("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!i&&!n)throw new M("No content is provided for sending chat message.");return i?e:t}function St(o,e){var t;let i={model:e?.model,generationConfig:e?.generationConfig,safetySettings:e?.safetySettings,tools:e?.tools,toolConfig:e?.toolConfig,systemInstruction:e?.systemInstruction,cachedContent:(t=e?.cachedContent)===null||t===void 0?void 0:t.name,contents:[]},n=o.generateContentRequest!=null;if(o.contents){if(n)throw new G("CountTokensRequest must have one of contents or generateContentRequest, not both.");i.contents=o.contents}else if(n)i=Object.assign(Object.assign({},i),o.generateContentRequest);else{let s=ie(o);i.contents=[s]}return{generateContentRequest:i}}function je(o){let e;return o.contents?e=o:e={contents:[ie(o)]},o.systemInstruction&&(e.systemInstruction=ze(o.systemInstruction)),e}function wt(o){return typeof o=="string"||Array.isArray(o)?{content:ie(o)}:o}var Ue=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],Pt={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function Vt(o){let e=!1;for(let t of o){let{role:i,parts:n}=t;if(!e&&i!=="user")throw new M(`First content should be with role 'user', got ${i}`);if(!Be.includes(i))throw new M(`Each item should include role field. Got ${i} but valid roles are: ${JSON.stringify(Be)}`);if(!Array.isArray(n))throw new M("Content should have 'parts' property with an array of Parts");if(n.length===0)throw new M("Each Content should have at least one part");let s={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let a of n)for(let l of Ue)l in a&&(s[l]+=1);let r=Pt[i];for(let a of Ue)if(!r.includes(a)&&s[a]>0)throw new M(`Content with role '${i}' can't contain '${a}' part`);e=!0}}function Ke(o){var e;if(o.candidates===void 0||o.candidates.length===0)return!1;let t=(e=o.candidates[0])===null||e===void 0?void 0:e.content;if(t===void 0||t.parts===void 0||t.parts.length===0)return!1;for(let i of t.parts)if(i===void 0||Object.keys(i).length===0||i.text!==void 0&&i.text==="")return!1;return!0}var We="SILENT_ERROR",Ie=class{constructor(e,t,i,n={}){this.model=t,this.params=i,this._requestOptions=n,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,i?.history&&(Vt(i.history),this._history=i.history)}getHistory(){return g(this,null,function*(){return yield this._sendPromise,this._history})}sendMessage(i){return g(this,arguments,function*(e,t={}){var n,s,r,a,l,c;yield this._sendPromise;let u=ie(e),m={safetySettings:(n=this.params)===null||n===void 0?void 0:n.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(r=this.params)===null||r===void 0?void 0:r.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,u]},v=Object.assign(Object.assign({},this._requestOptions),t),y;return this._sendPromise=this._sendPromise.then(()=>Ye(this._apiKey,this.model,m,v)).then(D=>{var O;if(Ke(D.response)){this._history.push(u);let re=Object.assign({parts:[],role:"model"},(O=D.response.candidates)===null||O===void 0?void 0:O[0].content);this._history.push(re)}else{let re=K(D.response);re&&console.warn(`sendMessage() was unsuccessful. ${re}. Inspect response object for details.`)}y=D}).catch(D=>{throw this._sendPromise=Promise.resolve(),D}),yield this._sendPromise,y})}sendMessageStream(i){return g(this,arguments,function*(e,t={}){var n,s,r,a,l,c;yield this._sendPromise;let u=ie(e),m={safetySettings:(n=this.params)===null||n===void 0?void 0:n.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(r=this.params)===null||r===void 0?void 0:r.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,u]},v=Object.assign(Object.assign({},this._requestOptions),t),y=qe(this._apiKey,this.model,m,v);return this._sendPromise=this._sendPromise.then(()=>y).catch(D=>{throw new Error(We)}).then(D=>D.response).then(D=>{if(Ke(D)){this._history.push(u);let O=Object.assign({},D.candidates[0].content);O.role||(O.role="model"),this._history.push(O)}else{let O=K(D);O&&console.warn(`sendMessageStream() was unsuccessful. ${O}. Inspect response object for details.`)}}).catch(D=>{D.message!==We&&console.error(D)}),y})}};function Ot(o,e,t,i){return g(this,null,function*(){return(yield ne(e,Q.COUNT_TOKENS,o,!1,JSON.stringify(t),i)).json()})}function Rt(o,e,t,i){return g(this,null,function*(){return(yield ne(e,Q.EMBED_CONTENT,o,!1,JSON.stringify(t),i)).json()})}function Nt(o,e,t,i){return g(this,null,function*(){let n=t.requests.map(r=>Object.assign(Object.assign({},r),{model:e}));return(yield ne(e,Q.BATCH_EMBED_CONTENTS,o,!1,JSON.stringify({requests:n}),i)).json()})}var ge=class{constructor(e,t,i={}){this.apiKey=e,this._requestOptions=i,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=ze(t.systemInstruction),this.cachedContent=t.cachedContent}generateContent(i){return g(this,arguments,function*(e,t={}){var n;let s=je(e),r=Object.assign(Object.assign({},this._requestOptions),t);return Ye(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},s),r)})}generateContentStream(i){return g(this,arguments,function*(e,t={}){var n;let s=je(e),r=Object.assign(Object.assign({},this._requestOptions),t);return qe(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},s),r)})}startChat(e){var t;return new Ie(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},e),this._requestOptions)}countTokens(i){return g(this,arguments,function*(e,t={}){let n=St(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),t);return Ot(this.apiKey,this.model,n,s)})}embedContent(i){return g(this,arguments,function*(e,t={}){let n=wt(e),s=Object.assign(Object.assign({},this._requestOptions),t);return Rt(this.apiKey,this.model,n,s)})}batchEmbedContents(i){return g(this,arguments,function*(e,t={}){let n=Object.assign(Object.assign({},this._requestOptions),t);return Nt(this.apiKey,this.model,e,n)})}};var pe=class{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new M("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new ge(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,i){if(!e.name)throw new G("Cached content must contain a `name` field.");if(!e.model)throw new G("Cached content must contain a `model` field.");let n=["model","systemInstruction"];for(let r of n)if(t?.[r]&&e[r]&&t?.[r]!==e[r]){if(r==="model"){let a=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,l=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(a===l)continue}throw new G(`Different value for "${r}" specified in modelParams (${t[r]}) and cachedContent (${e[r]})`)}let s=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new ge(this.apiKey,s,i)}};var oe=class o extends H{name="Gemini AI";priority=2;chessGameService=E(P);isAvailable(){return g(this,null,function*(){let e=typeof localStorage<"u"?localStorage.getItem("gemini-api-key"):null;return!!(e&&e!=="YOUR_GEMINI_API_KEY_HERE")})}makeMove(e){return g(this,null,function*(){try{let i=typeof localStorage<"u"?localStorage.getItem("gemini-api-key"):null;if(!i||i==="YOUR_GEMINI_API_KEY_HERE")return console.log("\u274C Gemini API Key \u672A\u8A2D\u7F6E\uFF0C\u8ACB\u5728\u8A2D\u5B9A\u4E2D\u8F38\u5165 API Key"),null;console.log("\u{1F511} \u4F7F\u7528 API Key:",i?`${i.substring(0,8)}...${i.substring(i.length-4)}`:"\u7121");let s=new pe(i).getGenerativeModel({model:"gemini-2.5-pro"});console.log("\u{1F4E1} \u6E96\u5099\u547C\u53EB Gemini API...");let r=this.createGeminiPrompt(e);console.log("\u{1F680} \u6B63\u5728\u547C\u53EB Gemini API...");let a=yield s.generateContent(r);console.log("\u2705 Gemini API \u547C\u53EB\u6210\u529F\uFF01");let c=(yield a.response).text();if(console.log("\u{1F4DD} Gemini \u56DE\u61C9\u9577\u5EA6:",c?.length||0),!c)return console.log("\u274C Gemini \u6C92\u6709\u8FD4\u56DE\u6709\u6548\u56DE\u61C9"),null;let u=c.match(/\{[\s\S]*\}/);if(u){let m=JSON.parse(u[0]);console.log("\u{1F916} Gemini \u5206\u6790:",m.analysis),console.log("\u{1F916} \u9078\u64C7\u7406\u7531:",m.reasoning);let v=this.getAllPossibleMoves(e,"black",this.chessGameService),y=m.move;if(this.isValidMove(y,v))return{from:y.from,to:y.to,analysis:`${m.analysis} - ${m.reasoning}`};console.log("\u274C Gemini \u63D0\u4F9B\u7684\u79FB\u52D5\u7121\u6548")}}catch(t){console.error("\u274C Gemini API \u8ABF\u7528\u5931\u6557:",t)}return null})}getThinkingDescription(){return"\u{1F916} Gemini AI \u6B63\u5728\u5206\u6790\u68CB\u5C40..."}createGeminiPrompt(e){let t=this.describeBoardState(e),i=this.getAllPossibleMoves(e,"black",this.chessGameService),n=this.describeValidMoves(i);return`
You are a professional Chinese Chess AI. Please analyze the current board state and choose the best move.

Board state (RED at bottom, BLACK at top, coordinates start from 0,0):
${t}

Available moves:
${n}

Please analyze the position and choose the best move. Response must be in JSON format:
{
  "analysis": "Your analysis process",
  "move": {
    "from": {"x": start_x_coordinate, "y": start_y_coordinate},
    "to": {"x": target_x_coordinate, "y": target_y_coordinate}
  },
  "reasoning": "Reason for choosing this move"
}

Important notes:
1. You are BLACK player, choose moves that benefit BLACK
2. Coordinate system: x is column (0-8), y is row (0-9)
3. You can only choose from the provided available moves
4. Priority: capturing, checking, position improvement, defense
5. You have maximum 10 seconds thinking time
6. Please respond in Traditional Chinese
`}describeBoardState(e){let t="";for(let i=0;i<10;i++){let n=`Row ${i}: `;for(let s=0;s<9;s++){let r=e.board[i][s];if(r){let a=r.color==="red"?"RED":"BLACK";n+=`(${s},${i}):${a}_${r.type} `}}t+=n+`
`}return t}describeValidMoves(e){return e.map((t,i)=>`${i+1}. Move from (${t.from.x},${t.from.y}) to (${t.to.x},${t.to.y})`).join(`
`)}static \u0275fac=(()=>{let e;return function(i){return(e||(e=J(o)))(i||o)}})();static \u0275prov=S({token:o,factory:o.\u0275fac,providedIn:"root"})};var se=class o extends H{name="Minimax\u7B97\u6CD5";priority=3;chessGameService=E(P);maxDepth=4;searchTime=3e3;startTime=0;nodes=0;isAvailable(){return g(this,null,function*(){return!0})}makeMove(e){return g(this,null,function*(){console.log(`\u{1F9E0} \u4F7F\u7528 Minimax \u7B97\u6CD5 (\u6DF1\u5EA6${this.maxDepth}\u5C64)...`);let t=Date.now();this.startTime=t,this.nodes=0;try{let i=this.minimax(e,this.maxDepth,-1/0,1/0,!0),n=Date.now()-t;return console.log(`\u{1F3AF} Minimax \u6C7A\u7B56\u5B8C\u6210: ${n}ms, \u641C\u7D22${this.nodes}\u500B\u7BC0\u9EDE`),i&&i.move?(console.log(`\u{1F916} \u9078\u64C7\u79FB\u52D5: (${i.move.from.x},${i.move.from.y}) -> (${i.move.to.x},${i.move.to.y}), \u8A55\u5206: ${i.score}`),{from:i.move.from,to:i.move.to,score:i.score,analysis:`Minimax \u6DF1\u5EA6 ${this.maxDepth}, \u641C\u7D22 ${this.nodes} \u7BC0\u9EDE, \u8A55\u5206 ${i.score}`}):null}catch(i){return console.error("\u274C Minimax \u7B56\u7565\u57F7\u884C\u5931\u6557:",i),null}})}getThinkingDescription(){return`\u{1F9E0} Minimax \u7B97\u6CD5\u6B63\u5728\u6DF1\u5EA6\u5206\u6790 (${this.maxDepth}\u5C64)...`}setDifficulty(e){switch(e){case"easy":this.maxDepth=2,this.searchTime=1e3;break;case"medium":this.maxDepth=4,this.searchTime=3e3;break;case"hard":this.maxDepth=6,this.searchTime=5e3;break}}minimax(e,t,i,n,s){if(this.nodes++,Date.now()-this.startTime>this.searchTime)return null;if(t===0)return{move:{from:{x:0,y:0},to:{x:0,y:0}},score:this.evaluatePosition(e)};let r=s?"black":"red",a=this.getAllPossibleMoves(e,r,this.chessGameService);if(a.length===0)return this.chessGameService.isInCheck(e.board,r)?{move:{from:{x:0,y:0},to:{x:0,y:0}},score:s?-1e4:1e4}:{move:{from:{x:0,y:0},to:{x:0,y:0}},score:0};let l=this.orderMoves(e,a),c=null;if(s){let u=-1/0;for(let m of l){let v=this.simulateMove(e,m.from,m.to);if(this.chessGameService.isInCheck(v.board,"black"))continue;let y=this.minimax(v,t-1,i,n,!1);if(y&&y.score>u&&(u=y.score,c=m),i=Math.max(i,u),n<=i)break}return c?{move:c,score:u}:null}else{let u=1/0;for(let m of l){let v=this.simulateMove(e,m.from,m.to);if(this.chessGameService.isInCheck(v.board,"red"))continue;let y=this.minimax(v,t-1,i,n,!0);if(y&&y.score<u&&(u=y.score,c=m),n=Math.min(n,u),n<=i)break}return c?{move:c,score:u}:null}}orderMoves(e,t){return t.sort((i,n)=>{let s=0,r=0,a=e.board[i.to.y][i.to.x],l=e.board[n.to.y][n.to.x];a&&(s+=j[a.type]),l&&(r+=j[l.type]);let c=this.simulateMove(e,i.from,i.to),u=this.simulateMove(e,n.from,n.to);return this.chessGameService.isInCheck(c.board,"red")&&(s+=100),this.chessGameService.isInCheck(u.board,"red")&&(r+=100),r-s})}evaluatePosition(e){let t=0;for(let s=0;s<10;s++)for(let r=0;r<9;r++){let a=e.board[s][r];if(!a)continue;let l=j[a.type];l+=Le(a.type,r,s,a.color),a.color==="black"?t+=l:t-=l}let i=this.getAllPossibleMoves(e,"black",this.chessGameService).length,n=this.getAllPossibleMoves(e,"red",this.chessGameService).length;return t+=(i-n)*5,this.chessGameService.isInCheck(e.board,"black")&&(t-=100),this.chessGameService.isInCheck(e.board,"red")&&(t+=100),t}simulateMove(e,t,i){let n=e.board.map((s,r)=>r===t.y||r===i.y?s.map((a,l)=>{if(l===t.x&&r===t.y||l===i.x&&r===i.y){if(l===t.x&&r===t.y)return null;if(l===i.x&&r===i.y){let c=e.board[t.y][t.x];return c?b(_({},c),{position:{x:i.x,y:i.y},hasMoved:!0,isSelected:!1}):null}}return a}):s);return b(_({},e),{board:n})}static \u0275fac=(()=>{let e;return function(i){return(e||(e=J(o)))(i||o)}})();static \u0275prov=S({token:o,factory:o.\u0275fac,providedIn:"root"})};var ve=class o{chessGameService=E(P);uciStrategy=E(ee);geminiStrategy=E(oe);minimaxStrategy=E(se);strategies=[];enabledStrategies={uci:!0,gemini:!1,minimax:!1};constructor(){this.initializeStrategies()}initializeStrategies(){this.strategies=[this.uciStrategy,this.geminiStrategy,this.minimaxStrategy]}executeAIMove(e){return g(this,null,function*(){console.log("\u{1F9E0} AI\u958B\u59CB\u601D\u8003...");let t=Date.now();try{let i=this.getEnabledStrategiesList().sort((s,r)=>s.priority-r.priority);for(let s of i){if(console.log(`\u{1F3AF} \u5617\u8A66\u7B56\u7565: ${s.name}`),!(yield s.isAvailable())){console.log(`\u26A0\uFE0F \u7B56\u7565 ${s.name} \u4E0D\u53EF\u7528\uFF0C\u5617\u8A66\u4E0B\u4E00\u500B...`);continue}let a=yield s.makeMove(e);if(a){let l=Date.now()-t;return console.log(`\u2705 \u7B56\u7565 ${s.name} \u6C7A\u7B56\u6210\u529F: ${l}ms`),console.log(`\u{1F3C6} \u9078\u64C7\u79FB\u52D5: (${a.from.x},${a.from.y}) -> (${a.to.x},${a.to.y})`),a.analysis&&console.log(`\u{1F4CA} \u5206\u6790: ${a.analysis}`),{from:a.from,to:a.to}}console.log(`\u274C \u7B56\u7565 ${s.name} \u672A\u80FD\u63D0\u4F9B\u6709\u6548\u79FB\u52D5`)}console.log("\u{1F3B2} \u4F7F\u7528\u96A8\u6A5F\u79FB\u52D5\u4F5C\u70BA\u6700\u5F8C\u5099\u6848...");let n=this.getAllPossibleMoves(e,"black");return n.length>0?n[Math.floor(Math.random()*n.length)]:null}catch(i){console.error("\u{1F916} AI\u601D\u8003\u51FA\u932F:",i);let n=this.getAllPossibleMoves(e,"black");return n.length>0?n[0]:null}})}getEnabledStrategiesList(){return this.strategies.filter(e=>e instanceof ee?this.enabledStrategies.uci:e instanceof oe?this.enabledStrategies.gemini:e instanceof se?this.enabledStrategies.minimax:!1)}getAllPossibleMoves(e,t){let i=[],n=e.board;for(let s=0;s<10;s++)for(let r=0;r<9;r++){let a=n[s][r];if(a&&a.color===t){let l=this.chessGameService.getPossibleMoves(a,n);for(let c of l)i.push({from:a.position,to:c})}}return i}setUCIEngineEnabled(e){this.enabledStrategies.uci=e,console.log(`\u{1F527} UCI \u5F15\u64CE\u7B56\u7565: ${e?"\u555F\u7528":"\u505C\u7528"}`)}setGeminiEnabled(e){this.enabledStrategies.gemini=e,console.log(`\u{1F916} Gemini AI \u7B56\u7565: ${e?"\u555F\u7528":"\u505C\u7528"}`)}setMinimaxEnabled(e){this.enabledStrategies.minimax=e,console.log(`\u{1F9E0} Minimax \u7B56\u7565: ${e?"\u555F\u7528":"\u505C\u7528"}`)}setAIMode(e){switch(e){case"uci-only":this.enabledStrategies={uci:!0,gemini:!1,minimax:!1},console.log("\u{1F3C6} AI \u6A21\u5F0F: \u50C5\u4F7F\u7528 UCI \u5F15\u64CE");break;case"gemini-only":this.enabledStrategies={uci:!1,gemini:!0,minimax:!1},console.log("\u{1F916} AI \u6A21\u5F0F: \u50C5\u4F7F\u7528 Gemini AI");break;case"minimax-only":this.enabledStrategies={uci:!1,gemini:!1,minimax:!0},console.log("\u{1F9E0} AI \u6A21\u5F0F: \u50C5\u4F7F\u7528 Minimax \u7B97\u6CD5");break;case"mixed":this.enabledStrategies={uci:!0,gemini:!0,minimax:!0},console.log("\u{1F500} AI \u6A21\u5F0F: \u6DF7\u5408\u6A21\u5F0F (UCI \u2192 Gemini \u2192 Minimax)");break;case"auto":default:this.enabledStrategies={uci:!0,gemini:!1,minimax:!1},console.log("\u26A1 AI \u6A21\u5F0F: \u81EA\u52D5 (\u512A\u5148 UCI \u5F15\u64CE)");break}}setDifficulty(e){this.uciStrategy.setDifficulty(e),this.minimaxStrategy.setDifficulty(e),console.log(`\u{1F3AF} \u6240\u6709 AI \u7B56\u7565\u96E3\u5EA6\u8A2D\u7F6E\u70BA: ${e}`)}setMinimaxDifficulty(e){this.minimaxStrategy.setDifficulty(e)}getThinkingDescription(){return this.getEnabledStrategiesList().sort((i,n)=>i.priority-n.priority)[0]?.getThinkingDescription()||"\u{1F3B2} AI\u6B63\u5728\u9078\u64C7\u79FB\u52D5..."}getStrategyStatus(){return _({},this.enabledStrategies)}static \u0275fac=function(t){return new(t||o)};static \u0275prov=S({token:o,factory:o.\u0275fac,providedIn:"root"})};var ye=class o{uciEngineService=E(z);strategyManager=E(ve);makeAIMove(e){return g(this,null,function*(){return this.strategyManager.executeAIMove(e)})}setUseUCIEngine(e){this.strategyManager.setUCIEngineEnabled(e)}setUseGeminiAI(e){this.strategyManager.setGeminiEnabled(e)}setUseLegacyMinimax(e){this.strategyManager.setMinimaxEnabled(e)}setAIMode(e){this.strategyManager.setAIMode(e)}initializeAI(e="Pikafish"){return g(this,null,function*(){console.log(`\u{1F680} \u521D\u59CB\u5316 AI \u7CFB\u7D71\uFF0C\u4F7F\u7528\u5F15\u64CE: ${e}`);try{let t=yield this.uciEngineService.initializeEngine(e);return t&&(console.log("\u2705 AI \u7CFB\u7D71\u521D\u59CB\u5316\u5B8C\u6210"),this.setAIMode("auto")),t}catch(t){return console.error("\u274C AI \u7CFB\u7D71\u521D\u59CB\u5316\u5931\u6557:",t),!1}})}getAIStatus(){let e=this.strategyManager.getStrategyStatus();return{uciEngine:e.uci,geminiAI:e.gemini,legacyMinimax:e.minimax,currentEngine:this.uciEngineService.currentEngineName,engineReady:this.uciEngineService.getEngineInfo()?.isReady||!1}}setDifficulty(e){this.strategyManager.setDifficulty(e)}getThinkingDescription(){return this.strategyManager.getThinkingDescription()}getDetailedThinkingStatus(){let e=this.getAIStatus(),t="unknown",i="";return e.uciEngine?(t="uci",i=`${e.currentEngine||"UCI\u5F15\u64CE"} \u5206\u6790\u4E2D...`):e.geminiAI?(t="gemini",i="Gemini AI \u601D\u8003\u4E2D..."):e.legacyMinimax?(t="minimax",i="Minimax \u7B97\u6CD5\u8A08\u7B97\u4E2D..."):(t="random",i="\u96A8\u6A5F\u9078\u64C7\u4E2D..."),{description:i,mode:t,engine:e.currentEngine||void 0,isThinking:!0}}static \u0275fac=function(t){return new(t||o)};static \u0275prov=S({token:o,factory:o.\u0275fac,providedIn:"root"})};var Tt=()=>[0,1,2,3,4,5,6,7,8,9],kt=()=>[0,1,2,3,4,5,6,7,8],Xe=o=>({"valid-move-point":o});function Ft(o,e){o&1&&(f(0,"div",8),p(1," \u5C07\u8ECD\uFF01 "),d())}function Gt(o,e){o&1&&(f(0,"div",9),p(1,"\u88AB\u5C07\u8ECD\uFF01"),d())}function Lt(o,e){if(o&1){let t=le();f(0,"div",11)(1,"div",50)(2,"span",51),p(3,"\u26A1 UCI \u5F15\u64CE\u96E3\u5EA6:"),d(),f(4,"button",52),k("click",function(){W(t);let n=C();return q(n.setAIDifficulty("easy"))}),p(5," \u7C21\u55AE "),d(),f(6,"button",52),k("click",function(){W(t);let n=C();return q(n.setAIDifficulty("medium"))}),p(7," \u4E2D\u7B49 "),d(),f(8,"button",52),k("click",function(){W(t);let n=C();return q(n.setAIDifficulty("hard"))}),p(9," \u56F0\u96E3 "),d()()()}if(o&2){let t=C();h(4),T("ngClass",t.aiDifficulty()==="easy"?"bg-green-600 text-white":"bg-neutral-700 text-neutral-300 hover:bg-neutral-600"),h(2),T("ngClass",t.aiDifficulty()==="medium"?"bg-yellow-600 text-white":"bg-neutral-700 text-neutral-300 hover:bg-neutral-600"),h(2),T("ngClass",t.aiDifficulty()==="hard"?"bg-red-600 text-white":"bg-neutral-700 text-neutral-300 hover:bg-neutral-600")}}function Bt(o,e){o&1&&(f(0,"span"),p(1,"\u{1F916}"),d())}function $t(o,e){if(o&1&&p(0),o&2){let t=C();V(" ",t.moveHistory()[t.moveHistory().length-1]," ")}}function Ht(o,e){o&1&&p(0," \uFF1F\uFF1F ")}function jt(o,e){o&1&&p(0," AI \u601D\u8003\u4E2D... ")}function Ut(o,e){if(o&1&&(f(0,"div",29),p(1),d()),o&2){let t=e.$implicit;h(),V(" ",t," ")}}function Kt(o,e){if(o&1&&(f(0,"div",32),p(1),d()),o&2){let t=e.$implicit;h(),V(" ",t," ")}}function Wt(o,e){if(o&1&&w(0,"div",53)(1,"div",54),o&2){let t=e.$implicit;Z(t===6?"z-20 h-[1.5px]":"z-10"),L("top",t*40+4,"px"),T("ngClass","sm:hidden"),h(),Z(t===6?"z-20 h-[1.5px]":"z-10"),L("top",t*50+4,"px")}}function qt(o,e){if(o&1&&w(0,"div",55)(1,"div",55)(2,"div",56)(3,"div",56),o&2){let t=e.$implicit;L("left",t*36+14,"px")("top",4,"px")("height",157,"px"),h(),L("left",t*36+14,"px")("top",203,"px")("height",162,"px"),h(),L("left",t*50+4,"px")("top",4,"px")("height",200,"px"),h(),L("left",t*50+4,"px")("top",254,"px")("height",200,"px")}}function Yt(o,e){o&1&&w(0,"div",58)}function zt(o,e){o&1&&w(0,"div",58)}function Xt(o,e){if(o&1&&(f(0,"div",59)(1,"div",66),p(2),d()()),o&2){let t=C().$implicit,i=C(2);T("ngClass",i.getPieceClass(t)),h(),Z(t.color===i.PlayerColor.RED?"bg-red-100 border-red-600 text-red-800":"bg-neutral-100 border-neutral-800 text-neutral-800"),h(),V(" ",i.getPieceSymbol(t)," ")}}function Qt(o,e){o&1&&w(0,"div",60)}function Jt(o,e){o&1&&w(0,"div",61)}function Zt(o,e){o&1&&w(0,"div",58)}function ei(o,e){o&1&&w(0,"div",58)}function ti(o,e){if(o&1&&(f(0,"div",63)(1,"div",67),p(2),d()()),o&2){let t=C().$implicit,i=C(2);T("ngClass",i.getPieceClass(t)),h(),Z(t.color===i.PlayerColor.RED?"bg-red-100 border-red-600 text-red-800":"bg-neutral-100 border-neutral-800 text-neutral-800"),h(),V(" ",i.getPieceSymbol(t)," ")}}function ii(o,e){o&1&&w(0,"div",64)}function ni(o,e){o&1&&w(0,"div",65)}function oi(o,e){if(o&1){let t=le();f(0,"div",57),k("click",function(){let n=W(t).$index,s=C().$index,r=C();return q(r.onSquareClick(n,s))}),x(1,Yt,1,0,"div",58),x(2,zt,1,0,"div",58),x(3,Xt,3,4,"div",59),x(4,Qt,1,0,"div",60),x(5,Jt,1,0,"div",61),d(),f(6,"div",62),k("click",function(){let n=W(t).$index,s=C().$index,r=C();return q(r.onSquareClick(n,s))}),x(7,Zt,1,0,"div",58),x(8,ei,1,0,"div",58),x(9,ti,3,4,"div",63),x(10,ii,1,0,"div",64),x(11,ni,1,0,"div",65),d()}if(o&2){let t=e.$implicit,i=e.$index,n=C().$index,s=C();L("top",n*40+4,"px")("left",i*36+14,"px"),T("ngClass",xe(20,Xe,s.isValidMove(i,n))),h(),A((n===2||n===7)&&(i===0||i===2||i===4||i===6||i===8)?1:-1),h(),A((n===3||n===6)&&(i===1||i===7)?2:-1),h(),A(t?3:-1),h(),A(s.isValidMove(i,n)&&!t?4:-1),h(),A(s.isValidMove(i,n)&&t&&t.color!==s.currentPlayer()?5:-1),h(),L("top",n*50+4,"px")("left",i*50+4,"px"),T("ngClass",xe(22,Xe,s.isValidMove(i,n))),h(),A((n===2||n===7)&&(i===0||i===2||i===4||i===6||i===8)?7:-1),h(),A((n===3||n===6)&&(i===1||i===7)?8:-1),h(),A(t?9:-1),h(),A(s.isValidMove(i,n)&&!t?10:-1),h(),A(s.isValidMove(i,n)&&t&&t.color!==s.currentPlayer()?11:-1)}}function si(o,e){if(o&1&&R(0,oi,12,24,null,null,ae),o&2){let t=e.$implicit;N(t)}}function ri(o,e){if(o&1&&(f(0,"div",32),p(1),d()),o&2){let t=e.$implicit;h(),V(" ",t," ")}}function ai(o,e){if(o&1&&(f(0,"div",29),p(1),d()),o&2){let t=e.$implicit;h(),V(" ",t," ")}}function li(o,e){if(o&1){let t=le();f(0,"div",46)(1,"div",68)(2,"div",69),p(3,"\u{1F3C6}"),d(),f(4,"h2",70),p(5),d(),f(6,"button",71),k("click",function(){W(t);let n=C();return q(n.resetGame())}),p(7," \u91CD\u65B0\u958B\u59CB "),d()()()}if(o&2){let t=C();h(5),V(" ",t.winner()===t.PlayerColor.RED?"\u7D05\u65B9\u7372\u52DD\uFF01":"\u9ED1\u65B9\u7372\u52DD\uFF01"," ")}}function ci(o,e){if(o&1&&(f(0,"span",77),p(1),d()),o&2){let t=C(2).$index,i=C(2);h(),ce(i.moveHistory()[t+1])}}function ui(o,e){if(o&1&&(f(0,"div",11)(1,"span",75),p(2),d(),f(3,"span",76),p(4),d(),x(5,ci,2,1,"span",77),d()),o&2){let t=C(),i=t.$implicit,n=t.$index,s=C(2);h(2),V("",s.Math.floor(n/2)+1,"."),h(2),ce(i),h(),A(s.moveHistory()[n+1]?5:-1)}}function di(o,e){if(o&1&&x(0,ui,6,3,"div",11),o&2){let t=e.$index;A(t%2===0?0:-1)}}function hi(o,e){if(o&1&&(f(0,"section",47)(1,"h3",72),p(2,"\u68CB\u8B5C\u8A18\u9304"),d(),f(3,"div",73)(4,"div",74),R(5,di,1,1,null,null,ae),d()()()),o&2){let t=C();h(5),N(t.moveHistory())}}var Qe=class o{chessGameService=E(P);chessAIService=E(ye);apiKeyUpdateListener;gameState=B(Ae);aiType=B("local");board=I(()=>this.gameState().board);currentPlayer=I(()=>this.gameState().currentPlayer);selectedPiece=I(()=>this.gameState().selectedPiece);validMoves=I(()=>this.gameState().validMoves);gameOver=I(()=>this.gameState().gameOver);winner=I(()=>this.gameState().winner);moveHistory=I(()=>this.gameState().moveHistory);isInCheck=I(()=>this.gameState().isInCheck);isSelfInCheck=I(()=>this.gameState().isSelfInCheck);currentPlayerDisplay=I(()=>this.currentPlayer()==="red"?"\u7D05\u65B9":"\u9ED1\u65B9");isVsAI=I(()=>this.gameState().isVsAI);aiIsThinking=I(()=>this.gameState().aiIsThinking);aiThinkingText=I(()=>this.gameState().aiThinkingText);aiDifficulty=B("hard");hasApiKey=I(()=>this.chessGameService.hasApiKey());isGeminiEnabled=I(()=>this.hasApiKey()&&this.isVsAI());isApiKeyModalOpen=B(!1);isAITurn=I(()=>this.isVsAI()&&this.currentPlayer()==="black"&&!this.gameOver());canInteract=I(()=>!this.isVsAI()||this.currentPlayer()==="red");PlayerColor=F;Math=Math;ngOnInit(){this.resetGame(),this.chessGameService.updateApiKeyStatus(),this.chessAIService.setAIMode("uci-only"),typeof window<"u"&&(this.apiKeyUpdateListener=()=>{this.chessGameService.updateApiKeyStatus(),this.hasApiKey()&&this.aiType()==="local"&&this.setAIType("service")},window.addEventListener("gemini_api_key_updated",this.apiKeyUpdateListener))}ngOnDestroy(){typeof window<"u"&&this.apiKeyUpdateListener&&window.removeEventListener("gemini_api_key_updated",this.apiKeyUpdateListener)}resetGame(){let e=this.chessGameService.initializeGameState();this.gameState.set(e)}onSquareClick(e,t){if(this.gameOver()||!this.canInteract())return;let i=this.gameState(),n=i.board[t][e];i.selectedPiece?n&&n.color===i.currentPlayer&&n!==i.selectedPiece?this.selectPiece(n):this.isValidMove(e,t)?this.makeMove(i.selectedPiece.position,{x:e,y:t}):this.deselectPiece():n&&n.color===i.currentPlayer&&this.selectPiece(n)}selectPiece(e){let t=this.gameState();t.board.flat().forEach(n=>{n&&(n.isSelected=!1)}),e.isSelected=!0;let i=this.chessGameService.getPossibleMoves(e,t.board);this.gameState.set(b(_({},t),{selectedPiece:e,validMoves:i}))}deselectPiece(){let e=this.gameState();e.selectedPiece&&(e.selectedPiece.isSelected=!1),this.gameState.set(b(_({},e),{selectedPiece:null,validMoves:[]}))}isValidMove(e,t){return this.validMoves().some(i=>i.x===e&&i.y===t)}makeMove(e,t){let i=this.gameState(),n=i.board[e.y][e.x];if(!n)return;let s=this.chessGameService.makeMove(i,e,t);if(s.success){let r=this.generateMoveNotation(n,e,t,s.captured),a=[...i.moveHistory,r],l=i.currentPlayer==="red"?"black":"red",c=s.isCheck||!1,u=s.isSelfInCheck||!1,m=s.isCheckmate||s.isStalemate||s.gameOver||!1,v=s.winner||(s.isCheckmate?i.currentPlayer:null);i.board.flat().forEach(y=>{y&&(y.isSelected=!1)}),this.gameState.set(b(_({},i),{currentPlayer:l,selectedPiece:null,validMoves:[],moveHistory:a,isInCheck:c,isSelfInCheck:u,gameOver:m,winner:v})),console.log("\u6AA2\u67E5AI\u89F8\u767C\u689D\u4EF6:",{gameOver:m,isVsAI:i.isVsAI,nextPlayer:l,shouldTrigger:!m&&i.isVsAI&&l==="black"}),!m&&i.isVsAI&&l==="black"&&(console.log("\u6E96\u5099\u89F8\u767CAI\u79FB\u52D5..."),this.triggerAIMove())}}generateMoveNotation(e,t,i,n){if(!e)return"";let s=u=>{let m=["\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D","\u4E03","\u516B","\u4E5D"];return u>=1&&u<=9?m[u-1]:u.toString()},r=this.chessGameService.getPieceSymbol(e),a=e.color==="red"?9-t.x:t.x+1,l=i.y-t.y,c="";if(l===0){let u=e.color==="red"?9-i.x:i.x+1;c="\u5E73"+s(u)}else c=(e.color==="red"&&l<0||e.color==="black"&&l>0?"\u9032":"\u9000")+s(Math.abs(l));return`${r}${s(a)}${c}`}getSquareClass(e,t){let i="chess-square";return this.board()[t]?.[e]?.isSelected&&(i+=" selected"),this.isValidMove(e,t)&&(i+=" valid-move"),(this.chessGameService.isInPalace(e,t,"red")||this.chessGameService.isInPalace(e,t,"black"))&&(i+=" palace"),i}getPieceClass(e){if(!e)return"";let t=`chess-piece ${e.color}`;return e.isSelected&&(t+=" selected"),t}getPieceSymbol(e){return e?this.chessGameService.getPieceSymbol(e):""}getRowNumbers(){return Array.from({length:10},(e,t)=>10-t)}getColumnLetters(){return["a","b","c","d","e","f","g","h","i"]}toggleGameMode(){let e=this.gameState(),t=!e.isVsAI;this.gameState.set(b(_({},e),{isVsAI:t,aiIsThinking:!1})),t&&e.currentPlayer==="black"&&!e.gameOver&&this.triggerAIMove()}triggerAIMove(){return g(this,null,function*(){let e=this.gameState();console.log("\u{1F916} \u89F8\u767CAI\u79FB\u52D5\uFF0C\u7576\u524D\u73A9\u5BB6:",e.currentPlayer),this.chessAIService.setDifficulty(this.aiDifficulty()),this.gameState.set(b(_({},e),{aiIsThinking:!0,aiThinkingText:this.chessAIService.getThinkingDescription()})),setTimeout(()=>g(this,null,function*(){try{let t=yield this.chessAIService.makeAIMove(e);t?(console.log("\u{1F916} AI\u9078\u64C7\u79FB\u52D5:",t),this.makeAIMove(t.from,t.to)):(console.warn("\u{1F916} AI\u7121\u6CD5\u627E\u5230\u6709\u6548\u79FB\u52D5\uFF0CAI\u6295\u964D"),this.aiSurrender())}catch(t){console.error("\u{1F916} AI\u79FB\u52D5\u51FA\u932F:",t),this.aiSurrender()}}),500)})}makeAIMove(e,t){let i=this.gameState(),n=i.board[e.y][e.x];if(!n)return;let s=this.chessGameService.makeMove(i,e,t);if(s.success){let r=this.generateMoveNotation(n,e,t,s.captured),a=[...i.moveHistory,r],l="red",c=s.isCheck||!1,u=s.isSelfInCheck||!1,m=s.isCheckmate||s.isStalemate||s.gameOver||!1,v=s.winner||(s.isCheckmate?"black":null);i.board.flat().forEach(y=>{y&&(y.isSelected=!1)}),this.gameState.set(b(_({},i),{currentPlayer:l,selectedPiece:null,validMoves:[],moveHistory:a,isInCheck:c,isSelfInCheck:u,gameOver:m,winner:v,aiIsThinking:!1}))}}aiSurrender(){let e=this.gameState();console.log("\u{1F916} AI\u6295\u964D\uFF0C\u904A\u6232\u7D50\u675F"),this.gameState.set(b(_({},e),{gameOver:!0,winner:"red",aiIsThinking:!1,moveHistory:[...e.moveHistory,"\u{1F916} AI\u6295\u964D"]}))}setAIDifficulty(e){this.aiDifficulty.set(e),console.log("\u{1F916} AI\u96E3\u5EA6\u8A2D\u7F6E\u70BA:",e)}getAIDifficultyText(){switch(this.aiDifficulty()){case"easy":return"\u7C21\u55AE";case"medium":return"\u4E2D\u7B49";case"hard":return"\u56F0\u96E3";default:return"\u4E2D\u7B49"}}openApiKeyModal(){this.isApiKeyModalOpen.set(!0)}closeApiKeyModal(){this.isApiKeyModalOpen.set(!1)}clearApiKey(){typeof localStorage<"u"&&localStorage.removeItem("gemini-api-key"),this.chessGameService.updateApiKeyStatus(),this.aiType()==="service"&&this.setAIType("local"),console.log("Gemini API Key \u5DF2\u6E05\u9664")}onApiKeySaved(){console.log("onApiKeySaved called"),this.chessGameService.updateApiKeyStatus(),console.log("hasApiKey after save:",this.hasApiKey()),setTimeout(()=>{this.closeApiKeyModal()},100)}onApiKeyCleared(){console.log("onApiKeyCleared called"),this.chessGameService.updateApiKeyStatus(),console.log("hasApiKey after clear:",this.hasApiKey()),this.aiType()==="service"&&this.setAIType("local"),setTimeout(()=>{this.closeApiKeyModal()},100)}setAIType(e){this.aiType.set(e),e==="service"&&!this.hasApiKey()&&this.openApiKeyModal(),this.chessAIService.setUseGeminiAI(e==="service"),console.log(`\u{1F916} \u5DF2\u5207\u63DB AI \u985E\u578B: ${e}`)}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=Ve({type:o,selectors:[["app-chinese-chess"]],decls:96,vars:15,consts:[[1,"w-full","max-w-[95vw]","sm:max-w-sm","mx-auto","flex","flex-col","px-2","sm:px-0"],[1,"mb-2","flex","flex-col","gap-3","items-stretch"],[1,"flex","justify-between","items-center"],[1,"text-center","text-2xl","font-bold","tracking-wider","text-lime-400","drop-shadow"],["routerLink","/",1,"text-lime-600","text-sm"],[1,"flex","gap-2","justify-between"],[1,"h-12","w-1/3","rounded-md","bg-lime-700","border","border-lime-500","text-lime-50","font-semibold","text-base","shadow","hover:bg-lime-600","focus:outline-none","focus:ring-2","focus:ring-lime-300","drop-shadow-[0_0_5px_#22d3ee]",3,"click"],[1,"h-12","w-1/3","rounded-md","border","font-medium","shadow","bg-zinc-800"],[1,"text-3xl","text-center","text-amber-300","font-bold","leading-12","animate-pulse"],[1,"text-3xl","text-red-400","animate-pulse"],[1,"h-12","w-1/3","rounded-md","bg-cyan-700","border","border-cyan-500","text-cyan-50","font-semibold","text-base","shadow","hover:bg-cyan-600","focus:outline-none","focus:ring-2","focus:ring-cyan-300",3,"click"],[1,"flex","gap-2"],[1,"flex","flex-col","gap-2"],[1,"flex","items-center","gap-1","flex-wrap","bg-white/10","rounded-md","p-2","border","border-white/20"],[1,"border","border-lime-400","bg-lime-400/20","px-2","py-1","text-lime-300","font-bold","hover:bg-lime-400/30","transition"],[1,"text-lime-400","text-xs"],[1,"text-center","text-xs"],[1,"border","px-2","py-1","font-bold",3,"ngClass"],[1,"text-xs"],[1,"border","border-amber-400","bg-amber-400/20","px-2","py-1","text-amber-300","font-bold"],[1,"text-amber-400","text-xs"],[1,"border","border-green-400","bg-green-400/20","px-2","py-1","text-green-300","font-bold","text-center"],[1,"text-green-400","text-xs"],[1,"w-full","text-center","text-sm","mt-2","h-4","bg-neutral-700/80","rounded","overflow-hidden","relative","animate-pulse","text-white"],[1,"flex","justify-center"],[1,"relative","inline-block"],[1,"chess-board","bg-amber-100","border-2","sm:border-4","border-amber-800","p-2","sm:p-6","relative"],[1,"flex","justify-center","mb-1","sm:mb-2"],[1,"grid","grid-cols-9","gap-0"],[1,"w-[36px]","sm:w-[50px]","text-center","text-xs","font-bold","text-amber-800"],[1,"flex"],[1,"flex","flex-col","justify-center","mr-1","sm:mr-2"],[1,"h-[40px]","sm:h-[50px]","flex","items-center","justify-center","text-xs","font-bold","text-amber-800","w-4","sm:w-6"],[1,"relative","w-[310px]","h-[360px]","sm:w-[408px]","sm:h-[450px]","bg-amber-100"],["viewBox","0 0 100 100",1,"absolute","top-0","left-[122px]","w-[72px]","h-[80px]","sm:hidden"],["x1","0","y1","0","x2","100","y2","100","stroke","#d97706","stroke-width","1"],["x1","100","y1","0","x2","0","y2","100","stroke","#d97706","stroke-width","1"],["viewBox","0 0 100 100",1,"absolute","bottom-0","left-[122px]","w-[72px]","h-[80px]","sm:hidden"],["viewBox","0 0 100 100",1,"absolute","top-0","left-[154px]","w-[100px]","h-[100px]","hidden","sm:block"],["viewBox","0 0 100 100",1,"absolute","bottom-0","left-[154px]","w-[100px]","h-[100px]","hidden","sm:block"],[1,"absolute","left-0","right-0","bg-amber-100","flex","items-center","justify-between","px-8","z-5","sm:hidden",2,"top","161px","height","40px"],[1,"text-amber-700","font-bold","text-xs","tracking-wider"],[1,"absolute","left-0","right-0","bg-amber-100","flex","items-center","justify-between","px-16","z-5","hidden","sm:flex",2,"top","204px","height","50px"],[1,"text-amber-700","font-bold","text-sm","tracking-wider"],[1,"flex","flex-col","justify-center","ml-1","sm:ml-2"],[1,"flex","justify-center","mt-1","sm:mt-2"],[1,"absolute","inset-0","bg-black/50","backdrop-blur-sm","flex","items-center","justify-center","z-50","rounded-lg"],[1,"mt-6"],[1,"mt-4","text-xs","text-amber-600","text-center"],[1,"mb-1"],[1,"w-full","flex","items-center","gap-2","bg-neutral-800/50","rounded-lg","p-2","border","border-neutral-600","justify-center"],[1,"text-amber-300","text-sm","font-medium"],[1,"px-2","py-1","text-xs","rounded","transition-colors",3,"click","ngClass"],[1,"absolute","left-0","right-0","h-[1px]","bg-amber-800",3,"ngClass"],[1,"absolute","left-0","right-0","h-[1px]","bg-amber-800","hidden","sm:block"],[1,"absolute","w-[1px]","bg-amber-800","sm:hidden"],[1,"absolute","w-[1px]","bg-amber-800","hidden","sm:block"],[1,"absolute","w-[20px]","h-[20px]","-translate-x-1/2","-translate-y-1/2","rounded-full","hover:bg-amber-200/30","cursor-pointer","z-20","sm:hidden",3,"click","ngClass"],[1,"absolute","w-[6px]","h-[6px]","bg-amber-800","rounded-full","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[32px]","h-[32px]",3,"ngClass"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-2","h-2","bg-green-500","rounded-full","opacity-70"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[34px]","h-[34px]","border-2","border-red-500","rounded-full"],[1,"absolute","w-[24px]","h-[24px]","-translate-x-1/2","-translate-y-1/2","rounded-full","hover:bg-amber-200/30","cursor-pointer","z-20","hidden","sm:block",3,"click","ngClass"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[40px]","h-[40px]",3,"ngClass"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-3","h-3","bg-green-500","rounded-full","opacity-70"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[42px]","h-[42px]","border-2","border-red-500","rounded-full"],[1,"w-8","h-8","rounded-full","border-2","flex","items-center","justify-center","text-sm","font-bold","shadow-lg"],[1,"w-10","h-10","rounded-full","border-2","flex","items-center","justify-center","text-lg","font-bold","shadow-lg"],[1,"bg-gradient-to-br","from-amber-600","to-amber-800","border-2","border-amber-400","rounded-lg","p-8","shadow-2xl","text-center"],[1,"text-3xl","mb-4"],[1,"text-2xl","font-bold","mb-4","text-amber-100"],[1,"bg-amber-400","hover:bg-amber-300","text-amber-900","font-bold","py-3","px-6","rounded-lg","transition-all","duration-200","transform","hover:scale-105","shadow-lg",3,"click"],[1,"text-lg","font-bold","text-amber-400","mb-3"],[1,"bg-neutral-900/70","border","border-neutral-700","rounded-md","p-4","max-h-32","overflow-y-auto"],[1,"grid","grid-cols-2","gap-2","text-sm"],[1,"text-neutral-400"],[1,"text-red-400"],[1,"text-neutral-300"]],template:function(t,i){t&1&&(f(0,"div",0)(1,"header",1)(2,"div",2)(3,"h1",3),p(4," \u4E2D\u570B\u8C61\u68CB "),d(),f(5,"a",4),p(6,"HOME"),d()(),f(7,"div",5)(8,"button",6),k("click",function(){return i.toggleGameMode()}),p(9),d(),f(10,"div",7),x(11,Ft,2,0,"div",8),x(12,Gt,2,0,"div",9),d(),f(13,"button",10),k("click",function(){return i.resetGame()}),p(14," \u91CD\u65B0\u958B\u59CB "),d()(),x(15,Lt,10,3,"div",11),f(16,"div",12)(17,"div",13)(18,"div",14)(19,"div",15),p(20,"\u7576\u524D\u5C0D\u6230"),d(),f(21,"div",16),p(22),d()(),f(23,"div",17)(24,"div",18),p(25,"\u7576\u524D\u56DE\u5408"),d(),f(26,"div",16),x(27,Bt,2,0,"span"),p(28),d()(),f(29,"div",19)(30,"div",20),p(31,"\u6700\u5F8C\u4E00\u6B65"),d(),f(32,"div",16),x(33,$t,1,1)(34,Ht,1,0),d()(),f(35,"div",21)(36,"div",22),p(37,"\u26A1 UCI \u5F15\u64CE"),d(),f(38,"div",16),p(39),d()(),f(40,"div",23),x(41,jt,1,0),d()()()(),f(42,"main",24)(43,"div",25)(44,"div",26)(45,"div",27)(46,"div",28),R(47,Ut,2,1,"div",29,Y),d()(),f(49,"div",30)(50,"div",31),R(51,Kt,2,1,"div",32,Y),d(),f(53,"div",33),R(54,Wt,2,9,null,null,Y),R(56,qt,4,24,null,null,Y),we(),f(58,"svg",34),w(59,"line",35)(60,"line",36),d(),f(61,"svg",37),w(62,"line",35)(63,"line",36),d(),f(64,"svg",38),w(65,"line",35)(66,"line",36),d(),f(67,"svg",39),w(68,"line",35)(69,"line",36),d(),Pe(),f(70,"div",40)(71,"span",41),p(72,"\u695A\u6CB3"),d(),f(73,"span",41),p(74,"\u6F22\u754C"),d()(),f(75,"div",42)(76,"span",43),p(77,"\u695A\u6CB3"),d(),f(78,"span",43),p(79,"\u6F22\u754C"),d()(),R(80,si,2,0,null,null,ae),d(),f(82,"div",44),R(83,ri,2,1,"div",32,Y),d()(),f(85,"div",45)(86,"div",28),R(87,ai,2,1,"div",29,Y),d()()(),x(89,li,8,1,"div",46),d()(),x(90,hi,7,0,"section",47),f(91,"footer",48)(92,"p",49),p(93,"\u9EDE\u64CA\u9078\u64C7\u68CB\u5B50\uFF0C\u518D\u9EDE\u64CA\u76EE\u6A19\u4F4D\u7F6E\u79FB\u52D5"),d(),f(94,"p"),p(95,"\u7D05\u65B9\u5148\u884C\uFF0C\u5C07\u8ECD\u5C0D\u65B9\u5373\u7372\u52DD"),d()()()),t&2&&(h(9),V(" ",i.isVsAI()?"\u{1F465} \u5207\u63DB\u96D9\u4EBA":"\u{1F916} \u5207\u63DBAI"," "),h(2),A(i.isInCheck()?11:-1),h(),A(i.isSelfInCheck()&&!i.isInCheck()?12:-1),h(3),A(i.isVsAI()?15:-1),h(7),ce(i.isVsAI()?"\u{1F916}":"\u{1F465}"),h(),T("ngClass",i.currentPlayer()===i.PlayerColor.RED?"bg-red-500/20 border-red-400 text-red-300":"bg-neutral-800/20 border-neutral-400 text-neutral-300"),h(4),A(i.isVsAI()&&i.currentPlayer()===i.PlayerColor.BLACK?27:-1),h(),V("",i.currentPlayerDisplay()," "),h(5),A(i.moveHistory().length>0?33:34),h(6),V(" ",i.getAIDifficultyText()," "),h(2),A(i.aiIsThinking()?41:-1),h(6),N(i.getColumnLetters()),h(4),N(i.getRowNumbers()),h(3),N(Ee(13,Tt)),h(2),N(Ee(14,kt)),h(24),N(i.board()),h(3),N(i.getRowNumbers()),h(4),N(i.getColumnLetters()),h(2),A(i.gameOver()?89:-1),h(),A(i.moveHistory().length>0?90:-1))},dependencies:[Re,Oe,Ne,ke],styles:[".api-key-modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#0009;display:flex;justify-content:center;align-items:center;z-index:1000;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.api-key-modal-content[_ngcontent-%COMP%]{position:relative;padding:20px;background:#1a1a1a;border-radius:8px;border:1px solid #444;width:90%;max-width:500px;box-shadow:0 5px 15px #00000080}.close-button[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;background:none;border:none;font-size:1.5rem;color:#888;cursor:pointer;line-height:1}.close-button[_ngcontent-%COMP%]:hover{color:#fff}"]})};export{Qe as ChineseChess};
