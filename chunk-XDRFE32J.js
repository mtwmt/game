import{$ as ae,A as g,B as z,C as T,D as b,E as w,F as V,G as m,H,I as D,L as X,M as U,O as ie,P as ne,R as _,S as oe,U as re,V as se,a as S,b as k,c as K,d as Y,f as F,g as L,h as Q,i as Z,k as ee,o as l,p as W,q as te,r as x,s as v,t as j,u as R,v as E,w as I,x as B,y as d,z as c}from"./chunk-UD7MAS2H.js";var $=(t=>(t.RED="red",t.BLACK="black",t))($||{});var G=class r{initializeBoard(){let e=Array(10).fill(null).map(()=>Array(9).fill(null));e[9][0]={id:"r-chariot-1",type:"chariot",color:"red",position:{x:0,y:9},isSelected:!1,hasMoved:!1},e[9][1]={id:"r-horse-1",type:"horse",color:"red",position:{x:1,y:9},isSelected:!1,hasMoved:!1},e[9][2]={id:"r-elephant-1",type:"elephant",color:"red",position:{x:2,y:9},isSelected:!1,hasMoved:!1},e[9][3]={id:"r-advisor-1",type:"advisor",color:"red",position:{x:3,y:9},isSelected:!1,hasMoved:!1},e[9][4]={id:"r-general",type:"general",color:"red",position:{x:4,y:9},isSelected:!1,hasMoved:!1},e[9][5]={id:"r-advisor-2",type:"advisor",color:"red",position:{x:5,y:9},isSelected:!1,hasMoved:!1},e[9][6]={id:"r-elephant-2",type:"elephant",color:"red",position:{x:6,y:9},isSelected:!1,hasMoved:!1},e[9][7]={id:"r-horse-2",type:"horse",color:"red",position:{x:7,y:9},isSelected:!1,hasMoved:!1},e[9][8]={id:"r-chariot-2",type:"chariot",color:"red",position:{x:8,y:9},isSelected:!1,hasMoved:!1},e[7][1]={id:"r-cannon-1",type:"cannon",color:"red",position:{x:1,y:7},isSelected:!1,hasMoved:!1},e[7][7]={id:"r-cannon-2",type:"cannon",color:"red",position:{x:7,y:7},isSelected:!1,hasMoved:!1};for(let t=0;t<9;t+=2)e[6][t]={id:`r-soldier-${t}`,type:"soldier",color:"red",position:{x:t,y:6},isSelected:!1,hasMoved:!1};e[0][0]={id:"b-chariot-1",type:"chariot",color:"black",position:{x:0,y:0},isSelected:!1,hasMoved:!1},e[0][1]={id:"b-horse-1",type:"horse",color:"black",position:{x:1,y:0},isSelected:!1,hasMoved:!1},e[0][2]={id:"b-elephant-1",type:"elephant",color:"black",position:{x:2,y:0},isSelected:!1,hasMoved:!1},e[0][3]={id:"b-advisor-1",type:"advisor",color:"black",position:{x:3,y:0},isSelected:!1,hasMoved:!1},e[0][4]={id:"b-general",type:"general",color:"black",position:{x:4,y:0},isSelected:!1,hasMoved:!1},e[0][5]={id:"b-advisor-2",type:"advisor",color:"black",position:{x:5,y:0},isSelected:!1,hasMoved:!1},e[0][6]={id:"b-elephant-2",type:"elephant",color:"black",position:{x:6,y:0},isSelected:!1,hasMoved:!1},e[0][7]={id:"b-horse-2",type:"horse",color:"black",position:{x:7,y:0},isSelected:!1,hasMoved:!1},e[0][8]={id:"b-chariot-2",type:"chariot",color:"black",position:{x:8,y:0},isSelected:!1,hasMoved:!1},e[2][1]={id:"b-cannon-1",type:"cannon",color:"black",position:{x:1,y:2},isSelected:!1,hasMoved:!1},e[2][7]={id:"b-cannon-2",type:"cannon",color:"black",position:{x:7,y:2},isSelected:!1,hasMoved:!1};for(let t=0;t<9;t+=2)e[3][t]={id:`b-soldier-${t}`,type:"soldier",color:"black",position:{x:t,y:3},isSelected:!1,hasMoved:!1};return e}initializeGameState(){return{board:this.initializeBoard(),currentPlayer:"red",selectedPiece:null,validMoves:[],gameOver:!1,winner:null,moveHistory:[],isInCheck:!1,isVsAI:!1,aiIsThinking:!1,aiThinkingText:""}}isValidPosition(e,t){return e>=0&&e<9&&t>=0&&t<10}isInPalace(e,t,i){return i==="red"?e>=3&&e<=5&&t>=7&&t<=9:e>=3&&e<=5&&t>=0&&t<=2}isOnOwnSide(e,t){return t==="red"?e>=5:e<=4}getPossibleMoves(e,t){let i=[],{x:n,y:o}=e.position;switch(e.type){case"general":[{x:n-1,y:o},{x:n+1,y:o},{x:n,y:o-1},{x:n,y:o+1}].forEach(a=>{if(this.isValidPosition(a.x,a.y)&&this.isInPalace(a.x,a.y,e.color)){let p=t[a.y][a.x];(!p||p.color!==e.color)&&i.push(a)}});break;case"advisor":[{x:n-1,y:o-1},{x:n+1,y:o-1},{x:n-1,y:o+1},{x:n+1,y:o+1}].forEach(a=>{if(this.isValidPosition(a.x,a.y)&&this.isInPalace(a.x,a.y,e.color)){let p=t[a.y][a.x];(!p||p.color!==e.color)&&i.push(a)}});break;case"elephant":[{x:n-2,y:o-2,block:{x:n-1,y:o-1}},{x:n+2,y:o-2,block:{x:n+1,y:o-1}},{x:n-2,y:o+2,block:{x:n-1,y:o+1}},{x:n+2,y:o+2,block:{x:n+1,y:o+1}}].forEach(a=>{if(this.isValidPosition(a.x,a.y)&&this.isOnOwnSide(a.y,e.color)&&!t[a.block.y][a.block.x]){let p=t[a.y][a.x];(!p||p.color!==e.color)&&i.push({x:a.x,y:a.y})}});break;case"horse":[{x:n-1,y:o-2,block:{x:n,y:o-1}},{x:n+1,y:o-2,block:{x:n,y:o-1}},{x:n-1,y:o+2,block:{x:n,y:o+1}},{x:n+1,y:o+2,block:{x:n,y:o+1}},{x:n-2,y:o-1,block:{x:n-1,y:o}},{x:n-2,y:o+1,block:{x:n-1,y:o}},{x:n+2,y:o-1,block:{x:n+1,y:o}},{x:n+2,y:o+1,block:{x:n+1,y:o}}].forEach(a=>{if(this.isValidPosition(a.x,a.y)&&!t[a.block.y][a.block.x]){let p=t[a.y][a.x];(!p||p.color!==e.color)&&i.push({x:a.x,y:a.y})}});break;case"chariot":[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}].forEach(a=>{for(let p=1;p<10;p++){let y=n+a.dx*p,A=o+a.dy*p;if(!this.isValidPosition(y,A))break;let O=t[A][y];if(O){O.color!==e.color&&i.push({x:y,y:A});break}else i.push({x:y,y:A})}});break;case"cannon":[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}].forEach(a=>{let p=!1;for(let y=1;y<10;y++){let A=n+a.dx*y,O=o+a.dy*y;if(!this.isValidPosition(A,O))break;let J=t[O][A];if(J)if(!p)p=!0;else{J.color!==e.color&&i.push({x:A,y:O});break}else p||i.push({x:A,y:O})}});break;case"soldier":let P=e.color==="red"?-1:1,N={x:n,y:o+P};if(this.isValidPosition(N.x,N.y)){let a=t[N.y][N.x];(!a||a.color!==e.color)&&i.push(N)}if(!this.isOnOwnSide(o,e.color)){let a={x:n-1,y:o},p={x:n+1,y:o};if(this.isValidPosition(a.x,a.y)){let y=t[a.y][a.x];(!y||y.color!==e.color)&&i.push(a)}if(this.isValidPosition(p.x,p.y)){let y=t[p.y][p.x];(!y||y.color!==e.color)&&i.push(p)}}break}return i}isInCheck(e,t){let i=null;for(let n=0;n<10;n++)for(let o=0;o<9;o++){let s=e[n][o];if(s&&s.type==="general"&&s.color===t){i={x:o,y:n};break}}if(!i)return!1;for(let n=0;n<10;n++)for(let o=0;o<9;o++){let s=e[n][o];if(s&&s.color!==t&&this.getPossibleMoves(s,e).some(h=>h.x===i.x&&h.y===i.y))return!0}return!1}makeMove(e,t,i){let{board:n}=e,o=n[t.y][t.x];if(!o)return{success:!1};let s=n[i.y][i.x];if(n[i.y][i.x]=o,n[t.y][t.x]=null,o.position=i,this.isInCheck(n,o.color))return n[t.y][t.x]=o,n[i.y][i.x]=s,o.position=t,{success:!1};let u=o.color==="red"?"black":"red",h=this.isInCheck(n,u);return o.hasMoved=!0,{success:!0,captured:s||void 0,isCheck:h}}getPieceSymbol(e){return{general:{red:"\u5E25",black:"\u5C07"},advisor:{red:"\u4ED5",black:"\u58EB"},elephant:{red:"\u76F8",black:"\u8C61"},horse:{red:"\u99AC",black:"\u99AC"},chariot:{red:"\u8ECA",black:"\u8ECA"},cannon:{red:"\u70AE",black:"\u7832"},soldier:{red:"\u5175",black:"\u5352"}}[e.type][e.color]}static \u0275fac=function(t){return new(t||r)};static \u0275prov=K({token:r,factory:r.\u0275fac,providedIn:"root"})};var q=class r{constructor(e){this.chessGameService=e}MAX_DEPTH=3;PIECE_VALUES={general:1e4,chariot:500,cannon:450,horse:400,elephant:200,advisor:200,soldier:100};POSITION_BONUS={general:[[0,0,0,8,9,8,0,0,0],[0,0,0,9,10,9,0,0,0],[0,0,0,8,9,8,0,0,0]],soldier:[[9,9,9,11,13,11,9,9,9],[19,24,34,42,44,42,34,24,19],[19,24,32,37,37,37,32,24,19],[19,23,27,29,30,29,27,23,19],[14,18,20,27,29,27,20,18,14]]};makeAIMove(e){console.log("\u{1F916} AI\u958B\u59CB\u5206\u6790\u68CB\u5C40...");let t=this.getAllPossibleMoves(e,"black");if(console.log(`\u{1F916} \u627E\u5230 ${t.length} \u500B\u53EF\u80FD\u79FB\u52D5`),t.length===0)return console.log("\u{1F916} AI\u7121\u79FB\u52D5\u53EF\u8D70\uFF0C\u6E96\u5099\u6295\u964D"),null;let i=this.chessGameService.isInCheck(e.board,"black"),n=i?Math.min(2,this.MAX_DEPTH):this.MAX_DEPTH;console.log(`\u{1F916} AI${i?"\u88AB\u5C07\u8ECD\uFF0C":""}\u4F7F\u7528\u6DF1\u5EA6 ${n} \u9032\u884C\u641C\u7D22`);let o=this.findBestMoveWithTimeout(e,n,3e3);if(o)return console.log(`\u{1F916} AI\u6C7A\u5B9A\u79FB\u52D5: (${o.from.x},${o.from.y}) -> (${o.to.x},${o.to.y}), \u8A55\u5206: ${o.score}`),{from:o.from,to:o.to};console.warn("\u{1F916} AI\u7121\u6CD5\u627E\u5230\u6700\u4F73\u79FB\u52D5\u6216\u8D85\u6642\uFF0C\u96A8\u6A5F\u9078\u64C7");let s=t[Math.floor(Math.random()*t.length)];return{from:s.from,to:s.to}}findBestMoveWithTimeout(e,t,i){let n=Date.now(),o=null;try{return this.findBestMoveInternal(e,t,n,i)}catch(s){return console.warn("\u{1F916} AI\u641C\u7D22\u8D85\u6642\u6216\u51FA\u932F:",s),o}}findBestMove(e,t){return this.findBestMoveInternal(e,t,Date.now(),1e4)}findBestMoveInternal(e,t,i,n){let o=this.getAllPossibleMoves(e,e.currentPlayer);if(o.length===0)return null;let s=null,u=e.currentPlayer==="black"?-1/0:1/0;for(let h of o){if(Date.now()-i>n){console.log("\u{1F916} AI\u641C\u7D22\u8D85\u6642\uFF0C\u8FD4\u56DE\u7576\u524D\u6700\u4F73\u79FB\u52D5");break}let f=this.simulateMove(e,h),C=this.minimaxWithTimeout(f,t-1,-1/0,1/0,e.currentPlayer==="red",i,n);h.score=C,e.currentPlayer==="black"?C>u&&(u=C,s=h):C<u&&(u=C,s=h)}return s}minimaxWithTimeout(e,t,i,n,o,s,u){if(Date.now()-s>u)return this.evaluateBoard(e);if(t===0||e.gameOver)return this.evaluateBoard(e);let h=this.getAllPossibleMoves(e,e.currentPlayer);if(o){let f=-1/0;for(let C of h){if(Date.now()-s>u)break;let M=this.simulateMove(e,C),P=this.minimaxWithTimeout(M,t-1,i,n,!1,s,u);if(f=Math.max(f,P),i=Math.max(i,P),n<=i)break}return f}else{let f=1/0;for(let C of h){if(Date.now()-s>u)break;let M=this.simulateMove(e,C),P=this.minimaxWithTimeout(M,t-1,i,n,!0,s,u);if(f=Math.min(f,P),n=Math.min(n,P),n<=i)break}return f}}minimax(e,t,i,n,o){return this.minimaxWithTimeout(e,t,i,n,o,Date.now(),1e4)}getAllPossibleMoves(e,t){let i=[];for(let n=0;n<10;n++)for(let o=0;o<9;o++){let s=e.board[n][o];if(s&&s.color===t){let u=this.chessGameService.getPossibleMoves(s,e.board);for(let h of u){let f=e.board[h.y][h.x];i.push({from:s.position,to:h,score:0,capturedPiece:f||void 0})}}}return i}simulateMove(e,t){let i=e.board.map(o=>o.map(s=>s?k(S({},s),{position:S({},s.position)}):null)),n=i[t.from.y][t.from.x];return n&&(i[t.to.y][t.to.x]=n,i[t.from.y][t.from.x]=null,n.position=S({},t.to)),k(S({},e),{board:i,currentPlayer:e.currentPlayer==="red"?"black":"red"})}evaluateBoard(e){let t=0;for(let i=0;i<10;i++)for(let n=0;n<9;n++){let o=e.board[i][n];if(o){let s=this.PIECE_VALUES[o.type];s+=this.getPositionBonus(o),s+=this.getThreatScore(n,i,o,e.board),o.color==="black"?t+=s:t-=s}}return t+=this.getCenterControlScore(e.board),t+=this.getCheckScore(e.board),t}getPositionBonus(e){let{x:t,y:i}=e.position,n=0,o=Math.abs(i-4.5)+Math.abs(t-4);switch(n+=(9-o)*2,e.type){case"horse":i>=2&&i<=7&&t>=1&&t<=7&&(n+=30);break;case"cannon":(t===4||i===(e.color==="red"?7:2))&&(n+=20);break;case"soldier":if(e.color==="red"&&i<5||e.color==="black"&&i>4){n+=50;let u=e.color==="red"?4-i:i-5;n+=u*10}break}return n}getThreatScore(e,t,i,n){let o=0,s=i.color==="red"?"black":"red";for(let u=0;u<10;u++)for(let h=0;h<9;h++){let f=n[u][h];if(f&&f.color===s&&this.chessGameService.getPossibleMoves(f,n).some(M=>M.x===e&&M.y===t)){o-=this.PIECE_VALUES[i.type]*.5;break}}return o}getCenterControlScore(e){let t=0,i=[{x:3,y:4},{x:4,y:4},{x:5,y:4},{x:3,y:5},{x:4,y:5},{x:5,y:5}];for(let{x:n,y:o}of i){let s=e[o][n];s&&(s.color==="black"?t+=15:t-=15)}return t}getCheckScore(e){let t=0;return this.chessGameService.isInCheck(e,"red")&&(t+=100),this.chessGameService.isInCheck(e,"black")&&(t-=100),t}delay(e){return new Promise(t=>setTimeout(t,e))}getThinkingDescription(e){let t=this.analyzeThreats(e),i=this.analyzeOpportunities(e),n=["\u6B63\u5728\u5206\u6790\u68CB\u5C40\u5F62\u52E2...","\u8A08\u7B97\u6700\u4F73\u79FB\u52D5\u8DEF\u7DDA...","\u8A55\u4F30\u653B\u9632\u5E73\u8861...","\u5C0B\u627E\u6230\u8853\u6A5F\u6703..."];return t.length>0&&n.push("\u767C\u73FE\u5A01\u8105\uFF0C\u6B63\u5728\u5236\u5B9A\u9632\u5B88\u7B56\u7565..."),i.length>0&&n.push("\u767C\u73FE\u653B\u64CA\u6A5F\u6703\uFF0C\u6B63\u5728\u8A08\u7B97..."),n[Math.floor(Math.random()*n.length)]}analyzeThreats(e){let t=[],i="black",n="red";if(this.chessGameService.isInCheck(e.board,i))for(let o=0;o<10;o++)for(let s=0;s<9;s++){let u=e.board[o][s];if(u&&u.type==="general"&&u.color===i){t.push({x:s,y:o});break}}return t}analyzeOpportunities(e){let t=[],i="black";return this.chessGameService.isInCheck(e.board,"red")&&t.push({x:4,y:9}),t}static \u0275fac=function(t){return new(t||r)(Y(G))};static \u0275prov=K({token:r,factory:r.\u0275fac,providedIn:"root"})};var me=()=>[0,1,2,3,4,5,6,7,8,9],pe=()=>[0,1,2,3,4,5,6,7,8],de=r=>({"valid-move-point":r});function fe(r,e){r&1&&(d(0,"span"),m(1,"\u{1F916}"),c())}function xe(r,e){r&1&&(d(0,"div",13),m(1,"\u5C07\u8ECD\uFF01"),c())}function ve(r,e){if(r&1){let t=z();d(0,"button",42),T("click",function(){F(t);let n=b();return L(n.startPvP())}),d(1,"div",12),m(2,"\u5207\u63DB\u6A21\u5F0F"),c()()}}function be(r,e){r&1&&m(0," AI \u601D\u8003\u4E2D... ")}function Ce(r,e){if(r&1&&(d(0,"div",21),m(1),c()),r&2){let t=e.$implicit;l(),H(t)}}function ye(r,e){if(r&1&&(d(0,"div",24),m(1),c()),r&2){let t=e.$implicit;l(),D(" ",t," ")}}function ge(r,e){if(r&1&&g(0,"div",43)(1,"div",44),r&2){let t=e.$implicit;V(t===6?"z-20 h-[1.5px]":"z-10"),w("top",t*40+4,"px"),B("ngClass","sm:hidden"),l(),V(t===6?"z-20 h-[1.5px]":"z-10"),w("top",t*50+4,"px")}}function _e(r,e){if(r&1&&g(0,"div",45)(1,"div",45)(2,"div",46)(3,"div",46),r&2){let t=e.$implicit;w("left",t*36+14,"px")("top",4,"px")("height",157,"px"),l(),w("left",t*36+14,"px")("top",203,"px")("height",162,"px"),l(),w("left",t*50+4,"px")("top",4,"px")("height",200,"px"),l(),w("left",t*50+4,"px")("top",254,"px")("height",200,"px")}}function Pe(r,e){r&1&&g(0,"div",48)}function Se(r,e){r&1&&g(0,"div",48)}function Me(r,e){if(r&1&&(d(0,"div",49)(1,"div",56),m(2),c()()),r&2){let t=b().$implicit,i=b(2);B("ngClass",i.getPieceClass(t)),l(),V(t.color===i.PlayerColor.RED?"bg-red-100 border-red-600 text-red-800":"bg-neutral-100 border-neutral-800 text-neutral-800"),l(),D(" ",i.getPieceSymbol(t)," ")}}function ke(r,e){r&1&&g(0,"div",50)}function Ee(r,e){r&1&&g(0,"div",51)}function Ie(r,e){r&1&&g(0,"div",48)}function Ae(r,e){r&1&&g(0,"div",48)}function we(r,e){if(r&1&&(d(0,"div",53)(1,"div",57),m(2),c()()),r&2){let t=b().$implicit,i=b(2);B("ngClass",i.getPieceClass(t)),l(),V(t.color===i.PlayerColor.RED?"bg-red-100 border-red-600 text-red-800":"bg-neutral-100 border-neutral-800 text-neutral-800"),l(),D(" ",i.getPieceSymbol(t)," ")}}function De(r,e){r&1&&g(0,"div",54)}function Te(r,e){r&1&&g(0,"div",55)}function Oe(r,e){if(r&1){let t=z();d(0,"div",47),T("click",function(){let n=F(t).$index,o=b().$index,s=b();return L(s.onSquareClick(n,o))}),x(1,Pe,1,0,"div",48),x(2,Se,1,0,"div",48),x(3,Me,3,4,"div",49),x(4,ke,1,0,"div",50),x(5,Ee,1,0,"div",51),c(),d(6,"div",52),T("click",function(){let n=F(t).$index,o=b().$index,s=b();return L(s.onSquareClick(n,o))}),x(7,Ie,1,0,"div",48),x(8,Ae,1,0,"div",48),x(9,we,3,4,"div",53),x(10,De,1,0,"div",54),x(11,Te,1,0,"div",55),c()}if(r&2){let t=e.$implicit,i=e.$index,n=b().$index,o=b();w("top",n*40+4,"px")("left",i*36+14,"px"),B("ngClass",U(20,de,o.isValidMove(i,n))),l(),v((n===2||n===7)&&(i===0||i===2||i===4||i===6||i===8)?1:-1),l(),v((n===3||n===6)&&(i===1||i===7)?2:-1),l(),v(t?3:-1),l(),v(o.isValidMove(i,n)&&!t?4:-1),l(),v(o.isValidMove(i,n)&&t&&t.color!==o.currentPlayer()?5:-1),l(),w("top",n*50+4,"px")("left",i*50+4,"px"),B("ngClass",U(22,de,o.isValidMove(i,n))),l(),v((n===2||n===7)&&(i===0||i===2||i===4||i===6||i===8)?7:-1),l(),v((n===3||n===6)&&(i===1||i===7)?8:-1),l(),v(t?9:-1),l(),v(o.isValidMove(i,n)&&!t?10:-1),l(),v(o.isValidMove(i,n)&&t&&t.color!==o.currentPlayer()?11:-1)}}function Re(r,e){if(r&1&&E(0,Oe,12,24,null,null,j),r&2){let t=e.$implicit;I(t)}}function Be(r,e){if(r&1&&(d(0,"div",24),m(1),c()),r&2){let t=e.$implicit;l(),D(" ",t," ")}}function Ge(r,e){if(r&1&&(d(0,"div",21),m(1),c()),r&2){let t=e.$implicit;l(),H(t)}}function Ne(r,e){if(r&1){let t=z();d(0,"div",38)(1,"div",58)(2,"div",59),m(3,"\u{1F3C6}"),c(),d(4,"h2",60),m(5),c(),d(6,"button",61),T("click",function(){F(t);let n=b();return L(n.resetGame())}),m(7," \u91CD\u65B0\u958B\u59CB "),c()()()}if(r&2){let t=b();l(5),D(" ",t.winner()===t.PlayerColor.RED?"\u7D05\u65B9\u7372\u52DD\uFF01":"\u9ED1\u65B9\u7372\u52DD\uFF01"," ")}}function Fe(r,e){if(r&1&&(d(0,"span",67),m(1),c()),r&2){let t=b(2).$index,i=b(2);l(),H(i.moveHistory()[t+1])}}function Le(r,e){if(r&1&&(d(0,"div",5)(1,"span",65),m(2),c(),d(3,"span",66),m(4),c(),x(5,Fe,2,1,"span",67),c()),r&2){let t=b(),i=t.$implicit,n=t.$index,o=b(2);l(2),D("",o.Math.floor(n/2)+1,"."),l(2),H(i),l(),v(o.moveHistory()[n+1]?5:-1)}}function Ve(r,e){if(r&1&&x(0,Le,6,3,"div",5),r&2){let t=e.$index;v(t%2===0?0:-1)}}function He(r,e){if(r&1&&(d(0,"section",39)(1,"h3",62),m(2,"\u68CB\u8B5C\u8A18\u9304"),c(),d(3,"div",63)(4,"div",64),E(5,Ve,1,1,null,null,j),c()()()),r&2){let t=b();l(5),I(t.moveHistory())}}var ue=class r{constructor(e,t){this.chessGameService=e;this.chessAIService=t}gameState=ee({board:[],currentPlayer:"red",selectedPiece:null,validMoves:[],gameOver:!1,winner:null,moveHistory:[],isInCheck:!1,isVsAI:!1,aiIsThinking:!1,aiThinkingText:""});board=_(()=>this.gameState().board);currentPlayer=_(()=>this.gameState().currentPlayer);selectedPiece=_(()=>this.gameState().selectedPiece);validMoves=_(()=>this.gameState().validMoves);gameOver=_(()=>this.gameState().gameOver);winner=_(()=>this.gameState().winner);moveHistory=_(()=>this.gameState().moveHistory);isInCheck=_(()=>this.gameState().isInCheck);currentPlayerDisplay=_(()=>this.currentPlayer()==="red"?"\u7D05\u65B9":"\u9ED1\u65B9");isVsAI=_(()=>this.gameState().isVsAI);aiIsThinking=_(()=>this.gameState().aiIsThinking);aiThinkingText=_(()=>this.gameState().aiThinkingText);isAITurn=_(()=>this.isVsAI()&&this.currentPlayer()==="black"&&!this.gameOver());canInteract=_(()=>!this.isVsAI()||this.currentPlayer()==="red");PlayerColor=$;Math=Math;ngOnInit(){this.resetGame(!0)}resetGame(e=!1){let t=this.chessGameService.initializeGameState();t.isVsAI=e,this.gameState.set(t)}onSquareClick(e,t){if(this.gameOver()||!this.canInteract())return;let i=this.gameState(),n=i.board[t][e];i.selectedPiece?n&&n.color===i.currentPlayer&&n!==i.selectedPiece?this.selectPiece(n):this.isValidMove(e,t)?this.makeMove(i.selectedPiece.position,{x:e,y:t}):this.deselectPiece():n&&n.color===i.currentPlayer&&this.selectPiece(n)}selectPiece(e){let t=this.gameState();t.board.flat().forEach(n=>{n&&(n.isSelected=!1)}),e.isSelected=!0;let i=this.chessGameService.getPossibleMoves(e,t.board);this.gameState.set(k(S({},t),{selectedPiece:e,validMoves:i}))}deselectPiece(){let e=this.gameState();e.selectedPiece&&(e.selectedPiece.isSelected=!1),this.gameState.set(k(S({},e),{selectedPiece:null,validMoves:[]}))}isValidMove(e,t){return this.validMoves().some(i=>i.x===e&&i.y===t)}makeMove(e,t){let i=this.gameState(),n=i.board[e.y][e.x];if(!n)return;let o=this.chessGameService.makeMove(i,e,t);if(o.success){let s=this.generateMoveNotation(n,e,t,o.captured),u=[...i.moveHistory,s],h=i.currentPlayer==="red"?"black":"red",f=o.isCheck||!1,C=o.isCheckmate||o.isStalemate||!1,M=o.isCheckmate?i.currentPlayer:null;i.board.flat().forEach(P=>{P&&(P.isSelected=!1)}),this.gameState.set(k(S({},i),{currentPlayer:h,selectedPiece:null,validMoves:[],moveHistory:u,isInCheck:f,gameOver:C,winner:M})),console.log("\u6AA2\u67E5AI\u89F8\u767C\u689D\u4EF6:",{gameOver:C,isVsAI:i.isVsAI,nextPlayer:h,shouldTrigger:!C&&i.isVsAI&&h==="black"}),!C&&i.isVsAI&&h==="black"&&(console.log("\u6E96\u5099\u89F8\u767CAI\u79FB\u52D5..."),this.triggerAIMove())}}generateMoveNotation(e,t,i,n){if(!e)return"";let o=this.chessGameService.getPieceSymbol(e),s=e.color==="red"?9-t.x:t.x+1,u=i.y-t.y,h="";return u===0?h="\u5E73"+(e.color==="red"?9-i.x:i.x+1):h=(u<0?"\u9032":"\u9000")+Math.abs(u),`${o}${s}${h}`}getSquareClass(e,t){let i="chess-square";return this.board()[t]?.[e]?.isSelected&&(i+=" selected"),this.isValidMove(e,t)&&(i+=" valid-move"),(this.chessGameService.isInPalace(e,t,"red")||this.chessGameService.isInPalace(e,t,"black"))&&(i+=" palace"),i}getPieceClass(e){if(!e)return"";let t=`chess-piece ${e.color}`;return e.isSelected&&(t+=" selected"),t}getPieceSymbol(e){return e?this.chessGameService.getPieceSymbol(e):""}getRowNumbers(){return Array.from({length:10},(e,t)=>10-t)}getColumnLetters(){return["a","b","c","d","e","f","g","h","i"]}startVsAI(){let e=this.chessGameService.initializeGameState();e.isVsAI=!0,this.gameState.set(e)}startPvP(){let e=this.chessGameService.initializeGameState();e.isVsAI=!1,this.gameState.set(e)}triggerAIMove(){let e=this.gameState();console.log("\u{1F916} \u89F8\u767CAI\u79FB\u52D5\uFF0C\u7576\u524D\u73A9\u5BB6:",e.currentPlayer),this.gameState.set(k(S({},e),{aiIsThinking:!0,aiThinkingText:this.chessAIService.getThinkingDescription(e)})),setTimeout(()=>{try{let t=this.chessAIService.makeAIMove(e);t?(console.log("\u{1F916} AI\u9078\u64C7\u79FB\u52D5:",t),this.makeAIMove(t.from,t.to)):(console.warn("\u{1F916} AI\u7121\u6CD5\u627E\u5230\u6709\u6548\u79FB\u52D5\uFF0CAI\u6295\u964D"),this.aiSurrender())}catch(t){console.error("\u{1F916} AI\u79FB\u52D5\u51FA\u932F:",t),this.aiSurrender()}},500)}makeAIMove(e,t){let i=this.gameState(),n=i.board[e.y][e.x];if(!n)return;let o=this.chessGameService.makeMove(i,e,t);if(o.success){let s=this.generateMoveNotation(n,e,t,o.captured),u=[...i.moveHistory,s],h="red",f=o.isCheck||!1,C=o.isCheckmate||o.isStalemate||!1,M=o.isCheckmate?"black":null;i.board.flat().forEach(P=>{P&&(P.isSelected=!1)}),this.gameState.set(k(S({},i),{currentPlayer:h,selectedPiece:null,validMoves:[],moveHistory:u,isInCheck:f,gameOver:C,winner:M,aiIsThinking:!1}))}}aiSurrender(){let e=this.gameState();console.log("\u{1F916} AI\u6295\u964D\uFF0C\u904A\u6232\u7D50\u675F"),this.gameState.set(k(S({},e),{gameOver:!0,winner:"red",aiIsThinking:!1,moveHistory:[...e.moveHistory,"\u{1F916} AI\u6295\u964D"]}))}static \u0275fac=function(t){return new(t||r)(W(G),W(q))};static \u0275cmp=te({type:r,selectors:[["app-chinese-chess"]],decls:82,vars:13,consts:[[1,"w-full","max-w-[95vw]","sm:max-w-sm","mx-auto","flex","flex-col","px-2","sm:px-0"],[1,"mb-2","flex","flex-col","gap-3","items-stretch"],[1,"flex","justify-between","items-center"],[1,"text-center","text-2xl","font-bold","tracking-wider","text-lime-400","drop-shadow"],["routerLink","/",1,"text-lime-600","text-sm"],[1,"flex","gap-2"],[1,"h-12","w-1/3","touch-btn","rounded-md","bg-cyan-700","border","border-cyan-500","text-cyan-50","font-semibold","text-base","shadow","hover:bg-cyan-600","focus:outline-none","focus:ring-2","focus:ring-cyan-300",3,"click"],[1,"h-12","w-1/3","touch-btn","rounded-md","bg-lime-700","border","border-lime-500","text-lime-50","font-semibold","text-base","shadow","hover:bg-lime-600","focus:outline-none","focus:ring-2","focus:ring-lime-300","drop-shadow-[0_0_5px_#22d3ee]",3,"click"],[1,"flex","flex-col","gap-2"],[1,"flex","items-center","gap-1","justify-between","flex-wrap","bg-white/10","rounded-md","p-2","border","border-white/20"],[1,"border","px-2","py-1","font-bold",3,"ngClass"],[1,"text-xs"],[1,"text-center","text-xs"],[1,"text-3xl","text-amber-300","animate-pulse"],[1,"py-3","border-1","border-lime-400","bg-lime-400/20","px-2","py-1","text-lime-300","font-bold","hover:bg-lime-400/30","transition"],[1,"w-full","text-center","text-sm","mt-2","h-4","bg-neutral-700/80","rounded","overflow-hidden","relative","animate-pulse","text-white"],[1,"flex","justify-center"],[1,"relative","inline-block"],[1,"chess-board","bg-amber-100","border-2","sm:border-4","border-amber-800","p-2","sm:p-6","relative"],[1,"flex","justify-center","mb-1","sm:mb-2"],[1,"grid","grid-cols-9","gap-0"],[1,"w-[36px]","sm:w-[50px]","text-center","text-xs","font-bold","text-amber-800"],[1,"flex"],[1,"flex","flex-col","justify-center","mr-1","sm:mr-2"],[1,"h-[40px]","sm:h-[50px]","flex","items-center","justify-center","text-xs","font-bold","text-amber-800","w-4","sm:w-6"],[1,"relative","w-[310px]","h-[360px]","sm:w-[408px]","sm:h-[450px]","bg-amber-100"],["viewBox","0 0 100 100",1,"absolute","top-0","left-[122px]","w-[72px]","h-[80px]","sm:hidden"],["x1","0","y1","0","x2","100","y2","100","stroke","#d97706","stroke-width","1"],["x1","100","y1","0","x2","0","y2","100","stroke","#d97706","stroke-width","1"],["viewBox","0 0 100 100",1,"absolute","bottom-0","left-[122px]","w-[72px]","h-[80px]","sm:hidden"],["viewBox","0 0 100 100",1,"absolute","top-0","left-[154px]","w-[100px]","h-[100px]","hidden","sm:block"],["viewBox","0 0 100 100",1,"absolute","bottom-0","left-[154px]","w-[100px]","h-[100px]","hidden","sm:block"],[1,"absolute","left-0","right-0","bg-amber-100","flex","items-center","justify-between","px-8","z-5","sm:hidden",2,"top","161px","height","40px"],[1,"text-amber-700","font-bold","text-xs","tracking-wider"],[1,"absolute","left-0","right-0","bg-amber-100","flex","items-center","justify-between","px-16","z-5","hidden","sm:flex",2,"top","204px","height","50px"],[1,"text-amber-700","font-bold","text-sm","tracking-wider"],[1,"flex","flex-col","justify-center","ml-1","sm:ml-2"],[1,"flex","justify-center","mt-1","sm:mt-2"],[1,"absolute","inset-0","bg-black/50","backdrop-blur-sm","flex","items-center","justify-center","z-50","rounded-lg"],[1,"mt-6"],[1,"mt-4","text-xs","text-amber-600","text-center"],[1,"mb-1"],[1,"py-3","border-1","border-lime-400","bg-lime-400/20","px-2","py-1","text-lime-300","font-bold","hover:bg-lime-400/30","transition",3,"click"],[1,"absolute","left-0","right-0","h-[1px]","bg-amber-800",3,"ngClass"],[1,"absolute","left-0","right-0","h-[1px]","bg-amber-800","hidden","sm:block"],[1,"absolute","w-[1px]","bg-amber-800","sm:hidden"],[1,"absolute","w-[1px]","bg-amber-800","hidden","sm:block"],[1,"absolute","w-[20px]","h-[20px]","-translate-x-1/2","-translate-y-1/2","rounded-full","hover:bg-amber-200/30","cursor-pointer","z-20","sm:hidden",3,"click","ngClass"],[1,"absolute","w-[6px]","h-[6px]","bg-amber-800","rounded-full","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[32px]","h-[32px]",3,"ngClass"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-2","h-2","bg-green-500","rounded-full","opacity-70"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[34px]","h-[34px]","border-2","border-red-500","rounded-full"],[1,"absolute","w-[24px]","h-[24px]","-translate-x-1/2","-translate-y-1/2","rounded-full","hover:bg-amber-200/30","cursor-pointer","z-20","hidden","sm:block",3,"click","ngClass"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[40px]","h-[40px]",3,"ngClass"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-3","h-3","bg-green-500","rounded-full","opacity-70"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[42px]","h-[42px]","border-2","border-red-500","rounded-full"],[1,"w-8","h-8","rounded-full","border-2","flex","items-center","justify-center","text-sm","font-bold","shadow-lg"],[1,"w-10","h-10","rounded-full","border-2","flex","items-center","justify-center","text-lg","font-bold","shadow-lg"],[1,"bg-gradient-to-br","from-amber-600","to-amber-800","border-2","border-amber-400","rounded-lg","p-8","shadow-2xl","text-center"],[1,"text-3xl","mb-4"],[1,"text-2xl","font-bold","mb-4","text-amber-100"],[1,"bg-amber-400","hover:bg-amber-300","text-amber-900","font-bold","py-3","px-6","rounded-lg","transition-all","duration-200","transform","hover:scale-105","shadow-lg",3,"click"],[1,"text-lg","font-bold","text-amber-400","mb-3"],[1,"bg-neutral-900/70","border","border-neutral-700","rounded-md","p-4","max-h-32","overflow-y-auto"],[1,"grid","grid-cols-2","gap-2","text-sm"],[1,"text-neutral-400"],[1,"text-red-400"],[1,"text-neutral-300"]],template:function(t,i){t&1&&(d(0,"div",0)(1,"header",1)(2,"div",2)(3,"h1",3),m(4," \u4E2D\u570B\u8C61\u68CB "),c(),d(5,"a",4),m(6,"HOME"),c()(),d(7,"div",5)(8,"button",6),T("click",function(){return i.startPvP()}),m(9," \u{1F465} \u96D9\u4EBA\u5C0D\u6230 "),c(),d(10,"button",7),T("click",function(){return i.startVsAI()}),m(11," \u{1F916} \u4EBA\u6A5F\u5C0D\u6230 "),c(),d(12,"button",6),T("click",function(){return i.resetGame(!1)}),m(13," \u91CD\u65B0\u958B\u59CB "),c()(),d(14,"div",8)(15,"div",9)(16,"div",10)(17,"div",11),m(18,"\u7576\u524D\u56DE\u5408"),c(),d(19,"div",12),x(20,fe,2,0,"span"),m(21),c()(),x(22,xe,2,0,"div",13),x(23,ve,3,0,"button",14),d(24,"div",15),x(25,be,1,0),c()()()(),d(26,"main",16)(27,"div",17)(28,"div",18)(29,"div",19)(30,"div",20),E(31,Ce,2,1,"div",21,R),c()(),d(33,"div",22)(34,"div",23),E(35,ye,2,1,"div",24,R),c(),d(37,"div",25),E(38,ge,2,9,null,null,R),E(40,_e,4,24,null,null,R),Q(),d(42,"svg",26),g(43,"line",27)(44,"line",28),c(),d(45,"svg",29),g(46,"line",27)(47,"line",28),c(),d(48,"svg",30),g(49,"line",27)(50,"line",28),c(),d(51,"svg",31),g(52,"line",27)(53,"line",28),c(),Z(),d(54,"div",32)(55,"span",33),m(56,"\u695A\u6CB3"),c(),d(57,"span",33),m(58,"\u6F22\u754C"),c()(),d(59,"div",34)(60,"span",35),m(61,"\u695A\u6CB3"),c(),d(62,"span",35),m(63,"\u6F22\u754C"),c()(),E(64,Re,2,0,null,null,j),c(),d(66,"div",36),E(67,Be,2,1,"div",24,R),c()(),d(69,"div",37)(70,"div",20),E(71,Ge,2,1,"div",21,R),c()()(),x(73,Ne,8,1,"div",38),c()(),m(74),ie(75,"json"),x(76,He,7,0,"section",39),d(77,"footer",40)(78,"p",41),m(79,"\u9EDE\u64CA\u9078\u64C7\u68CB\u5B50\uFF0C\u518D\u9EDE\u64CA\u76EE\u6A19\u4F4D\u7F6E\u79FB\u52D5"),c(),d(80,"p"),m(81,"\u7D05\u65B9\u5148\u884C\uFF0C\u5C07\u8ECD\u5C0D\u65B9\u5373\u7372\u52DD"),c()()()),t&2&&(l(16),B("ngClass",i.currentPlayer()===i.PlayerColor.RED?"bg-red-500/20 border-red-400 text-red-300":"bg-neutral-800/20 border-neutral-400 text-neutral-300"),l(4),v(i.isVsAI()&&i.currentPlayer()===i.PlayerColor.BLACK?20:-1),l(),D("",i.currentPlayerDisplay()," "),l(),v(i.isInCheck()?22:-1),l(),v(i.isVsAI()?23:-1),l(2),v(i.aiIsThinking()?25:-1),l(6),I(i.getColumnLetters()),l(4),I(i.getRowNumbers()),l(3),I(X(11,me)),l(2),I(X(12,pe)),l(24),I(i.board()),l(3),I(i.getRowNumbers()),l(4),I(i.getColumnLetters()),l(2),v(i.gameOver()?73:-1),l(),D(" ",ne(75,9,i.moveHistory())," "),l(2),v(i.moveHistory().length>0?76:-1))},dependencies:[se,oe,ae,re],styles:['.chess-board[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fef3c7,#fed7aa);box-shadow:0 8px 32px #0000004d}.chess-square[_ngcontent-%COMP%]{position:relative;background:transparent;transition:all .2s ease}.chess-square[_ngcontent-%COMP%]:hover{background-color:#f59e0b1a}.chess-square.selected[_ngcontent-%COMP%]{background-color:#22c55e4d!important;border-color:#22c55e!important;box-shadow:inset 0 0 0 2px #22c55e}.chess-square.valid-move[_ngcontent-%COMP%]{background-color:#22c55e26!important}.chess-square.valid-move[_ngcontent-%COMP%]:after{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:12px;height:12px;background-color:#22c55e;border-radius:50%;opacity:.8}.chess-square.valid-move[_ngcontent-%COMP%]:hover:after{width:16px;height:16px;opacity:1}.chess-square.palace[_ngcontent-%COMP%]{background-color:#f59e0b0d}.chess-piece[_ngcontent-%COMP%]{transition:all .3s ease;z-index:10}.chess-piece.selected[_ngcontent-%COMP%]{transform:scale(1.1);filter:drop-shadow(0 0 8px rgba(34,197,94,.6))}.chess-piece.red[_ngcontent-%COMP%]   .piece-symbol[_ngcontent-%COMP%]{color:#dc2626;background:linear-gradient(135deg,#fecaca,#fee2e2);border-color:#dc2626}.chess-piece.black[_ngcontent-%COMP%]   .piece-symbol[_ngcontent-%COMP%]{color:#374151;background:linear-gradient(135deg,#f3f4f6,#e5e7eb);border-color:#374151}.chess-piece[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.move-history[_ngcontent-%COMP%]{scrollbar-width:thin;scrollbar-color:#6b7280 #1f2937}.move-history[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.move-history[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#1f2937;border-radius:3px}.move-history[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#6b7280;border-radius:3px}.move-history[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#9ca3af}@media (max-width: 640px){.chess-board[_ngcontent-%COMP%]{padding:1rem}.chess-board[_ngcontent-%COMP%]   .chess-square[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem}.chess-board[_ngcontent-%COMP%]   .chess-piece[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:2rem;height:2rem;font-size:.875rem}}@keyframes _ngcontent-%COMP%_piece-capture{0%{transform:scale(1);opacity:1}50%{transform:scale(1.3);opacity:.7}to{transform:scale(0);opacity:0}}.captured[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_piece-capture .5s ease-out forwards}@keyframes _ngcontent-%COMP%_check-warning{0%,to{box-shadow:0 0 #ef4444b3}50%{box-shadow:0 0 0 10px #ef444400}}.in-check[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_check-warning 1s infinite}.valid-move-point.valid-move[_ngcontent-%COMP%]:after{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:10px;height:10px;background-color:#22c55e;border-radius:50%;opacity:.7}.valid-move-point[_ngcontent-%COMP%]:hover{background-color:#f59e0b33}']})};export{ue as ChineseChess};
