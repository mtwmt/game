import{A as v,B as u,C as y,D as E,E as B,F as O,G as X,I as b,J,K as q,L as K,M as Q,R as Z,b as L,c as z,d as _,e as P,g as f,h as H,i as N,k as c,l as j,m as C,n as w,o as $,q as k,r as U,s as T,t as s,u as m,v as D,w as M,x as S,y as x,z as Y}from"./chunk-SMCJFMY5.js";var V=class d{findPath(e,t,i,o,l){let n=this.tryDirectPath(e,t,i,o,l);if(n)return n;let r=this.tryLShapePath(e,t,i,o,l);if(r)return r;let a=this.tryUShapePath(e,t,i,o,l);if(a)return a;let h=this.tryBoundaryPath(e,t,i,o,l);return h||null}tryDirectPath(e,t,i,o,l){return e.y===t.y&&this.isPathClear(e,t,"horizontal",i,o,l)?[{start:e,end:t,direction:"horizontal"}]:e.x===t.x&&this.isPathClear(e,t,"vertical",i,o,l)?[{start:e,end:t,direction:"vertical"}]:null}tryLShapePath(e,t,i,o,l){let n={x:e.x,y:t.y},r=!(n.x===e.x&&n.y===e.y)&&!(n.x===t.x&&n.y===t.y),a=this.isValidPosition(n,i,o,l),h=r&&a&&this.isPathClear(e,n,"vertical",i,o,l),p=h&&this.isPathClear(n,t,"horizontal",i,o,l);if(typeof window<"u"&&e.x===1&&e.y===2&&t.x===4&&t.y===1&&(console.log(`L1 \u8DEF\u5F91\u5206\u6790: corner1=(${n.x},${n.y})`),console.log("- \u8F49\u89D2\u9EDE\u6709\u6548:",r),console.log("- \u8F49\u89D2\u9EDE\u4F4D\u7F6E\u6709\u6548:",a),console.log("- \u5782\u76F4\u8DEF\u5F91\u66A2\u901A:",h),console.log("- \u6C34\u5E73\u8DEF\u5F91\u66A2\u901A:",p),a&&console.log("- \u8F49\u89D2\u9EDE\u5167\u5BB9:",n.x>=0&&n.x<o&&n.y>=0&&n.y<l?i[n.y][n.x]?"\u6709\u65B9\u584A":"\u7A7A\u767D":"\u908A\u754C\u5916")),r&&a&&h&&p)return[{start:e,end:n,direction:"vertical"},{start:n,end:t,direction:"horizontal"}];let g={x:t.x,y:e.y},G=!(g.x===e.x&&g.y===e.y)&&!(g.x===t.x&&g.y===t.y),I=this.isValidPosition(g,i,o,l),F=G&&I&&this.isPathClear(e,g,"horizontal",i,o,l),R=F&&this.isPathClear(g,t,"vertical",i,o,l);return typeof window<"u"&&e.x===1&&e.y===2&&t.x===4&&t.y===1&&(console.log(`L2 \u8DEF\u5F91\u5206\u6790: corner2=(${g.x},${g.y})`),console.log("- \u8F49\u89D2\u9EDE\u6709\u6548:",G),console.log("- \u8F49\u89D2\u9EDE\u4F4D\u7F6E\u6709\u6548:",I),console.log("- \u6C34\u5E73\u8DEF\u5F91\u66A2\u901A:",F),console.log("- \u5782\u76F4\u8DEF\u5F91\u66A2\u901A:",R),I&&console.log("- \u8F49\u89D2\u9EDE\u5167\u5BB9:",g.x>=0&&g.x<o&&g.y>=0&&g.y<l?i[g.y][g.x]?"\u6709\u65B9\u584A":"\u7A7A\u767D":"\u908A\u754C\u5916")),G&&I&&F&&R?[{start:e,end:g,direction:"horizontal"},{start:g,end:t,direction:"vertical"}]:null}tryUShapePath(e,t,i,o,l){for(let n=0;n<o;n++)if(n!==e.x&&n!==t.x){let r={x:n,y:e.y},a={x:n,y:t.y};if(this.isValidPosition(r,i,o,l)&&this.isValidPosition(a,i,o,l)&&this.isPathClear(e,r,"horizontal",i,o,l)&&this.isPathClear(r,a,"vertical",i,o,l)&&this.isPathClear(a,t,"horizontal",i,o,l))return[{start:e,end:r,direction:"horizontal"},{start:r,end:a,direction:"vertical"},{start:a,end:t,direction:"horizontal"}]}for(let n=0;n<l;n++)if(n!==e.y&&n!==t.y){let r={x:e.x,y:n},a={x:t.x,y:n};if(this.isValidPosition(r,i,o,l)&&this.isValidPosition(a,i,o,l)&&this.isPathClear(e,r,"vertical",i,o,l)&&this.isPathClear(r,a,"horizontal",i,o,l)&&this.isPathClear(a,t,"vertical",i,o,l))return[{start:e,end:r,direction:"vertical"},{start:r,end:a,direction:"horizontal"},{start:a,end:t,direction:"vertical"}]}return null}tryBoundaryPath(e,t,i,o,l){let n=[{y:-1,name:"top"},{y:l,name:"bottom"},{x:-1,name:"left"},{x:o,name:"right"}];for(let r of n){let a=this.tryBoundaryRoute(e,t,r,i,o,l);if(a)return a}return null}tryBoundaryRoute(e,t,i,o,l,n){if("y"in i){let r={x:e.x,y:i.y},a={x:t.x,y:i.y};if(this.isPathClear(e,r,"vertical",o,l,n)&&this.isPathClear(r,a,"horizontal",o,l,n)&&this.isPathClear(a,t,"vertical",o,l,n))return[{start:e,end:r,direction:"vertical"},{start:r,end:a,direction:"horizontal"},{start:a,end:t,direction:"vertical"}]}else{let r={x:i.x,y:e.y},a={x:i.x,y:t.y};if(this.isPathClear(e,r,"horizontal",o,l,n)&&this.isPathClear(r,a,"vertical",o,l,n)&&this.isPathClear(a,t,"horizontal",o,l,n))return[{start:e,end:r,direction:"horizontal"},{start:r,end:a,direction:"vertical"},{start:a,end:t,direction:"horizontal"}]}return null}isPathClear(e,t,i,o,l,n){if(e.x===t.x&&e.y===t.y)return!0;if(i==="horizontal"){if(e.y!==t.y)return!1;let r=Math.min(e.x,t.x),a=Math.max(e.x,t.x);return this.checkLineEmpty(r+1,a,e.y,"horizontal",o,l,n)}else{if(e.x!==t.x)return!1;let r=Math.min(e.y,t.y),a=Math.max(e.y,t.y);return this.checkLineEmpty(r+1,a,e.x,"vertical",o,l,n)}}checkLineEmpty(e,t,i,o,l,n,r){for(let a=e;a<t;a++){let h=o==="horizontal"?a:i,p=o==="horizontal"?i:a;if(h>=0&&h<n&&p>=0&&p<r&&l[p][h])return!1}return!0}isValidPosition(e,t,i,o){return e.x<0||e.x>=i||e.y<0||e.y>=o?!0:!t[e.y][e.x]}static \u0275fac=function(t){return new(t||d)};static \u0275prov=L({token:d,factory:d.\u0275fac,providedIn:"root"})};var A=class d{initializeBoard(e,t,i){let o=[],l=0,n=e*t,r=[];for(let h=0;h<n/2;h++){let p=h%i;r.push(p,p)}for(let h=r.length-1;h>0;h--){let p=Math.floor(Math.random()*(h+1));[r[h],r[p]]=[r[p],r[h]]}let a=0;for(let h=0;h<t;h++){o[h]=[];for(let p=0;p<e;p++)a<r.length?o[h][p]={id:l++,petType:r[a++],position:{x:p,y:h},selected:!1}:o[h][p]=null}return o}removeTiles(e,t,i){e[t.position.y][t.position.x]=null,e[i.position.y][i.position.x]=null}collapseBoardDown(e,t,i){for(let o=0;o<t;o++){let l=[];for(let n=i-1;n>=0;n--)e[n][o]&&l.unshift(e[n][o]);for(let n=0;n<i;n++)if(n<i-l.length)e[n][o]=null;else{let r=l[n-(i-l.length)];r&&(r.position={x:o,y:n},e[n][o]=r)}}}collapseBoardUp(e,t,i){for(let o=0;o<t;o++){let l=[];for(let n=0;n<i;n++)e[n][o]&&l.push(e[n][o]);for(let n=0;n<i;n++)if(n<l.length){let r=l[n];r&&(r.position={x:o,y:n},e[n][o]=r)}else e[n][o]=null}}collapseBoardLeft(e,t,i){for(let o=0;o<i;o++){let l=[];for(let n=0;n<t;n++)e[o][n]&&l.push(e[o][n]);for(let n=0;n<t;n++)if(n<l.length){let r=l[n];r&&(r.position={x:n,y:o},e[o][n]=r)}else e[o][n]=null}}collapseBoardRight(e,t,i){for(let o=0;o<i;o++){let l=[];for(let n=t-1;n>=0;n--)e[o][n]&&l.unshift(e[o][n]);for(let n=0;n<t;n++)if(n<t-l.length)e[o][n]=null;else{let r=l[n-(t-l.length)];r&&(r.position={x:n,y:o},e[o][n]=r)}}}getRemainingTileCount(e){return e.flat().filter(t=>t!==null).length}isGameComplete(e){return this.getRemainingTileCount(e)===0}hasValidMoves(e,t,i,o){for(let l=0;l<i;l++)for(let n=0;n<t;n++){let r=e[l][n];if(r)for(let a=0;a<i;a++)for(let h=0;h<t;h++){let p=e[a][h];if(!(!p||r.id===p.id||r.petType!==p.petType)&&o.findPath(r.position,p.position,e,t,i))return!0}}return!1}getElapsedTime(e){return Math.floor((Date.now()-e)/1e3)}formatTime(e){let t=Math.floor(e/60),i=e%60;return`${t.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`}static \u0275fac=function(t){return new(t||d)};static \u0275prov=L({token:d,factory:d.\u0275fac,providedIn:"root"})};var te=d=>({"grid-template-columns":d}),ie=(d,e)=>(e==null?null:e.id)||d;function ne(d,e){if(d&1){let t=M();s(0,"button",30),S("click",function(){_(t);let o=x();return P(o.resetGame())}),u(1," \u91CD\u65B0\u958B\u59CB "),m()}}function oe(d,e){if(d&1){let t=M();s(0,"button",31),S("click",function(){_(t);let o=x();return P(o.resetGame())}),u(1," \u65B0\u904A\u6232 "),m()}}function le(d,e){if(d&1&&(s(0,"span",34),u(1),m()),d&2){let t=x().$implicit,i=x(2);c(),y(i.petEmojis[t.petType])}}function re(d,e){if(d&1){let t=M();s(0,"div",33),S("click",function(){let o=_(t).$implicit,l=x(2);return P(l.onTileClick(o))}),C(1,le,2,1,"span",34),m()}if(d&2){let t=e.$implicit,i=x(2);T("ngClass",i.getTileClass(t)),c(),w(t?1:-1)}}function ae(d,e){if(d&1&&k(0,re,2,2,"div",32,ie),d&2){let t=e.$implicit;U(t)}}function se(d,e){if(d&1&&D(0,"div",35),d&2){let t=e.$implicit,i=x(2);T("ngStyle",i.getPathStyle(t))}}function ce(d,e){if(d&1&&(s(0,"div",28),k(1,se,1,1,"div",35,$),m()),d&2){let t=x();c(),U(t.matchPath())}}function me(d,e){if(d&1){let t=M();s(0,"div",29)(1,"div",36),D(2,"div",37),s(3,"h2",38),u(4),m(),s(5,"div",39)(6,"div"),u(7,"\u7E3D\u5206\u6578"),m(),s(8,"div",40),u(9),m()(),s(10,"button",41),S("click",function(){_(t);let o=x();return P(o.resetGame())}),u(11," \u91CD\u65B0\u958B\u59CB "),m()()()}if(d&2){let t=x();c(),v(t.timeUp()?"from-red-600 to-red-800 border-red-400 shadow-red-400/50":"from-orange-600 to-orange-800 border-orange-400 shadow-orange-400/50"),c(),T("innerHTML",t.timeUp()?"\u23F0":"\u{1F635}",N),c(),v(t.timeUp()?"text-red-100":"text-orange-100"),c(),E(" ",t.timeUp()?"\u6642\u9593\u5230\u4E86\uFF01":"\u904A\u6232\u7D50\u675F"," "),c(),v(t.timeUp()?"bg-red-700/50":"bg-orange-700/50"),c(),v(t.timeUp()?"text-red-200":"text-orange-200"),c(2),v(t.timeUp()?"text-red-100":"text-orange-100"),c(),E(" ",t.score()," "),c(),v(t.timeUp()?"bg-red-500 hover:bg-red-400 text-red-900":"bg-orange-500 hover:bg-orange-400 text-orange-900")}}function de(d,e){if(d&1&&(s(0,"div",42)(1,"div",43),u(2,"\u{1F3AE} \u904A\u6232\u7D71\u8A08 \u{1F3AE}"),m(),s(3,"div",44)(4,"div",45)(5,"div",46),u(6,"\u7E3D\u79FB\u52D5"),m(),s(7,"div",47),u(8),m()(),s(9,"div",45)(10,"div",46),u(11,"\u7E3D\u6642\u9593"),m(),s(12,"div",47),u(13),m()(),s(14,"div",45)(15,"div",46),u(16,"\u9053\u5177\u4F7F\u7528"),m(),s(17,"div",47),u(18),m()(),s(19,"div",45)(20,"div",46),u(21,"\u6700\u7D42\u5206\u6578"),m(),s(22,"div",47),u(23),m()()()()),d&2){let t=x(2);c(8),y(t.moves()),c(5),y(t.formattedTime()),c(5),E(" ",t.totalShufflesUsed()+t.totalHintsUsed()," "),c(5),y(t.score())}}function ue(d,e){if(d&1&&(s(0,"div",48)(1,"div",49)(2,"div",50),u(3,"\u79FB\u52D5\u6B21\u6578"),m(),s(4,"div",51),u(5),m()(),s(6,"div",49)(7,"div",50),u(8,"\u5B8C\u6210\u6642\u9593"),m(),s(9,"div",51),u(10),m()()(),s(11,"div",52)(12,"div",50),u(13,"\u7E3D\u5206\u6578"),m(),s(14,"div",53),u(15),m()()),d&2){let t=x(2);c(5),y(t.moves()),c(5),y(t.formattedTime()),c(5),y(t.score())}}function he(d,e){if(d&1){let t=M();s(0,"div",29)(1,"div",36),D(2,"div",37),s(3,"h2",38),u(4),m(),C(5,de,24,4,"div",42)(6,ue,16,3),s(7,"button",41),S("click",function(){_(t);let o=x();return P(o.gameComplete()?o.resetGame():o.nextLevel())}),u(8),m()()()}if(d&2){let t=x();c(),v(t.gameComplete()?"from-yellow-500 to-yellow-700 border-yellow-300 shadow-yellow-300/50":"from-green-600 to-green-800 border-green-400 shadow-green-400/50"),c(),T("innerHTML",t.gameComplete()?"\u{1F3C6}":"\u{1F389}",N),c(),v(t.gameComplete()?"text-yellow-100":"text-green-100"),c(),E(" ",t.gameComplete()?"\u606D\u559C\u4F60\u5168\u90E8\u7834\u95DC\uFF01":"\u95DC\u5361 "+t.level()+" \u5B8C\u6210\uFF01"," "),c(),w(t.gameComplete()?5:6),c(2),v(t.gameComplete()?"bg-yellow-400 hover:bg-yellow-300 text-yellow-900":"bg-green-500 hover:bg-green-400 text-green-900"),c(),E(" ",t.gameComplete()?"\u91CD\u65B0\u6311\u6230":"\u4E0B\u4E00\u95DC \u2192"," ")}}var ee=class d{pathfindingService=z(V);gameLogicService=z(A);platformId=z(H);isBrowser=Q(this.platformId);boardWidth=6;boardHeight=8;petTypes=12;board=f([]);selectedTiles=f([]);score=f(0);level=f(1);gameOver=f(!1);levelComplete=f(!1);gameComplete=f(!1);matchPath=f([]);showPath=f(!1);moves=f(0);gameTime=f(0);remainingTiles=b(()=>this.gameLogicService.getRemainingTileCount(this.board()));formattedTime=b(()=>this.gameLogicService.formatTime(this.gameTime()));MAX_LEVEL_TIME=300;countdownTime=f(this.MAX_LEVEL_TIME);formattedCountdown=b(()=>{let e=this.countdownTime(),t=Math.floor(e/60),i=e%60;return`${t.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`});timeUp=b(()=>this.countdownTime()<=0);timelinePercentage=b(()=>this.countdownTime()/this.MAX_LEVEL_TIME*100);timelineColorClass=b(()=>this.countdownTime()<=30?"from-red-500 to-red-300":this.countdownTime()<=60?"from-yellow-500 to-yellow-300":"from-lime-500 to-lime-300");timelineTextClass=b(()=>this.countdownTime()<=this.MAX_LEVEL_TIME*.5?"text-white":"text-neutral-900/90");totalShufflesUsed=f(0);totalHintsUsed=f(0);maxShufflesPerGame=f(5);maxHintsPerGame=f(5);remainingShuffles=b(()=>this.maxShufflesPerGame()-this.totalShufflesUsed());remainingHints=b(()=>this.maxHintsPerGame()-this.totalHintsUsed());hintTiles=f([]);showHint=f(!1);animationTimeout;gameStartTime=0;timeUpdateInterval;countdownInterval;levelStartTime=0;petEmojis=["\u{1F436}","\u{1F431}","\u{1F42D}","\u{1F439}","\u{1F430}","\u{1F98A}","\u{1F43B}","\u{1F43C}","\u{1F437}","\u{1F438}","\u{1F435}","\u{1F98B}"];ngOnInit(){this.initializeBoard()}ngOnDestroy(){this.clearAllTimers()}clearAllTimers(){this.animationTimeout&&clearTimeout(this.animationTimeout),this.timeUpdateInterval&&clearInterval(this.timeUpdateInterval),this.countdownInterval&&clearInterval(this.countdownInterval)}initializeBoard(){let e=this.gameLogicService.initializeBoard(this.boardWidth,this.boardHeight,this.petTypes);this.board.set(e),this.startLevelTimer()}startLevelTimer(){this.isBrowser&&(this.clearAllTimers(),this.levelStartTime=Date.now(),this.countdownTime.set(this.MAX_LEVEL_TIME),this.timeUpdateInterval=setInterval(()=>{let e=this.gameLogicService.getElapsedTime(this.levelStartTime);this.gameTime.set(e)},1e3),this.countdownInterval=setInterval(()=>{let e=this.gameLogicService.getElapsedTime(this.levelStartTime),t=Math.max(0,this.MAX_LEVEL_TIME-e);this.countdownTime.set(t),t<=0&&this.handleTimeUp()},1e3))}handleTimeUp(){this.gameOver()||(this.clearAllTimers(),this.gameOver.set(!0))}getCurrentLevelType(){let e=this.level();return e===1?"classic":e===2?"down":e===3?"up":e===4?"left":"right"}applyLevelGravity(e){switch(this.getCurrentLevelType()){case"classic":break;case"down":this.gameLogicService.collapseBoardDown(e,this.boardWidth,this.boardHeight);break;case"up":this.gameLogicService.collapseBoardUp(e,this.boardWidth,this.boardHeight);break;case"left":this.gameLogicService.collapseBoardLeft(e,this.boardWidth,this.boardHeight);break;case"right":this.gameLogicService.collapseBoardRight(e,this.boardWidth,this.boardHeight);break}}onTileClick(e){if(!e||this.gameOver()||this.showPath())return;let t=this.selectedTiles();if(e.selected){e.selected=!1,this.selectedTiles.set(t.filter(o=>o.id!==e.id));return}t.length>=2&&this.clearSelection(),e.selected=!0;let i=[...t,e];this.selectedTiles.set(i),i.length===2&&this.checkMatch(i[0],i[1])}checkMatch(e,t){if(e.petType!==t.petType){this.isBrowser?setTimeout(()=>this.clearSelection(),300):this.clearSelection();return}this.moves.update(o=>o+1);let i=this.pathfindingService.findPath(e.position,t.position,this.board(),this.boardWidth,this.boardHeight);if(this.isBrowser&&!i&&console.log(`\u914D\u5C0D\u5931\u6557: \u5BF5\u7269${this.petEmojis[e.petType]} (${e.position.x},${e.position.y}) \u2192 (${t.position.x},${t.position.y}) \u7121\u6CD5\u627E\u5230\u8DEF\u5F91`),i){this.matchPath.set(i),this.showPath.set(!0);let o=()=>{let l=this.board();this.gameLogicService.removeTiles(l,e,t),this.applyLevelGravity(l),this.board.set([...l]),this.score.update(n=>n+10),this.showPath.set(!1),this.matchPath.set([]),this.clearSelection(),this.checkGameOver()};this.isBrowser?this.animationTimeout=setTimeout(o,200):o()}else this.isBrowser?setTimeout(()=>this.clearSelection(),300):this.clearSelection()}clearSelection(){this.selectedTiles().forEach(t=>t.selected=!1),this.selectedTiles.set([])}checkGameOver(){let e=this.board();if(this.gameLogicService.isGameComplete(e)){this.levelComplete.set(!0),this.clearAllTimers(),this.level()>=5&&this.gameComplete.set(!0);return}this.gameLogicService.hasValidMoves(e,this.boardWidth,this.boardHeight,this.pathfindingService)||(this.remainingTiles()>0&&this.canUseShuffle()?(console.log("\u81EA\u52D5\u89F8\u767C\u91CD\u6392\uFF1A\u7121\u53EF\u7528\u79FB\u52D5\u4F46\u9084\u6709\u5269\u9918\u65B9\u584A"),this.shuffleTiles()):(this.gameOver.set(!0),this.stopTimer()))}stopTimer(){this.timeUpdateInterval&&(clearInterval(this.timeUpdateInterval),this.timeUpdateInterval=void 0)}nextLevel(){this.gameComplete()||(this.level.update(e=>e+1),this.levelComplete.set(!1),this.clearSelection(),this.showPath.set(!1),this.matchPath.set([]),this.hideHint(),this.clearAllTimers(),this.animationTimeout&&clearTimeout(this.animationTimeout),this.initializeBoard())}resetGame(){this.score.set(0),this.level.set(1),this.moves.set(0),this.gameTime.set(0),this.totalShufflesUsed.set(0),this.totalHintsUsed.set(0),this.hideHint(),this.gameOver.set(!1),this.levelComplete.set(!1),this.gameComplete.set(!1),this.clearSelection(),this.showPath.set(!1),this.matchPath.set([]),this.clearAllTimers(),this.animationTimeout&&clearTimeout(this.animationTimeout),this.initializeBoard()}getTileClass(e){if(!e)return"bg-stone-800 border border-stone-700";let t="bg-gradient-to-br border-2 cursor-pointer flex items-center justify-center text-2xl";if(e.selected)return`${t} from-yellow-400 to-yellow-600 border-yellow-300 brightness-125`;if(this.isHintTile(e))return`${t} from-green-400 to-green-600 border-green-300 animate-pulse ring-2 ring-green-400 ring-opacity-75`;let i=["from-blue-400 to-blue-600 border-blue-300","from-pink-400 to-pink-600 border-pink-300","from-gray-400 to-gray-600 border-gray-300","from-yellow-400 to-yellow-600 border-yellow-300","from-purple-400 to-purple-600 border-purple-300","from-orange-400 to-orange-600 border-orange-300","from-amber-600 to-amber-800 border-amber-400","from-slate-400 to-slate-600 border-slate-300","from-rose-400 to-rose-600 border-rose-300","from-green-400 to-green-600 border-green-300","from-teal-400 to-teal-600 border-teal-300","from-violet-400 to-violet-600 border-violet-300"];return`${t} ${i[e.petType]||i[0]}`}getPathStyle(e){let o=e.start.x*50,l=e.start.y*50,n=e.end.x*50,r=e.end.y*50;if(e.direction==="horizontal"){let a=Math.min(o,n)+24,h=Math.abs(n-o),p=l+48/2-1;return{position:"absolute",left:`${a}px`,top:`${p}px`,width:`${h}px`,height:"2px",background:"linear-gradient(90deg, #fbbf24, #f59e0b)",boxShadow:"0 0 8px #fbbf24, 0 0 8px #f59e0b",zIndex:10}}else{let a=Math.min(l,r)+24,h=Math.abs(r-l);return{position:"absolute",left:`${o+48/2-1}px`,top:`${a}px`,width:"2px",height:`${h}px`,background:"linear-gradient(180deg, #fbbf24, #f59e0b)",boxShadow:"0 0 8px #fbbf24, 0 0 16px #f59e0b",zIndex:10}}}shuffleTiles(){if(!this.canUseShuffle()||this.gameOver()||this.levelComplete()||this.remainingTiles()===0)return;this.clearSelection();let e=this.board(),t=[];for(let l=0;l<this.boardHeight;l++)for(let n=0;n<this.boardWidth;n++)e[l][n]&&t.push(e[l][n].petType);for(let l=t.length-1;l>0;l--){let n=Math.floor(Math.random()*(l+1));[t[l],t[n]]=[t[n],t[l]]}let i=0,o=Date.now();for(let l=0;l<this.boardHeight;l++)for(let n=0;n<this.boardWidth;n++)e[l][n]&&(e[l][n]={id:o++,petType:t[i++],position:{x:n,y:l},selected:!1});this.board.set([...e]),this.totalShufflesUsed.update(l=>l+1),this.checkGameOver()}hasAvailableMoves(){return this.gameLogicService.hasValidMoves(this.board(),this.boardWidth,this.boardHeight,this.pathfindingService)}canUseShuffle(){return this.remainingShuffles()>0&&!this.gameOver()&&!this.levelComplete()&&!this.timeUp()&&this.remainingTiles()>0}useHint(){if(!this.canUseHint())return;this.clearSelection();let e=this.findValidPair();e&&(this.hintTiles.set([e.tile1,e.tile2]),this.showHint.set(!0),this.totalHintsUsed.update(t=>t+1),this.isBrowser&&setTimeout(()=>this.hideHint(),3e3))}hideHint(){this.showHint.set(!1),this.hintTiles.set([])}canUseHint(){return this.remainingHints()>0&&!this.gameOver()&&!this.levelComplete()&&!this.timeUp()&&!this.showHint()&&this.remainingTiles()>0}findValidPair(){let e=this.board();for(let t=0;t<this.boardHeight;t++)for(let i=0;i<this.boardWidth;i++){let o=e[t][i];if(o)for(let l=0;l<this.boardHeight;l++)for(let n=0;n<this.boardWidth;n++){let r=e[l][n];if(!(!r||o.id===r.id)&&o.petType===r.petType&&this.pathfindingService.findPath(o.position,r.position,e,this.boardWidth,this.boardHeight))return{tile1:o,tile2:r}}}return null}isHintTile(e){return!e||!this.showHint()?!1:this.hintTiles().some(t=>t.id===e.id)}static \u0275fac=function(t){return new(t||d)};static \u0275cmp=j({type:d,selectors:[["app-pet-match"]],decls:59,vars:38,consts:[[1,"w-full","max-w-sm","mx-auto","flex","flex-col"],[1,"mb-2","flex","flex-col","gap-3","items-stretch"],[1,"flex","justify-between","items-center"],[1,"text-center","text-2xl","font-bold","tracking-wider","text-lime-400","drop-shadow"],["routerLink","/",1,"text-lime-600","text-sm"],[1,"flex","gap-2"],[1,"h-12","w-1/3","touch-btn","rounded-md","bg-cyan-700","border","border-cyan-500","text-cyan-50","font-semibold","text-base","shadow","hover:bg-cyan-600","focus:outline-none","focus:ring-2","focus:ring-cyan-300"],[1,"h-12","w-1/3","touch-btn","rounded-md","bg-lime-700","border","border-lime-500","text-lime-50","font-semibold","text-base","shadow","hover:bg-lime-600","focus:outline-none","focus:ring-2","focus:ring-lime-300"],[1,"h-12","w-1/3","touch-btn","rounded-md","border","font-medium","shadow","focus:outline-none","focus:ring-2",3,"click","disabled","title"],[1,"flex","flex-col","gap-2"],[1,"flex","items-center","gap-1","justify-center","flex-wrap","bg-neutral-900/70","rounded-md","p-2","border","border-neutral-700"],[1,"border","border-cyan-400","bg-cyan-400/20","px-2","py-1","text-cyan-300","font-bold","hover:bg-cyan-400/30","transition"],[1,"text-cyan-400","text-xs"],[1,"text-center","text-xs"],[1,"border","border-lime-400","bg-lime-400/20","px-2","py-1","text-lime-300","font-bold","hover:bg-lime-400/30","transition"],[1,"text-lime-400","text-xs"],[1,"border","border-yellow-400","bg-yellow-400/20","px-2","py-1","text-yellow-300","font-bold","hover:bg-yellow-400/30","transition"],[1,"text-yellow-400","text-xs"],[1,"border","border-orange-400","bg-orange-400/20","px-2","py-1","text-orange-300","font-bold","hover:bg-orange-400/30","transition"],[1,"text-orange-400","text-xs"],[1,"border","px-2","py-1","font-bold","hover:bg-opacity-30","transition"],[1,"text-xs"],[1,"w-full","mt-2","h-2","bg-neutral-700/80","rounded","overflow-hidden","relative"],[1,"h-full","bg-gradient-to-r","transition-all","duration-300"],[1,"absolute","inset-0","text-[9px]","tracking-wide","font-semibold","flex","items-center","justify-center","select-none","transition-colors","duration-300"],[1,"flex","justify-center"],[1,"relative","inline-block"],[1,"inline-grid","gap-[2px]","p-4","border-2","border-lime-700","rounded-lg",3,"ngStyle"],[1,"absolute","inset-0","pointer-events-none"],[1,"absolute","inset-0","bg-black/50","backdrop-blur-sm","flex","items-center","justify-center","z-50","rounded-lg"],[1,"h-12","w-1/3","touch-btn","rounded-md","bg-cyan-700","border","border-cyan-500","text-cyan-50","font-semibold","text-base","shadow","hover:bg-cyan-600","focus:outline-none","focus:ring-2","focus:ring-cyan-300",3,"click"],[1,"h-12","w-1/3","touch-btn","rounded-md","bg-lime-700","border","border-lime-500","text-lime-50","font-semibold","text-base","shadow","hover:bg-lime-600","focus:outline-none","focus:ring-2","focus:ring-lime-300",3,"click"],[1,"w-12","h-12","rounded-lg","relative",3,"ngClass"],[1,"w-12","h-12","rounded-lg","relative",3,"click","ngClass"],[1,"select-none","pointer-events-none"],[1,"absolute","animate-pulse","transition-all","duration-300",3,"ngStyle"],[1,"bg-gradient-to-br","border-2","rounded-lg","p-8","shadow-2xl","text-center"],[1,"text-3xl","mb-4",3,"innerHTML"],[1,"text-2xl","font-bold","mb-4"],[1,"rounded-lg","p-3","mb-6"],[1,"font-bold","text-2xl"],[1,"font-bold","py-3","px-6","rounded-lg","transition-all","duration-200","transform","hover:scale-105","shadow-lg",3,"click"],[1,"mb-6"],[1,"text-yellow-200","text-lg","mb-4"],[1,"grid","grid-cols-2","gap-4","text-sm"],[1,"bg-yellow-600/50","rounded-lg","p-3"],[1,"text-yellow-200"],[1,"text-yellow-100","font-bold","text-xl"],[1,"grid","grid-cols-2","gap-4","mb-6","text-sm"],[1,"bg-green-700/50","rounded-lg","p-3"],[1,"text-green-200"],[1,"text-green-100","font-bold","text-xl"],[1,"bg-green-700/50","rounded-lg","p-3","mb-6"],[1,"text-green-100","font-bold","text-2xl"]],template:function(t,i){t&1&&(s(0,"div",0)(1,"header",1)(2,"div",2)(3,"h1",3),u(4," \u5BF5\u7269\u9023\u9023\u770B "),m(),s(5,"a",4),u(6,"HOME"),m()(),s(7,"div",5),C(8,ne,2,0,"button",6)(9,oe,2,0,"button",7),s(10,"button",8),S("click",function(){return i.shuffleTiles()}),u(11," \u91CD\u6392 ("),s(12,"span"),u(13),m(),u(14,") "),m(),s(15,"button",8),S("click",function(){return i.useHint()}),u(16," \u63D0\u793A ("),s(17,"span"),u(18),m(),u(19,") "),m()(),s(20,"div",9)(21,"div",10)(22,"div",11)(23,"div",12),u(24,"\u95DC\u5361"),m(),s(25,"div",13),u(26),m()(),s(27,"div",14)(28,"div",15),u(29,"\u5206\u6578"),m(),s(30,"div",13),u(31),m()(),s(32,"div",16)(33,"div",17),u(34,"\u79FB\u52D5"),m(),s(35,"div",13),u(36),m()(),s(37,"div",18)(38,"div",19),u(39,"\u5269\u9918"),m(),s(40,"div",13),u(41),m()(),s(42,"div",20)(43,"div",21),u(44," \u5012\u6578 "),m(),s(45,"div",13),u(46),m()(),s(47,"div",22),D(48,"div",23),s(49,"span",24),u(50),m()()()()(),s(51,"main",25)(52,"div",26)(53,"div",27),k(54,ae,2,0,null,null,$),m(),C(56,ce,3,0,"div",28),C(57,me,12,15,"div",29),C(58,he,9,10,"div",29),m()()()),t&2&&(c(8),w(i.gameOver()?8:9),c(2),v(i.canUseShuffle()?"bg-zinc-800 border-zinc-600 text-lime-200 hover:bg-zinc-700 focus:ring-lime-300":"bg-zinc-800 border-zinc-600 text-zinc-400 opacity-50"),T("title",O("\u91CD\u65B0\u6D17\u724C\u6240\u6709\u65B9\u584A (\u5269\u9918: ",i.remainingShuffles(),")"))("disabled",!i.canUseShuffle()),c(3),B("",i.totalShufflesUsed(),"/",i.maxShufflesPerGame()),c(2),v(i.canUseHint()?"bg-emerald-700 border-emerald-500 text-emerald-50 hover:bg-emerald-600 focus:ring-emerald-300":"bg-zinc-800 border-zinc-600 text-zinc-400 opacity-50"),T("title",O("\u986F\u793A\u4E00\u500B\u53EF\u914D\u5C0D\u7684\u63D0\u793A (\u5269\u9918: ",i.remainingHints(),")"))("disabled",!i.canUseHint()),c(3),B("",i.totalHintsUsed(),"/",i.maxHintsPerGame()),c(8),y(i.level()),c(5),y(i.score()),c(5),y(i.moves()),c(5),y(i.remainingTiles()),c(),v(i.countdownTime()<=30?"border-red-400 bg-red-400/20 text-red-300 hover:bg-red-400/30":i.countdownTime()<=60?"border-yellow-400 bg-yellow-400/20 text-yellow-300 hover:bg-yellow-400/30":"border-blue-400 bg-blue-400/20 text-blue-300 hover:bg-blue-400/30"),c(),v(i.countdownTime()<=30?"text-red-400":i.countdownTime()<=60?"text-yellow-400":"text-blue-400"),c(3),y(i.formattedCountdown()),c(2),v(i.timelineColorClass()),Y("width",i.timelinePercentage(),"%"),c(),v(i.timelineTextClass()),c(),B(" ",i.formattedTime()," / ",i.formattedCountdown()," "),c(3),T("ngStyle",X(36,te,"repeat("+i.boardWidth+", minmax(0, 1fr))")),c(),U(i.board()),c(2),w(i.showPath()?56:-1),c(),w(i.gameOver()?57:-1),c(),w(i.levelComplete()?58:-1))},dependencies:[K,J,q,Z],encapsulation:2})};export{ee as PetMatch};
