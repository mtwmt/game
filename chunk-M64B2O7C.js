import{A as L,B as E,C as x,D as I,E as T,F as m,G as K,H as P,K as H,L as z,N as Y,O as J,Q as b,R as Q,T as Z,U as ee,_ as te,a as y,b as _,c as R,d as j,e as $,f as F,g as G,h as q,i as W,k as X,o as l,p as U,q as C,r as f,s as N,t as w,u as k,v as M,w as D,x as u,y as c,z as g}from"./chunk-ZLBWINJC.js";var B=(t=>(t.RED="red",t.BLACK="black",t))(B||{});var A=class r{boardCache={kingPositions:new Map,piecesByColor:new Map,lastMoveCount:-1};moveCache=new Map;ORTHOGONAL_DIRECTIONS=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}];DIAGONAL_DIRECTIONS=[{dx:-1,dy:-1},{dx:1,dy:-1},{dx:-1,dy:1},{dx:1,dy:1}];initializeBoard(){let e=Array(10).fill(null).map(()=>Array(9).fill(null));return this.setupInitialPieces(e),e}setupInitialPieces(e){let t=["rook","horse","elephant","advisor","king","advisor","elephant","horse","rook"];t.forEach((n,o)=>{let s=this.generatePieceId(n,"red",o);e[9][o]=this.createPiece(s,n,"red",o,9)}),[...t].forEach((n,o)=>{let s=this.generatePieceId(n,"black",o);e[0][o]=this.createPiece(s,n,"black",o,0)}),[1,7].forEach((n,o)=>{e[7][n]=this.createPiece(`r-cannon-${o+1}`,"cannon","red",n,7),e[2][n]=this.createPiece(`b-cannon-${o+1}`,"cannon","black",n,2)});for(let n=0;n<9;n+=2)e[6][n]=this.createPiece(`r-soldier-${n}`,"soldier","red",n,6),e[3][n]=this.createPiece(`b-soldier-${n}`,"soldier","black",n,3)}generatePieceId(e,t,i){let n=t==="red"?"r":"b";return e==="king"?`${n}-king`:`${n}-${e}-${i<4?"1":"2"}`}createPiece(e,t,i,n,o){return{id:e,type:t,color:i,position:{x:n,y:o},isSelected:!1,hasMoved:!1}}initializeGameState(){return{board:this.initializeBoard(),currentPlayer:"red",selectedPiece:null,validMoves:[],gameOver:!1,winner:null,moveHistory:[],isInCheck:!1,isSelfInCheck:!1,isVsAI:!1,aiIsThinking:!1,aiThinkingText:""}}isValidPosition(e,t){return e>=0&&e<9&&t>=0&&t<10}isInPalace(e,t,i){return i==="red"?e>=3&&e<=5&&t>=7&&t<=9:e>=3&&e<=5&&t>=0&&t<=2}isOnOwnSide(e,t){return t==="red"?e>=5:e<=4}wouldKingsFaceEachOther(e,t=0){this.updateBoardCache(e,t);let i=this.boardCache.kingPositions.get("red"),n=this.boardCache.kingPositions.get("black");return!i||!n||i.x!==n.x?!1:this.isPathClear(e,i,n)}isPathClear(e,t,i){let n=Math.min(t.y,i.y),o=Math.max(t.y,i.y);for(let s=n+1;s<o;s++)if(e[s][t.x]!==null)return!1;return!0}updateBoardCache(e,t){if(this.boardCache.lastMoveCount!==t){this.boardCache.kingPositions.clear(),this.boardCache.piecesByColor.clear(),this.boardCache.piecesByColor.set("red",[]),this.boardCache.piecesByColor.set("black",[]);for(let i=0;i<10;i++)for(let n=0;n<9;n++){let o=e[i][n];o&&(this.boardCache.piecesByColor.get(o.color).push(o),o.type==="king"&&this.boardCache.kingPositions.set(o.color,{x:n,y:i}))}this.boardCache.lastMoveCount=t}}clearCaches(){this.moveCache.clear(),this.boardCache.lastMoveCount=-1}getBoardHash(e){let t="";for(let i=0;i<10;i++)for(let n=0;n<9;n++){let o=e[i][n];t+=o?`${o.type}${o.color}${n}${i}`:"e"}return t}isValidMoveForPiece(e,t,i){if(!this.isValidPosition(e.x,e.y))return!1;let n=i[e.y][e.x];return!n||n.color!==t.color}getSlidingPieceMoves(e,t,i){let n=[],{x:o,y:s}=e.position;return i.forEach(a=>{for(let d=1;d<10;d++){let h=o+a.dx*d,p=s+a.dy*d;if(!this.isValidPosition(h,p))break;let v=t[p][h];if(v){v.color!==e.color&&n.push({x:h,y:p});break}else n.push({x:h,y:p})}}),n}getPossibleMoves(e,t){let i=`${e.id}-${e.position.x}-${e.position.y}-true`;if(this.moveCache.has(i))return this.moveCache.get(i);let n=this.calculatePieceMoves(e,t,!0);return this.moveCache.set(i,n),n}getPossibleMovesForCheck(e,t){let i=`${e.id}-${e.position.x}-${e.position.y}-false`;if(this.moveCache.has(i))return this.moveCache.get(i);let n=this.calculatePieceMoves(e,t,!1);return this.moveCache.set(i,n),n}calculatePieceMoves(e,t,i){switch(e.type){case"king":return this.getKingMoves(e,t,i);case"advisor":return this.getAdvisorMoves(e,t);case"elephant":return this.getElephantMoves(e,t);case"horse":return this.getHorseMoves(e,t);case"rook":return this.getRookMoves(e,t);case"cannon":return this.getCannonMoves(e,t);case"soldier":return this.getSoldierMoves(e,t);default:return[]}}getKingMoves(e,t,i){let{x:n,y:o}=e.position;return this.ORTHOGONAL_DIRECTIONS.map(a=>({x:n+a.dx,y:o+a.dy})).filter(a=>{if(!this.isValidPosition(a.x,a.y)||!this.isInPalace(a.x,a.y,e.color))return!1;let d=t[a.y][a.x];return d&&d.color===e.color?!1:!i||!this.wouldMoveCreateKingFacing(e,a,t)})}wouldMoveCreateKingFacing(e,t,i){let n=i[t.y][t.x],o=e.position;i[t.y][t.x]=e,i[o.y][o.x]=null,e.position=t;let s=this.wouldKingsFaceEachOther(i);return i[o.y][o.x]=e,i[t.y][t.x]=n,e.position=o,s}getAdvisorMoves(e,t){let{x:i,y:n}=e.position;return this.DIAGONAL_DIRECTIONS.map(s=>({x:i+s.dx,y:n+s.dy})).filter(s=>this.isValidPosition(s.x,s.y)&&this.isInPalace(s.x,s.y,e.color)&&this.isValidMoveForPiece(s,e,t))}getElephantMoves(e,t){let{x:i,y:n}=e.position;return[{x:i-2,y:n-2,block:{x:i-1,y:n-1}},{x:i+2,y:n-2,block:{x:i+1,y:n-1}},{x:i-2,y:n+2,block:{x:i-1,y:n+1}},{x:i+2,y:n+2,block:{x:i+1,y:n+1}}].filter(s=>this.isValidPosition(s.x,s.y)&&this.isOnOwnSide(s.y,e.color)&&!t[s.block.y][s.block.x]&&this.isValidMoveForPiece(s,e,t)).map(s=>({x:s.x,y:s.y}))}getHorseMoves(e,t){let{x:i,y:n}=e.position;return[{x:i-1,y:n-2,block:{x:i,y:n-1}},{x:i+1,y:n-2,block:{x:i,y:n-1}},{x:i-1,y:n+2,block:{x:i,y:n+1}},{x:i+1,y:n+2,block:{x:i,y:n+1}},{x:i-2,y:n-1,block:{x:i-1,y:n}},{x:i-2,y:n+1,block:{x:i-1,y:n}},{x:i+2,y:n-1,block:{x:i+1,y:n}},{x:i+2,y:n+1,block:{x:i+1,y:n}}].filter(s=>this.isValidPosition(s.x,s.y)&&!t[s.block.y][s.block.x]&&this.isValidMoveForPiece(s,e,t)).map(s=>({x:s.x,y:s.y}))}getRookMoves(e,t){return this.getSlidingPieceMoves(e,t,this.ORTHOGONAL_DIRECTIONS)}getCannonMoves(e,t){let i=[],{x:n,y:o}=e.position;return this.ORTHOGONAL_DIRECTIONS.forEach(s=>{let a=!1;for(let d=1;d<10;d++){let h=n+s.dx*d,p=o+s.dy*d;if(!this.isValidPosition(h,p))break;let v=t[p][h];if(v)if(!a)a=!0;else{v.color!==e.color&&i.push({x:h,y:p});break}else a||i.push({x:h,y:p})}}),i}getSoldierMoves(e,t){let i=[],{x:n,y:o}=e.position,s=e.color==="red"?-1:1,a={x:n,y:o+s};return this.isValidMoveForPiece(a,e,t)&&i.push(a),this.isOnOwnSide(o,e.color)||[{x:n-1,y:o},{x:n+1,y:o}].forEach(h=>{this.isValidMoveForPiece(h,e,t)&&i.push(h)}),i}isInCheck(e,t,i=0){this.updateBoardCache(e,i);let n=this.boardCache.kingPositions.get(t);if(!n)return!1;let o=t==="red"?"black":"red";return(this.boardCache.piecesByColor.get(o)||[]).some(a=>this.getPossibleMovesForCheck(a,e).some(h=>h.x===n.x&&h.y===n.y))}makeMove(e,t,i){let{board:n,moveHistory:o}=e,s=n[t.y][t.x];if(!s)return{success:!1};let a=n[i.y][i.x],d=o.length;if(this.clearCaches(),n[i.y][i.x]=s,n[t.y][t.x]=null,s.position=i,a&&a.type==="king")return s.hasMoved=!0,{success:!0,captured:a,isCheck:!1,gameOver:!0,winner:s.color};if(this.wouldKingsFaceEachOther(n,d+1))return s.hasMoved=!0,{success:!0,captured:a||void 0,isCheck:!1,gameOver:!0,winner:s.color==="red"?"black":"red"};let h=s.color==="red"?"black":"red",p=this.isInCheck(n,h,d+1),v=this.isInCheck(n,s.color,d+1);return s.hasMoved=!0,{success:!0,captured:a||void 0,isCheck:p,isSelfInCheck:v}}getPieceSymbol(e){return{king:{red:"\u5E25",black:"\u5C07"},advisor:{red:"\u4ED5",black:"\u58EB"},elephant:{red:"\u76F8",black:"\u8C61"},horse:{red:"\u99AC",black:"\u99AC"},rook:{red:"\u8ECA",black:"\u8ECA"},cannon:{red:"\u70AE",black:"\u7832"},soldier:{red:"\u5175",black:"\u5352"}}[e.type][e.color]}static \u0275fac=function(t){return new(t||r)};static \u0275prov=R({token:r,factory:r.\u0275fac,providedIn:"root"})};var V=class r{constructor(e){this.chessGameService=e}MAX_DEPTH=3;PIECE_VALUES={king:1e4,rook:500,cannon:450,horse:400,elephant:200,advisor:200,soldier:100};POSITION_BONUS={king:[[0,0,0,8,9,8,0,0,0],[0,0,0,9,10,9,0,0,0],[0,0,0,8,9,8,0,0,0]],soldier:[[9,9,9,11,13,11,9,9,9],[19,24,34,42,44,42,34,24,19],[19,24,32,37,37,37,32,24,19],[19,23,27,29,30,29,27,23,19],[14,18,20,27,29,27,20,18,14]]};makeAIMove(e){console.log("\u{1F916} AI\u958B\u59CB\u5206\u6790\u68CB\u5C40...");let t=this.getAllPossibleMoves(e,"black");if(console.log(`\u{1F916} \u627E\u5230 ${t.length} \u500B\u53EF\u80FD\u79FB\u52D5`),t.length===0)return console.log("\u{1F916} AI\u7121\u79FB\u52D5\u53EF\u8D70\uFF0C\u6E96\u5099\u6295\u964D"),null;let i=this.chessGameService.isInCheck(e.board,"black"),n=i?Math.min(2,this.MAX_DEPTH):this.MAX_DEPTH;console.log(`\u{1F916} AI${i?"\u88AB\u5C07\u8ECD\uFF0C":""}\u4F7F\u7528\u6DF1\u5EA6 ${n} \u9032\u884C\u641C\u7D22`);let o=this.findBestMoveWithTimeout(e,n,3e3);if(o)return console.log(`\u{1F916} AI\u6C7A\u5B9A\u79FB\u52D5: (${o.from.x},${o.from.y}) -> (${o.to.x},${o.to.y}), \u8A55\u5206: ${o.score}`),{from:o.from,to:o.to};console.warn("\u{1F916} AI\u7121\u6CD5\u627E\u5230\u6700\u4F73\u79FB\u52D5\u6216\u8D85\u6642\uFF0C\u96A8\u6A5F\u9078\u64C7");let s=t[Math.floor(Math.random()*t.length)];return{from:s.from,to:s.to}}findBestMoveWithTimeout(e,t,i){let n=Date.now(),o=null;try{return this.findBestMoveInternal(e,t,n,i)}catch(s){return console.warn("\u{1F916} AI\u641C\u7D22\u8D85\u6642\u6216\u51FA\u932F:",s),o}}findBestMove(e,t){return this.findBestMoveInternal(e,t,Date.now(),1e4)}findBestMoveInternal(e,t,i,n){let o=this.getAllPossibleMoves(e,e.currentPlayer);if(o.length===0)return null;let s=null,a=e.currentPlayer==="black"?-1/0:1/0;for(let d of o){if(Date.now()-i>n){console.log("\u{1F916} AI\u641C\u7D22\u8D85\u6642\uFF0C\u8FD4\u56DE\u7576\u524D\u6700\u4F73\u79FB\u52D5");break}let h=this.simulateMove(e,d),p=this.minimaxWithTimeout(h,t-1,-1/0,1/0,e.currentPlayer==="red",i,n);d.score=p,e.currentPlayer==="black"?p>a&&(a=p,s=d):p<a&&(a=p,s=d)}return s}minimaxWithTimeout(e,t,i,n,o,s,a){if(Date.now()-s>a)return this.evaluateBoard(e);if(t===0||e.gameOver)return this.evaluateBoard(e);let d=this.getAllPossibleMoves(e,e.currentPlayer);if(o){let h=-1/0;for(let p of d){if(Date.now()-s>a)break;let v=this.simulateMove(e,p),S=this.minimaxWithTimeout(v,t-1,i,n,!1,s,a);if(h=Math.max(h,S),i=Math.max(i,S),n<=i)break}return h}else{let h=1/0;for(let p of d){if(Date.now()-s>a)break;let v=this.simulateMove(e,p),S=this.minimaxWithTimeout(v,t-1,i,n,!0,s,a);if(h=Math.min(h,S),n=Math.min(n,S),n<=i)break}return h}}minimax(e,t,i,n,o){return this.minimaxWithTimeout(e,t,i,n,o,Date.now(),1e4)}getAllPossibleMoves(e,t){let i=[];for(let n=0;n<10;n++)for(let o=0;o<9;o++){let s=e.board[n][o];if(s&&s.color===t){let a=this.chessGameService.getPossibleMoves(s,e.board);for(let d of a){let h=e.board[d.y][d.x];i.push({from:s.position,to:d,score:0,capturedPiece:h||void 0})}}}return i}simulateMove(e,t){let i=e.board.map(o=>o.map(s=>s?_(y({},s),{position:y({},s.position)}):null)),n=i[t.from.y][t.from.x];return n&&(i[t.to.y][t.to.x]=n,i[t.from.y][t.from.x]=null,n.position=y({},t.to)),_(y({},e),{board:i,currentPlayer:e.currentPlayer==="red"?"black":"red"})}evaluateBoard(e){let t=0;for(let i=0;i<10;i++)for(let n=0;n<9;n++){let o=e.board[i][n];if(o){let s=this.PIECE_VALUES[o.type];s+=this.getPositionBonus(o),s+=this.getThreatScore(n,i,o,e.board),o.color==="black"?t+=s:t-=s}}return t+=this.getCenterControlScore(e.board),t+=this.getCheckScore(e.board),t}getPositionBonus(e){let{x:t,y:i}=e.position,n=0,o=Math.abs(i-4.5)+Math.abs(t-4);switch(n+=(9-o)*2,e.type){case"horse":i>=2&&i<=7&&t>=1&&t<=7&&(n+=30);break;case"cannon":(t===4||i===(e.color==="red"?7:2))&&(n+=20);break;case"soldier":if(e.color==="red"&&i<5||e.color==="black"&&i>4){n+=50;let a=e.color==="red"?4-i:i-5;n+=a*10}break}return n}getThreatScore(e,t,i,n){let o=0,s=i.color==="red"?"black":"red";for(let a=0;a<10;a++)for(let d=0;d<9;d++){let h=n[a][d];if(h&&h.color===s&&this.chessGameService.getPossibleMoves(h,n).some(v=>v.x===e&&v.y===t)){o-=this.PIECE_VALUES[i.type]*.5;break}}return o}getCenterControlScore(e){let t=0,i=[{x:3,y:4},{x:4,y:4},{x:5,y:4},{x:3,y:5},{x:4,y:5},{x:5,y:5}];for(let{x:n,y:o}of i){let s=e[o][n];s&&(s.color==="black"?t+=15:t-=15)}return t}getCheckScore(e){let t=0;return this.chessGameService.isInCheck(e,"red")&&(t+=100),this.chessGameService.isInCheck(e,"black")&&(t-=100),t}delay(e){return new Promise(t=>setTimeout(t,e))}getThinkingDescription(e){let t=this.analyzeThreats(e),i=this.analyzeOpportunities(e),n=["\u6B63\u5728\u5206\u6790\u68CB\u5C40\u5F62\u52E2...","\u8A08\u7B97\u6700\u4F73\u79FB\u52D5\u8DEF\u7DDA...","\u8A55\u4F30\u653B\u9632\u5E73\u8861...","\u5C0B\u627E\u6230\u8853\u6A5F\u6703..."];return t.length>0&&n.push("\u767C\u73FE\u5A01\u8105\uFF0C\u6B63\u5728\u5236\u5B9A\u9632\u5B88\u7B56\u7565..."),i.length>0&&n.push("\u767C\u73FE\u653B\u64CA\u6A5F\u6703\uFF0C\u6B63\u5728\u8A08\u7B97..."),n[Math.floor(Math.random()*n.length)]}analyzeThreats(e){let t=[],i="black",n="red";if(this.chessGameService.isInCheck(e.board,i))for(let o=0;o<10;o++)for(let s=0;s<9;s++){let a=e.board[o][s];if(a&&a.type==="king"&&a.color===i){t.push({x:s,y:o});break}}return t}analyzeOpportunities(e){let t=[],i="black";return this.chessGameService.isInCheck(e.board,"red")&&t.push({x:4,y:9}),t}static \u0275fac=function(t){return new(t||r)(j(A))};static \u0275prov=R({token:r,factory:r.\u0275fac,providedIn:"root"})};var re=()=>[0,1,2,3,4,5,6,7,8,9],ae=()=>[0,1,2,3,4,5,6,7,8],ne=r=>({"valid-move-point":r});function le(r,e){r&1&&(u(0,"span"),m(1,"\u{1F916}"),c())}function ce(r,e){r&1&&(u(0,"div",13),m(1,"\u5C07\u8ECD\uFF01"),c())}function de(r,e){r&1&&(u(0,"div",14),m(1,"\u88AB\u5C07\u8ECD\uFF01"),c())}function ue(r,e){r&1&&m(0," AI \u601D\u8003\u4E2D... ")}function he(r,e){if(r&1&&(u(0,"div",22),m(1),c()),r&2){let t=e.$implicit;l(),P(" ",t," ")}}function me(r,e){if(r&1&&(u(0,"div",25),m(1),c()),r&2){let t=e.$implicit;l(),P(" ",t," ")}}function pe(r,e){if(r&1&&g(0,"div",43)(1,"div",44),r&2){let t=e.$implicit;T(t===6?"z-20 h-[1.5px]":"z-10"),I("top",t*40+4,"px"),D("ngClass","sm:hidden"),l(),T(t===6?"z-20 h-[1.5px]":"z-10"),I("top",t*50+4,"px")}}function ve(r,e){if(r&1&&g(0,"div",45)(1,"div",45)(2,"div",46)(3,"div",46),r&2){let t=e.$implicit;I("left",t*36+14,"px")("top",4,"px")("height",157,"px"),l(),I("left",t*36+14,"px")("top",203,"px")("height",162,"px"),l(),I("left",t*50+4,"px")("top",4,"px")("height",200,"px"),l(),I("left",t*50+4,"px")("top",254,"px")("height",200,"px")}}function Ce(r,e){r&1&&g(0,"div",48)}function fe(r,e){r&1&&g(0,"div",48)}function xe(r,e){if(r&1&&(u(0,"div",49)(1,"div",56),m(2),c()()),r&2){let t=x().$implicit,i=x(2);D("ngClass",i.getPieceClass(t)),l(),T(t.color===i.PlayerColor.RED?"bg-red-100 border-red-600 text-red-800":"bg-neutral-100 border-neutral-800 text-neutral-800"),l(),P(" ",i.getPieceSymbol(t)," ")}}function be(r,e){r&1&&g(0,"div",50)}function ge(r,e){r&1&&g(0,"div",51)}function ye(r,e){r&1&&g(0,"div",48)}function Pe(r,e){r&1&&g(0,"div",48)}function _e(r,e){if(r&1&&(u(0,"div",53)(1,"div",57),m(2),c()()),r&2){let t=x().$implicit,i=x(2);D("ngClass",i.getPieceClass(t)),l(),T(t.color===i.PlayerColor.RED?"bg-red-100 border-red-600 text-red-800":"bg-neutral-100 border-neutral-800 text-neutral-800"),l(),P(" ",i.getPieceSymbol(t)," ")}}function ke(r,e){r&1&&g(0,"div",54)}function Me(r,e){r&1&&g(0,"div",55)}function Se(r,e){if(r&1){let t=L();u(0,"div",47),E("click",function(){let n=F(t).$index,o=x().$index,s=x();return G(s.onSquareClick(n,o))}),C(1,Ce,1,0,"div",48),C(2,fe,1,0,"div",48),C(3,xe,3,4,"div",49),C(4,be,1,0,"div",50),C(5,ge,1,0,"div",51),c(),u(6,"div",52),E("click",function(){let n=F(t).$index,o=x().$index,s=x();return G(s.onSquareClick(n,o))}),C(7,ye,1,0,"div",48),C(8,Pe,1,0,"div",48),C(9,_e,3,4,"div",53),C(10,ke,1,0,"div",54),C(11,Me,1,0,"div",55),c()}if(r&2){let t=e.$implicit,i=e.$index,n=x().$index,o=x();I("top",n*40+4,"px")("left",i*36+14,"px"),D("ngClass",z(20,ne,o.isValidMove(i,n))),l(),f((n===2||n===7)&&(i===0||i===2||i===4||i===6||i===8)?1:-1),l(),f((n===3||n===6)&&(i===1||i===7)?2:-1),l(),f(t?3:-1),l(),f(o.isValidMove(i,n)&&!t?4:-1),l(),f(o.isValidMove(i,n)&&t&&t.color!==o.currentPlayer()?5:-1),l(),I("top",n*50+4,"px")("left",i*50+4,"px"),D("ngClass",z(22,ne,o.isValidMove(i,n))),l(),f((n===2||n===7)&&(i===0||i===2||i===4||i===6||i===8)?7:-1),l(),f((n===3||n===6)&&(i===1||i===7)?8:-1),l(),f(t?9:-1),l(),f(o.isValidMove(i,n)&&!t?10:-1),l(),f(o.isValidMove(i,n)&&t&&t.color!==o.currentPlayer()?11:-1)}}function Ie(r,e){if(r&1&&k(0,Se,12,24,null,null,N),r&2){let t=e.$implicit;M(t)}}function Ee(r,e){if(r&1&&(u(0,"div",25),m(1),c()),r&2){let t=e.$implicit;l(),P(" ",t," ")}}function we(r,e){if(r&1&&(u(0,"div",22),m(1),c()),r&2){let t=e.$implicit;l(),P(" ",t," ")}}function De(r,e){if(r&1){let t=L();u(0,"div",39)(1,"div",58)(2,"div",59),m(3,"\u{1F3C6}"),c(),u(4,"h2",60),m(5),c(),u(6,"button",61),E("click",function(){F(t);let n=x();return G(n.resetGame())}),m(7," \u91CD\u65B0\u958B\u59CB "),c()()()}if(r&2){let t=x();l(5),P(" ",t.winner()===t.PlayerColor.RED?"\u7D05\u65B9\u7372\u52DD\uFF01":"\u9ED1\u65B9\u7372\u52DD\uFF01"," ")}}function Ae(r,e){if(r&1&&(u(0,"span",67),m(1),c()),r&2){let t=x(2).$index,i=x(2);l(),K(i.moveHistory()[t+1])}}function Oe(r,e){if(r&1&&(u(0,"div",5)(1,"span",65),m(2),c(),u(3,"span",66),m(4),c(),C(5,Ae,2,1,"span",67),c()),r&2){let t=x(),i=t.$implicit,n=t.$index,o=x(2);l(2),P("",o.Math.floor(n/2)+1,"."),l(2),K(i),l(),f(o.moveHistory()[n+1]?5:-1)}}function Te(r,e){if(r&1&&C(0,Oe,6,3,"div",5),r&2){let t=e.$index;f(t%2===0?0:-1)}}function Be(r,e){if(r&1&&(u(0,"section",40)(1,"h3",62),m(2,"\u68CB\u8B5C\u8A18\u9304"),c(),u(3,"div",63)(4,"div",64),k(5,Te,1,1,null,null,N),c()()()),r&2){let t=x();l(5),M(t.moveHistory())}}var oe=class r{chessGameService=$(A);chessAIService=$(V);gameState=X({board:[],currentPlayer:"red",selectedPiece:null,validMoves:[],gameOver:!1,winner:null,moveHistory:[],isInCheck:!1,isSelfInCheck:!1,isVsAI:!1,aiIsThinking:!1,aiThinkingText:""});board=b(()=>this.gameState().board);currentPlayer=b(()=>this.gameState().currentPlayer);selectedPiece=b(()=>this.gameState().selectedPiece);validMoves=b(()=>this.gameState().validMoves);gameOver=b(()=>this.gameState().gameOver);winner=b(()=>this.gameState().winner);moveHistory=b(()=>this.gameState().moveHistory);isInCheck=b(()=>this.gameState().isInCheck);isSelfInCheck=b(()=>this.gameState().isSelfInCheck);currentPlayerDisplay=b(()=>this.currentPlayer()==="red"?"\u7D05\u65B9":"\u9ED1\u65B9");isVsAI=b(()=>this.gameState().isVsAI);aiIsThinking=b(()=>this.gameState().aiIsThinking);aiThinkingText=b(()=>this.gameState().aiThinkingText);isAITurn=b(()=>this.isVsAI()&&this.currentPlayer()==="black"&&!this.gameOver());canInteract=b(()=>!this.isVsAI()||this.currentPlayer()==="red");PlayerColor=B;Math=Math;ngOnInit(){this.resetGame(!0)}resetGame(e=!1){let t=this.chessGameService.initializeGameState();t.isVsAI=e,this.gameState.set(t)}onSquareClick(e,t){if(this.gameOver()||!this.canInteract())return;let i=this.gameState(),n=i.board[t][e];i.selectedPiece?n&&n.color===i.currentPlayer&&n!==i.selectedPiece?this.selectPiece(n):this.isValidMove(e,t)?this.makeMove(i.selectedPiece.position,{x:e,y:t}):this.deselectPiece():n&&n.color===i.currentPlayer&&this.selectPiece(n)}selectPiece(e){let t=this.gameState();t.board.flat().forEach(n=>{n&&(n.isSelected=!1)}),e.isSelected=!0;let i=this.chessGameService.getPossibleMoves(e,t.board);this.gameState.set(_(y({},t),{selectedPiece:e,validMoves:i}))}deselectPiece(){let e=this.gameState();e.selectedPiece&&(e.selectedPiece.isSelected=!1),this.gameState.set(_(y({},e),{selectedPiece:null,validMoves:[]}))}isValidMove(e,t){return this.validMoves().some(i=>i.x===e&&i.y===t)}makeMove(e,t){let i=this.gameState(),n=i.board[e.y][e.x];if(!n)return;let o=this.chessGameService.makeMove(i,e,t);if(o.success){let s=this.generateMoveNotation(n,e,t,o.captured),a=[...i.moveHistory,s],d=i.currentPlayer==="red"?"black":"red",h=o.isCheck||!1,p=o.isSelfInCheck||!1,v=o.isCheckmate||o.isStalemate||o.gameOver||!1,S=o.winner||(o.isCheckmate?i.currentPlayer:null);i.board.flat().forEach(O=>{O&&(O.isSelected=!1)}),this.gameState.set(_(y({},i),{currentPlayer:d,selectedPiece:null,validMoves:[],moveHistory:a,isInCheck:h,isSelfInCheck:p,gameOver:v,winner:S})),console.log("\u6AA2\u67E5AI\u89F8\u767C\u689D\u4EF6:",{gameOver:v,isVsAI:i.isVsAI,nextPlayer:d,shouldTrigger:!v&&i.isVsAI&&d==="black"}),!v&&i.isVsAI&&d==="black"&&(console.log("\u6E96\u5099\u89F8\u767CAI\u79FB\u52D5..."),this.triggerAIMove())}}generateMoveNotation(e,t,i,n){if(!e)return"";let o=this.chessGameService.getPieceSymbol(e),s=e.color==="red"?9-t.x:t.x+1,a=i.y-t.y,d="";return a===0?d="\u5E73"+(e.color==="red"?9-i.x:i.x+1):d=(a<0?"\u9032":"\u9000")+Math.abs(a),`${o}${s}${d}`}getSquareClass(e,t){let i="chess-square";return this.board()[t]?.[e]?.isSelected&&(i+=" selected"),this.isValidMove(e,t)&&(i+=" valid-move"),(this.chessGameService.isInPalace(e,t,"red")||this.chessGameService.isInPalace(e,t,"black"))&&(i+=" palace"),i}getPieceClass(e){if(!e)return"";let t=`chess-piece ${e.color}`;return e.isSelected&&(t+=" selected"),t}getPieceSymbol(e){return e?this.chessGameService.getPieceSymbol(e):""}getRowNumbers(){return Array.from({length:10},(e,t)=>10-t)}getColumnLetters(){return["a","b","c","d","e","f","g","h","i"]}startVsAI(){let e=this.chessGameService.initializeGameState();e.isVsAI=!0,this.gameState.set(e)}startPvP(){let e=this.chessGameService.initializeGameState();e.isVsAI=!1,this.gameState.set(e)}toggleGameMode(){let e=this.gameState(),t=!e.isVsAI;this.gameState.set(_(y({},e),{isVsAI:t,aiIsThinking:!1})),t&&e.currentPlayer==="black"&&!e.gameOver&&this.triggerAIMove()}triggerAIMove(){let e=this.gameState();console.log("\u{1F916} \u89F8\u767CAI\u79FB\u52D5\uFF0C\u7576\u524D\u73A9\u5BB6:",e.currentPlayer),this.gameState.set(_(y({},e),{aiIsThinking:!0,aiThinkingText:this.chessAIService.getThinkingDescription(e)})),setTimeout(()=>{try{let t=this.chessAIService.makeAIMove(e);t?(console.log("\u{1F916} AI\u9078\u64C7\u79FB\u52D5:",t),this.makeAIMove(t.from,t.to)):(console.warn("\u{1F916} AI\u7121\u6CD5\u627E\u5230\u6709\u6548\u79FB\u52D5\uFF0CAI\u6295\u964D"),this.aiSurrender())}catch(t){console.error("\u{1F916} AI\u79FB\u52D5\u51FA\u932F:",t),this.aiSurrender()}},500)}makeAIMove(e,t){let i=this.gameState(),n=i.board[e.y][e.x];if(!n)return;let o=this.chessGameService.makeMove(i,e,t);if(o.success){let s=this.generateMoveNotation(n,e,t,o.captured),a=[...i.moveHistory,s],d="red",h=o.isCheck||!1,p=o.isSelfInCheck||!1,v=o.isCheckmate||o.isStalemate||o.gameOver||!1,S=o.winner||(o.isCheckmate?"black":null);i.board.flat().forEach(O=>{O&&(O.isSelected=!1)}),this.gameState.set(_(y({},i),{currentPlayer:d,selectedPiece:null,validMoves:[],moveHistory:a,isInCheck:h,isSelfInCheck:p,gameOver:v,winner:S,aiIsThinking:!1}))}}aiSurrender(){let e=this.gameState();console.log("\u{1F916} AI\u6295\u964D\uFF0C\u904A\u6232\u7D50\u675F"),this.gameState.set(_(y({},e),{gameOver:!0,winner:"red",aiIsThinking:!1,moveHistory:[...e.moveHistory,"\u{1F916} AI\u6295\u964D"]}))}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=U({type:r,selectors:[["app-chinese-chess"]],decls:85,vars:14,consts:[[1,"w-full","max-w-[95vw]","sm:max-w-sm","mx-auto","flex","flex-col","px-2","sm:px-0"],[1,"mb-2","flex","flex-col","gap-3","items-stretch"],[1,"flex","justify-between","items-center"],[1,"text-center","text-2xl","font-bold","tracking-wider","text-lime-400","drop-shadow"],["routerLink","/",1,"text-lime-600","text-sm"],[1,"flex","gap-2"],[1,"h-12","w-1/3","touch-btn","rounded-md","bg-cyan-700","border","border-cyan-500","text-cyan-50","font-semibold","text-base","shadow","hover:bg-cyan-600","focus:outline-none","focus:ring-2","focus:ring-cyan-300",3,"click"],[1,"h-12","w-1/3","touch-btn","rounded-md","bg-lime-700","border","border-lime-500","text-lime-50","font-semibold","text-base","shadow","hover:bg-lime-600","focus:outline-none","focus:ring-2","focus:ring-lime-300","drop-shadow-[0_0_5px_#22d3ee]",3,"click"],[1,"flex","flex-col","gap-2"],[1,"flex","items-center","gap-1","justify-between","flex-wrap","bg-white/10","rounded-md","p-2","border","border-white/20"],[1,"border","px-2","py-1","font-bold",3,"ngClass"],[1,"text-xs"],[1,"text-center","text-xs"],[1,"text-3xl","text-amber-300","animate-pulse"],[1,"text-3xl","text-red-400","animate-pulse"],[1,"py-3","border-1","border-lime-400","bg-lime-400/20","px-2","py-1","text-lime-300","font-bold","hover:bg-lime-400/30","transition",3,"click"],[1,"w-full","text-center","text-sm","mt-2","h-4","bg-neutral-700/80","rounded","overflow-hidden","relative","animate-pulse","text-white"],[1,"flex","justify-center"],[1,"relative","inline-block"],[1,"chess-board","bg-amber-100","border-2","sm:border-4","border-amber-800","p-2","sm:p-6","relative"],[1,"flex","justify-center","mb-1","sm:mb-2"],[1,"grid","grid-cols-9","gap-0"],[1,"w-[36px]","sm:w-[50px]","text-center","text-xs","font-bold","text-amber-800"],[1,"flex"],[1,"flex","flex-col","justify-center","mr-1","sm:mr-2"],[1,"h-[40px]","sm:h-[50px]","flex","items-center","justify-center","text-xs","font-bold","text-amber-800","w-4","sm:w-6"],[1,"relative","w-[310px]","h-[360px]","sm:w-[408px]","sm:h-[450px]","bg-amber-100"],["viewBox","0 0 100 100",1,"absolute","top-0","left-[122px]","w-[72px]","h-[80px]","sm:hidden"],["x1","0","y1","0","x2","100","y2","100","stroke","#d97706","stroke-width","1"],["x1","100","y1","0","x2","0","y2","100","stroke","#d97706","stroke-width","1"],["viewBox","0 0 100 100",1,"absolute","bottom-0","left-[122px]","w-[72px]","h-[80px]","sm:hidden"],["viewBox","0 0 100 100",1,"absolute","top-0","left-[154px]","w-[100px]","h-[100px]","hidden","sm:block"],["viewBox","0 0 100 100",1,"absolute","bottom-0","left-[154px]","w-[100px]","h-[100px]","hidden","sm:block"],[1,"absolute","left-0","right-0","bg-amber-100","flex","items-center","justify-between","px-8","z-5","sm:hidden",2,"top","161px","height","40px"],[1,"text-amber-700","font-bold","text-xs","tracking-wider"],[1,"absolute","left-0","right-0","bg-amber-100","flex","items-center","justify-between","px-16","z-5","hidden","sm:flex",2,"top","204px","height","50px"],[1,"text-amber-700","font-bold","text-sm","tracking-wider"],[1,"flex","flex-col","justify-center","ml-1","sm:ml-2"],[1,"flex","justify-center","mt-1","sm:mt-2"],[1,"absolute","inset-0","bg-black/50","backdrop-blur-sm","flex","items-center","justify-center","z-50","rounded-lg"],[1,"mt-6"],[1,"mt-4","text-xs","text-amber-600","text-center"],[1,"mb-1"],[1,"absolute","left-0","right-0","h-[1px]","bg-amber-800",3,"ngClass"],[1,"absolute","left-0","right-0","h-[1px]","bg-amber-800","hidden","sm:block"],[1,"absolute","w-[1px]","bg-amber-800","sm:hidden"],[1,"absolute","w-[1px]","bg-amber-800","hidden","sm:block"],[1,"absolute","w-[20px]","h-[20px]","-translate-x-1/2","-translate-y-1/2","rounded-full","hover:bg-amber-200/30","cursor-pointer","z-20","sm:hidden",3,"click","ngClass"],[1,"absolute","w-[6px]","h-[6px]","bg-amber-800","rounded-full","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[32px]","h-[32px]",3,"ngClass"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-2","h-2","bg-green-500","rounded-full","opacity-70"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[34px]","h-[34px]","border-2","border-red-500","rounded-full"],[1,"absolute","w-[24px]","h-[24px]","-translate-x-1/2","-translate-y-1/2","rounded-full","hover:bg-amber-200/30","cursor-pointer","z-20","hidden","sm:block",3,"click","ngClass"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[40px]","h-[40px]",3,"ngClass"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-3","h-3","bg-green-500","rounded-full","opacity-70"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[42px]","h-[42px]","border-2","border-red-500","rounded-full"],[1,"w-8","h-8","rounded-full","border-2","flex","items-center","justify-center","text-sm","font-bold","shadow-lg"],[1,"w-10","h-10","rounded-full","border-2","flex","items-center","justify-center","text-lg","font-bold","shadow-lg"],[1,"bg-gradient-to-br","from-amber-600","to-amber-800","border-2","border-amber-400","rounded-lg","p-8","shadow-2xl","text-center"],[1,"text-3xl","mb-4"],[1,"text-2xl","font-bold","mb-4","text-amber-100"],[1,"bg-amber-400","hover:bg-amber-300","text-amber-900","font-bold","py-3","px-6","rounded-lg","transition-all","duration-200","transform","hover:scale-105","shadow-lg",3,"click"],[1,"text-lg","font-bold","text-amber-400","mb-3"],[1,"bg-neutral-900/70","border","border-neutral-700","rounded-md","p-4","max-h-32","overflow-y-auto"],[1,"grid","grid-cols-2","gap-2","text-sm"],[1,"text-neutral-400"],[1,"text-red-400"],[1,"text-neutral-300"]],template:function(t,i){t&1&&(u(0,"div",0)(1,"header",1)(2,"div",2)(3,"h1",3),m(4," \u4E2D\u570B\u8C61\u68CB "),c(),u(5,"a",4),m(6,"HOME"),c()(),u(7,"div",5)(8,"button",6),E("click",function(){return i.startPvP()}),m(9," \u{1F465} \u96D9\u4EBA\u5C0D\u6230 "),c(),u(10,"button",7),E("click",function(){return i.startVsAI()}),m(11," \u{1F916} \u4EBA\u6A5F\u5C0D\u6230 "),c(),u(12,"button",6),E("click",function(){return i.resetGame(!1)}),m(13," \u91CD\u65B0\u958B\u59CB "),c()(),u(14,"div",8)(15,"div",9)(16,"div",10)(17,"div",11),m(18,"\u7576\u524D\u56DE\u5408"),c(),u(19,"div",12),C(20,le,2,0,"span"),m(21),c()(),C(22,ce,2,0,"div",13),C(23,de,2,0,"div",14),u(24,"button",15),E("click",function(){return i.toggleGameMode()}),u(25,"div",12),m(26),c()(),u(27,"div",16),C(28,ue,1,0),c()()()(),u(29,"main",17)(30,"div",18)(31,"div",19)(32,"div",20)(33,"div",21),k(34,he,2,1,"div",22,w),c()(),u(36,"div",23)(37,"div",24),k(38,me,2,1,"div",25,w),c(),u(40,"div",26),k(41,pe,2,9,null,null,w),k(43,ve,4,24,null,null,w),q(),u(45,"svg",27),g(46,"line",28)(47,"line",29),c(),u(48,"svg",30),g(49,"line",28)(50,"line",29),c(),u(51,"svg",31),g(52,"line",28)(53,"line",29),c(),u(54,"svg",32),g(55,"line",28)(56,"line",29),c(),W(),u(57,"div",33)(58,"span",34),m(59,"\u695A\u6CB3"),c(),u(60,"span",34),m(61,"\u6F22\u754C"),c()(),u(62,"div",35)(63,"span",36),m(64,"\u695A\u6CB3"),c(),u(65,"span",36),m(66,"\u6F22\u754C"),c()(),k(67,Ie,2,0,null,null,N),c(),u(69,"div",37),k(70,Ee,2,1,"div",25,w),c()(),u(72,"div",38)(73,"div",21),k(74,we,2,1,"div",22,w),c()()(),C(76,De,8,1,"div",39),c()(),m(77),Y(78,"json"),C(79,Be,7,0,"section",40),u(80,"footer",41)(81,"p",42),m(82,"\u9EDE\u64CA\u9078\u64C7\u68CB\u5B50\uFF0C\u518D\u9EDE\u64CA\u76EE\u6A19\u4F4D\u7F6E\u79FB\u52D5"),c(),u(83,"p"),m(84,"\u7D05\u65B9\u5148\u884C\uFF0C\u5C07\u8ECD\u5C0D\u65B9\u5373\u7372\u52DD"),c()()()),t&2&&(l(16),D("ngClass",i.currentPlayer()===i.PlayerColor.RED?"bg-red-500/20 border-red-400 text-red-300":"bg-neutral-800/20 border-neutral-400 text-neutral-300"),l(4),f(i.isVsAI()&&i.currentPlayer()===i.PlayerColor.BLACK?20:-1),l(),P("",i.currentPlayerDisplay()," "),l(),f(i.isInCheck()?22:-1),l(),f(i.isSelfInCheck()?23:-1),l(3),P(" ",i.isVsAI()?"\u5207\u63DB\u81F3\u96D9\u4EBA":"\u5207\u63DB\u81F3AI"," "),l(2),f(i.aiIsThinking()?28:-1),l(6),M(i.getColumnLetters()),l(4),M(i.getRowNumbers()),l(3),M(H(12,re)),l(2),M(H(13,ae)),l(24),M(i.board()),l(3),M(i.getRowNumbers()),l(4),M(i.getColumnLetters()),l(2),f(i.gameOver()?76:-1),l(),P(" ",J(78,10,i.moveHistory())," "),l(2),f(i.moveHistory().length>0?79:-1))},dependencies:[ee,Q,te,Z],styles:['.chess-board[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fef3c7,#fed7aa);box-shadow:0 8px 32px #0000004d}.chess-square[_ngcontent-%COMP%]{position:relative;background:transparent;transition:all .2s ease}.chess-square[_ngcontent-%COMP%]:hover{background-color:#f59e0b1a}.chess-square.selected[_ngcontent-%COMP%]{background-color:#22c55e4d!important;border-color:#22c55e!important;box-shadow:inset 0 0 0 2px #22c55e}.chess-square.valid-move[_ngcontent-%COMP%]{background-color:#22c55e26!important}.chess-square.valid-move[_ngcontent-%COMP%]:after{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:12px;height:12px;background-color:#22c55e;border-radius:50%;opacity:.8}.chess-square.valid-move[_ngcontent-%COMP%]:hover:after{width:16px;height:16px;opacity:1}.chess-square.palace[_ngcontent-%COMP%]{background-color:#f59e0b0d}.chess-piece[_ngcontent-%COMP%]{transition:all .3s ease;z-index:10}.chess-piece.selected[_ngcontent-%COMP%]{transform:scale(1.1);filter:drop-shadow(0 0 8px rgba(34,197,94,.6))}.chess-piece.red[_ngcontent-%COMP%]   .piece-symbol[_ngcontent-%COMP%]{color:#dc2626;background:linear-gradient(135deg,#fecaca,#fee2e2);border-color:#dc2626}.chess-piece.black[_ngcontent-%COMP%]   .piece-symbol[_ngcontent-%COMP%]{color:#374151;background:linear-gradient(135deg,#f3f4f6,#e5e7eb);border-color:#374151}.chess-piece[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.move-history[_ngcontent-%COMP%]{scrollbar-width:thin;scrollbar-color:#6b7280 #1f2937}.move-history[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.move-history[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#1f2937;border-radius:3px}.move-history[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#6b7280;border-radius:3px}.move-history[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#9ca3af}@media (max-width: 640px){.chess-board[_ngcontent-%COMP%]{padding:1rem}.chess-board[_ngcontent-%COMP%]   .chess-square[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem}.chess-board[_ngcontent-%COMP%]   .chess-piece[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:2rem;height:2rem;font-size:.875rem}}@keyframes _ngcontent-%COMP%_piece-capture{0%{transform:scale(1);opacity:1}50%{transform:scale(1.3);opacity:.7}to{transform:scale(0);opacity:0}}.captured[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_piece-capture .5s ease-out forwards}@keyframes _ngcontent-%COMP%_check-warning{0%,to{box-shadow:0 0 #ef4444b3}50%{box-shadow:0 0 0 10px #ef444400}}.in-check[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_check-warning 1s infinite}.valid-move-point.valid-move[_ngcontent-%COMP%]:after{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:10px;height:10px;background-color:#22c55e;border-radius:50%;opacity:.7}.valid-move-point[_ngcontent-%COMP%]:hover{background-color:#f59e0b33}']})};export{oe as ChineseChess};
