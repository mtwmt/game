import{$ as M,A as Ke,Aa as At,B as T,C as Z,D as Ue,E as Q,F as le,G as ce,H as ye,I as ft,J as C,K as b,L as Ce,M as W,N as B,O as L,P as w,Q as c,R as l,S as O,T as k,U as x,V as p,W as U,X as mt,Y as G,Z as d,_ as Y,a as E,aa as pt,b as A,ba as gt,c as g,ca as vt,d as st,da as _t,e as Ge,f as rt,fa as He,g as at,ga as je,h as lt,ha as be,i as Be,j as q,k as Le,ka as z,l as X,la as S,m as F,ma as qe,n as I,na as yt,o as D,oa as Ct,p as ct,pa as We,q as ut,qa as bt,ra as xt,s as R,sa as Et,t as dt,u as ht,ua as ee,v as $e,z as u}from"./chunk-3CRZA7Q3.js";var Ot=(()=>{class n{_renderer;_elementRef;onChange=t=>{};onTouched=()=>{};constructor(t,i){this._renderer=t,this._elementRef=i}setProperty(t,i){this._renderer.setProperty(this._elementRef.nativeElement,t,i)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static \u0275fac=function(i){return new(i||n)(T(Ke),T($e))};static \u0275dir=Q({type:n})}return n})(),oi=(()=>{class n extends Ot{static \u0275fac=(()=>{let t;return function(o){return(t||(t=ht(n)))(o||n)}})();static \u0275dir=Q({type:n,features:[le]})}return n})(),kt=new X("");var si={provide:kt,useExisting:Be(()=>De),multi:!0};function ri(){let n=We()?We().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var ai=new X(""),De=(()=>{class n extends Ot{_compositionMode;_composing=!1;constructor(t,i,o){super(t,i),this._compositionMode=o,this._compositionMode==null&&(this._compositionMode=!ri())}writeValue(t){let i=t??"";this.setProperty("value",i)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static \u0275fac=function(i){return new(i||n)(T(Ke),T($e),T(ai,8))};static \u0275dir=Q({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,o){i&1&&x("input",function(r){return o._handleInput(r.target.value)})("blur",function(){return o.onTouched()})("compositionstart",function(){return o._compositionStart()})("compositionend",function(r){return o._compositionEnd(r.target.value)})},standalone:!1,features:[He([si]),le]})}return n})();var li=new X(""),ci=new X("");function Ft(n){return n!=null}function Tt(n){return ft(n)?rt(n):n}function Nt(n){let e={};return n.forEach(t=>{e=t!=null?E(E({},e),t):e}),Object.keys(e).length===0?null:e}function Rt(n,e){return e.map(t=>t(n))}function ui(n){return!n.validate}function Gt(n){return n.map(e=>ui(e)?e:t=>e.validate(t))}function di(n){if(!n)return null;let e=n.filter(Ft);return e.length==0?null:function(t){return Nt(Rt(t,e))}}function Bt(n){return n!=null?di(Gt(n)):null}function hi(n){if(!n)return null;let e=n.filter(Ft);return e.length==0?null:function(t){let i=Rt(t,e).map(Tt);return lt(i).pipe(at(Nt))}}function Lt(n){return n!=null?hi(Gt(n)):null}function It(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function fi(n){return n._rawValidators}function mi(n){return n._rawAsyncValidators}function Ye(n){return n?Array.isArray(n)?n:[n]:[]}function Ee(n,e){return Array.isArray(n)?n.includes(e):n===e}function Dt(n,e){let t=Ye(e);return Ye(n).forEach(o=>{Ee(t,o)||t.push(o)}),t}function Mt(n,e){return Ye(e).filter(t=>!Ee(n,t))}var Ae=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=Bt(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=Lt(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},ze=class extends Ae{name;get formDirective(){return null}get path(){return null}},me=class extends Ae{_parent=null;name=null;valueAccessor=null},Je=class{_cd;constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},pi={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},Fo=A(E({},pi),{"[class.ng-submitted]":"isSubmitted"}),$t=(()=>{class n extends Je{constructor(t){super(t)}static \u0275fac=function(i){return new(i||n)(T(me,2))};static \u0275dir=Q({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,o){i&2&&mt("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)},standalone:!1,features:[le]})}return n})();var ue="VALID",xe="INVALID",te="PENDING",de="DISABLED",ne=class{},Ie=class extends ne{value;source;constructor(e,t){super(),this.value=e,this.source=t}},he=class extends ne{pristine;source;constructor(e,t){super(),this.pristine=e,this.source=t}},fe=class extends ne{touched;source;constructor(e,t){super(),this.touched=e,this.source=t}},ie=class extends ne{status;source;constructor(e,t){super(),this.status=e,this.source=t}};function gi(n){return(Me(n)?n.validators:n)||null}function vi(n){return Array.isArray(n)?Bt(n):n||null}function _i(n,e){return(Me(e)?e.asyncValidators:n)||null}function yi(n){return Array.isArray(n)?Lt(n):n||null}function Me(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}var Xe=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(e,t){this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return z(this.statusReactive)}set status(e){z(()=>this.statusReactive.set(e))}_status=S(()=>this.statusReactive());statusReactive=R(void 0);get valid(){return this.status===ue}get invalid(){return this.status===xe}get pending(){return this.status==te}get disabled(){return this.status===de}get enabled(){return this.status!==de}errors;get pristine(){return z(this.pristineReactive)}set pristine(e){z(()=>this.pristineReactive.set(e))}_pristine=S(()=>this.pristineReactive());pristineReactive=R(!0);get dirty(){return!this.pristine}get touched(){return z(this.touchedReactive)}set touched(e){z(()=>this.touchedReactive.set(e))}_touched=S(()=>this.touchedReactive());touchedReactive=R(!1);get untouched(){return!this.touched}_events=new st;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(Dt(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(Dt(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(Mt(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(Mt(e,this._rawAsyncValidators))}hasValidator(e){return Ee(this._rawValidators,e)}hasAsyncValidator(e){return Ee(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let i=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(A(E({},e),{sourceControl:i})),t&&e.emitEvent!==!1&&this._events.next(new fe(!0,i))}markAllAsDirty(e={}){this.markAsDirty({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsDirty(e))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let i=e.sourceControl??this;this._forEachChild(o=>{o.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:i})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,i),t&&e.emitEvent!==!1&&this._events.next(new fe(!1,i))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let i=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(A(E({},e),{sourceControl:i})),t&&e.emitEvent!==!1&&this._events.next(new he(!1,i))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let i=e.sourceControl??this;this._forEachChild(o=>{o.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,i),t&&e.emitEvent!==!1&&this._events.next(new he(!0,i))}markAsPending(e={}){this.status=te;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new ie(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(A(E({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=de,this.errors=null,this._forEachChild(o=>{o.disable(A(E({},e),{onlySelf:!0}))}),this._updateValue();let i=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Ie(this.value,i)),this._events.next(new ie(this.status,i)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(A(E({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(o=>o(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=ue,this._forEachChild(i=>{i.enable(A(E({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(A(E({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let i=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===ue||this.status===te)&&this._runAsyncValidator(i,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Ie(this.value,t)),this._events.next(new ie(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(A(E({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?de:ue}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=te,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1,shouldHaveEmitted:e!==!1};let i=Tt(this.asyncValidator(this));this._asyncValidationSubscription=i.subscribe(o=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(o,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=(this._hasOwnPendingAsyncValidator?.emitEvent||this._hasOwnPendingAsyncValidator?.shouldHaveEmitted)??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((i,o)=>i&&i._find(o),this)}getError(e,t){let i=t?this.get(t):this;return i&&i.errors?i.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,i){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||i)&&this._events.next(new ie(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,i)}_initObservables(){this.valueChanges=new ye,this.statusChanges=new ye}_calculateStatus(){return this._allControlsDisabled()?de:this.errors?xe:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(te)?te:this._anyControlsHaveStatus(xe)?xe:ue}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let i=!this._anyControlsDirty(),o=this.pristine!==i;this.pristine=i,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),o&&this._events.next(new he(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new fe(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_onDisabledChange=[];_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Me(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=vi(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=yi(this._rawAsyncValidators)}};var Kt=new X("",{providedIn:"root",factory:()=>Ze}),Ze="always";function Ci(n,e){return[...e.path,n]}function bi(n,e,t=Ze){Ei(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),Ai(n,e),Di(n,e),Ii(n,e),xi(n,e)}function St(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function xi(n,e){if(e.valueAccessor.setDisabledState){let t=i=>{e.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function Ei(n,e){let t=fi(n);e.validator!==null?n.setValidators(It(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let i=mi(n);e.asyncValidator!==null?n.setAsyncValidators(It(i,e.asyncValidator)):typeof i=="function"&&n.setAsyncValidators([i]);let o=()=>n.updateValueAndValidity();St(e._rawValidators,o),St(e._rawAsyncValidators,o)}function Ai(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&Ut(n,e)})}function Ii(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&Ut(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function Ut(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function Di(n,e){let t=(i,o)=>{e.valueAccessor.writeValue(i),o&&e.viewToModelUpdate(i)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function Mi(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function Si(n){return Object.getPrototypeOf(n.constructor)===oi}function wi(n,e){if(!e)return null;Array.isArray(e);let t,i,o;return e.forEach(s=>{s.constructor===De?t=s:Si(s)?i=s:o=s}),o||i||t||null}function wt(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function Vt(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var Vi=class extends Xe{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(e=null,t,i){super(gi(t),_i(i,t)),this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Me(t)&&(t.nonNullable||t.initialValueIsDefault)&&(Vt(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(i=>i(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){wt(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){wt(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){Vt(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var Pi={provide:me,useExisting:Be(()=>Qe)},Pt=Promise.resolve(),Qe=(()=>{class n extends me{_changeDetectorRef;callSetDisabledState;control=new Vi;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new ye;constructor(t,i,o,s,r,a){super(),this._changeDetectorRef=r,this.callSetDisabledState=a,this._parent=t,this._setValidators(i),this._setAsyncValidators(o),this.valueAccessor=wi(this,s)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){let i=t.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),Mi(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){bi(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(t){Pt.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){let i=t.isDisabled.currentValue,o=i!==0&&Ct(i);Pt.then(()=>{o&&!this.control.disabled?this.control.disable():!o&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?Ci(t,this._parent):[t]}static \u0275fac=function(i){return new(i||n)(T(ze,9),T(li,10),T(ci,10),T(kt,10),T(yt,8),T(Kt,8))};static \u0275dir=Q({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[He([Pi]),le,dt]})}return n})();var Oi=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=Ue({type:n});static \u0275inj=Le({})}return n})();var Se=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:Kt,useValue:t.callSetDisabledState??Ze}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=Ue({type:n});static \u0275inj=Le({imports:[Oi]})}return n})();var J=(t=>(t.RED="red",t.BLACK="black",t))(J||{});var et={board:[],currentPlayer:"red",selectedPiece:null,validMoves:[],gameOver:!1,winner:null,moveHistory:[],isInCheck:!1,isSelfInCheck:!1,isVsAI:!0,aiIsThinking:!1,aiThinkingText:"",hasApiKey:!1},$=class n{static BOARD_WIDTH=9;static BOARD_HEIGHT=10;static PALACE_LEFT=3;static PALACE_RIGHT=5;static RED_PALACE_TOP=7;static RED_PALACE_BOTTOM=9;static BLACK_PALACE_TOP=0;static BLACK_PALACE_BOTTOM=2;hasApiKey=R(!1);boardCache={kingPositions:new Map,piecesByColor:new Map,lastMoveCount:-1};constructor(){this.updateApiKeyStatus()}moveCache=new Map;ORTHOGONAL_DIRECTIONS=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}];DIAGONAL_DIRECTIONS=[{dx:-1,dy:-1},{dx:1,dy:-1},{dx:-1,dy:1},{dx:1,dy:1}];initializeBoard(){let e=Array(10).fill(null).map(()=>Array(9).fill(null));return this.setupInitialPieces(e),e}setupInitialPieces(e){let t=["rook","horse","elephant","advisor","king","advisor","elephant","horse","rook"];t.forEach((o,s)=>{let r=this.generatePieceId(o,"red",s);e[9][s]=this.createPiece(r,o,"red",s,9)}),[...t].forEach((o,s)=>{let r=this.generatePieceId(o,"black",s);e[0][s]=this.createPiece(r,o,"black",s,0)}),[1,7].forEach((o,s)=>{e[7][o]=this.createPiece(`r-cannon-${s+1}`,"cannon","red",o,7),e[2][o]=this.createPiece(`b-cannon-${s+1}`,"cannon","black",o,2)});for(let o=0;o<9;o+=2)e[6][o]=this.createPiece(`r-soldier-${o}`,"soldier","red",o,6),e[3][o]=this.createPiece(`b-soldier-${o}`,"soldier","black",o,3)}generatePieceId(e,t,i){let o=t==="red"?"r":"b";return e==="king"?`${o}-king`:`${o}-${e}-${i<4?"1":"2"}`}createPiece(e,t,i,o,s){return{id:e,type:t,color:i,position:{x:o,y:s},isSelected:!1,hasMoved:!1}}initializeGameState(){return A(E({},et),{board:this.initializeBoard(),hasApiKey:this.checkHasApiKey()})}isValidPosition(e,t){return e>=0&&e<n.BOARD_WIDTH&&t>=0&&t<n.BOARD_HEIGHT}isInPalace(e,t,i){return i==="red"?e>=n.PALACE_LEFT&&e<=n.PALACE_RIGHT&&t>=n.RED_PALACE_TOP&&t<=n.RED_PALACE_BOTTOM:e>=n.PALACE_LEFT&&e<=n.PALACE_RIGHT&&t>=n.BLACK_PALACE_TOP&&t<=n.BLACK_PALACE_BOTTOM}isOnOwnSide(e,t){return t==="red"?e>=5:e<=4}wouldKingsFaceEachOther(e,t=0){this.updateBoardCache(e,t);let i=this.boardCache.kingPositions.get("red"),o=this.boardCache.kingPositions.get("black");return!i||!o||i.x!==o.x?!1:this.isPathClear(e,i,o)}isPathClear(e,t,i){let o=Math.min(t.y,i.y),s=Math.max(t.y,i.y);for(let r=o+1;r<s;r++)if(e[r][t.x]!==null)return!1;return!0}updateBoardCache(e,t){if(this.boardCache.lastMoveCount!==t){this.boardCache.kingPositions.clear(),this.boardCache.piecesByColor.clear(),this.boardCache.piecesByColor.set("red",[]),this.boardCache.piecesByColor.set("black",[]);for(let i=0;i<n.BOARD_HEIGHT;i++)for(let o=0;o<n.BOARD_WIDTH;o++){let s=e[i][o];s&&(this.boardCache.piecesByColor.get(s.color).push(s),s.type==="king"&&this.boardCache.kingPositions.set(s.color,{x:o,y:i}))}this.boardCache.lastMoveCount=t}}clearCaches(){this.moveCache.clear(),this.boardCache.lastMoveCount=-1}getBoardHash(e){let t="";for(let i=0;i<n.BOARD_HEIGHT;i++)for(let o=0;o<n.BOARD_WIDTH;o++){let s=e[i][o];t+=s?`${s.type}${s.color}${o}${i}`:"e"}return t}isValidMoveForPiece(e,t,i){if(!this.isValidPosition(e.x,e.y))return!1;let o=i[e.y][e.x];return!o||o.color!==t.color}getSlidingPieceMoves(e,t,i){let o=[],{x:s,y:r}=e.position;return i.forEach(a=>{for(let h=1;h<10;h++){let f=s+a.dx*h,m=r+a.dy*h;if(!this.isValidPosition(f,m))break;let v=t[m][f];if(v){v.color!==e.color&&o.push({x:f,y:m});break}else o.push({x:f,y:m})}}),o}getPossibleMoves(e,t){let i=`${e.id}-${e.position.x}-${e.position.y}-true`;if(this.moveCache.has(i))return this.moveCache.get(i);let o=this.calculatePieceMoves(e,t,!0);return this.moveCache.set(i,o),o}getPossibleMovesForCheck(e,t){let i=`${e.id}-${e.position.x}-${e.position.y}-false`;if(this.moveCache.has(i))return this.moveCache.get(i);let o=this.calculatePieceMoves(e,t,!1);return this.moveCache.set(i,o),o}calculatePieceMoves(e,t,i){switch(e.type){case"king":return this.getKingMoves(e,t,i);case"advisor":return this.getAdvisorMoves(e,t);case"elephant":return this.getElephantMoves(e,t);case"horse":return this.getHorseMoves(e,t);case"rook":return this.getRookMoves(e,t);case"cannon":return this.getCannonMoves(e,t);case"soldier":return this.getSoldierMoves(e,t);default:return[]}}getKingMoves(e,t,i){let{x:o,y:s}=e.position;return this.ORTHOGONAL_DIRECTIONS.map(a=>({x:o+a.dx,y:s+a.dy})).filter(a=>{if(!this.isValidPosition(a.x,a.y)||!this.isInPalace(a.x,a.y,e.color))return!1;let h=t[a.y][a.x];return h&&h.color===e.color?!1:!i||!this.wouldMoveCreateKingFacing(e,a,t)})}wouldMoveCreateKingFacing(e,t,i){let o=i[t.y][t.x],s=e.position;i[t.y][t.x]=e,i[s.y][s.x]=null,e.position=t;let r=this.wouldKingsFaceEachOther(i);return i[s.y][s.x]=e,i[t.y][t.x]=o,e.position=s,r}getAdvisorMoves(e,t){let{x:i,y:o}=e.position;return this.DIAGONAL_DIRECTIONS.map(r=>({x:i+r.dx,y:o+r.dy})).filter(r=>this.isValidPosition(r.x,r.y)&&this.isInPalace(r.x,r.y,e.color)&&this.isValidMoveForPiece(r,e,t))}getElephantMoves(e,t){let{x:i,y:o}=e.position;return[{x:i-2,y:o-2,block:{x:i-1,y:o-1}},{x:i+2,y:o-2,block:{x:i+1,y:o-1}},{x:i-2,y:o+2,block:{x:i-1,y:o+1}},{x:i+2,y:o+2,block:{x:i+1,y:o+1}}].filter(r=>this.isValidPosition(r.x,r.y)&&this.isOnOwnSide(r.y,e.color)&&!t[r.block.y][r.block.x]&&this.isValidMoveForPiece(r,e,t)).map(r=>({x:r.x,y:r.y}))}getHorseMoves(e,t){let{x:i,y:o}=e.position;return[{x:i-1,y:o-2,block:{x:i,y:o-1}},{x:i+1,y:o-2,block:{x:i,y:o-1}},{x:i-1,y:o+2,block:{x:i,y:o+1}},{x:i+1,y:o+2,block:{x:i,y:o+1}},{x:i-2,y:o-1,block:{x:i-1,y:o}},{x:i-2,y:o+1,block:{x:i-1,y:o}},{x:i+2,y:o-1,block:{x:i+1,y:o}},{x:i+2,y:o+1,block:{x:i+1,y:o}}].filter(r=>this.isValidPosition(r.x,r.y)&&!t[r.block.y][r.block.x]&&this.isValidMoveForPiece(r,e,t)).map(r=>({x:r.x,y:r.y}))}getRookMoves(e,t){return this.getSlidingPieceMoves(e,t,this.ORTHOGONAL_DIRECTIONS)}getCannonMoves(e,t){let i=[],{x:o,y:s}=e.position;return this.ORTHOGONAL_DIRECTIONS.forEach(r=>{let a=!1;for(let h=1;h<10;h++){let f=o+r.dx*h,m=s+r.dy*h;if(!this.isValidPosition(f,m))break;let v=t[m][f];if(v)if(!a)a=!0;else{v.color!==e.color&&i.push({x:f,y:m});break}else a||i.push({x:f,y:m})}}),i}getSoldierMoves(e,t){let i=[],{x:o,y:s}=e.position,r=e.color==="red"?-1:1,a={x:o,y:s+r};return this.isValidMoveForPiece(a,e,t)&&i.push(a),this.isOnOwnSide(s,e.color)||[{x:o-1,y:s},{x:o+1,y:s}].forEach(f=>{this.isValidMoveForPiece(f,e,t)&&i.push(f)}),i}isInCheck(e,t,i=0){this.updateBoardCache(e,i);let o=this.boardCache.kingPositions.get(t);if(!o)return!1;let s=t==="red"?"black":"red";return(this.boardCache.piecesByColor.get(s)||[]).some(a=>this.getPossibleMovesForCheck(a,e).some(f=>f.x===o.x&&f.y===o.y))}makeMove(e,t,i){let{board:o,moveHistory:s}=e,r=o[t.y][t.x];if(!r)return{success:!1};let a=o[i.y][i.x],h=s.length;if(this.clearCaches(),o[i.y][i.x]=r,o[t.y][t.x]=null,r.position=i,a&&a.type==="king")return r.hasMoved=!0,{success:!0,captured:a,isCheck:!1,gameOver:!0,winner:r.color};if(this.wouldKingsFaceEachOther(o,h+1))return r.hasMoved=!0,{success:!0,captured:a||void 0,isCheck:!1,gameOver:!0,winner:r.color==="red"?"black":"red"};let f=r.color==="red"?"black":"red",m=this.isInCheck(o,f,h+1),v=this.isInCheck(o,r.color,h+1);return r.hasMoved=!0,{success:!0,captured:a||void 0,isCheck:m,isSelfInCheck:v}}getPieceSymbol(e){return{king:{red:"\u5E25",black:"\u5C07"},advisor:{red:"\u4ED5",black:"\u58EB"},elephant:{red:"\u76F8",black:"\u8C61"},horse:{red:"\u99AC",black:"\u99AC"},rook:{red:"\u8ECA",black:"\u8ECA"},cannon:{red:"\u70AE",black:"\u7832"},soldier:{red:"\u5175",black:"\u5352"}}[e.type][e.color]}checkHasApiKey(){if(typeof localStorage<"u"){let e=localStorage.getItem("gemini-api-key");return!!e&&e!=="YOUR_GEMINI_API_KEY_HERE"}return!1}updateApiKeyStatus(){let e=this.checkHasApiKey();this.hasApiKey.set(e)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=q({token:n,factory:n.\u0275fac,providedIn:"root"})};var se=class n{chessGameService=F($);engines=new Map;currentEngine=null;engineReady$=new Ge(!1);isThinking$=new Ge(!1);availableEngines=[{name:"Pikafish",path:"engines/pikafish.exe",author:"Pikafish Team",difficulty:9,description:"Professional xiangqi engine with NNUE evaluation"},{name:"Fairy-Stockfish",path:"engines/fairy-stockfish.exe",author:"Fairy-Stockfish Team",difficulty:8,description:"Multi-variant chess engine supporting xiangqi"}];constructor(){console.log("\u{1F527} UCI\u5F15\u64CE\u670D\u52D9\u5DF2\u521D\u59CB\u5316")}getAvailableEngines(){return this.availableEngines}initializeEngine(e){return g(this,null,function*(){console.log(`\u{1F680} \u521D\u59CB\u5316\u5F15\u64CE: ${e}`);try{yield this.delay(1e3);let t=this.availableEngines.find(o=>o.name===e);if(!t)return console.error(`\u274C \u627E\u4E0D\u5230\u5F15\u64CE: ${e}`),!1;let i={name:t.name,author:t.author,isReady:!0,difficulty:t.difficulty};return this.engines.set(e,i),this.currentEngine=e,this.engineReady$.next(!0),console.log(`\u2705 \u5F15\u64CE ${e} \u521D\u59CB\u5316\u5B8C\u6210`),!0}catch(t){return console.error("\u274C \u5F15\u64CE\u521D\u59CB\u5316\u5931\u6557:",t),this.engineReady$.next(!1),!1}})}shutdownEngine(){return g(this,null,function*(){this.currentEngine&&(console.log(`\u{1F50C} \u95DC\u9589\u5F15\u64CE: ${this.currentEngine}`),this.engines.delete(this.currentEngine),this.currentEngine=null,this.engineReady$.next(!1),this.isThinking$.next(!1))})}getEngineMove(e,t=3e3){return g(this,null,function*(){if(!this.currentEngine||!this.engineReady$.value)return console.error("\u274C \u5F15\u64CE\u672A\u5C31\u7DD2"),null;console.log(`\u{1F9E0} ${this.currentEngine} \u958B\u59CB\u5206\u6790...`),this.isThinking$.next(!0);try{yield this.delay(Math.min(t,2e3));let i=this.generateMockEngineMove(e);return this.isThinking$.next(!1),i&&(console.log(`\u{1F3AF} ${this.currentEngine} \u63A8\u85A6\u79FB\u52D5:`,i),console.log(`\u{1F4CA} \u8A55\u5206: ${i.score}, \u6DF1\u5EA6: ${i.depth}`)),i}catch(i){return console.error("\u274C \u5F15\u64CE\u5206\u6790\u5931\u6557:",i),this.isThinking$.next(!1),null}})}generateMockEngineMove(e){let t=this.getAllPossibleMoves(e,"black");if(t.length===0)return console.warn("\u{1F50D} UCI\u5F15\u64CE\uFF1A\u6C92\u6709\u627E\u5230\u4EFB\u4F55\u6709\u6548\u79FB\u52D5"),null;console.log(`\u{1F3AF} UCI\u5F15\u64CE\uFF1A\u5728 ${t.length} \u500B\u6709\u6548\u79FB\u52D5\u4E2D\u9078\u64C7`);let i=t.map(s=>{let r=0,a=e.board[s.to.y][s.to.x];a&&a.color==="red"&&(r+=100,console.log(`\u26A1 \u767C\u73FE\u5403\u5B50\u79FB\u52D5: ${this.positionToNotation(s.from)} -> ${this.positionToNotation(s.to)}`));let h=this.simulateMove(e.board,s.from,s.to);return this.chessGameService.isInCheck(h,"red")&&(r+=50,console.log(`\u{1F451} \u767C\u73FE\u5C07\u8ECD\u79FB\u52D5: ${this.positionToNotation(s.from)} -> ${this.positionToNotation(s.to)}`)),r+=Math.floor(Math.random()*20),{move:s,score:r}});i.sort((s,r)=>r.score-s.score);let o=i[0].move;return console.log(`\u2705 UCI\u5F15\u64CE\u9078\u64C7: ${this.positionToNotation(o.from)} -> ${this.positionToNotation(o.to)} (\u8A55\u5206: ${i[0].score})`),{from:o.from,to:o.to,score:i[0].score,depth:12,pv:`${this.positionToNotation(o.from)}${this.positionToNotation(o.to)}`}}getAllPossibleMoves(e,t){let i=[],o=e.board;for(let s=0;s<10;s++)for(let r=0;r<9;r++){let a=o[s][r];if(a&&a.color===t)try{let h=this.chessGameService.getPossibleMoves(a,o);for(let f of h){let m=this.simulateMove(o,a.position,f);this.chessGameService.isInCheck(m,t)||i.push({from:a.position,to:f})}}catch(h){console.warn(`\u7372\u53D6\u68CB\u5B50 ${a.type} \u79FB\u52D5\u5931\u6557:`,h)}}return console.log(`\u{1F50D} UCI\u5F15\u64CE\u627E\u5230 ${i.length} \u500B\u6709\u6548\u79FB\u52D5`),i}simulateMove(e,t,i){let o=e.map(r=>[...r]),s=o[t.y][t.x];return o[t.y][t.x]=null,o[i.y][i.x]=s?A(E({},s),{position:i}):null,o}positionToNotation(e){return"abcdefghi"[e.x]+(9-e.y)}setEngineOption(e,t){return g(this,null,function*(){if(!this.currentEngine){console.error("\u274C \u6C92\u6709\u6D3B\u52D5\u5F15\u64CE");return}console.log(`\u2699\uFE0F \u8A2D\u7F6E\u5F15\u64CE\u9078\u9805: ${e} = ${t}`)})}setDifficulty(e){return g(this,null,function*(){if(e<1||e>10){console.error("\u274C \u96E3\u5EA6\u7B49\u7D1A\u5FC5\u9808\u57281-10\u4E4B\u9593");return}let t=Math.floor(e*500),i=Math.floor(e*1.5);yield this.setEngineOption("Depth",i.toString()),yield this.setEngineOption("MoveTime",t.toString()),console.log(`\u{1F39A}\uFE0F \u8A2D\u7F6E\u5F15\u64CE\u96E3\u5EA6\u70BA ${e}/10`)})}delay(e){return new Promise(t=>setTimeout(t,e))}get engineReady(){return this.engineReady$.asObservable()}get isThinking(){return this.isThinking$.asObservable()}get currentEngineName(){return this.currentEngine}getEngineInfo(){return this.currentEngine&&this.engines.get(this.currentEngine)||null}pingEngine(){return g(this,null,function*(){if(!this.currentEngine||!this.engineReady$.value)return!1;try{return yield this.delay(100),!0}catch{return!1}})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=q({token:n,factory:n.\u0275fac,providedIn:"root"})};var we={king:1e4,rook:500,cannon:450,horse:400,elephant:200,advisor:200,soldier:100},Ti=[[0,0,0,20,30,20,0,0,0],[0,0,0,10,20,10,0,0,0],[0,0,0,5,10,5,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,-5,-10,-5,0,0,0],[0,0,0,-10,-20,-10,0,0,0],[0,0,0,-20,-30,-20,0,0,0]],Ni=[[40,50,50,55,60,55,50,50,40],[30,40,45,50,55,50,45,40,30],[20,30,35,40,45,40,35,30,20],[10,20,25,30,35,30,25,20,10],[5,15,20,25,30,25,20,15,5],[-5,-5,10,15,20,15,10,-5,-5],[-10,-10,0,5,10,5,0,-10,-10],[-15,-15,-5,0,5,0,-5,-15,-15],[-20,-20,-10,-5,0,-5,-10,-20,-20],[-25,-25,-15,-10,-5,-10,-15,-25,-25]],Ri=[[30,35,40,45,50,45,40,35,30],[25,30,35,40,45,40,35,30,25],[20,25,30,35,40,35,30,25,20],[15,20,25,30,35,30,25,20,15],[10,15,20,25,30,25,20,15,10],[5,10,15,20,25,20,15,10,5],[0,5,10,15,20,15,10,5,0],[-5,0,5,10,15,10,5,0,-5],[-10,-5,0,5,10,5,0,-5,-10],[-15,-10,-5,0,5,0,-5,-10,-15]],Gi=[[10,20,30,35,40,35,30,20,10],[15,25,35,40,45,40,35,25,15],[20,30,40,45,50,45,40,30,20],[25,35,45,50,55,50,45,35,25],[20,30,40,45,50,45,40,30,20],[15,25,35,40,45,40,35,25,15],[10,20,30,35,40,35,30,20,10],[5,15,25,30,35,30,25,15,5],[0,10,20,25,30,25,20,10,0],[-5,5,15,20,25,20,15,5,-5]],Bi=[[0,0,20,0,0,0,20,0,0],[0,0,0,0,0,0,0,0,0],[15,0,0,0,25,0,0,0,15],[0,0,0,0,0,0,0,0,0],[10,0,0,0,20,0,0,0,10],[0,0,0,0,0,0,0,0,0],[-10,0,0,0,-20,0,0,0,-10],[0,0,0,0,0,0,0,0,0],[-15,0,0,0,-25,0,0,0,-15],[0,0,-20,0,0,0,-20,0,0]],Li=[[0,0,0,20,0,20,0,0,0],[0,0,0,0,30,0,0,0,0],[0,0,0,15,0,15,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,-15,0,-15,0,0,0],[0,0,0,0,-30,0,0,0,0],[0,0,0,-20,0,-20,0,0,0]],$i=[[15,20,25,30,35,30,25,20,15],[10,15,20,25,30,25,20,15,10],[8,12,16,20,25,20,16,12,8],[6,10,14,18,22,18,14,10,6],[5,8,12,16,20,16,12,8,5],[3,6,9,12,15,12,9,6,3],[2,4,6,8,10,8,6,4,2],[1,2,3,4,5,4,3,2,1],[0,1,2,3,4,3,2,1,0],[0,0,1,2,3,2,1,0,0]],tt={king:Ti,rook:Ni,cannon:Ri,horse:Gi,elephant:Bi,advisor:Li,soldier:$i};function Ht(n,e,t,i){if(!tt[n])return 0;if(i==="red"){let o=9-t;return tt[n][o][e]}else return tt[n][t][e]}var jt=["user","model","function","system"];var Ve=(function(n){return n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.OTHER="OTHER",n})(Ve||{});var P=class extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}},H=class extends P{constructor(e,t){super(e),this.response=t}},Oe=class extends P{constructor(e,t,i,o){super(e),this.status=t,this.statusText=i,this.errorDetails=o}},K=class extends P{},ke=class extends P{};var Ki="https://generativelanguage.googleapis.com",Ui="v1beta",Hi="0.24.1",ji="genai-js",re=(function(n){return n.GENERATE_CONTENT="generateContent",n.STREAM_GENERATE_CONTENT="streamGenerateContent",n.COUNT_TOKENS="countTokens",n.EMBED_CONTENT="embedContent",n.BATCH_EMBED_CONTENTS="batchEmbedContents",n})(re||{}),it=class{constructor(e,t,i,o,s){this.model=e,this.task=t,this.apiKey=i,this.stream=o,this.requestOptions=s}toString(){var e,t;let i=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||Ui,s=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||Ki}/${i}/${this.model}:${this.task}`;return this.stream&&(s+="?alt=sse"),s}};function qi(n){let e=[];return n?.apiClient&&e.push(n.apiClient),e.push(`${ji}/${Hi}`),e.join(" ")}function Wi(n){return g(this,null,function*(){var e;let t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",qi(n.requestOptions)),t.append("x-goog-api-key",n.apiKey);let i=(e=n.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(i){if(!(i instanceof Headers))try{i=new Headers(i)}catch(o){throw new K(`unable to convert customHeaders value ${JSON.stringify(i)} to Headers: ${o.message}`)}for(let[o,s]of i.entries()){if(o==="x-goog-api-key")throw new K(`Cannot set reserved header name ${o}`);if(o==="x-goog-api-client")throw new K(`Header name ${o} can only be set using the apiClient field`);t.append(o,s)}}return t})}function Yi(n,e,t,i,o,s){return g(this,null,function*(){let r=new it(n,e,t,i,s);return{url:r.toString(),fetchOptions:Object.assign(Object.assign({},Zi(s)),{method:"POST",headers:yield Wi(r),body:o})}})}function ve(a,h,f,m,v){return g(this,arguments,function*(n,e,t,i,o,s={},r=fetch){let{url:_,fetchOptions:y}=yield Yi(n,e,t,i,o,s);return zi(_,y,r)})}function zi(i,o){return g(this,arguments,function*(n,e,t=fetch){let s;try{s=yield t(n,e)}catch(r){Ji(r,n)}return s.ok||(yield Xi(s,n)),s})}function Ji(n,e){let t=n;throw t.name==="AbortError"?(t=new ke(`Request aborted when fetching ${e.toString()}: ${n.message}`),t.stack=n.stack):n instanceof Oe||n instanceof K||(t=new P(`Error fetching from ${e.toString()}: ${n.message}`),t.stack=n.stack),t}function Xi(n,e){return g(this,null,function*(){let t="",i;try{let o=yield n.json();t=o.error.message,o.error.details&&(t+=` ${JSON.stringify(o.error.details)}`,i=o.error.details)}catch{}throw new Oe(`Error fetching from ${e.toString()}: [${n.status} ${n.statusText}] ${t}`,n.status,n.statusText,i)})}function Zi(n){let e={};if(n?.signal!==void 0||n?.timeout>=0){let t=new AbortController;n?.timeout>=0&&setTimeout(()=>t.abort(),n.timeout),n?.signal&&n.signal.addEventListener("abort",()=>{t.abort()}),e.signal=t.signal}return e}function ot(n){return n.text=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),Pe(n.candidates[0]))throw new H(`${j(n)}`,n);return Qi(n)}else if(n.promptFeedback)throw new H(`Text not available. ${j(n)}`,n);return""},n.functionCall=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Pe(n.candidates[0]))throw new H(`${j(n)}`,n);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),qt(n)[0]}else if(n.promptFeedback)throw new H(`Function call not available. ${j(n)}`,n)},n.functionCalls=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Pe(n.candidates[0]))throw new H(`${j(n)}`,n);return qt(n)}else if(n.promptFeedback)throw new H(`Function call not available. ${j(n)}`,n)},n}function Qi(n){var e,t,i,o;let s=[];if(!((t=(e=n.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(let r of(o=(i=n.candidates)===null||i===void 0?void 0:i[0].content)===null||o===void 0?void 0:o.parts)r.text&&s.push(r.text),r.executableCode&&s.push("\n```"+r.executableCode.language+`
`+r.executableCode.code+"\n```\n"),r.codeExecutionResult&&s.push("\n```\n"+r.codeExecutionResult.output+"\n```\n");return s.length>0?s.join(""):""}function qt(n){var e,t,i,o;let s=[];if(!((t=(e=n.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(let r of(o=(i=n.candidates)===null||i===void 0?void 0:i[0].content)===null||o===void 0?void 0:o.parts)r.functionCall&&s.push(r.functionCall);if(s.length>0)return s}var en=[Ve.RECITATION,Ve.SAFETY,Ve.LANGUAGE];function Pe(n){return!!n.finishReason&&en.includes(n.finishReason)}function j(n){var e,t,i;let o="";if((!n.candidates||n.candidates.length===0)&&n.promptFeedback)o+="Response was blocked",!((e=n.promptFeedback)===null||e===void 0)&&e.blockReason&&(o+=` due to ${n.promptFeedback.blockReason}`),!((t=n.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(o+=`: ${n.promptFeedback.blockReasonMessage}`);else if(!((i=n.candidates)===null||i===void 0)&&i[0]){let s=n.candidates[0];Pe(s)&&(o+=`Candidate was blocked due to ${s.finishReason}`,s.finishMessage&&(o+=`: ${s.finishMessage}`))}return o}function pe(n){return this instanceof pe?(this.v=n,this):new pe(n)}function tn(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(n,e||[]),o,s=[];return o={},r("next"),r("throw"),r("return"),o[Symbol.asyncIterator]=function(){return this},o;function r(_){i[_]&&(o[_]=function(y){return new Promise(function(V,N){s.push([_,y,V,N])>1||a(_,y)})})}function a(_,y){try{h(i[_](y))}catch(V){v(s[0][3],V)}}function h(_){_.value instanceof pe?Promise.resolve(_.value.v).then(f,m):v(s[0][2],_)}function f(_){a("next",_)}function m(_){a("throw",_)}function v(_,y){_(y),s.shift(),s.length&&a(s[0][0],s[0][1])}}var Wt=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function nn(n){let e=n.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=rn(e),[i,o]=t.tee();return{stream:sn(i),response:on(o)}}function on(n){return g(this,null,function*(){let e=[],t=n.getReader();for(;;){let{done:i,value:o}=yield t.read();if(i)return ot(an(e));e.push(o)}})}function sn(n){return tn(this,arguments,function*(){let t=n.getReader();for(;;){let{value:i,done:o}=yield pe(t.read());if(o)break;yield yield pe(ot(i))}})}function rn(n){let e=n.getReader();return new ReadableStream({start(i){let o="";return s();function s(){return e.read().then(({value:r,done:a})=>{if(a){if(o.trim()){i.error(new P("Failed to parse stream"));return}i.close();return}o+=r;let h=o.match(Wt),f;for(;h;){try{f=JSON.parse(h[1])}catch{i.error(new P(`Error parsing JSON response: "${h[1]}"`));return}i.enqueue(f),o=o.substring(h[0].length),h=o.match(Wt)}return s()}).catch(r=>{let a=r;throw a.stack=r.stack,a.name==="AbortError"?a=new ke("Request aborted when reading from the stream"):a=new P("Error reading from the stream"),a})}}})}function an(n){let e=n[n.length-1],t={promptFeedback:e?.promptFeedback};for(let i of n){if(i.candidates){let o=0;for(let s of i.candidates)if(t.candidates||(t.candidates=[]),t.candidates[o]||(t.candidates[o]={index:o}),t.candidates[o].citationMetadata=s.citationMetadata,t.candidates[o].groundingMetadata=s.groundingMetadata,t.candidates[o].finishReason=s.finishReason,t.candidates[o].finishMessage=s.finishMessage,t.candidates[o].safetyRatings=s.safetyRatings,s.content&&s.content.parts){t.candidates[o].content||(t.candidates[o].content={role:s.content.role||"user",parts:[]});let r={};for(let a of s.content.parts)a.text&&(r.text=a.text),a.functionCall&&(r.functionCall=a.functionCall),a.executableCode&&(r.executableCode=a.executableCode),a.codeExecutionResult&&(r.codeExecutionResult=a.codeExecutionResult),Object.keys(r).length===0&&(r.text=""),t.candidates[o].content.parts.push(r)}o++}i.usageMetadata&&(t.usageMetadata=i.usageMetadata)}return t}function Zt(n,e,t,i){return g(this,null,function*(){let o=yield ve(e,re.STREAM_GENERATE_CONTENT,n,!0,JSON.stringify(t),i);return nn(o)})}function Qt(n,e,t,i){return g(this,null,function*(){let s=yield(yield ve(e,re.GENERATE_CONTENT,n,!1,JSON.stringify(t),i)).json();return{response:ot(s)}})}function ei(n){if(n!=null){if(typeof n=="string")return{role:"system",parts:[{text:n}]};if(n.text)return{role:"system",parts:[n]};if(n.parts)return n.role?n:{role:"system",parts:n.parts}}}function ge(n){let e=[];if(typeof n=="string")e=[{text:n}];else for(let t of n)typeof t=="string"?e.push({text:t}):e.push(t);return ln(e)}function ln(n){let e={role:"user",parts:[]},t={role:"function",parts:[]},i=!1,o=!1;for(let s of n)"functionResponse"in s?(t.parts.push(s),o=!0):(e.parts.push(s),i=!0);if(i&&o)throw new P("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!i&&!o)throw new P("No content is provided for sending chat message.");return i?e:t}function cn(n,e){var t;let i={model:e?.model,generationConfig:e?.generationConfig,safetySettings:e?.safetySettings,tools:e?.tools,toolConfig:e?.toolConfig,systemInstruction:e?.systemInstruction,cachedContent:(t=e?.cachedContent)===null||t===void 0?void 0:t.name,contents:[]},o=n.generateContentRequest!=null;if(n.contents){if(o)throw new K("CountTokensRequest must have one of contents or generateContentRequest, not both.");i.contents=n.contents}else if(o)i=Object.assign(Object.assign({},i),n.generateContentRequest);else{let s=ge(n);i.contents=[s]}return{generateContentRequest:i}}function Yt(n){let e;return n.contents?e=n:e={contents:[ge(n)]},n.systemInstruction&&(e.systemInstruction=ei(n.systemInstruction)),e}function un(n){return typeof n=="string"||Array.isArray(n)?{content:ge(n)}:n}var zt=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],dn={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function hn(n){let e=!1;for(let t of n){let{role:i,parts:o}=t;if(!e&&i!=="user")throw new P(`First content should be with role 'user', got ${i}`);if(!jt.includes(i))throw new P(`Each item should include role field. Got ${i} but valid roles are: ${JSON.stringify(jt)}`);if(!Array.isArray(o))throw new P("Content should have 'parts' property with an array of Parts");if(o.length===0)throw new P("Each Content should have at least one part");let s={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let a of o)for(let h of zt)h in a&&(s[h]+=1);let r=dn[i];for(let a of zt)if(!r.includes(a)&&s[a]>0)throw new P(`Content with role '${i}' can't contain '${a}' part`);e=!0}}function Jt(n){var e;if(n.candidates===void 0||n.candidates.length===0)return!1;let t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;if(t===void 0||t.parts===void 0||t.parts.length===0)return!1;for(let i of t.parts)if(i===void 0||Object.keys(i).length===0||i.text!==void 0&&i.text==="")return!1;return!0}var Xt="SILENT_ERROR",nt=class{constructor(e,t,i,o={}){this.model=t,this.params=i,this._requestOptions=o,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,i?.history&&(hn(i.history),this._history=i.history)}getHistory(){return g(this,null,function*(){return yield this._sendPromise,this._history})}sendMessage(i){return g(this,arguments,function*(e,t={}){var o,s,r,a,h,f;yield this._sendPromise;let m=ge(e),v={safetySettings:(o=this.params)===null||o===void 0?void 0:o.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(r=this.params)===null||r===void 0?void 0:r.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(h=this.params)===null||h===void 0?void 0:h.systemInstruction,cachedContent:(f=this.params)===null||f===void 0?void 0:f.cachedContent,contents:[...this._history,m]},_=Object.assign(Object.assign({},this._requestOptions),t),y;return this._sendPromise=this._sendPromise.then(()=>Qt(this._apiKey,this.model,v,_)).then(V=>{var N;if(Jt(V.response)){this._history.push(m);let _e=Object.assign({parts:[],role:"model"},(N=V.response.candidates)===null||N===void 0?void 0:N[0].content);this._history.push(_e)}else{let _e=j(V.response);_e&&console.warn(`sendMessage() was unsuccessful. ${_e}. Inspect response object for details.`)}y=V}).catch(V=>{throw this._sendPromise=Promise.resolve(),V}),yield this._sendPromise,y})}sendMessageStream(i){return g(this,arguments,function*(e,t={}){var o,s,r,a,h,f;yield this._sendPromise;let m=ge(e),v={safetySettings:(o=this.params)===null||o===void 0?void 0:o.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(r=this.params)===null||r===void 0?void 0:r.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(h=this.params)===null||h===void 0?void 0:h.systemInstruction,cachedContent:(f=this.params)===null||f===void 0?void 0:f.cachedContent,contents:[...this._history,m]},_=Object.assign(Object.assign({},this._requestOptions),t),y=Zt(this._apiKey,this.model,v,_);return this._sendPromise=this._sendPromise.then(()=>y).catch(V=>{throw new Error(Xt)}).then(V=>V.response).then(V=>{if(Jt(V)){this._history.push(m);let N=Object.assign({},V.candidates[0].content);N.role||(N.role="model"),this._history.push(N)}else{let N=j(V);N&&console.warn(`sendMessageStream() was unsuccessful. ${N}. Inspect response object for details.`)}}).catch(V=>{V.message!==Xt&&console.error(V)}),y})}};function fn(n,e,t,i){return g(this,null,function*(){return(yield ve(e,re.COUNT_TOKENS,n,!1,JSON.stringify(t),i)).json()})}function mn(n,e,t,i){return g(this,null,function*(){return(yield ve(e,re.EMBED_CONTENT,n,!1,JSON.stringify(t),i)).json()})}function pn(n,e,t,i){return g(this,null,function*(){let o=t.requests.map(r=>Object.assign(Object.assign({},r),{model:e}));return(yield ve(e,re.BATCH_EMBED_CONTENTS,n,!1,JSON.stringify({requests:o}),i)).json()})}var Fe=class{constructor(e,t,i={}){this.apiKey=e,this._requestOptions=i,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=ei(t.systemInstruction),this.cachedContent=t.cachedContent}generateContent(i){return g(this,arguments,function*(e,t={}){var o;let s=Yt(e),r=Object.assign(Object.assign({},this._requestOptions),t);return Qt(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(o=this.cachedContent)===null||o===void 0?void 0:o.name},s),r)})}generateContentStream(i){return g(this,arguments,function*(e,t={}){var o;let s=Yt(e),r=Object.assign(Object.assign({},this._requestOptions),t);return Zt(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(o=this.cachedContent)===null||o===void 0?void 0:o.name},s),r)})}startChat(e){var t;return new nt(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},e),this._requestOptions)}countTokens(i){return g(this,arguments,function*(e,t={}){let o=cn(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),t);return fn(this.apiKey,this.model,o,s)})}embedContent(i){return g(this,arguments,function*(e,t={}){let o=un(e),s=Object.assign(Object.assign({},this._requestOptions),t);return mn(this.apiKey,this.model,o,s)})}batchEmbedContents(i){return g(this,arguments,function*(e,t={}){let o=Object.assign(Object.assign({},this._requestOptions),t);return pn(this.apiKey,this.model,e,o)})}};var Te=class{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new P("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Fe(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,i){if(!e.name)throw new K("Cached content must contain a `name` field.");if(!e.model)throw new K("Cached content must contain a `model` field.");let o=["model","systemInstruction"];for(let r of o)if(t?.[r]&&e[r]&&t?.[r]!==e[r]){if(r==="model"){let a=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,h=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(a===h)continue}throw new K(`Different value for "${r}" specified in modelParams (${t[r]}) and cachedContent (${e[r]})`)}let s=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new Fe(this.apiKey,s,i)}};var ae=class n{chessGameService=F($);uciEngineService=F(se);maxDepth=4;searchTime=3e3;startTime=0;nodes=0;useGeminiAI=!1;useUCIEngine=!0;useLegacyMinimax=!1;makeAIMove(e){return g(this,null,function*(){console.log("\u{1F9E0} AI\u958B\u59CB\u601D\u8003..."),this.startTime=Date.now(),this.nodes=0;try{if(this.useUCIEngine){console.log("\u26A1 \u4F7F\u7528 UCI \u5F15\u64CE\u9032\u884C\u5206\u6790...");let i=yield this.getUCIEngineMove(e);if(i){let o=Date.now()-this.startTime;return console.log(`\u{1F3AF} UCI \u5F15\u64CE\u6C7A\u7B56\u5B8C\u6210: ${o}ms`),console.log(`\u{1F3C6} UCI \u5F15\u64CE\u9078\u64C7\u79FB\u52D5: (${i.from.x},${i.from.y}) -> (${i.to.x},${i.to.y})`),i.score!==void 0&&console.log(`\u{1F4CA} \u5F15\u64CE\u8A55\u5206: ${i.score}, \u641C\u7D22\u6DF1\u5EA6: ${i.depth||"N/A"}`),i}console.log("\u26A0\uFE0F UCI \u5F15\u64CE\u672A\u80FD\u63D0\u4F9B\u6709\u6548\u79FB\u52D5\uFF0C\u5617\u8A66\u5099\u7528\u65B9\u6848...")}if(this.useGeminiAI){console.log("\u{1F916} \u4F7F\u7528 Gemini AI \u9032\u884C\u6C7A\u7B56...");let i=yield this.getGeminiMove(e);if(i){let o=Date.now()-this.startTime;return console.log(`\u{1F3AF} Gemini AI \u6C7A\u7B56\u5B8C\u6210: ${o}ms`),console.log(`\u{1F916} Gemini \u9078\u64C7\u79FB\u52D5: (${i.from.x},${i.from.y}) -> (${i.to.x},${i.to.y})`),i}console.log("\u26A0\uFE0F Gemini AI \u672A\u80FD\u63D0\u4F9B\u6709\u6548\u79FB\u52D5\uFF0C\u5617\u8A66\u50B3\u7D71\u7B97\u6CD5...")}if(this.useLegacyMinimax){console.log(`\u{1F9E0} \u4F7F\u7528 Minimax \u7B97\u6CD5 (\u6DF1\u5EA6${this.maxDepth}\u5C64)...`);let i=this.minimax(e,this.maxDepth,-1/0,1/0,!0),o=Date.now()-this.startTime;if(console.log(`\u{1F3AF} Minimax \u6C7A\u7B56\u5B8C\u6210: ${o}ms, \u641C\u7D22${this.nodes}\u500B\u7BC0\u9EDE`),i&&i.move)return console.log(`\u{1F916} \u9078\u64C7\u79FB\u52D5: (${i.move.from.x},${i.move.from.y}) -> (${i.move.to.x},${i.move.to.y}), \u8A55\u5206: ${i.score}`),i.move}console.log("\u{1F3B2} \u4F7F\u7528\u96A8\u6A5F\u79FB\u52D5\u4F5C\u70BA\u6700\u5F8C\u5099\u6848...");let t=this.getAllPossibleMoves(e,"black");return t.length>0?t[Math.floor(Math.random()*t.length)]:null}catch(t){console.error("\u{1F916} AI\u601D\u8003\u51FA\u932F:",t);let i=this.getAllPossibleMoves(e,"black");return i.length>0?i[0]:null}})}getUCIEngineMove(e){return g(this,null,function*(){try{let t=this.uciEngineService.getEngineInfo();if((!t||!t.isReady)&&(console.log("\u{1F527} \u521D\u59CB\u5316 Pikafish \u5F15\u64CE..."),!(yield this.uciEngineService.initializeEngine("Pikafish"))))return console.log("\u274C UCI \u5F15\u64CE\u521D\u59CB\u5316\u5931\u6557"),null;let i=this.searchTime;console.log(`\u23F1\uFE0F \u5F15\u64CE\u5206\u6790\u6642\u9593\u9650\u5236: ${i}ms`);let o=yield this.uciEngineService.getEngineMove(e,i);if(o){let s=this.getAllPossibleMoves(e,"black");if(this.isValidMove(o,s))return console.log("\u2705 UCI \u5F15\u64CE\u79FB\u52D5\u6709\u6548"),o;console.log("\u274C UCI \u5F15\u64CE\u8FD4\u56DE\u7121\u6548\u79FB\u52D5")}return null}catch(t){return console.error("\u274C UCI \u5F15\u64CE\u8ABF\u7528\u5931\u6557:",t),null}})}getGeminiMove(e){return g(this,null,function*(){try{let i=typeof localStorage<"u"?localStorage.getItem("gemini-api-key"):null;if(!i||i==="YOUR_GEMINI_API_KEY_HERE")return console.log("\u274C Gemini API Key \u672A\u8A2D\u7F6E\uFF0C\u8ACB\u5728\u8A2D\u5B9A\u4E2D\u8F38\u5165 API Key"),null;console.log("\u{1F511} \u4F7F\u7528 API Key:",i?`${i.substring(0,8)}...${i.substring(i.length-4)}`:"\u7121");let s=new Te(i).getGenerativeModel({model:"gemini-2.5-pro"});console.log("\u{1F4E1} \u6E96\u5099\u547C\u53EB Gemini API...");let r=this.createGeminiPrompt(e);console.log("\u{1F680} \u6B63\u5728\u547C\u53EB Gemini API...");let a=yield s.generateContent(r);console.log("\u2705 Gemini API \u547C\u53EB\u6210\u529F\uFF01");let f=(yield a.response).text();if(console.log("\u{1F4DD} Gemini \u56DE\u61C9\u9577\u5EA6:",f?.length||0),!f)return console.log("\u274C Gemini \u6C92\u6709\u8FD4\u56DE\u6709\u6548\u56DE\u61C9"),null;let m=f.match(/\{[\s\S]*\}/);if(m){let v=JSON.parse(m[0]);console.log("\u{1F916} Gemini \u5206\u6790:",v.analysis),console.log("\u{1F916} \u9078\u64C7\u7406\u7531:",v.reasoning);let _=this.getAllPossibleMoves(e,"black"),y=v.move;if(this.isValidMove(y,_))return y;console.log("\u274C Gemini \u63D0\u4F9B\u7684\u79FB\u52D5\u7121\u6548")}}catch(t){console.error("\u274C Gemini API \u8ABF\u7528\u5931\u6557:",t)}return null})}createGeminiPrompt(e){let t=this.describeBoardState(e),i=this.getAllPossibleMoves(e,"black"),o=this.describeValidMoves(i);return`
You are a professional Chinese Chess AI. Please analyze the current board state and choose the best move.

Board state (RED at bottom, BLACK at top, coordinates start from 0,0):
${t}

Available moves:
${o}

Please analyze the position and choose the best move. Response must be in JSON format:
{
  "analysis": "Your analysis process",
  "move": {
    "from": {"x": start_x_coordinate, "y": start_y_coordinate},
    "to": {"x": target_x_coordinate, "y": target_y_coordinate}
  },
  "reasoning": "Reason for choosing this move"
}

Important notes:
1. You are BLACK player, choose moves that benefit BLACK
2. Coordinate system: x is column (0-8), y is row (0-9)
3. You can only choose from the provided available moves
4. Priority: capturing, checking, position improvement, defense
5. You have maximum 10 seconds thinking time
6. Please respond in Traditional Chinese
`}describeBoardState(e){let t="";for(let i=0;i<10;i++){let o=`Row ${i}: `;for(let s=0;s<9;s++){let r=e.board[i][s];if(r){let a=r.color==="red"?"RED":"BLACK";o+=`(${s},${i}):${a}_${r.type} `}}t+=o+`
`}return t}describeValidMoves(e){return e.map((t,i)=>`${i+1}. Move from (${t.from.x},${t.from.y}) to (${t.to.x},${t.to.y})`).join(`
`)}isValidMove(e,t){return t.some(i=>i.from.x===e.from.x&&i.from.y===e.from.y&&i.to.x===e.to.x&&i.to.y===e.to.y)}setUseUCIEngine(e){this.useUCIEngine=e,console.log(`\u{1F527} UCI \u5F15\u64CE\u6A21\u5F0F: ${e?"\u555F\u7528":"\u505C\u7528"}`)}setUseGeminiAI(e){this.useGeminiAI=e,console.log(`\u{1F916} Gemini AI \u6A21\u5F0F: ${e?"\u555F\u7528":"\u505C\u7528"}`)}setUseLegacyMinimax(e){this.useLegacyMinimax=e,console.log(`\u{1F9E0} \u50B3\u7D71 Minimax \u6A21\u5F0F: ${e?"\u555F\u7528":"\u505C\u7528"}`)}setAIMode(e){switch(e){case"uci-only":this.useUCIEngine=!0,this.useGeminiAI=!1,this.useLegacyMinimax=!1,console.log("\u{1F3C6} AI \u6A21\u5F0F: \u50C5\u4F7F\u7528 UCI \u5F15\u64CE");break;case"gemini-only":this.useUCIEngine=!1,this.useGeminiAI=!0,this.useLegacyMinimax=!1,console.log("\u{1F916} AI \u6A21\u5F0F: \u50C5\u4F7F\u7528 Gemini AI");break;case"minimax-only":this.useUCIEngine=!1,this.useGeminiAI=!1,this.useLegacyMinimax=!0,console.log("\u{1F9E0} AI \u6A21\u5F0F: \u50C5\u4F7F\u7528 Minimax \u7B97\u6CD5");break;case"mixed":this.useUCIEngine=!0,this.useGeminiAI=!0,this.useLegacyMinimax=!0,console.log("\u{1F500} AI \u6A21\u5F0F: \u6DF7\u5408\u6A21\u5F0F (UCI \u2192 Gemini \u2192 Minimax)");break;case"auto":default:this.useUCIEngine=!0,this.useGeminiAI=!1,this.useLegacyMinimax=!1,console.log("\u26A1 AI \u6A21\u5F0F: \u81EA\u52D5 (\u512A\u5148 UCI \u5F15\u64CE)");break}}initializeAI(e="Pikafish"){return g(this,null,function*(){console.log(`\u{1F680} \u521D\u59CB\u5316 AI \u7CFB\u7D71\uFF0C\u4F7F\u7528\u5F15\u64CE: ${e}`);try{let t=yield this.uciEngineService.initializeEngine(e);return t&&(console.log("\u2705 AI \u7CFB\u7D71\u521D\u59CB\u5316\u5B8C\u6210"),this.setAIMode("auto")),t}catch(t){return console.error("\u274C AI \u7CFB\u7D71\u521D\u59CB\u5316\u5931\u6557:",t),!1}})}getAIStatus(){return{uciEngine:this.useUCIEngine,geminiAI:this.useGeminiAI,legacyMinimax:this.useLegacyMinimax,currentEngine:this.uciEngineService.currentEngineName,engineReady:this.uciEngineService.getEngineInfo()?.isReady||!1}}minimax(e,t,i,o,s){if(this.nodes++,Date.now()-this.startTime>this.searchTime)return null;if(t===0)return{move:{from:{x:0,y:0},to:{x:0,y:0}},score:this.evaluatePosition(e)};let r=s?"black":"red",a=this.getAllPossibleMoves(e,r);if(a.length===0)return this.chessGameService.isInCheck(e.board,r)?{move:{from:{x:0,y:0},to:{x:0,y:0}},score:s?-1e4:1e4}:{move:{from:{x:0,y:0},to:{x:0,y:0}},score:0};let h=this.orderMoves(e,a),f=null;if(s){let m=-1/0;for(let v of h){let _=this.simulateMove(e,v.from,v.to);if(this.chessGameService.isInCheck(_.board,"black"))continue;let y=this.minimax(_,t-1,i,o,!1);if(y&&y.score>m&&(m=y.score,f=v),i=Math.max(i,m),o<=i)break}return f?{move:f,score:m}:null}else{let m=1/0;for(let v of h){let _=this.simulateMove(e,v.from,v.to);if(this.chessGameService.isInCheck(_.board,"red"))continue;let y=this.minimax(_,t-1,i,o,!0);if(y&&y.score<m&&(m=y.score,f=v),o=Math.min(o,m),o<=i)break}return f?{move:f,score:m}:null}}orderMoves(e,t){return t.sort((i,o)=>{let s=0,r=0,a=e.board[i.to.y][i.to.x],h=e.board[o.to.y][o.to.x];a&&(s+=we[a.type]),h&&(r+=we[h.type]);let f=this.simulateMove(e,i.from,i.to),m=this.simulateMove(e,o.from,o.to);return this.chessGameService.isInCheck(f.board,"red")&&(s+=100),this.chessGameService.isInCheck(m.board,"red")&&(r+=100),r-s})}evaluatePosition(e){let t=0;for(let s=0;s<10;s++)for(let r=0;r<9;r++){let a=e.board[s][r];if(!a)continue;let h=we[a.type];h+=Ht(a.type,r,s,a.color),a.color==="black"?t+=h:t-=h}let i=this.getAllPossibleMoves(e,"black").length,o=this.getAllPossibleMoves(e,"red").length;return t+=(i-o)*5,this.chessGameService.isInCheck(e.board,"black")&&(t-=100),this.chessGameService.isInCheck(e.board,"red")&&(t+=100),t}simulateMove(e,t,i){let o=e.board.map((s,r)=>r===t.y||r===i.y?s.map((a,h)=>{if(h===t.x&&r===t.y||h===i.x&&r===i.y){if(h===t.x&&r===t.y)return null;if(h===i.x&&r===i.y){let f=e.board[t.y][t.x];return f?A(E({},f),{position:{x:i.x,y:i.y},hasMoved:!0,isSelected:!1}):null}}return a}):s);return A(E({},e),{board:o})}getAllPossibleMoves(e,t){let i=[],o=e.board;for(let s=0;s<10;s++)for(let r=0;r<9;r++){let a=o[s][r];if(a&&a.color===t){let h=this.chessGameService.getPossibleMoves(a,o);for(let f of h)i.push({from:a.position,to:f})}}return i}setDifficulty(e){switch(e){case"easy":this.maxDepth=2,this.searchTime=1e3;break;case"medium":this.maxDepth=4,this.searchTime=3e3;break;case"hard":this.maxDepth=6,this.searchTime=5e3;break}}getThinkingDescription(){return this.useUCIEngine?`\u26A1 ${this.uciEngineService.currentEngineName||"UCI\u5F15\u64CE"} \u6B63\u5728\u9032\u884C\u6DF1\u5EA6\u5206\u6790...`:this.useGeminiAI?"\u{1F916} Gemini AI \u6B63\u5728\u5206\u6790\u68CB\u5C40...":this.useLegacyMinimax?"\u{1F9E0} AI\u6B63\u5728\u4F7F\u7528Minimax\u7B97\u6CD5\u6DF1\u5EA6\u5206\u6790...":"\u{1F3B2} AI\u6B63\u5728\u9078\u64C7\u79FB\u52D5..."}getDetailedThinkingStatus(){let e=this.getAIStatus(),t="unknown",i="";return e.uciEngine?(t="uci",i=`${e.currentEngine||"UCI\u5F15\u64CE"} \u5206\u6790\u4E2D...`):e.geminiAI?(t="gemini",i="Gemini AI \u601D\u8003\u4E2D..."):e.legacyMinimax?(t="minimax",i="Minimax \u7B97\u6CD5\u8A08\u7B97\u4E2D..."):(t="random",i="\u96A8\u6A5F\u9078\u64C7\u4E2D..."),{description:i,mode:t,engine:e.currentEngine||void 0,isThinking:!0}}static \u0275fac=function(t){return new(t||n)};static \u0275prov=q({token:n,factory:n.\u0275fac,providedIn:"root"})};function gn(n,e){if(n&1){let t=k();c(0,"div",2)(1,"label",4),d(2," Gemini API Key "),l(),c(3,"div",5)(4,"input",6),_t("ngModelChange",function(o){I(t);let s=p();return vt(s.apiKeyInput,o)||(s.apiKeyInput=o),D(o)}),x("keyup.enter",function(){I(t);let o=p();return D(o.saveApiKey())}),l(),c(5,"button",7),x("click",function(){I(t);let o=p();return D(o.saveApiKey())}),d(6," \u5132\u5B58 "),l()(),c(7,"p",8),d(8," \u8ACB\u5F9E "),c(9,"a",9),d(10,"Google AI Studio"),l(),d(11," \u53D6\u5F97 API Key "),l()()}if(n&2){let t=p();u(4),gt("ngModel",t.apiKeyInput),u(),w("disabled",!t.apiKeyInput.trim())}}function vn(n,e){if(n&1){let t=k();c(0,"div",3)(1,"div")(2,"p",10),d(3),l(),c(4,"p",11),d(5,"Gemini AI \u8C61\u68CB\u529F\u80FD\u5DF2\u555F\u7528"),l()(),c(6,"button",12),x("click",function(){I(t);let o=p();return D(o.clearApiKey())}),d(7," \u6E05\u9664 "),l()()}if(n&2){let t=p();u(3),M("\u2705 API Key \u5DF2\u8A2D\u5B9A (",t.maskedApiKey(),")")}}var Ne=class n{chessGameService=F($);apiKeyInput="";hasApiKey=S(()=>this.chessGameService.hasApiKey());onApiKeySaved=qe();onApiKeyClear=qe();constructor(){this.chessGameService.updateApiKeyStatus()}saveApiKey(){this.apiKeyInput.trim()&&typeof localStorage<"u"&&(localStorage.setItem("gemini-api-key",this.apiKeyInput.trim()),this.apiKeyInput="",console.log("API Key saved, emitting onApiKeySaved event"),this.onApiKeySaved.emit(),typeof window<"u"&&window.dispatchEvent(new CustomEvent("gemini_api_key_updated")),this.chessGameService.updateApiKeyStatus())}clearApiKey(){typeof localStorage<"u"&&(localStorage.removeItem("gemini-api-key"),this.onApiKeyClear.emit(),typeof window<"u"&&window.dispatchEvent(new CustomEvent("gemini_api_key_updated")),this.chessGameService.updateApiKeyStatus())}maskedApiKey(){if(typeof localStorage<"u"){let e=localStorage.getItem("gemini-api-key");if(e)return`${e.substring(0,8)}...${e.substring(e.length-4)}`}return""}static getApiKey(){return typeof localStorage<"u"?localStorage.getItem("gemini-api-key"):null}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=Z({type:n,selectors:[["app-gemini-api-key"]],outputs:{onApiKeySaved:"onApiKeySaved",onApiKeyClear:"onApiKeyClear"},decls:5,vars:1,consts:[[1,"bg-gray-900","border","border-gray-700","rounded-lg","p-4","mb-4"],[1,"text-lime-400","font-bold","mb-3","flex","items-center","gap-2"],[1,"mb-3"],[1,"flex","items-center","justify-between"],[1,"block","text-gray-300","text-sm","font-medium","mb-2"],[1,"flex","gap-2"],["type","password","placeholder","\u8ACB\u8F38\u5165\u60A8\u7684 Gemini API Key...",1,"flex-1","bg-gray-800","border","border-gray-600","rounded","px-3","py-2","text-white","focus:outline-none","focus:border-lime-400",3,"ngModelChange","keyup.enter","ngModel"],[1,"bg-lime-600","hover:bg-lime-700","disabled:bg-gray-600","disabled:cursor-not-allowed","text-white","px-4","py-2","rounded","transition-colors",3,"click","disabled"],[1,"text-gray-400","text-xs","mt-2"],["href","https://makersuite.google.com/app/apikey","target","_blank",1,"text-lime-400","hover:underline"],[1,"text-green-400","text-sm"],[1,"text-gray-400","text-xs"],[1,"bg-red-600","hover:bg-red-700","text-white","px-3","py-1","rounded","text-sm","transition-colors",3,"click"]],template:function(t,i){t&1&&(c(0,"div",0)(1,"h3",1),d(2,"\u{1F916} Gemini AI \u8A2D\u5B9A"),l(),C(3,gn,12,2,"div",2)(4,vn,8,1,"div",3),l()),t&2&&(u(3),b(i.hasApiKey()?4:3))},dependencies:[ee,Se,De,$t,Qe],styles:["[_nghost-%COMP%]{display:block}@media (max-width: 640px){.flex[_ngcontent-%COMP%]{flex-direction:column}.flex-1[_ngcontent-%COMP%]{margin-bottom:.5rem}}"]})};function yn(n,e){if(n&1&&(c(0,"span",17),d(1),l()),n&2){let t=p();u(),M(" (",t.aiStatus.currentEngine,") ")}}function Cn(n,e){if(n&1){let t=k();c(0,"button",18),x("click",function(){let o=I(t).$implicit,s=p();return D(s.setAIMode(o.value))}),d(1),l()}if(n&2){let t=e.$implicit,i=p();G(i.getButtonClass(t.value)),u(),pt(" ",t.icon," ",t.label," ")}}function bn(n,e){if(n&1){let t=k();c(0,"div",19)(1,"div",20)(2,"span",21),d(3),l(),c(4,"span",22),d(5),l()(),c(6,"div",23),d(7),l(),c(8,"button",24),x("click",function(){let o=I(t).$implicit,s=p();return D(s.initializeEngine(o.name))}),d(9),l()()}if(n&2){let t=e.$implicit,i=p();u(3),Y(t.name),u(2),M("\u96E3\u5EA6: ",t.difficulty,"/10"),u(2),Y(t.description),u(),w("disabled",i.isInitializing),u(),M(" ",i.currentEngine===t.name?"\u2705 \u4F7F\u7528\u4E2D":"\u{1F680} \u521D\u59CB\u5316"," ")}}function xn(n,e){n&1&&(c(0,"div",25),d(1," \u23F3 \u6B63\u5728\u521D\u59CB\u5316\u5F15\u64CE... "),l())}var Re=class n{chessAI=F(ae);uciEngine=F(se);aiStatus={};currentEngine=null;isInitializing=!1;availableEngines=[];aiModes=[{value:"auto",label:"\u81EA\u52D5 (\u63A8\u85A6)",icon:"\u26A1"},{value:"uci-only",label:"UCI \u5F15\u64CE",icon:"\u{1F3C6}"},{value:"gemini-only",label:"Gemini AI",icon:"\u{1F916}"},{value:"minimax-only",label:"Minimax",icon:"\u{1F9E0}"},{value:"mixed",label:"\u6DF7\u5408\u6A21\u5F0F",icon:"\u{1F500}"}];ngOnInit(){this.updateStatus(),this.availableEngines=this.uciEngine.getAvailableEngines()}updateStatus(){this.aiStatus=this.chessAI.getAIStatus(),this.currentEngine=this.aiStatus.currentEngine}setAIMode(e){console.log(`\u{1F527} \u8A2D\u7F6E AI \u6A21\u5F0F: ${e}`),this.chessAI.setAIMode(e),this.updateStatus()}getButtonClass(e){let t="px-3 py-2 text-sm rounded transition-colors ",i=this.getCurrentMode();return e===i?t+"bg-blue-600 text-white":t+"bg-gray-600 hover:bg-gray-500 text-gray-200"}getCurrentMode(){let e=this.aiStatus;return e.uciEngine&&!e.geminiAI&&!e.legacyMinimax?"uci-only":!e.uciEngine&&e.geminiAI&&!e.legacyMinimax?"gemini-only":!e.uciEngine&&!e.geminiAI&&e.legacyMinimax?"minimax-only":e.uciEngine&&e.geminiAI&&e.legacyMinimax?"mixed":"auto"}initializeEngine(e){return g(this,null,function*(){this.isInitializing=!0;try{console.log(`\u{1F680} \u521D\u59CB\u5316\u5F15\u64CE: ${e}`),(yield this.chessAI.initializeAI(e))?(console.log(`\u2705 \u5F15\u64CE ${e} \u521D\u59CB\u5316\u6210\u529F`),this.updateStatus()):console.error(`\u274C \u5F15\u64CE ${e} \u521D\u59CB\u5316\u5931\u6557`)}catch(t){console.error("\u5F15\u64CE\u521D\u59CB\u5316\u932F\u8AA4:",t)}finally{this.isInitializing=!1}})}quickSetup(){return g(this,null,function*(){console.log("\u26A1 \u57F7\u884C\u5FEB\u901F\u8A2D\u7F6E..."),this.isInitializing=!0;try{(yield this.chessAI.initializeAI("Pikafish"))?(this.chessAI.setAIMode("auto"),console.log("\u2705 \u5FEB\u901F\u8A2D\u7F6E\u5B8C\u6210 - \u4F7F\u7528 Pikafish \u5F15\u64CE")):(this.chessAI.setAIMode("gemini-only"),console.log("\u26A0\uFE0F UCI \u5F15\u64CE\u4E0D\u53EF\u7528\uFF0C\u5207\u63DB\u5230 Gemini AI")),this.updateStatus()}catch(e){console.error("\u5FEB\u901F\u8A2D\u7F6E\u5931\u6557:",e),this.chessAI.setAIMode("minimax-only"),this.updateStatus()}finally{this.isInitializing=!1}})}resetAI(){console.log("\u{1F504} \u91CD\u7F6E AI \u8A2D\u5B9A"),this.chessAI.setAIMode("auto"),this.updateStatus()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=Z({type:n,selectors:[["app-ai-config"]],decls:44,vars:17,consts:[[1,"bg-gray-800","text-white","p-4","rounded-lg","shadow-lg","mb-4"],[1,"text-lg","font-bold","mb-3","text-yellow-400"],[1,"mb-4","p-3","bg-gray-700","rounded"],[1,"font-semibold","mb-2"],[1,"space-y-1","text-sm"],[1,"flex","items-center"],[1,"w-20"],["class","ml-2 text-blue-300",4,"ngIf"],[1,"mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-2"],[3,"class","click",4,"ngFor","ngForOf"],[1,"space-y-2"],["class","p-2 bg-gray-600 rounded text-sm",4,"ngFor","ngForOf"],[1,"flex","flex-wrap","gap-2"],[1,"px-3","py-1","text-sm","bg-green-600","hover:bg-green-700","rounded",3,"click","disabled"],[1,"px-3","py-1","text-sm","bg-red-600","hover:bg-red-700","rounded",3,"click"],["class","mt-3 text-center text-yellow-400",4,"ngIf"],[1,"ml-2","text-blue-300"],[3,"click"],[1,"p-2","bg-gray-600","rounded","text-sm"],[1,"flex","justify-between","items-center"],[1,"font-medium"],[1,"text-yellow-400"],[1,"text-gray-300","text-xs"],[1,"mt-1","px-3","py-1","text-xs","bg-blue-600","hover:bg-blue-700","rounded",3,"click","disabled"],[1,"mt-3","text-center","text-yellow-400"]],template:function(t,i){t&1&&(c(0,"div",0)(1,"h3",1),d(2,"\u{1F916} AI \u8A2D\u5B9A"),l(),c(3,"div",2)(4,"h4",3),d(5,"\u7576\u524D\u72C0\u614B"),l(),c(6,"div",4)(7,"div",5)(8,"span",6),d(9,"UCI \u5F15\u64CE:"),l(),c(10,"span"),d(11),l(),ce(12,yn,2,1,"span",7),l(),c(13,"div",5)(14,"span",6),d(15,"Gemini AI:"),l(),c(16,"span"),d(17),l()(),c(18,"div",5)(19,"span",6),d(20,"Minimax:"),l(),c(21,"span"),d(22),l()(),c(23,"div",5)(24,"span",6),d(25,"\u5F15\u64CE\u72C0\u614B:"),l(),c(26,"span"),d(27),l()()()(),c(28,"div",8)(29,"h4",3),d(30,"AI \u6A21\u5F0F"),l(),c(31,"div",9),ce(32,Cn,2,4,"button",10),l()(),c(33,"div",8)(34,"h4",3),d(35,"\u53EF\u7528\u5F15\u64CE"),l(),c(36,"div",11),ce(37,bn,10,5,"div",12),l()(),c(38,"div",13)(39,"button",14),x("click",function(){return i.quickSetup()}),d(40," \u26A1 \u5FEB\u901F\u8A2D\u7F6E (\u63A8\u85A6) "),l(),c(41,"button",15),x("click",function(){return i.resetAI()}),d(42," \u{1F504} \u91CD\u7F6E "),l()(),ce(43,xn,2,0,"div",16),l()),t&2&&(u(10),G(i.aiStatus.uciEngine?"text-green-400":"text-red-400"),u(),M(" ",i.aiStatus.uciEngine?"\u2705 \u555F\u7528":"\u274C \u505C\u7528"," "),u(),w("ngIf",i.aiStatus.currentEngine),u(4),G(i.aiStatus.geminiAI?"text-green-400":"text-red-400"),u(),M(" ",i.aiStatus.geminiAI?"\u2705 \u555F\u7528":"\u274C \u505C\u7528"," "),u(4),G(i.aiStatus.legacyMinimax?"text-green-400":"text-red-400"),u(),M(" ",i.aiStatus.legacyMinimax?"\u2705 \u555F\u7528":"\u274C \u505C\u7528"," "),u(4),G(i.aiStatus.engineReady?"text-green-400":"text-yellow-400"),u(),M(" ",i.aiStatus.engineReady?"\u2705 \u5C31\u7DD2":"\u23F3 \u672A\u5C31\u7DD2"," "),u(5),w("ngForOf",i.aiModes),u(5),w("ngForOf",i.availableEngines),u(2),w("disabled",i.isInitializing),u(4),w("ngIf",i.isInitializing))},dependencies:[ee,xt,Et],encapsulation:2})};var En=()=>[0,1,2,3,4,5,6,7,8,9],An=()=>[0,1,2,3,4,5,6,7,8],In=n=>({"bg-blue-700 border-blue-500":n}),ii=n=>({"valid-move-point":n});function Dn(n,e){n&1&&(c(0,"div",8),d(1," \u5C07\u8ECD\uFF01 "),l())}function Mn(n,e){n&1&&(c(0,"div",9),d(1,"\u88AB\u5C07\u8ECD\uFF01"),l())}function Sn(n,e){if(n&1){let t=k();c(0,"button",52),x("click",function(){I(t);let o=p();return D(o.toggleAIConfig())}),d(1),l()}if(n&2){let t=p();w("ngClass",be(2,In,t.isAIConfigOpen())),u(),M(" \u{1F916} AI \u5F15\u64CE\u8A2D\u5B9A ",t.isAIConfigOpen()?"\u25B2":"\u25BC"," ")}}function wn(n,e){n&1&&O(0,"app-ai-config")}function Vn(n,e){if(n&1){let t=k();c(0,"div",56)(1,"button",57),x("click",function(){I(t);let o=p(2);return D(o.setAIDifficulty("easy"))}),d(2," \u7C21\u55AE "),l(),c(3,"button",57),x("click",function(){I(t);let o=p(2);return D(o.setAIDifficulty("medium"))}),d(4," \u4E2D\u7B49 "),l(),c(5,"button",57),x("click",function(){I(t);let o=p(2);return D(o.setAIDifficulty("hard"))}),d(6," \u56F0\u96E3 "),l()()}if(n&2){let t=p(2);u(),w("ngClass",t.aiDifficulty()==="easy"?"bg-green-600 text-white":"bg-neutral-700 text-neutral-300 hover:bg-neutral-600"),u(2),w("ngClass",t.aiDifficulty()==="medium"?"bg-yellow-600 text-white":"bg-neutral-700 text-neutral-300 hover:bg-neutral-600"),u(2),w("ngClass",t.aiDifficulty()==="hard"?"bg-red-600 text-white":"bg-neutral-700 text-neutral-300 hover:bg-neutral-600")}}function Pn(n,e){if(n&1){let t=k();c(0,"div",58)(1,"span",23),d(2,"API Key \u5DF2\u8A2D\u7F6E"),l(),c(3,"button",60),x("click",function(){I(t);let o=p(3);return D(o.clearApiKey())}),d(4," \u6E05\u9664 "),l()()}}function On(n,e){if(n&1){let t=k();c(0,"button",61),x("click",function(){I(t);let o=p(3);return D(o.openApiKeyModal())}),d(1," Gemini API Key "),l()}}function kn(n,e){if(n&1&&(c(0,"div",56),C(1,Pn,5,0,"div",58)(2,On,2,0,"button",59),l()),n&2){let t=p(2);u(),b(t.hasApiKey()?1:2)}}function Fn(n,e){if(n&1){let t=k();c(0,"div",12)(1,"div",53)(2,"span",54),d(3,"\u{1F916}AI\u985E\u578B:"),l(),c(4,"button",55),x("click",function(){I(t);let o=p();return D(o.setAIType("local"))}),d(5," \u672C\u5730\u7AEF "),l(),c(6,"button",55),x("click",function(){I(t);let o=p();return D(o.setAIType("service"))}),d(7," Gemini AI "),l()(),C(8,Vn,7,3,"div",56),C(9,kn,3,1,"div",56),l()}if(n&2){let t=p();u(4),w("ngClass",t.aiType()==="local"?"bg-blue-600 text-white":"bg-neutral-700 text-neutral-300 hover:bg-neutral-600"),u(2),w("ngClass",t.aiType()==="service"?"bg-purple-600 text-white":"bg-neutral-700 text-neutral-300 hover:bg-neutral-600"),u(2),b(t.aiType()==="local"?8:-1),u(),b(t.aiType()==="service"?9:-1)}}function Tn(n,e){n&1&&(c(0,"span"),d(1,"\u{1F916}"),l())}function Nn(n,e){if(n&1&&d(0),n&2){let t=p();M(" ",t.moveHistory()[t.moveHistory().length-1]," ")}}function Rn(n,e){n&1&&d(0," \uFF1F\uFF1F ")}function Gn(n,e){n&1&&d(0," Gemini \u5DF2\u555F\u7528 ")}function Bn(n,e){if(n&1&&d(0),n&2){let t=p();M(" \u672C\u5730\u7AEF (",t.getAIDifficultyText(),")")}}function Ln(n,e){n&1&&d(0," AI \u601D\u8003\u4E2D... ")}function $n(n,e){if(n&1&&(c(0,"div",30),d(1),l()),n&2){let t=e.$implicit;u(),M(" ",t," ")}}function Kn(n,e){if(n&1&&(c(0,"div",33),d(1),l()),n&2){let t=e.$implicit;u(),M(" ",t," ")}}function Un(n,e){if(n&1&&O(0,"div",62)(1,"div",63),n&2){let t=e.$implicit;G(t===6?"z-20 h-[1.5px]":"z-10"),U("top",t*40+4,"px"),w("ngClass","sm:hidden"),u(),G(t===6?"z-20 h-[1.5px]":"z-10"),U("top",t*50+4,"px")}}function Hn(n,e){if(n&1&&O(0,"div",64)(1,"div",64)(2,"div",65)(3,"div",65),n&2){let t=e.$implicit;U("left",t*36+14,"px")("top",4,"px")("height",157,"px"),u(),U("left",t*36+14,"px")("top",203,"px")("height",162,"px"),u(),U("left",t*50+4,"px")("top",4,"px")("height",200,"px"),u(),U("left",t*50+4,"px")("top",254,"px")("height",200,"px")}}function jn(n,e){n&1&&O(0,"div",67)}function qn(n,e){n&1&&O(0,"div",67)}function Wn(n,e){if(n&1&&(c(0,"div",68)(1,"div",75),d(2),l()()),n&2){let t=p().$implicit,i=p(2);w("ngClass",i.getPieceClass(t)),u(),G(t.color===i.PlayerColor.RED?"bg-red-100 border-red-600 text-red-800":"bg-neutral-100 border-neutral-800 text-neutral-800"),u(),M(" ",i.getPieceSymbol(t)," ")}}function Yn(n,e){n&1&&O(0,"div",69)}function zn(n,e){n&1&&O(0,"div",70)}function Jn(n,e){n&1&&O(0,"div",67)}function Xn(n,e){n&1&&O(0,"div",67)}function Zn(n,e){if(n&1&&(c(0,"div",72)(1,"div",76),d(2),l()()),n&2){let t=p().$implicit,i=p(2);w("ngClass",i.getPieceClass(t)),u(),G(t.color===i.PlayerColor.RED?"bg-red-100 border-red-600 text-red-800":"bg-neutral-100 border-neutral-800 text-neutral-800"),u(),M(" ",i.getPieceSymbol(t)," ")}}function Qn(n,e){n&1&&O(0,"div",73)}function eo(n,e){n&1&&O(0,"div",74)}function to(n,e){if(n&1){let t=k();c(0,"div",66),x("click",function(){let o=I(t).$index,s=p().$index,r=p();return D(r.onSquareClick(o,s))}),C(1,jn,1,0,"div",67),C(2,qn,1,0,"div",67),C(3,Wn,3,4,"div",68),C(4,Yn,1,0,"div",69),C(5,zn,1,0,"div",70),l(),c(6,"div",71),x("click",function(){let o=I(t).$index,s=p().$index,r=p();return D(r.onSquareClick(o,s))}),C(7,Jn,1,0,"div",67),C(8,Xn,1,0,"div",67),C(9,Zn,3,4,"div",72),C(10,Qn,1,0,"div",73),C(11,eo,1,0,"div",74),l()}if(n&2){let t=e.$implicit,i=e.$index,o=p().$index,s=p();U("top",o*40+4,"px")("left",i*36+14,"px"),w("ngClass",be(20,ii,s.isValidMove(i,o))),u(),b((o===2||o===7)&&(i===0||i===2||i===4||i===6||i===8)?1:-1),u(),b((o===3||o===6)&&(i===1||i===7)?2:-1),u(),b(t?3:-1),u(),b(s.isValidMove(i,o)&&!t?4:-1),u(),b(s.isValidMove(i,o)&&t&&t.color!==s.currentPlayer()?5:-1),u(),U("top",o*50+4,"px")("left",i*50+4,"px"),w("ngClass",be(22,ii,s.isValidMove(i,o))),u(),b((o===2||o===7)&&(i===0||i===2||i===4||i===6||i===8)?7:-1),u(),b((o===3||o===6)&&(i===1||i===7)?8:-1),u(),b(t?9:-1),u(),b(s.isValidMove(i,o)&&!t?10:-1),u(),b(s.isValidMove(i,o)&&t&&t.color!==s.currentPlayer()?11:-1)}}function io(n,e){if(n&1&&B(0,to,12,24,null,null,Ce),n&2){let t=e.$implicit;L(t)}}function no(n,e){if(n&1&&(c(0,"div",33),d(1),l()),n&2){let t=e.$implicit;u(),M(" ",t," ")}}function oo(n,e){if(n&1&&(c(0,"div",30),d(1),l()),n&2){let t=e.$implicit;u(),M(" ",t," ")}}function so(n,e){if(n&1){let t=k();c(0,"div",47)(1,"div",77)(2,"div",78),d(3,"\u{1F3C6}"),l(),c(4,"h2",79),d(5),l(),c(6,"button",80),x("click",function(){I(t);let o=p();return D(o.resetGame())}),d(7," \u91CD\u65B0\u958B\u59CB "),l()()()}if(n&2){let t=p();u(5),M(" ",t.winner()===t.PlayerColor.RED?"\u7D05\u65B9\u7372\u52DD\uFF01":"\u9ED1\u65B9\u7372\u52DD\uFF01"," ")}}function ro(n,e){if(n&1&&(c(0,"span",86),d(1),l()),n&2){let t=p(2).$index,i=p(2);u(),Y(i.moveHistory()[t+1])}}function ao(n,e){if(n&1&&(c(0,"div",12)(1,"span",84),d(2),l(),c(3,"span",85),d(4),l(),C(5,ro,2,1,"span",86),l()),n&2){let t=p(),i=t.$implicit,o=t.$index,s=p(2);u(2),M("",s.Math.floor(o/2)+1,"."),u(2),Y(i),u(),b(s.moveHistory()[o+1]?5:-1)}}function lo(n,e){if(n&1&&C(0,ao,6,3,"div",12),n&2){let t=e.$index;b(t%2===0?0:-1)}}function co(n,e){if(n&1&&(c(0,"section",48)(1,"h3",81),d(2,"\u68CB\u8B5C\u8A18\u9304"),l(),c(3,"div",82)(4,"div",83),B(5,lo,1,1,null,null,Ce),l()()()),n&2){let t=p();u(5),L(t.moveHistory())}}function uo(n,e){if(n&1){let t=k();c(0,"div",87),x("click",function(){I(t);let o=p();return D(o.closeApiKeyModal())}),c(1,"div",88),x("click",function(o){return I(t),D(o.stopPropagation())}),c(2,"button",89),x("click",function(){I(t);let o=p();return D(o.closeApiKeyModal())}),d(3,"\xD7"),l(),c(4,"app-gemini-api-key",90),x("onApiKeySaved",function(){I(t);let o=p();return D(o.onApiKeySaved())})("onApiKeyClear",function(){I(t);let o=p();return D(o.onApiKeyCleared())}),l()()()}}var ni=class n{chessGameService=F($);chessAIService=F(ae);apiKeyUpdateListener;gameState=R(et);aiType=R("local");board=S(()=>this.gameState().board);currentPlayer=S(()=>this.gameState().currentPlayer);selectedPiece=S(()=>this.gameState().selectedPiece);validMoves=S(()=>this.gameState().validMoves);gameOver=S(()=>this.gameState().gameOver);winner=S(()=>this.gameState().winner);moveHistory=S(()=>this.gameState().moveHistory);isInCheck=S(()=>this.gameState().isInCheck);isSelfInCheck=S(()=>this.gameState().isSelfInCheck);currentPlayerDisplay=S(()=>this.currentPlayer()==="red"?"\u7D05\u65B9":"\u9ED1\u65B9");isVsAI=S(()=>this.gameState().isVsAI);aiIsThinking=S(()=>this.gameState().aiIsThinking);aiThinkingText=S(()=>this.gameState().aiThinkingText);aiDifficulty=R("hard");hasApiKey=S(()=>this.chessGameService.hasApiKey());isGeminiEnabled=S(()=>this.hasApiKey()&&this.isVsAI());isApiKeyModalOpen=R(!1);isAIConfigOpen=R(!1);isAITurn=S(()=>this.isVsAI()&&this.currentPlayer()==="black"&&!this.gameOver());canInteract=S(()=>!this.isVsAI()||this.currentPlayer()==="red");PlayerColor=J;Math=Math;ngOnInit(){this.resetGame(),this.chessGameService.updateApiKeyStatus(),this.hasApiKey()&&this.setAIType("service"),typeof window<"u"&&(this.apiKeyUpdateListener=()=>{this.chessGameService.updateApiKeyStatus(),this.hasApiKey()&&this.aiType()==="local"&&this.setAIType("service")},window.addEventListener("gemini_api_key_updated",this.apiKeyUpdateListener))}ngOnDestroy(){typeof window<"u"&&this.apiKeyUpdateListener&&window.removeEventListener("gemini_api_key_updated",this.apiKeyUpdateListener)}resetGame(){let e=this.chessGameService.initializeGameState();this.gameState.set(e)}onSquareClick(e,t){if(this.gameOver()||!this.canInteract())return;let i=this.gameState(),o=i.board[t][e];i.selectedPiece?o&&o.color===i.currentPlayer&&o!==i.selectedPiece?this.selectPiece(o):this.isValidMove(e,t)?this.makeMove(i.selectedPiece.position,{x:e,y:t}):this.deselectPiece():o&&o.color===i.currentPlayer&&this.selectPiece(o)}selectPiece(e){let t=this.gameState();t.board.flat().forEach(o=>{o&&(o.isSelected=!1)}),e.isSelected=!0;let i=this.chessGameService.getPossibleMoves(e,t.board);this.gameState.set(A(E({},t),{selectedPiece:e,validMoves:i}))}deselectPiece(){let e=this.gameState();e.selectedPiece&&(e.selectedPiece.isSelected=!1),this.gameState.set(A(E({},e),{selectedPiece:null,validMoves:[]}))}isValidMove(e,t){return this.validMoves().some(i=>i.x===e&&i.y===t)}makeMove(e,t){let i=this.gameState(),o=i.board[e.y][e.x];if(!o)return;let s=this.chessGameService.makeMove(i,e,t);if(s.success){let r=this.generateMoveNotation(o,e,t,s.captured),a=[...i.moveHistory,r],h=i.currentPlayer==="red"?"black":"red",f=s.isCheck||!1,m=s.isSelfInCheck||!1,v=s.isCheckmate||s.isStalemate||s.gameOver||!1,_=s.winner||(s.isCheckmate?i.currentPlayer:null);i.board.flat().forEach(y=>{y&&(y.isSelected=!1)}),this.gameState.set(A(E({},i),{currentPlayer:h,selectedPiece:null,validMoves:[],moveHistory:a,isInCheck:f,isSelfInCheck:m,gameOver:v,winner:_})),console.log("\u6AA2\u67E5AI\u89F8\u767C\u689D\u4EF6:",{gameOver:v,isVsAI:i.isVsAI,nextPlayer:h,shouldTrigger:!v&&i.isVsAI&&h==="black"}),!v&&i.isVsAI&&h==="black"&&(console.log("\u6E96\u5099\u89F8\u767CAI\u79FB\u52D5..."),this.triggerAIMove())}}generateMoveNotation(e,t,i,o){if(!e)return"";let s=m=>{let v=["\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D","\u4E03","\u516B","\u4E5D"];return m>=1&&m<=9?v[m-1]:m.toString()},r=this.chessGameService.getPieceSymbol(e),a=e.color==="red"?9-t.x:t.x+1,h=i.y-t.y,f="";if(h===0){let m=e.color==="red"?9-i.x:i.x+1;f="\u5E73"+s(m)}else f=(e.color==="red"&&h<0||e.color==="black"&&h>0?"\u9032":"\u9000")+s(Math.abs(h));return`${r}${s(a)}${f}`}getSquareClass(e,t){let i="chess-square";return this.board()[t]?.[e]?.isSelected&&(i+=" selected"),this.isValidMove(e,t)&&(i+=" valid-move"),(this.chessGameService.isInPalace(e,t,"red")||this.chessGameService.isInPalace(e,t,"black"))&&(i+=" palace"),i}getPieceClass(e){if(!e)return"";let t=`chess-piece ${e.color}`;return e.isSelected&&(t+=" selected"),t}getPieceSymbol(e){return e?this.chessGameService.getPieceSymbol(e):""}getRowNumbers(){return Array.from({length:10},(e,t)=>10-t)}getColumnLetters(){return["a","b","c","d","e","f","g","h","i"]}toggleGameMode(){let e=this.gameState(),t=!e.isVsAI;this.gameState.set(A(E({},e),{isVsAI:t,aiIsThinking:!1})),t&&e.currentPlayer==="black"&&!e.gameOver&&this.triggerAIMove()}triggerAIMove(){return g(this,null,function*(){let e=this.gameState();console.log("\u{1F916} \u89F8\u767CAI\u79FB\u52D5\uFF0C\u7576\u524D\u73A9\u5BB6:",e.currentPlayer),this.chessAIService.setDifficulty(this.aiDifficulty()),this.gameState.set(A(E({},e),{aiIsThinking:!0,aiThinkingText:this.chessAIService.getThinkingDescription()})),setTimeout(()=>g(this,null,function*(){try{let t=yield this.chessAIService.makeAIMove(e);t?(console.log("\u{1F916} AI\u9078\u64C7\u79FB\u52D5:",t),this.makeAIMove(t.from,t.to)):(console.warn("\u{1F916} AI\u7121\u6CD5\u627E\u5230\u6709\u6548\u79FB\u52D5\uFF0CAI\u6295\u964D"),this.aiSurrender())}catch(t){console.error("\u{1F916} AI\u79FB\u52D5\u51FA\u932F:",t),this.aiSurrender()}}),500)})}makeAIMove(e,t){let i=this.gameState(),o=i.board[e.y][e.x];if(!o)return;let s=this.chessGameService.makeMove(i,e,t);if(s.success){let r=this.generateMoveNotation(o,e,t,s.captured),a=[...i.moveHistory,r],h="red",f=s.isCheck||!1,m=s.isSelfInCheck||!1,v=s.isCheckmate||s.isStalemate||s.gameOver||!1,_=s.winner||(s.isCheckmate?"black":null);i.board.flat().forEach(y=>{y&&(y.isSelected=!1)}),this.gameState.set(A(E({},i),{currentPlayer:h,selectedPiece:null,validMoves:[],moveHistory:a,isInCheck:f,isSelfInCheck:m,gameOver:v,winner:_,aiIsThinking:!1}))}}aiSurrender(){let e=this.gameState();console.log("\u{1F916} AI\u6295\u964D\uFF0C\u904A\u6232\u7D50\u675F"),this.gameState.set(A(E({},e),{gameOver:!0,winner:"red",aiIsThinking:!1,moveHistory:[...e.moveHistory,"\u{1F916} AI\u6295\u964D"]}))}setAIDifficulty(e){this.aiDifficulty.set(e),console.log("\u{1F916} AI\u96E3\u5EA6\u8A2D\u7F6E\u70BA:",e)}getAIDifficultyText(){switch(this.aiDifficulty()){case"easy":return"\u7C21\u55AE";case"medium":return"\u4E2D\u7B49";case"hard":return"\u56F0\u96E3";default:return"\u4E2D\u7B49"}}openApiKeyModal(){this.isApiKeyModalOpen.set(!0)}closeApiKeyModal(){this.isApiKeyModalOpen.set(!1)}clearApiKey(){typeof localStorage<"u"&&localStorage.removeItem("gemini-api-key"),this.chessGameService.updateApiKeyStatus(),this.aiType()==="service"&&this.setAIType("local"),console.log("Gemini API Key \u5DF2\u6E05\u9664")}onApiKeySaved(){console.log("onApiKeySaved called"),this.chessGameService.updateApiKeyStatus(),console.log("hasApiKey after save:",this.hasApiKey()),setTimeout(()=>{this.closeApiKeyModal()},100)}onApiKeyCleared(){console.log("onApiKeyCleared called"),this.chessGameService.updateApiKeyStatus(),console.log("hasApiKey after clear:",this.hasApiKey()),this.aiType()==="service"&&this.setAIType("local"),setTimeout(()=>{this.closeApiKeyModal()},100)}setAIType(e){this.aiType.set(e),e==="service"&&!this.hasApiKey()&&this.openApiKeyModal(),this.chessAIService.setUseGeminiAI(e==="service"),console.log(`\u{1F916} \u5DF2\u5207\u63DB AI \u985E\u578B: ${e}`)}openAIConfig(){this.isAIConfigOpen.set(!0)}closeAIConfig(){this.isAIConfigOpen.set(!1)}toggleAIConfig(){this.isAIConfigOpen.set(!this.isAIConfigOpen())}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=Z({type:n,selectors:[["app-chinese-chess"]],decls:100,vars:18,consts:[[1,"w-full","max-w-[95vw]","sm:max-w-sm","mx-auto","flex","flex-col","px-2","sm:px-0"],[1,"mb-2","flex","flex-col","gap-3","items-stretch"],[1,"flex","justify-between","items-center"],[1,"text-center","text-2xl","font-bold","tracking-wider","text-lime-400","drop-shadow"],["routerLink","/",1,"text-lime-600","text-sm"],[1,"flex","gap-2","justify-between"],[1,"h-12","w-1/3","rounded-md","bg-lime-700","border","border-lime-500","text-lime-50","font-semibold","text-base","shadow","hover:bg-lime-600","focus:outline-none","focus:ring-2","focus:ring-lime-300","drop-shadow-[0_0_5px_#22d3ee]",3,"click"],[1,"h-12","w-1/3","rounded-md","border","font-medium","shadow","bg-zinc-800"],[1,"text-3xl","text-center","text-amber-300","font-bold","leading-12","animate-pulse"],[1,"text-3xl","text-red-400","animate-pulse"],[1,"h-12","w-1/3","rounded-md","bg-cyan-700","border","border-cyan-500","text-cyan-50","font-semibold","text-base","shadow","hover:bg-cyan-600","focus:outline-none","focus:ring-2","focus:ring-cyan-300",3,"click"],[1,"w-full","h-12","rounded-md","bg-gray-700","border","border-gray-500","text-gray-50","font-semibold","text-base","shadow","hover:bg-gray-600","focus:outline-none","focus:ring-2","focus:ring-gray-300","transition-all",3,"ngClass"],[1,"flex","gap-2"],[1,"flex","flex-col","gap-2"],[1,"flex","items-center","gap-1","flex-wrap","bg-white/10","rounded-md","p-2","border","border-white/20"],[1,"border","border-lime-400","bg-lime-400/20","px-2","py-1","text-lime-300","font-bold","hover:bg-lime-400/30","transition"],[1,"text-lime-400","text-xs"],[1,"text-center","text-xs"],[1,"border","px-2","py-1","font-bold",3,"ngClass"],[1,"text-xs"],[1,"border","border-amber-400","bg-amber-400/20","px-2","py-1","text-amber-300","font-bold"],[1,"text-amber-400","text-xs"],[1,"border","border-green-400","bg-green-400/20","px-2","py-1","text-green-300","font-bold","text-center",3,"click"],[1,"text-green-400","text-xs"],[1,"w-full","text-center","text-sm","mt-2","h-4","bg-neutral-700/80","rounded","overflow-hidden","relative","animate-pulse","text-white"],[1,"flex","justify-center"],[1,"relative","inline-block"],[1,"chess-board","bg-amber-100","border-2","sm:border-4","border-amber-800","p-2","sm:p-6","relative"],[1,"flex","justify-center","mb-1","sm:mb-2"],[1,"grid","grid-cols-9","gap-0"],[1,"w-[36px]","sm:w-[50px]","text-center","text-xs","font-bold","text-amber-800"],[1,"flex"],[1,"flex","flex-col","justify-center","mr-1","sm:mr-2"],[1,"h-[40px]","sm:h-[50px]","flex","items-center","justify-center","text-xs","font-bold","text-amber-800","w-4","sm:w-6"],[1,"relative","w-[310px]","h-[360px]","sm:w-[408px]","sm:h-[450px]","bg-amber-100"],["viewBox","0 0 100 100",1,"absolute","top-0","left-[122px]","w-[72px]","h-[80px]","sm:hidden"],["x1","0","y1","0","x2","100","y2","100","stroke","#d97706","stroke-width","1"],["x1","100","y1","0","x2","0","y2","100","stroke","#d97706","stroke-width","1"],["viewBox","0 0 100 100",1,"absolute","bottom-0","left-[122px]","w-[72px]","h-[80px]","sm:hidden"],["viewBox","0 0 100 100",1,"absolute","top-0","left-[154px]","w-[100px]","h-[100px]","hidden","sm:block"],["viewBox","0 0 100 100",1,"absolute","bottom-0","left-[154px]","w-[100px]","h-[100px]","hidden","sm:block"],[1,"absolute","left-0","right-0","bg-amber-100","flex","items-center","justify-between","px-8","z-5","sm:hidden",2,"top","161px","height","40px"],[1,"text-amber-700","font-bold","text-xs","tracking-wider"],[1,"absolute","left-0","right-0","bg-amber-100","flex","items-center","justify-between","px-16","z-5","hidden","sm:flex",2,"top","204px","height","50px"],[1,"text-amber-700","font-bold","text-sm","tracking-wider"],[1,"flex","flex-col","justify-center","ml-1","sm:ml-2"],[1,"flex","justify-center","mt-1","sm:mt-2"],[1,"absolute","inset-0","bg-black/50","backdrop-blur-sm","flex","items-center","justify-center","z-50","rounded-lg"],[1,"mt-6"],[1,"mt-4","text-xs","text-amber-600","text-center"],[1,"mb-1"],[1,"api-key-modal-overlay"],[1,"w-full","h-12","rounded-md","bg-gray-700","border","border-gray-500","text-gray-50","font-semibold","text-base","shadow","hover:bg-gray-600","focus:outline-none","focus:ring-2","focus:ring-gray-300","transition-all",3,"click","ngClass"],[1,"w-3/5","flex","items-center","gap-2","bg-neutral-800/50","rounded-lg","p-2","border","border-neutral-600","justify-center"],[1,"text-amber-300","text-sm","font-medium"],[1,"px-2","py-1","text-xs","rounded","transition-colors",3,"click","ngClass"],[1,"w-2/5","flex","items-center","gap-2","bg-neutral-800/50","rounded-lg","p-2","border","border-neutral-600","justify-center"],[1,"px-1","py-1","text-xs","rounded","transition-colors",3,"click","ngClass"],[1,"flex","gap-2","items-center"],[1,"px-3","py-1","text-xs","rounded","transition-colors","bg-purple-700","hover:bg-purple-600","text-white"],[1,"px-2","py-1","text-xs","rounded","transition-colors","bg-red-700","hover:bg-red-600","text-white",3,"click"],[1,"px-3","py-1","text-xs","rounded","transition-colors","bg-purple-700","hover:bg-purple-600","text-white",3,"click"],[1,"absolute","left-0","right-0","h-[1px]","bg-amber-800",3,"ngClass"],[1,"absolute","left-0","right-0","h-[1px]","bg-amber-800","hidden","sm:block"],[1,"absolute","w-[1px]","bg-amber-800","sm:hidden"],[1,"absolute","w-[1px]","bg-amber-800","hidden","sm:block"],[1,"absolute","w-[20px]","h-[20px]","-translate-x-1/2","-translate-y-1/2","rounded-full","hover:bg-amber-200/30","cursor-pointer","z-20","sm:hidden",3,"click","ngClass"],[1,"absolute","w-[6px]","h-[6px]","bg-amber-800","rounded-full","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[32px]","h-[32px]",3,"ngClass"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-2","h-2","bg-green-500","rounded-full","opacity-70"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[34px]","h-[34px]","border-2","border-red-500","rounded-full"],[1,"absolute","w-[24px]","h-[24px]","-translate-x-1/2","-translate-y-1/2","rounded-full","hover:bg-amber-200/30","cursor-pointer","z-20","hidden","sm:block",3,"click","ngClass"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[40px]","h-[40px]",3,"ngClass"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-3","h-3","bg-green-500","rounded-full","opacity-70"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","w-[42px]","h-[42px]","border-2","border-red-500","rounded-full"],[1,"w-8","h-8","rounded-full","border-2","flex","items-center","justify-center","text-sm","font-bold","shadow-lg"],[1,"w-10","h-10","rounded-full","border-2","flex","items-center","justify-center","text-lg","font-bold","shadow-lg"],[1,"bg-gradient-to-br","from-amber-600","to-amber-800","border-2","border-amber-400","rounded-lg","p-8","shadow-2xl","text-center"],[1,"text-3xl","mb-4"],[1,"text-2xl","font-bold","mb-4","text-amber-100"],[1,"bg-amber-400","hover:bg-amber-300","text-amber-900","font-bold","py-3","px-6","rounded-lg","transition-all","duration-200","transform","hover:scale-105","shadow-lg",3,"click"],[1,"text-lg","font-bold","text-amber-400","mb-3"],[1,"bg-neutral-900/70","border","border-neutral-700","rounded-md","p-4","max-h-32","overflow-y-auto"],[1,"grid","grid-cols-2","gap-2","text-sm"],[1,"text-neutral-400"],[1,"text-red-400"],[1,"text-neutral-300"],[1,"api-key-modal-overlay",3,"click"],[1,"api-key-modal-content",3,"click"],[1,"close-button",3,"click"],[3,"onApiKeySaved","onApiKeyClear"]],template:function(t,i){t&1&&(c(0,"div",0)(1,"header",1)(2,"div",2)(3,"h1",3),d(4," \u4E2D\u570B\u8C61\u68CB "),l(),c(5,"a",4),d(6,"HOME"),l()(),c(7,"div",5)(8,"button",6),x("click",function(){return i.toggleGameMode()}),d(9),l(),c(10,"div",7),C(11,Dn,2,0,"div",8),C(12,Mn,2,0,"div",9),l(),c(13,"button",10),x("click",function(){return i.resetGame()}),d(14," \u91CD\u65B0\u958B\u59CB "),l()(),C(15,Sn,2,4,"button",11),C(16,wn,1,0,"app-ai-config"),C(17,Fn,10,4,"div",12),c(18,"div",13)(19,"div",14)(20,"div",15)(21,"div",16),d(22,"\u7576\u524D\u5C0D\u6230"),l(),c(23,"div",17),d(24),l()(),c(25,"div",18)(26,"div",19),d(27,"\u7576\u524D\u56DE\u5408"),l(),c(28,"div",17),C(29,Tn,2,0,"span"),d(30),l()(),c(31,"div",20)(32,"div",21),d(33,"\u6700\u5F8C\u4E00\u6B65"),l(),c(34,"div",17),C(35,Nn,1,1)(36,Rn,1,0),l()(),c(37,"div",22),x("click",function(){return i.openApiKeyModal()}),c(38,"div",23),d(39,"\u{1F916} AI \u8A2D\u5B9A"),l(),c(40,"div",17),C(41,Gn,1,0)(42,Bn,1,1),l()(),c(43,"div",24),C(44,Ln,1,0),l()()()(),c(45,"main",25)(46,"div",26)(47,"div",27)(48,"div",28)(49,"div",29),B(50,$n,2,1,"div",30,W),l()(),c(52,"div",31)(53,"div",32),B(54,Kn,2,1,"div",33,W),l(),c(56,"div",34),B(57,Un,2,9,null,null,W),B(59,Hn,4,24,null,null,W),ct(),c(61,"svg",35),O(62,"line",36)(63,"line",37),l(),c(64,"svg",38),O(65,"line",36)(66,"line",37),l(),c(67,"svg",39),O(68,"line",36)(69,"line",37),l(),c(70,"svg",40),O(71,"line",36)(72,"line",37),l(),ut(),c(73,"div",41)(74,"span",42),d(75,"\u695A\u6CB3"),l(),c(76,"span",42),d(77,"\u6F22\u754C"),l()(),c(78,"div",43)(79,"span",44),d(80,"\u695A\u6CB3"),l(),c(81,"span",44),d(82,"\u6F22\u754C"),l()(),B(83,io,2,0,null,null,Ce),l(),c(85,"div",45),B(86,no,2,1,"div",33,W),l()(),c(88,"div",46)(89,"div",29),B(90,oo,2,1,"div",30,W),l()()(),C(92,so,8,1,"div",47),l()(),C(93,co,7,0,"section",48),c(94,"footer",49)(95,"p",50),d(96,"\u9EDE\u64CA\u9078\u64C7\u68CB\u5B50\uFF0C\u518D\u9EDE\u64CA\u76EE\u6A19\u4F4D\u7F6E\u79FB\u52D5"),l(),c(97,"p"),d(98,"\u7D05\u65B9\u5148\u884C\uFF0C\u5C07\u8ECD\u5C0D\u65B9\u5373\u7372\u52DD"),l()()(),C(99,uo,5,0,"div",51)),t&2&&(u(9),M(" ",i.isVsAI()?"\u{1F465} \u5207\u63DB\u96D9\u4EBA":"\u{1F916} \u5207\u63DBAI"," "),u(2),b(i.isInCheck()?11:-1),u(),b(i.isSelfInCheck()&&!i.isInCheck()?12:-1),u(3),b(i.isVsAI()?15:-1),u(),b(i.isVsAI()&&i.isAIConfigOpen()?16:-1),u(),b(i.isVsAI()?17:-1),u(7),Y(i.isVsAI()?"\u{1F916}":"\u{1F465}"),u(),w("ngClass",i.currentPlayer()===i.PlayerColor.RED?"bg-red-500/20 border-red-400 text-red-300":"bg-neutral-800/20 border-neutral-400 text-neutral-300"),u(4),b(i.isVsAI()&&i.currentPlayer()===i.PlayerColor.BLACK?29:-1),u(),M("",i.currentPlayerDisplay()," "),u(5),b(i.moveHistory().length>0?35:36),u(6),b(i.isGeminiEnabled()?41:42),u(3),b(i.aiIsThinking()?44:-1),u(6),L(i.getColumnLetters()),u(4),L(i.getRowNumbers()),u(3),L(je(16,En)),u(2),L(je(17,An)),u(24),L(i.board()),u(3),L(i.getRowNumbers()),u(4),L(i.getColumnLetters()),u(2),b(i.gameOver()?92:-1),u(),b(i.moveHistory().length>0?93:-1),u(6),b(i.isApiKeyModalOpen()?99:-1))},dependencies:[ee,bt,At,Ne,Se,Re],styles:[".api-key-modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#0009;display:flex;justify-content:center;align-items:center;z-index:1000;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.api-key-modal-content[_ngcontent-%COMP%]{position:relative;padding:20px;background:#1a1a1a;border-radius:8px;border:1px solid #444;width:90%;max-width:500px;box-shadow:0 5px 15px #00000080}.close-button[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;background:none;border:none;font-size:1.5rem;color:#888;cursor:pointer;line-height:1}.close-button[_ngcontent-%COMP%]:hover{color:#fff}"]})};export{ni as ChineseChess};
