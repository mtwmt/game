<div class="w-full max-w-sm mx-auto flex flex-col">
  <header class="mb-2 flex flex-col gap-3 items-stretch">
    <app-game-header title="è²ªé£Ÿè›‡" [gameRules]="gameRules"></app-game-header>

    <!-- Game Control Buttons -->
    <div class="flex gap-2">
      @if (!gameStarted() && !gameOver()) {
      <button
        class="h-12 w-1/2 rounded-md bg-lime-700 border border-lime-500 text-lime-50 font-semibold text-base shadow hover:bg-lime-600 focus:outline-none focus:ring-2 focus:ring-lime-300"
        (click)="startGame()"
      >
        é–‹å§‹éŠæˆ²
      </button>
      } @if (gameOver()) {
      <button
        class="h-12 w-1/2 rounded-md bg-cyan-700 border border-cyan-500 text-cyan-50 font-semibold text-base shadow hover:bg-cyan-600 focus:outline-none focus:ring-2 focus:ring-cyan-300"
        (click)="resetGame()"
      >
        é‡æ–°é–‹å§‹
      </button>
      } @if (gameStarted() && !gameOver()) {
      <button
        class="h-12 w-1/2 rounded-md bg-yellow-700 border border-yellow-500 text-yellow-50 font-semibold text-base shadow hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-yellow-300"
        (click)="togglePause()"
      >
        {{ isPaused() ? 'ç¹¼çºŒ' : 'æš«åœ' }}
      </button>
      }

      <button
        class="h-12 w-1/2 rounded-md bg-zinc-800 border border-zinc-600 text-lime-200 font-medium shadow hover:bg-zinc-700 focus:outline-none focus:ring-2 focus:ring-lime-300"
      >
        åˆ†æ•¸ (<span>{{ score() }}</span
        >)
      </button>
    </div>
  </header>

  <!-- Game Board -->
  <!-- class="inline-grid grid-cols-12 gap-[2px] p-2 bg-green-900/40 border border-green-800 touch-none select-none" -->
  <main
    class="inline-grid gap-[2px] p-2 bg-green-900/40 border border-green-800 touch-none select-none mx-auto"
    [ngStyle]="{ 'grid-template-columns': 'repeat(' + boardSize + ', minmax(0, 1fr))' }"
    (touchstart)="onTouchStart($event)"
    (touchmove)="onTouchMove($event)"
    (touchend)="onTouchEnd($event)"
  >
    @for (cell of getBoard(); track cell) {
    <div class="w-3 h-3" [ngClass]="getCellClass(getCol(cell), getRow(cell))"></div>
    }
  </main>

  <!-- Mobile Control Buttons -->
  <div
    class="md:hidden fixed inset-x-0 bottom-0 z-40 px-4 pb-4 pt-3 bg-black/70 backdrop-blur-sm flex justify-center gap-6 transition-opacity"
  >
    <!-- <div class=""> -->
    <div class="grid grid-cols-3 grid-rows-3 gap-1">
      <span></span>
      <button
        class="gb-pad h-16 w-16 flex items-center justify-center bg-lime-900 border border-lime-700 text-lime-400 active:scale-95"
        (click)="changeDirection('UP')"
      >
        â–²
      </button>
      <span></span>
      <button
        data-key="ArrowLeft"
        class="gb-pad h-16 w-16 flex items-center justify-center bg-lime-900 border border-lime-700 text-lime-400 active:scale-95"
        (click)="changeDirection('LEFT')"
      >
        â—€
      </button>
      <span class="h-16 w-16"></span>
      <button
        class="gb-pad h-16 w-16 flex items-center justify-center bg-lime-900 border border-lime-700 text-lime-400 active:scale-95"
        (click)="changeDirection('RIGHT')"
      >
        â–¶
      </button>
      <span></span>
      <button
        class="gb-pad h-16 w-16 flex items-center justify-center bg-lime-900 border border-lime-700 text-lime-400 active:scale-95"
        (click)="changeDirection('DOWN')"
      >
        â–¼
      </button>
      <span></span>
    </div>

    <!-- Game Control Buttons -->
    <div class="absolute bottom-0 right-0 m-4">
      @if (!gameStarted() && !gameOver()) {
      <button
        class="border border-lime-800 bg-lime-900 p-2 text-lime-400 font-bold hover:bg-lime-400/30 transition"
        (click)="startGame()"
      >
        é–‹å§‹éŠæˆ²
      </button>
      } @if (gameStarted() && !gameOver()) {
      <button
        class="border border-yellow-800 bg-yellow-900 p-2 text-yellow-400 font-bold hover:bg-yellow-300/30 transition"
        (click)="togglePause()"
      >
        {{ isPaused() ? 'ç¹¼çºŒ' : 'æš«åœ' }}
      </button>
      }
    </div>
  </div>

  <!-- Game Over Modal -->
  <app-modal
    [isOpen]="gameOver()"
    theme="lime"
    [showCloseButton]="false"
    [closeOnBackdrop]="false"
    (close)="resetGame()"
  >
    <div class="text-3xl mb-4">ğŸ’€</div>
    <h2 class="text-2xl font-bold mb-2 text-lime-100">éŠæˆ²çµæŸ</h2>
    <div class="rounded-lg p-3 mb-6 bg-lime-700/50">
      <div class="text-lime-200">æœ€çµ‚åˆ†æ•¸</div>
      <div class="font-bold text-2xl text-lime-100">{{ score() }}</div>
    </div>
    <button
      class="bg-lime-400 hover:bg-lime-300 text-lime-900 font-bold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg"
      (click)="resetGame()"
    >
      é‡æ–°é–‹å§‹
    </button>
  </app-modal>
</div>
