import{b as se}from"./chunk-5ZD5S26U.js";import{a as re,b as ae}from"./chunk-UFRIRQNP.js";import{A,B as P,C as m,D as u,E as I,I as O,J as M,L as x,O as te,Q as b,R as d,S,T as D,U,V as j,X as ie,_ as f,a as v,b as w,ba as ne,ca as le,d as Z,da as oe,ea as k,g as G,h as N,i as z,m as W,o as B,p as $,s as c,t as ee,v as C,w as E,x as Y,z as L}from"./chunk-OZ6TVAUY.js";var _={width:14,height:10,petTypes:12,maxLevelTime:300};var y={MATCH_SCORE:10,MAX_SHUFFLES_PER_GAME:5,MAX_HINTS_PER_GAME:5,HINT_DISPLAY_TIME:3e3,PATH_ANIMATION_TIME:200,SELECTION_CLEAR_TIME:300,MAX_LEVELS:5,MAX_TURNS:2,TIMER_INTERVAL:1e3},me=["\u{1F436}","\u{1F431}","\u{1F42D}","\u{1F439}","\u{1F430}","\u{1F98A}","\u{1F43B}","\u{1F43C}","\u{1F437}","\u{1F438}","\u{1F435}","\u{1F98B}","\u{1F414}","\u{1F986}","\u{1F985}","\u{1F989}","\u{1F43A}","\u{1F417}"],X=["from-blue-400 to-blue-600 border-blue-300","from-pink-400 to-pink-600 border-pink-300","from-gray-400 to-gray-600 border-gray-300","from-yellow-400 to-yellow-600 border-yellow-300","from-purple-400 to-purple-600 border-purple-300","from-orange-400 to-orange-600 border-orange-300","from-amber-600 to-amber-800 border-amber-400","from-slate-400 to-slate-600 border-slate-300","from-rose-400 to-rose-600 border-rose-300","from-green-400 to-green-600 border-green-300","from-teal-400 to-teal-600 border-teal-300","from-violet-400 to-violet-600 border-violet-300","from-red-400 to-red-600 border-red-300","from-cyan-400 to-cyan-600 border-cyan-300","from-indigo-400 to-indigo-600 border-indigo-300","from-fuchsia-400 to-fuchsia-600 border-fuchsia-300","from-zinc-400 to-zinc-600 border-zinc-300","from-stone-400 to-stone-600 border-stone-300"];function fe(a,e){let i={cellSize:48,paddingHorizontal:40,paddingVertical:280,gapTotal:2,borderTotal:4,minBoardSize:6,maxBoardWidth:10,maxBoardHeight:15,elementDensity:void 0},t=se(a,e,i),l=t.width*t.height;l%2!==0&&(t.height>i.minBoardSize?(t.height--,l=t.width*t.height):t.width>i.minBoardSize&&(t.width--,l=t.width*t.height));let o=Math.min(12,Math.max(6,Math.floor(l/2)));return{width:t.width,height:t.height,petTypes:o}}function F(a,e,i){if(a&&e&&i){let t=fe(e,i);return w(v({},t),{maxLevelTime:_.maxLevelTime})}return v({},_)}function ce(a){return a===1?"classic":a===2?"down":a===3?"up":a===4?"left":"right"}var R=class{initializeBoard(e,i,t){let l=[],o=0,n=e*i,r=[];for(let h=0;h<n/2;h++){let p=h%t;r.push(p,p)}for(let h=r.length-1;h>0;h--){let p=Math.floor(Math.random()*(h+1));[r[h],r[p]]=[r[p],r[h]]}let s=0;for(let h=0;h<i;h++){l[h]=[];for(let p=0;p<e;p++)s<r.length?l[h][p]={id:o++,petType:r[s++],position:{x:p,y:h},selected:!1}:l[h][p]=null}return l}removeTiles(e,i,t){e[i.position.y][i.position.x]=null,e[t.position.y][t.position.x]=null}collapseBoardDown(e,i,t){for(let l=0;l<i;l++){let o=[];for(let n=t-1;n>=0;n--)e[n][l]&&o.unshift(e[n][l]);for(let n=0;n<t;n++)if(n<t-o.length)e[n][l]=null;else{let r=o[n-(t-o.length)];r&&(r.position={x:l,y:n},e[n][l]=r)}}}collapseBoardUp(e,i,t){for(let l=0;l<i;l++){let o=[];for(let n=0;n<t;n++)e[n][l]&&o.push(e[n][l]);for(let n=0;n<t;n++)if(n<o.length){let r=o[n];r&&(r.position={x:l,y:n},e[n][l]=r)}else e[n][l]=null}}collapseBoardLeft(e,i,t){for(let l=0;l<t;l++){let o=[];for(let n=0;n<i;n++)e[l][n]&&o.push(e[l][n]);for(let n=0;n<i;n++)if(n<o.length){let r=o[n];r&&(r.position={x:n,y:l},e[l][n]=r)}else e[l][n]=null}}collapseBoardRight(e,i,t){for(let l=0;l<t;l++){let o=[];for(let n=i-1;n>=0;n--)e[l][n]&&o.unshift(e[l][n]);for(let n=0;n<i;n++)if(n<i-o.length)e[l][n]=null;else{let r=o[n-(i-o.length)];r&&(r.position={x:n,y:l},e[l][n]=r)}}}getRemainingTileCount(e){return e.flat().filter(i=>i!==null).length}isGameComplete(e){return this.getRemainingTileCount(e)===0}hasValidMoves(e,i,t,l){for(let o=0;o<t;o++)for(let n=0;n<i;n++){let r=e[o][n];if(r)for(let s=0;s<t;s++)for(let h=0;h<i;h++){let p=e[s][h];if(!(!p||r.id===p.id||r.petType!==p.petType)&&l.findPath(r.position,p.position,e,i,t))return!0}}return!1}findValidPair(e,i,t,l){for(let o=0;o<t;o++)for(let n=0;n<i;n++){let r=e[o][n];if(r)for(let s=0;s<t;s++)for(let h=0;h<i;h++){let p=e[s][h];if(!p||r.id===p.id||r.petType!==p.petType)continue;if(l.findPath(r.position,p.position,e,i,t))return{tile1:r,tile2:p}}}return null}getElapsedTime(e){return Math.floor((Date.now()-e)/1e3)}formatTime(e){let i=Math.floor(e/60),t=e%60;return`${i.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`}};var V=class{findPath(e,i,t,l,o){let n=this.tryDirectPath(e,i,t,l,o);if(n)return n;let r=this.tryLShapePath(e,i,t,l,o);if(r)return r;let s=this.tryUShapePath(e,i,t,l,o);if(s)return s;let h=this.tryBoundaryPath(e,i,t,l,o);return h||null}tryDirectPath(e,i,t,l,o){return e.y===i.y&&this.isPathClear(e,i,"horizontal",t,l,o)?[{start:e,end:i,direction:"horizontal"}]:e.x===i.x&&this.isPathClear(e,i,"vertical",t,l,o)?[{start:e,end:i,direction:"vertical"}]:null}tryLShapePath(e,i,t,l,o){let n={x:e.x,y:i.y},r=!(n.x===e.x&&n.y===e.y)&&!(n.x===i.x&&n.y===i.y),s=this.isValidPosition(n,t,l,o),h=r&&s&&this.isPathClear(e,n,"vertical",t,l,o),p=h&&this.isPathClear(n,i,"horizontal",t,l,o);if(r&&s&&h&&p)return[{start:e,end:n,direction:"vertical"},{start:n,end:i,direction:"horizontal"}];let T={x:i.x,y:e.y},q=!(T.x===e.x&&T.y===e.y)&&!(T.x===i.x&&T.y===i.y),K=this.isValidPosition(T,t,l,o),Q=q&&K&&this.isPathClear(e,T,"horizontal",t,l,o),pe=Q&&this.isPathClear(T,i,"vertical",t,l,o);return q&&K&&Q&&pe?[{start:e,end:T,direction:"horizontal"},{start:T,end:i,direction:"vertical"}]:null}tryUShapePath(e,i,t,l,o){for(let n=0;n<l;n++)if(n!==e.x&&n!==i.x){let r={x:n,y:e.y},s={x:n,y:i.y};if(this.isValidPosition(r,t,l,o)&&this.isValidPosition(s,t,l,o)&&this.isPathClear(e,r,"horizontal",t,l,o)&&this.isPathClear(r,s,"vertical",t,l,o)&&this.isPathClear(s,i,"horizontal",t,l,o))return[{start:e,end:r,direction:"horizontal"},{start:r,end:s,direction:"vertical"},{start:s,end:i,direction:"horizontal"}]}for(let n=0;n<o;n++)if(n!==e.y&&n!==i.y){let r={x:e.x,y:n},s={x:i.x,y:n};if(this.isValidPosition(r,t,l,o)&&this.isValidPosition(s,t,l,o)&&this.isPathClear(e,r,"vertical",t,l,o)&&this.isPathClear(r,s,"horizontal",t,l,o)&&this.isPathClear(s,i,"vertical",t,l,o))return[{start:e,end:r,direction:"vertical"},{start:r,end:s,direction:"horizontal"},{start:s,end:i,direction:"vertical"}]}return null}tryBoundaryPath(e,i,t,l,o){let n=[{y:-1,name:"top"},{y:o,name:"bottom"},{x:-1,name:"left"},{x:l,name:"right"}];for(let r of n){let s=this.tryBoundaryRoute(e,i,r,t,l,o);if(s)return s}return null}tryBoundaryRoute(e,i,t,l,o,n){if("y"in t){let r={x:e.x,y:t.y},s={x:i.x,y:t.y};if(this.isPathClear(e,r,"vertical",l,o,n)&&this.isPathClear(r,s,"horizontal",l,o,n)&&this.isPathClear(s,i,"vertical",l,o,n))return[{start:e,end:r,direction:"vertical"},{start:r,end:s,direction:"horizontal"},{start:s,end:i,direction:"vertical"}]}else{let r={x:t.x,y:e.y},s={x:t.x,y:i.y};if(this.isPathClear(e,r,"horizontal",l,o,n)&&this.isPathClear(r,s,"vertical",l,o,n)&&this.isPathClear(s,i,"horizontal",l,o,n))return[{start:e,end:r,direction:"horizontal"},{start:r,end:s,direction:"vertical"},{start:s,end:i,direction:"horizontal"}]}return null}isPathClear(e,i,t,l,o,n){if(e.x===i.x&&e.y===i.y)return!0;if(t==="horizontal"){if(e.y!==i.y)return!1;let r=Math.min(e.x,i.x),s=Math.max(e.x,i.x);return this.checkLineEmpty(r+1,s,e.y,"horizontal",l,o,n)}else{if(e.x!==i.x)return!1;let r=Math.min(e.y,i.y),s=Math.max(e.y,i.y);return this.checkLineEmpty(r+1,s,e.x,"vertical",l,o,n)}}checkLineEmpty(e,i,t,l,o,n,r){for(let s=e;s<i;s++){let h=l==="horizontal"?s:t,p=l==="horizontal"?t:s;if(h>=0&&h<n&&p>=0&&p<r&&o[p][h])return!1}return!0}isValidPosition(e,i,t,l){return e.x<0||e.x>=t||e.y<0||e.y>=l?!0:!i[e.y][e.x]}};var g=class{static isValidPosition(e,i,t){return e.x>=0&&e.x<i&&e.y>=0&&e.y<t}static isValidGameConfig(e,i,t){let l=e*i;return!(e<=0||i<=0||t<=0||t>18||l%2!==0||l/2<t)}static canMakeMove(e){return e.gameStatus==="playing"&&e.levelStatus==="playing"}static canClickTile(e,i){return!(!e||!this.canMakeMove(i))}static canMatch(e,i){return!(e.id===i.id||e.petType!==i.petType)}static isLevelComplete(e){return e.remainingTiles===0}static isGameOver(e){return e.gameStatus==="timeup"||e.gameStatus==="nomoves"}static isGameComplete(e){return e.gameStatus==="complete"}static hasTimeRemaining(e){return e.countdownTime>0}static isValidLevel(e){return e>=1&&e<=y.MAX_LEVELS}static canUseShuffle(e){return e.totalShufflesUsed<e.maxShufflesPerGame&&e.gameStatus==="playing"&&e.remainingTiles>0&&this.hasTimeRemaining(e)}static canUseHint(e){return e.totalHintsUsed<e.maxHintsPerGame&&e.gameStatus==="playing"&&!e.showHint&&e.remainingTiles>0&&this.hasTimeRemaining(e)}static hasTilesRemaining(e){for(let i of e)for(let t of i)if(t!==null)return!0;return!1}static countRemainingTiles(e){let i=0;for(let t of e)for(let l of t)l!==null&&i++;return i}static isTileSelected(e,i){return i.some(t=>t.id===e.id)}static isHintTile(e,i){return i.showHint?i.hintTiles.some(t=>t.id===e.id):!1}static isValidLevelType(e){return["classic","down","up","left","right"].includes(e)}};var J={board:[],width:_.width,height:_.height,petTypes:_.petTypes,score:0,level:1,moves:0,remainingTiles:0,gameStatus:"waiting",levelStatus:"playing",gameTime:0,countdownTime:_.maxLevelTime,totalShufflesUsed:0,totalHintsUsed:0,maxShufflesPerGame:y.MAX_SHUFFLES_PER_GAME,maxHintsPerGame:y.MAX_HINTS_PER_GAME,hintTiles:[],showHint:!1},H=class a{platformId=G(B);isBrowser=k(this.platformId);gameState=W(v({},J));logic=new R;pathfinding=new V;gameTimer=null;countdownTimer=null;levelStartTime=0;isMobile=!1;screenWidth=0;screenHeight=0;setDeviceType(e,i,t){this.isMobile=e,this.screenWidth=i||0,this.screenHeight=t||0}initializeGame(){this.stopAllTimers();let e=F(this.isMobile,this.screenWidth,this.screenHeight),i=this.logic.initializeBoard(e.width,e.height,e.petTypes),t=w(v({},J),{width:e.width,height:e.height,petTypes:e.petTypes,board:i,remainingTiles:this.logic.getRemainingTileCount(i),gameStatus:"playing",countdownTime:e.maxLevelTime});this.gameState.set(t),this.startLevelTimer()}resetGame(){this.stopAllTimers();let e=F(this.isMobile,this.screenWidth,this.screenHeight),i=this.logic.initializeBoard(e.width,e.height,e.petTypes),t=w(v({},J),{width:e.width,height:e.height,petTypes:e.petTypes,board:i,remainingTiles:this.logic.getRemainingTileCount(i),gameStatus:"playing",countdownTime:e.maxLevelTime});this.gameState.set(t),this.startLevelTimer()}nextLevel(){let e=this.gameState();if(e.level>=y.MAX_LEVELS)return;this.stopAllTimers();let i=F(this.isMobile,this.screenWidth,this.screenHeight),t=this.logic.initializeBoard(i.width,i.height,i.petTypes),l=w(v({},e),{width:i.width,height:i.height,petTypes:i.petTypes,board:t,level:e.level+1,moves:0,remainingTiles:this.logic.getRemainingTileCount(t),gameStatus:"playing",levelStatus:"playing",gameTime:0,countdownTime:i.maxLevelTime,hintTiles:[],showHint:!1});this.gameState.set(l),this.startLevelTimer()}attemptMatch(e,i){let t=this.gameState();if(!g.canMakeMove(t))return{success:!1,path:null,tile1:e,tile2:i};if(!g.canMatch(e,i))return{success:!1,path:null,tile1:e,tile2:i};let l=this.pathfinding.findPath(e.position,i.position,t.board,t.width,t.height);return l?(this.logic.removeTiles(t.board,e,i),this.applyLevelGravity(t),t.score+=y.MATCH_SCORE,t.moves++,t.remainingTiles=this.logic.getRemainingTileCount(t.board),g.isLevelComplete(t)?(t.levelStatus="completed",t.level>=y.MAX_LEVELS&&(t.gameStatus="complete"),this.stopAllTimers()):this.logic.hasValidMoves(t.board,t.width,t.height,this.pathfinding)||(g.canUseShuffle(t)?this.shuffleTiles():(t.gameStatus="nomoves",t.levelStatus="failed",this.stopAllTimers())),this.gameState.set(v({},t)),{success:!0,path:l,tile1:e,tile2:i}):{success:!1,path:null,tile1:e,tile2:i}}shuffleTiles(){let e=this.gameState();if(!g.canUseShuffle(e))return;let i=[];for(let o=0;o<e.height;o++)for(let n=0;n<e.width;n++)e.board[o][n]&&i.push(e.board[o][n].petType);for(let o=i.length-1;o>0;o--){let n=Math.floor(Math.random()*(o+1));[i[o],i[n]]=[i[n],i[o]]}let t=0,l=Date.now();for(let o=0;o<e.height;o++)for(let n=0;n<e.width;n++)e.board[o][n]&&(e.board[o][n]={id:l++,petType:i[t++],position:{x:n,y:o},selected:!1});e.totalShufflesUsed++,this.gameState.set(v({},e)),this.logic.hasValidMoves(e.board,e.width,e.height,this.pathfinding)||(g.canUseShuffle(e)?this.shuffleTiles():(e.gameStatus="nomoves",e.levelStatus="failed",this.stopAllTimers(),this.gameState.set(v({},e))))}useHint(){let e=this.gameState();if(!g.canUseHint(e))return;let i=this.logic.findValidPair(e.board,e.width,e.height,this.pathfinding);i&&(e.hintTiles=[i.tile1,i.tile2],e.showHint=!0,e.totalHintsUsed++,this.gameState.set(v({},e)))}hideHint(){let e=this.gameState();e.hintTiles=[],e.showHint=!1,this.gameState.set(v({},e))}applyLevelGravity(e){switch(ce(e.level)){case"classic":break;case"down":this.logic.collapseBoardDown(e.board,e.width,e.height);break;case"up":this.logic.collapseBoardUp(e.board,e.width,e.height);break;case"left":this.logic.collapseBoardLeft(e.board,e.width,e.height);break;case"right":this.logic.collapseBoardRight(e.board,e.width,e.height);break}}startLevelTimer(){this.isBrowser&&(this.levelStartTime=Date.now(),this.gameTimer=window.setInterval(()=>{let e=this.gameState();e.gameTime=this.logic.getElapsedTime(this.levelStartTime),this.gameState.set(v({},e))},y.TIMER_INTERVAL),this.countdownTimer=window.setInterval(()=>{let e=this.gameState(),i=this.logic.getElapsedTime(this.levelStartTime),t=Math.max(0,_.maxLevelTime-i);e.countdownTime=t,t<=0&&(e.gameStatus="timeup",e.levelStatus="failed",this.stopAllTimers()),this.gameState.set(v({},e))},y.TIMER_INTERVAL))}stopAllTimers(){this.gameTimer&&(clearInterval(this.gameTimer),this.gameTimer=null),this.countdownTimer&&(clearInterval(this.countdownTimer),this.countdownTimer=null)}getRemainingShuffles(){let e=this.gameState();return e.maxShufflesPerGame-e.totalShufflesUsed}getRemainingHints(){let e=this.gameState();return e.maxHintsPerGame-e.totalHintsUsed}formatTime(e){return this.logic.formatTime(e)}cleanup(){this.stopAllTimers()}static \u0275fac=function(i){return new(i||a)};static \u0275prov=Z({token:a,factory:a.\u0275fac,providedIn:"root"})};var ve=a=>({"grid-template-columns":a}),Te=(a,e)=>e.id,xe=(a,e)=>(e==null?null:e.id)||a;function Se(a,e){if(a&1){let i=O();m(0,"button",36),M("click",function(){N(i);let l=x();return z(l.resetGame())}),d(1," \u91CD\u65B0\u958B\u59CB "),u()}}function ye(a,e){if(a&1){let i=O();m(0,"button",37),M("click",function(){N(i);let l=x();return z(l.resetGame())}),d(1," \u65B0\u904A\u6232 "),u()}}function be(a,e){if(a&1&&(m(0,"span",38),d(1),u()),a&2){let i=e.$implicit,t=x(2);c(),S(t.petEmojis[i.petType])}}function Pe(a,e){if(a&1&&L(0,be,2,1,"span",38,Te),a&2){let i=x();A(i.selectedTiles)}}function Me(a,e){a&1&&(m(0,"span",21),d(1,"\u9EDE\u64CA\u5BF5\u7269"),u())}function _e(a,e){if(a&1&&(m(0,"span",41),d(1),u()),a&2){let i=x().$implicit,t=x(2);c(),S(t.petEmojis[i.petType])}}function we(a,e){if(a&1){let i=O();m(0,"div",40),M("click",function(){let l=N(i).$implicit,o=x(2);return z(o.onTileClick(l))}),C(1,_e,2,1,"span",41),u()}if(a&2){let i=e.$implicit,t=x(2);P("ngClass",t.getTileClass(i)),c(),E(i?1:-1)}}function Ce(a,e){if(a&1&&L(0,we,2,2,"div",39,xe),a&2){let i=e.$implicit;A(i)}}function Ee(a,e){if(a&1&&I(0,"div",42),a&2){let i=e.$implicit,t=x(2);P("ngStyle",t.getPathStyle(i))}}function Ie(a,e){if(a&1&&(m(0,"div",28),L(1,Ee,1,1,"div",42,Y),u()),a&2){let i=x();c(),A(i.getDisplayPath())}}function De(a,e){if(a&1&&(m(0,"div",35)(1,"div",43),d(2,"\u{1F3AE} \u904A\u6232\u7D71\u8A08 \u{1F3AE}"),u(),m(3,"div",44)(4,"div",45)(5,"div",46),d(6,"\u7E3D\u79FB\u52D5"),u(),m(7,"div",47),d(8),u()(),m(9,"div",45)(10,"div",46),d(11,"\u7E3D\u6642\u9593"),u(),m(12,"div",47),d(13),u()(),m(14,"div",45)(15,"div",46),d(16,"\u9053\u5177\u4F7F\u7528"),u(),m(17,"div",47),d(18),u()(),m(19,"div",45)(20,"div",46),d(21,"\u6700\u7D42\u5206\u6578"),u(),m(22,"div",47),d(23),u()()()()),a&2){let i=x();c(8),S(i.moves()),c(5),S(i.formattedTime()),c(5),D(" ",i.totalShufflesUsed()+i.totalHintsUsed()," "),c(5),S(i.score())}}function Ge(a,e){if(a&1&&(m(0,"div",48)(1,"div",49)(2,"div",50),d(3,"\u79FB\u52D5\u6B21\u6578"),u(),m(4,"div",51),d(5),u()(),m(6,"div",49)(7,"div",50),d(8,"\u5B8C\u6210\u6642\u9593"),u(),m(9,"div",51),d(10),u()()(),m(11,"div",52)(12,"div",50),d(13,"\u7E3D\u5206\u6578"),u(),m(14,"div",53),d(15),u()()),a&2){let i=x();c(5),S(i.moves()),c(5),S(i.formattedTime()),c(5),S(i.score())}}var he=class a{petMatchService=G(H);platformId=G(B);isBrowser=k(this.platformId);gameState=this.petMatchService.gameState;gameRules={title:"\u5BF5\u7269\u9023\u9023\u770B\u904A\u6232\u898F\u5247",rules:["\u9EDE\u64CA\u5169\u500B\u76F8\u540C\u7684\u5BF5\u7269\u5716\u6848\u9032\u884C\u914D\u5C0D\u6D88\u9664","\u5169\u500B\u5716\u6848\u4E4B\u9593\u7684\u9023\u7DDA\u6700\u591A\u53EA\u80FD\u67092\u500B\u8F49\u5F4E","\u9023\u7DDA\u8DEF\u5F91\u4E0D\u80FD\u88AB\u5176\u4ED6\u5716\u6848\u963B\u64CB","\u6210\u529F\u914D\u5C0D\u5F8C\u5716\u6848\u6703\u6D88\u9664\u4E26\u7372\u5F97\u5206\u6578","\u6BCF\u95DC\u9650\u66425\u5206\u9418\uFF0C\u8D85\u6642\u5373\u904A\u6232\u7D50\u675F","\u6D88\u9664\u6240\u6709\u5716\u6848\u5373\u53EF\u904E\u95DC\u9032\u5165\u4E0B\u4E00\u95DC","\u4E0D\u540C\u95DC\u5361\u6709\u4E0D\u540C\u7684\u91CD\u529B\u88DC\u4F4D\u6548\u679C"]};selectedTiles=[];matchPath=f(()=>[]);showPath=f(()=>!1);petEmojis=me;formattedTime=f(()=>this.petMatchService.formatTime(this.gameState().gameTime));formattedCountdown=f(()=>{let e=this.gameState().countdownTime,i=Math.floor(e/60),t=e%60;return`${i.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`});timelinePercentage=f(()=>this.gameState().countdownTime/300*100);timelineColorClass=f(()=>this.gameState().countdownTime<=30?"from-red-500 to-red-300":this.gameState().countdownTime<=60?"from-yellow-500 to-yellow-300":"from-lime-500 to-lime-300");timelineTextClass=f(()=>this.gameState().countdownTime<=150?"text-white":"text-neutral-900/90");remainingShuffles=f(()=>this.petMatchService.getRemainingShuffles());remainingHints=f(()=>this.petMatchService.getRemainingHints());board=f(()=>this.gameState().board);score=f(()=>this.gameState().score);level=f(()=>this.gameState().level);moves=f(()=>this.gameState().moves);remainingTiles=f(()=>this.gameState().remainingTiles);totalShufflesUsed=f(()=>this.gameState().totalShufflesUsed);totalHintsUsed=f(()=>this.gameState().totalHintsUsed);maxShufflesPerGame=f(()=>this.gameState().maxShufflesPerGame);maxHintsPerGame=f(()=>this.gameState().maxHintsPerGame);gameOver=f(()=>this.gameState().gameStatus==="timeup"||this.gameState().gameStatus==="nomoves");levelComplete=f(()=>this.gameState().levelStatus==="completed");gameComplete=f(()=>this.gameState().gameStatus==="complete");timeUp=f(()=>this.gameState().gameStatus==="timeup");selectedTilesSignal=f(()=>this.selectedTiles);animationTimeout;currentPath=[];showingPath=!1;ngOnInit(){if(this.isBrowser){let e=window.innerWidth<=768;this.petMatchService.setDeviceType(e,window.innerWidth,window.innerHeight)}this.petMatchService.initializeGame()}ngOnDestroy(){this.clearAnimationTimeout(),this.petMatchService.cleanup()}clearAnimationTimeout(){this.animationTimeout&&clearTimeout(this.animationTimeout)}onTileClick(e){if(!(!g.canClickTile(e,this.gameState())||this.showingPath)&&e){if(g.isHintTile(e,this.gameState())&&this.petMatchService.hideHint(),e.selected){e.selected=!1;let i=this.selectedTiles.findIndex(t=>t.id===e.id);i!==-1&&this.selectedTiles.splice(i,1);return}this.selectedTiles.length>=2&&this.clearSelection(),e.selected=!0,this.selectedTiles.push(e),this.selectedTiles.length===2&&this.checkMatch(this.selectedTiles[0],this.selectedTiles[1])}}checkMatch(e,i){let t=this.petMatchService.attemptMatch(e,i);if(t.success&&t.path){this.currentPath=t.path,this.showingPath=!0;let l=()=>{this.showingPath=!1,this.currentPath=[],this.clearSelection()};this.isBrowser?this.animationTimeout=setTimeout(l,y.PATH_ANIMATION_TIME):l()}else this.isBrowser?setTimeout(()=>this.clearSelection(),y.SELECTION_CLEAR_TIME):this.clearSelection()}clearSelection(){this.selectedTiles.forEach(e=>e.selected=!1),this.selectedTiles.length=0}nextLevel(){this.clearSelection(),this.petMatchService.nextLevel()}resetGame(){this.clearSelection(),this.clearAnimationTimeout(),this.petMatchService.resetGame()}getTileClass(e){if(!e)return"bg-stone-800 border border-stone-700";let i="bg-gradient-to-br border-2 cursor-pointer flex items-center justify-center text-2xl";return e.selected?`${i} from-yellow-400 to-yellow-600 border-yellow-300 brightness-125`:this.isHintTile(e)?`${i} from-green-400 to-green-600 border-green-300 animate-pulse ring-2 ring-green-400 ring-opacity-75`:`${i} ${X[e.petType]||X[0]}`}getPathStyle(e){let o=8+e.start.x*49,n=8+e.start.y*49,r=8+e.end.x*49,s=8+e.end.y*49;if(e.direction==="horizontal"){let h=Math.min(o,r)+24,p=Math.abs(r-o),T=n+48/2-1;return{position:"absolute",left:`${h}px`,top:`${T}px`,width:`${p}px`,height:"2px",background:"linear-gradient(90deg, #fbbf24, #f59e0b)",boxShadow:"0 0 8px #fbbf24, 0 0 8px #f59e0b",zIndex:10}}else{let h=Math.min(n,s)+24,p=Math.abs(s-n);return{position:"absolute",left:`${o+48/2-1}px`,top:`${h}px`,width:"2px",height:`${p}px`,background:"linear-gradient(180deg, #fbbf24, #f59e0b)",boxShadow:"0 0 8px #fbbf24, 0 0 16px #f59e0b",zIndex:10}}}shuffleTiles(){this.clearSelection(),this.petMatchService.shuffleTiles()}canUseShuffle(){return g.canUseShuffle(this.gameState())}useHint(){this.clearSelection(),this.petMatchService.useHint()}hideHint(){this.petMatchService.hideHint()}canUseHint(){return g.canUseHint(this.gameState())}isHintTile(e){return e?g.isHintTile(e,this.gameState()):!1}getDisplayPath(){return this.showingPath?this.currentPath:[]}static \u0275fac=function(i){return new(i||a)};static \u0275cmp=ee({type:a,selectors:[["app-pet-match"]],decls:73,vars:62,consts:[[1,"w-full","max-w-sm","mx-auto","flex","flex-col"],[1,"mb-2","flex","flex-col","gap-3","items-stretch"],["title","\u5BF5\u7269\u9023\u9023\u770B",3,"gameRules"],[1,"flex","gap-2"],[1,"h-12","w-1/3","rounded-md","bg-cyan-700","border","border-cyan-500","text-cyan-50","font-semibold","text-base","shadow","hover:bg-cyan-600","focus:outline-none","focus:ring-2","focus:ring-cyan-300"],[1,"h-12","w-1/3","rounded-md","bg-lime-700","border","border-lime-500","text-lime-50","font-semibold","text-base","shadow","hover:bg-lime-600","focus:outline-none","focus:ring-2","focus:ring-lime-300"],[1,"h-12","w-1/3","rounded-md","border","font-medium","shadow","focus:outline-none","focus:ring-2",3,"click","disabled","title"],[1,"flex","flex-col","gap-2"],[1,"flex","items-center","gap-1","justify-center","flex-wrap","bg-neutral-900/70","rounded-md","p-2","border","border-neutral-700"],[1,"border","border-cyan-400","bg-cyan-400/20","px-2","py-1","text-cyan-300","font-bold","hover:bg-cyan-400/30","transition"],[1,"text-cyan-400","text-xs"],[1,"text-center","text-xs"],[1,"border","border-lime-400","bg-lime-400/20","px-2","py-1","text-lime-300","font-bold","hover:bg-lime-400/30","transition"],[1,"text-lime-400","text-xs"],[1,"border","border-yellow-400","bg-yellow-400/20","px-2","py-1","text-yellow-300","font-bold","hover:bg-yellow-400/30","transition"],[1,"text-yellow-400","text-xs"],[1,"border","border-orange-400","bg-orange-400/20","px-2","py-1","text-orange-300","font-bold","hover:bg-orange-400/30","transition"],[1,"text-orange-400","text-xs"],[1,"text-center","border","border-purple-400","bg-purple-400/20","px-1","py-1","text-purple-300","font-bold","hover:bg-purple-400/30","transition","w-16"],[1,"text-purple-400","text-xs"],[1,"text-center","text-xs","flex","gap-1","justify-center","h-4","items-center","overflow-hidden"],[1,"text-neutral-500","text-xs","leading-none"],[1,"w-full","mt-2","h-2","bg-neutral-700/80","rounded","overflow-hidden","relative"],[1,"h-full","bg-gradient-to-r","transition-all","duration-300"],[1,"absolute","inset-0","text-[9px]","tracking-wide","font-semibold","flex","items-center","justify-center","select-none","transition-colors","duration-300"],[1,"flex","justify-center"],[1,"relative","inline-block"],[1,"inline-grid","gap-[1px]","p-2","bg-lime-900/40","border","border-lime-800","rounded","touch-none","select-none",3,"ngStyle"],[1,"absolute","inset-0","pointer-events-none"],[3,"close","isOpen","theme","showCloseButton","closeOnBackdrop"],[1,"text-3xl","mb-4",3,"innerHTML"],[1,"text-2xl","font-bold","mb-4"],[1,"rounded-lg","p-3","mb-6"],[1,"font-bold","text-2xl"],[1,"font-bold","py-3","px-6","rounded-lg","transition-all","duration-200","transform","hover:scale-105","shadow-lg",3,"click"],[1,"mb-6"],[1,"h-12","w-1/3","rounded-md","bg-cyan-700","border","border-cyan-500","text-cyan-50","font-semibold","text-base","shadow","hover:bg-cyan-600","focus:outline-none","focus:ring-2","focus:ring-cyan-300",3,"click"],[1,"h-12","w-1/3","rounded-md","bg-lime-700","border","border-lime-500","text-lime-50","font-semibold","text-base","shadow","hover:bg-lime-600","focus:outline-none","focus:ring-2","focus:ring-lime-300",3,"click"],[1,"text-xs","leading-none"],[1,"w-12","h-12","rounded-lg","relative",3,"ngClass"],[1,"w-12","h-12","rounded-lg","relative",3,"click","ngClass"],[1,"select-none","pointer-events-none"],[1,"absolute","animate-pulse","transition-all","duration-300",3,"ngStyle"],[1,"text-yellow-200","text-lg","mb-4"],[1,"grid","grid-cols-2","gap-4","text-sm"],[1,"bg-yellow-600/50","rounded-lg","p-3"],[1,"text-yellow-200"],[1,"text-yellow-100","font-bold","text-xl"],[1,"grid","grid-cols-2","gap-4","mb-6","text-sm"],[1,"bg-green-700/50","rounded-lg","p-3"],[1,"text-green-200"],[1,"text-green-100","font-bold","text-xl"],[1,"bg-green-700/50","rounded-lg","p-3","mb-6"],[1,"text-green-100","font-bold","text-2xl"]],template:function(i,t){i&1&&(m(0,"div",0)(1,"header",1),I(2,"app-game-header",2),m(3,"div",3),C(4,Se,2,0,"button",4)(5,ye,2,0,"button",5),m(6,"button",6),M("click",function(){return t.shuffleTiles()}),d(7," \u91CD\u6392 ("),m(8,"span"),d(9),u(),d(10,") "),u(),m(11,"button",6),M("click",function(){return t.useHint()}),d(12," \u63D0\u793A ("),m(13,"span"),d(14),u(),d(15,") "),u()(),m(16,"div",7)(17,"div",8)(18,"div",9)(19,"div",10),d(20,"\u95DC\u5361"),u(),m(21,"div",11),d(22),u()(),m(23,"div",12)(24,"div",13),d(25,"\u5206\u6578"),u(),m(26,"div",11),d(27),u()(),m(28,"div",14)(29,"div",15),d(30,"\u79FB\u52D5"),u(),m(31,"div",11),d(32),u()(),m(33,"div",16)(34,"div",17),d(35,"\u5269\u9918"),u(),m(36,"div",11),d(37),u()(),m(38,"div",18)(39,"div",19),d(40,"\u5DF2\u9078"),u(),m(41,"div",20),C(42,Pe,2,0)(43,Me,2,0,"span",21),u()(),m(44,"div",22),I(45,"div",23),m(46,"span",24),d(47),u()()()()(),m(48,"main",25)(49,"div",26)(50,"div",27),L(51,Ce,2,0,null,null,Y),u(),C(53,Ie,3,0,"div",28),m(54,"app-modal",29),M("close",function(){return t.resetGame()}),I(55,"div",30),m(56,"h2",31),d(57),u(),m(58,"div",32)(59,"div"),d(60,"\u7E3D\u5206\u6578"),u(),m(61,"div",33),d(62),u()(),m(63,"button",34),M("click",function(){return t.resetGame()}),d(64," \u91CD\u65B0\u958B\u59CB "),u()(),m(65,"app-modal",29),M("close",function(){return t.gameComplete()?t.resetGame():t.nextLevel()}),I(66,"div",30),m(67,"h2",31),d(68),u(),C(69,De,24,4,"div",35)(70,Ge,16,3),m(71,"button",34),M("click",function(){return t.gameComplete()?t.resetGame():t.nextLevel()}),d(72),u()()()()()),i&2&&(c(2),P("gameRules",t.gameRules),c(2),E(t.gameOver()?4:5),c(2),b(t.canUseShuffle()?"bg-zinc-800 border-zinc-600 text-lime-200 hover:bg-zinc-700 focus:ring-lime-300":"bg-zinc-800 border-zinc-600 text-zinc-400 opacity-50"),P("title",j("\u91CD\u65B0\u6D17\u724C\u6240\u6709\u65B9\u584A (\u5269\u9918: ",t.remainingShuffles(),")"))("disabled",!t.canUseShuffle()),c(3),U("",t.totalShufflesUsed(),"/",t.maxShufflesPerGame()),c(2),b(t.canUseHint()?"bg-emerald-700 border-emerald-500 text-emerald-50 hover:bg-emerald-600 focus:ring-emerald-300":"bg-zinc-800 border-zinc-600 text-zinc-400 opacity-50"),P("title",j("\u986F\u793A\u4E00\u500B\u53EF\u914D\u5C0D\u7684\u63D0\u793A (\u5269\u9918: ",t.remainingHints(),")"))("disabled",!t.canUseHint()),c(3),U("",t.totalHintsUsed(),"/",t.maxHintsPerGame()),c(8),S(t.level()),c(5),S(t.score()),c(5),S(t.moves()),c(5),S(t.remainingTiles()),c(5),E(t.selectedTiles.length>0?42:43),c(3),b(t.timelineColorClass()),te("width",t.timelinePercentage(),"%"),c(),b(t.timelineTextClass()),c(),U(" ",t.formattedTime()," / ",t.formattedCountdown()," "),c(3),P("ngStyle",ie(60,ve,"repeat("+t.gameState().width+", 48px")),c(),A(t.board()),c(2),E(t.showingPath?53:-1),c(),P("isOpen",t.gameOver())("theme",t.timeUp()?"red":"orange")("showCloseButton",!1)("closeOnBackdrop",!1),c(),P("innerHTML",t.timeUp()?"\u23F0":"\u{1F635}",$),c(),b(t.timeUp()?"text-red-100":"text-orange-100"),c(),D(" ",t.timeUp()?"\u6642\u9593\u5230\u4E86\uFF01":"\u904A\u6232\u7D50\u675F"," "),c(),b(t.timeUp()?"bg-red-700/50":"bg-orange-700/50"),c(),b(t.timeUp()?"text-red-200":"text-orange-200"),c(2),b(t.timeUp()?"text-red-100":"text-orange-100"),c(),D(" ",t.score()," "),c(),b(t.timeUp()?"bg-red-500 hover:bg-red-400 text-red-900":"bg-orange-500 hover:bg-orange-400 text-orange-900"),c(2),P("isOpen",t.levelComplete())("theme",t.gameComplete()?"yellow":"green")("showCloseButton",!1)("closeOnBackdrop",!1),c(),P("innerHTML",t.gameComplete()?"\u{1F3C6}":"\u{1F389}",$),c(),b(t.gameComplete()?"text-yellow-100":"text-green-100"),c(),D(" ",t.gameComplete()?"\u606D\u559C\u4F60\u5168\u90E8\u7834\u95DC\uFF01":"\u95DC\u5361 "+t.level()+" \u5B8C\u6210\uFF01"," "),c(),E(t.gameComplete()?69:70),c(2),b(t.gameComplete()?"bg-yellow-400 hover:bg-yellow-300 text-yellow-900":"bg-green-500 hover:bg-green-400 text-green-900"),c(),D(" ",t.gameComplete()?"\u91CD\u65B0\u6311\u6230":"\u4E0B\u4E00\u95DC \u2192"," "))},dependencies:[oe,ne,le,ae,re],encapsulation:2})};export{he as PetMatch};
